<!doctype html>
<html itemscope itemtype="http://schema.org/WebPage" lang="ru" class="no-js">
  <head><script src="/livereload.js?mindelay=10&amp;v=2&amp;port=1313&amp;path=livereload" data-no-instant defer></script>
    <meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link rel="canonical" type="text/html" href="http://localhost:1313/ru/docs/">
<link rel="alternate" type="application/rss&#43;xml" href="http://localhost:1313/ru/docs/index.xml">
<meta name="robots" content="noindex, nofollow">


<link rel="shortcut icon" href="/favicons/favicon.ico" >
<link rel="apple-touch-icon" href="/favicons/apple-touch-icon-180x180.png" sizes="180x180">
<link rel="icon" type="image/png" href="/favicons/favicon-16x16.png" sizes="16x16">
<link rel="icon" type="image/png" href="/favicons/favicon-32x32.png" sizes="32x32">
<link rel="icon" type="image/png" href="/favicons/android-36x36.png" sizes="36x36">
<link rel="icon" type="image/png" href="/favicons/android-48x48.png" sizes="48x48">
<link rel="icon" type="image/png" href="/favicons/android-72x72.png" sizes="72x72">
<link rel="icon" type="image/png" href="/favicons/android-96x96.png" sizes="96x96">
<link rel="icon" type="image/png" href="/favicons/android-144x144.png" sizes="144x144">
<link rel="icon" type="image/png" href="/favicons/android-192x192.png" sizes="192x192">

<title>Документация | NewLang</title>
<meta name="description" content="NewLang сайт">
<meta property="og:title" content="Документация" />
<meta property="og:description" content="NewLang сайт" />
<meta property="og:type" content="website" />
<meta property="og:url" content="http://localhost:1313/ru/docs/" /><meta property="og:site_name" content="NewLang" />
<meta itemprop="name" content="Документация">
<meta itemprop="description" content="NewLang сайт"><meta name="twitter:card" content="summary"/><meta name="twitter:title" content="Документация"/>
<meta name="twitter:description" content="NewLang сайт"/>





<link href="/scss/main.css" rel="stylesheet">

<script
  src="https://code.jquery.com/jquery-3.6.3.min.js"
  integrity="sha512-STof4xm1wgkfm7heWqFJVn58Hm3EtS31XFaagaa8VMReCXAkQnJZ+jEy8PCC/iT18dFy95WcExNHFTqLyp72eQ=="
  crossorigin="anonymous"></script>
<script defer
  src="https://unpkg.com/lunr@2.3.9/lunr.min.js"
  integrity="sha384-203J0SNzyqHby3iU6hzvzltrWi/M41wOP5Gu+BiJMz5nwKykbkUx8Kp7iti0Lpli"
  crossorigin="anonymous"></script>

  </head>
  <body class="td-section">
    <header>
      <nav class="td-navbar navbar-dark js-navbar-scroll">
<div class="container-fluid flex-column flex-md-row">
  <a class="navbar-brand" href="/ru/"><span class="navbar-brand__logo navbar-logo"><svg id="Layer_1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewBox="0 0 500 500" style="enable-background:new 0 0 500 500"><g><path style="fill:#fff" d="M116.8525 421.9722c-5.7041.0-10.3442-4.3127-10.3442-9.6129V88.183c0-5.3002 4.6401-9.6117 10.3442-9.6117H320.858c3.0347.0 9.3959.5498 11.7506 2.6302l.3545.3442 58.905 63.2912c2.3101 2.491 2.9202 8.4928 2.9202 11.3184v256.2039c0 5.3002-4.6407 9.6129-10.3436 9.6129H116.8525z"/><g><g><g><path style="fill:#767676" d="M384.4445 423.2066H116.852c-6.3839.0-11.5786-4.8658-11.5786-10.8474V88.1831c0-5.9804 5.1947-10.8461 11.5786-10.8461h204.0062c.377.0 9.2786.0329 12.568 2.9389l.3947.3833 58.9508 63.337c3.2135 3.4652 3.2514 11.7924 3.2514 12.1593v256.2036C396.0231 418.3408 390.8284 423.2066 384.4445 423.2066zM116.5079 411.9189c.0848.0278.1999.0531.3441.0531h267.5925c.1442.0.2581-.0253.3441-.0531V156.1556c-.0076-.9033-.3593-3.7347-.7034-5.0037l-57.6527-61.9416c-1.4651-.3176-4.4533-.6389-5.5742-.6389H116.852c-.143.0-.2594.024-.3441.0531V411.9189zm267.4533-261.149zM327.0321 89.371v.0013V89.371z"/></g></g></g><g><g><path style="fill:#5b7fc0" d="M189.0874 210.1754l.0012-.0012c7.7751.0012 15.0295 4.1862 18.932 10.9234 1.9177 3.3159 2.9305 7.1011 2.9293 10.9378.0 5.8394-2.2733 11.3304-6.4032 15.4604-4.1288 4.1288-9.6186 6.4032-15.458 6.4032s-11.328-2.2733-15.458-6.4032-6.4032-9.6186-6.4056-15.4628c.0012-6.025 2.454-11.4897 6.4116-15.4473C177.5953 212.627 183.0601 210.1742 189.0874 210.1754zm7.993 21.8576c.0012-1.4042-.3687-2.7868-1.063-3.9887-1.4293-2.4684-4.0833-3.9995-6.9299-4.0019-4.4077.0024-7.993 3.5877-7.993 7.993.0 2.1356.832 4.1431 2.3427 5.6539 1.5083 1.5083 3.5159 2.3403 5.6503 2.3415 2.1356.0 4.1443-.8308 5.6539-2.3403S197.0816 234.1722 197.0804 232.033z"/><path style="opacity:.3;fill:#fff" d="M189.0898 210.176c7.7763.0 15.0283 4.1826 18.926 10.9151 1.9201 3.3136 2.9377 7.0988 2.9353 10.9462.0024 12.0643-9.8065 21.8636-21.8613 21.8613-12.0547.0024-21.8636-9.8066-21.8612-21.8613.0-6.0285 2.4516-11.4921 6.4116-15.452C177.5977 212.6276 183.0612 210.176 189.0898 210.176zm7.9941 21.8612c0-1.4078-.3711-2.7892-1.0702-3.9959-1.4269-2.466-4.0797-3.9983-6.924-3.9983-4.4005-.0048-7.9918 3.5817-7.9942 7.9942.0024 4.4077 3.5865 7.9918 7.9942 7.9942 2.2027.0 4.2018-.8978 5.6479-2.3439C196.1861 236.239 197.0839 234.2399 197.0839 232.0372z"/><g><defs><path id="SVGID_1_" d="M194.7376 237.6875c-1.4461 1.4461-3.4452 2.3439-5.6479 2.3439-4.4077-.0024-7.9918-3.5865-7.9942-7.9942.0024-4.4125 3.5937-7.999 7.9942-7.9942 2.8443.0 5.497 1.5323 6.924 3.9983.6991 1.2067 1.0702 2.5881 1.0702 3.9959C197.0839 234.2399 196.1861 236.239 194.7376 237.6875z"/></defs><clipPath id="SVGID_2_"><use xlink:href="#SVGID_1_" style="overflow:visible"/></clipPath><path style="clip-path:url(#SVGID_2_);fill:#fff" d="M190.0704 225.0237c-4.4005-.0048-7.9918 3.5817-7.9942 7.9942.0011 1.9546.7088 3.7452 1.8782 5.1354-1.7447-1.4674-2.8575-3.663-2.8588-6.116.0024-4.4125 3.5936-7.999 7.9942-7.9942 2.3802-1e-4 4.616 1.0833 6.1218 2.8788C193.7885 225.7247 191.9774 225.0237 190.0704 225.0237z"/><path style="opacity:.13;clip-path:url(#SVGID_2_);fill:#020202" d="M190.0704 225.0237c-4.4005-.0048-7.9918 3.5817-7.9942 7.9942.0011 1.9546.7088 3.7452 1.8782 5.1354-1.7447-1.4674-2.8575-3.663-2.8588-6.116.0024-4.4125 3.5936-7.999 7.9942-7.9942 2.3802-1e-4 4.616 1.0833 6.1218 2.8788C193.7885 225.7247 191.9774 225.0237 190.0704 225.0237z"/></g><g><defs><path id="SVGID_3_" d="M189.0898 210.176c7.7763.0 15.0283 4.1826 18.926 10.9151 1.9201 3.3136 2.9377 7.0988 2.9353 10.9462.0024 12.0643-9.8065 21.8636-21.8613 21.8613-12.0547.0024-21.8636-9.8066-21.8612-21.8613.0-6.0285 2.4516-11.4921 6.4116-15.452C177.5977 212.6276 183.0612 210.176 189.0898 210.176zm7.9941 21.8612c0-1.4078-.3711-2.7892-1.0702-3.9959-1.4269-2.466-4.0797-3.9983-6.924-3.9983-4.4005-.0048-7.9918 3.5817-7.9942 7.9942.0024 4.4077 3.5865 7.9918 7.9942 7.9942 2.2027.0 4.2018-.8978 5.6479-2.3439C196.1861 236.239 197.0839 234.2399 197.0839 232.0372z"/></defs><clipPath id="SVGID_4_"><use xlink:href="#SVGID_3_" style="overflow:visible"/></clipPath><path style="clip-path:url(#SVGID_4_);fill:#5b7fc0" d="M172.6595 215.6045c-3.96 3.96-6.4116 9.4235-6.4116 15.452-.0024 12.0547 9.8066 21.8636 21.8613 21.8612 12.0547.0024 21.8636-9.797 21.8613-21.8612.0024-3.8475-1.0151-7.6326-2.9353-10.9462-3.8977-6.7324-11.1497-10.9151-18.926-10.9151C182.0806 209.1953 176.6171 211.647 172.6595 215.6045z"/></g></g><rect x="198.8952" y="225.1043" style="fill:#5b7fc0" width="122.6266" height="13.8671"/></g><g><path style="fill:#d95140" d="M189.0874 155.7611l.0012-.0012c7.7751.0012 15.0295 4.1862 18.932 10.9234 1.9177 3.3159 2.9305 7.1011 2.9293 10.9378.0 5.8394-2.2733 11.3304-6.4032 15.4604-4.1288 4.1288-9.6186 6.4032-15.458 6.4032s-11.328-2.2733-15.458-6.4032-6.4032-9.6186-6.4056-15.4628c.0012-6.0249 2.454-11.4897 6.4116-15.4473C177.5953 158.2128 183.0601 155.7599 189.0874 155.7611zm7.993 21.8577c.0012-1.4042-.3687-2.7868-1.063-3.9887-1.4293-2.4684-4.0833-3.9995-6.9299-4.0019-4.4077.0024-7.993 3.5877-7.993 7.993.0 2.1356.832 4.1431 2.3427 5.6539 1.5083 1.5083 3.5159 2.3403 5.6503 2.3415 2.1356.0 4.1443-.8308 5.6539-2.3403C196.2508 181.7667 197.0816 179.758 197.0804 177.6188z"/><path style="opacity:.3;fill:#fff" d="M189.0898 155.7617c7.7763.0 15.0283 4.1826 18.926 10.9151 1.9201 3.3135 2.9377 7.0987 2.9353 10.9462.0024 12.0643-9.8065 21.8636-21.8613 21.8613-12.0547.0024-21.8636-9.8066-21.8612-21.8613.0-6.0285 2.4516-11.4921 6.4116-15.452C177.5977 158.2134 183.0612 155.7617 189.0898 155.7617zm7.9941 21.8613c0-1.4078-.3711-2.7892-1.0702-3.9959-1.4269-2.466-4.0797-3.9983-6.924-3.9983-4.4005-.0048-7.9918 3.5817-7.9942 7.9942.0024 4.4077 3.5865 7.9918 7.9942 7.9942 2.2027.0 4.2018-.8978 5.6479-2.3439C196.1861 181.8248 197.0839 179.8256 197.0839 177.623z"/><g><defs><path id="SVGID_5_" d="M194.7376 183.2733c-1.4461 1.4461-3.4452 2.3439-5.6479 2.3439-4.4077-.0024-7.9918-3.5865-7.9942-7.9942.0024-4.4125 3.5937-7.9989 7.9942-7.9942 2.8443.0 5.497 1.5323 6.924 3.9983.6991 1.2067 1.0702 2.5881 1.0702 3.9959C197.0839 179.8256 196.1861 181.8248 194.7376 183.2733z"/></defs><clipPath id="SVGID_6_"><use xlink:href="#SVGID_5_" style="overflow:visible"/></clipPath><path style="clip-path:url(#SVGID_6_);fill:#fff" d="M190.0704 170.6095c-4.4005-.0048-7.9918 3.5817-7.9942 7.9942.0011 1.9546.7088 3.7452 1.8782 5.1354-1.7447-1.4674-2.8575-3.663-2.8588-6.116.0024-4.4125 3.5936-7.999 7.9942-7.9942 2.3802-1e-4 4.616 1.0833 6.1218 2.8788C193.7885 171.3104 191.9774 170.6095 190.0704 170.6095z"/><path style="opacity:.13;clip-path:url(#SVGID_6_);fill:#020202" d="M190.0704 170.6095c-4.4005-.0048-7.9918 3.5817-7.9942 7.9942.0011 1.9546.7088 3.7452 1.8782 5.1354-1.7447-1.4674-2.8575-3.663-2.8588-6.116.0024-4.4125 3.5936-7.999 7.9942-7.9942 2.3802-1e-4 4.616 1.0833 6.1218 2.8788C193.7885 171.3104 191.9774 170.6095 190.0704 170.6095z"/></g><g><defs><path id="SVGID_7_" d="M189.0898 155.7617c7.7763.0 15.0283 4.1826 18.926 10.9151 1.9201 3.3135 2.9377 7.0987 2.9353 10.9462.0024 12.0643-9.8065 21.8636-21.8613 21.8613-12.0547.0024-21.8636-9.8066-21.8612-21.8613.0-6.0285 2.4516-11.4921 6.4116-15.452C177.5977 158.2134 183.0612 155.7617 189.0898 155.7617zm7.9941 21.8613c0-1.4078-.3711-2.7892-1.0702-3.9959-1.4269-2.466-4.0797-3.9983-6.924-3.9983-4.4005-.0048-7.9918 3.5817-7.9942 7.9942.0024 4.4077 3.5865 7.9918 7.9942 7.9942 2.2027.0 4.2018-.8978 5.6479-2.3439C196.1861 181.8248 197.0839 179.8256 197.0839 177.623z"/></defs><clipPath id="SVGID_8_"><use xlink:href="#SVGID_7_" style="overflow:visible"/></clipPath><path style="clip-path:url(#SVGID_8_);fill:#d95140" d="M172.6595 161.1903c-3.96 3.96-6.4116 9.4235-6.4116 15.452-.0024 12.0547 9.8066 21.8636 21.8613 21.8613 12.0547.0024 21.8636-9.797 21.8613-21.8613.0024-3.8474-1.0151-7.6326-2.9353-10.9462-3.8977-6.7324-11.1497-10.9151-18.926-10.9151C182.0806 154.7811 176.6171 157.2327 172.6595 161.1903z"/></g><rect x="198.8952" y="170.69" style="fill:#d95140" width="122.6266" height="13.8671"/></g><g><g><path style="fill:#56a55c" d="M189.5379 264.6147l.0012-.0012c7.7751.0012 15.0294 4.1862 18.932 10.9235 1.9177 3.3159 2.9305 7.1011 2.9293 10.9378.0 5.8394-2.2733 11.3304-6.4032 15.4604-4.1288 4.1288-9.6186 6.4032-15.458 6.4032-5.8394.0-11.3281-2.2733-15.458-6.4032-4.13-4.13-6.4032-9.6186-6.4056-15.4628.0012-6.0249 2.454-11.4897 6.4116-15.4472C178.0458 267.0663 183.5105 264.6135 189.5379 264.6147zm7.993 21.8576c.0012-1.4042-.3687-2.7868-1.063-3.9887-1.4293-2.4684-4.0833-3.9995-6.9299-4.0019-4.4077.0024-7.993 3.5877-7.993 7.993.0 2.1356.832 4.1431 2.3427 5.6538 1.5083 1.5083 3.5159 2.3403 5.6503 2.3415 2.1356.0 4.1443-.8308 5.6539-2.3403C196.7013 290.6202 197.5321 288.6115 197.5309 286.4723z"/><path style="opacity:.3;fill:#fff" d="M189.5403 264.6153c7.7763.0 15.0283 4.1826 18.926 10.9151 1.9201 3.3135 2.9377 7.0987 2.9353 10.9462.0024 12.0643-9.8065 21.8636-21.8613 21.8613-12.0547.0024-21.8636-9.8065-21.8612-21.8613.0-6.0285 2.4516-11.492 6.4116-15.452C178.0482 267.0669 183.5117 264.6153 189.5403 264.6153zm7.9941 21.8612c0-1.4078-.3711-2.7892-1.0702-3.9959-1.4269-2.466-4.0797-3.9983-6.924-3.9983-4.4005-.0048-7.9918 3.5817-7.9942 7.9941.0024 4.4077 3.5865 7.9918 7.9942 7.9942 2.2027.0 4.2018-.8978 5.6479-2.3439C196.6366 290.6783 197.5344 288.6792 197.5344 286.4765z"/><g><defs><path id="SVGID_9_" d="M195.1881 292.1268c-1.4461 1.4461-3.4452 2.3439-5.6479 2.3439-4.4077-.0024-7.9918-3.5865-7.9942-7.9942.0024-4.4125 3.5937-7.9989 7.9942-7.9941 2.8443.0 5.497 1.5323 6.924 3.9983.6991 1.2067 1.0702 2.5881 1.0702 3.9959C197.5344 288.6792 196.6366 290.6783 195.1881 292.1268z"/></defs><clipPath id="SVGID_10_"><use xlink:href="#SVGID_9_" style="overflow:visible"/></clipPath><path style="clip-path:url(#SVGID_10_);fill:#fff" d="M190.5209 279.463c-4.4005-.0048-7.9918 3.5817-7.9942 7.9941.0011 1.9547.7088 3.7452 1.8782 5.1354-1.7446-1.4674-2.8575-3.6631-2.8588-6.1161.0024-4.4125 3.5936-7.999 7.9942-7.9941 2.3802-1e-4 4.616 1.0833 6.1218 2.8788C194.239 280.164 192.4279 279.463 190.5209 279.463z"/><path style="opacity:.13;clip-path:url(#SVGID_10_);fill:#020202" d="M190.5209 279.463c-4.4005-.0048-7.9918 3.5817-7.9942 7.9941.0011 1.9547.7088 3.7452 1.8782 5.1354-1.7446-1.4674-2.8575-3.6631-2.8588-6.1161.0024-4.4125 3.5936-7.999 7.9942-7.9941 2.3802-1e-4 4.616 1.0833 6.1218 2.8788C194.239 280.164 192.4279 279.463 190.5209 279.463z"/></g><g><defs><path id="SVGID_11_" d="M189.5403 264.6153c7.7763.0 15.0283 4.1826 18.926 10.9151 1.9201 3.3135 2.9377 7.0987 2.9353 10.9462.0024 12.0643-9.8065 21.8636-21.8613 21.8613-12.0547.0024-21.8636-9.8065-21.8612-21.8613.0-6.0285 2.4516-11.492 6.4116-15.452C178.0482 267.0669 183.5117 264.6153 189.5403 264.6153zm7.9941 21.8612c0-1.4078-.3711-2.7892-1.0702-3.9959-1.4269-2.466-4.0797-3.9983-6.924-3.9983-4.4005-.0048-7.9918 3.5817-7.9942 7.9941.0024 4.4077 3.5865 7.9918 7.9942 7.9942 2.2027.0 4.2018-.8978 5.6479-2.3439C196.6366 290.6783 197.5344 288.6792 197.5344 286.4765z"/></defs><clipPath id="SVGID_12_"><use xlink:href="#SVGID_11_" style="overflow:visible"/></clipPath><path style="clip-path:url(#SVGID_12_);fill:#56a55c" d="M173.11 270.0439c-3.96 3.96-6.4116 9.4235-6.4116 15.452-.0024 12.0547 9.8066 21.8636 21.8613 21.8613 12.0547.0024 21.8636-9.797 21.8613-21.8613.0024-3.8474-1.0151-7.6326-2.9353-10.9462-3.8977-6.7325-11.1497-10.9151-18.926-10.9151C182.5311 263.6346 177.0676 266.0863 173.11 270.0439z"/></g></g><rect x="199.3456" y="279.5436" style="fill:#56a55c" width="122.6266" height="13.8671"/></g><g><g><path style="fill:#f1bc42" d="M189.0874 318.7208l.0012-.0012c7.7751.0012 15.0295 4.1862 18.932 10.9234 1.9177 3.3159 2.9305 7.1011 2.9293 10.9378.0 5.8394-2.2733 11.3305-6.4032 15.4604-4.1288 4.1288-9.6186 6.4032-15.458 6.4032s-11.328-2.2733-15.458-6.4032-6.4032-9.6186-6.4056-15.4628c.0012-6.025 2.454-11.4897 6.4116-15.4472C177.5953 321.1724 183.0601 318.7196 189.0874 318.7208zm7.993 21.8576c.0012-1.4042-.3687-2.7868-1.063-3.9887-1.4293-2.4684-4.0833-3.9995-6.9299-4.0019-4.4077.0024-7.993 3.5877-7.993 7.993.0 2.1356.832 4.1431 2.3427 5.6539 1.5083 1.5083 3.5159 2.3403 5.6503 2.3415 2.1356.0 4.1443-.8308 5.6539-2.3403S197.0816 342.7176 197.0804 340.5784z"/><path style="opacity:.3;fill:#fff" d="M189.0898 318.7214c7.7763.0 15.0283 4.1826 18.926 10.915 1.9201 3.3136 2.9377 7.0988 2.9353 10.9462.0024 12.0643-9.8065 21.8636-21.8613 21.8612-12.0547.0024-21.8636-9.8065-21.8612-21.8612.0-6.0285 2.4516-11.4921 6.4116-15.452C177.5977 321.173 183.0612 318.7214 189.0898 318.7214zm7.9941 21.8612c0-1.4078-.3711-2.7892-1.0702-3.9959-1.4269-2.466-4.0797-3.9983-6.924-3.9983-4.4005-.0048-7.9918 3.5817-7.9942 7.9942.0024 4.4077 3.5865 7.9918 7.9942 7.9942 2.2027.0 4.2018-.8978 5.6479-2.3439C196.1861 344.7844 197.0839 342.7853 197.0839 340.5826z"/><g><defs><path id="SVGID_13_" d="M194.7376 346.2329c-1.4461 1.4461-3.4452 2.3439-5.6479 2.3439-4.4077-.0024-7.9918-3.5865-7.9942-7.9942.0024-4.4125 3.5937-7.999 7.9942-7.9942 2.8443.0 5.497 1.5323 6.924 3.9983.6991 1.2067 1.0702 2.5881 1.0702 3.9959C197.0839 342.7853 196.1861 344.7844 194.7376 346.2329z"/></defs><clipPath id="SVGID_14_"><use xlink:href="#SVGID_13_" style="overflow:visible"/></clipPath><path style="clip-path:url(#SVGID_14_);fill:#fff" d="M190.0704 333.5691c-4.4005-.0048-7.9918 3.5817-7.9942 7.9942.0011 1.9547.7088 3.7452 1.8782 5.1354-1.7447-1.4674-2.8575-3.6631-2.8588-6.1161.0024-4.4125 3.5936-7.999 7.9942-7.9942 2.3802-1e-4 4.616 1.0834 6.1218 2.8788C193.7885 334.2701 191.9774 333.5691 190.0704 333.5691z"/><path style="opacity:.13;clip-path:url(#SVGID_14_);fill:#020202" d="M190.0704 333.5691c-4.4005-.0048-7.9918 3.5817-7.9942 7.9942.0011 1.9547.7088 3.7452 1.8782 5.1354-1.7447-1.4674-2.8575-3.6631-2.8588-6.1161.0024-4.4125 3.5936-7.999 7.9942-7.9942 2.3802-1e-4 4.616 1.0834 6.1218 2.8788C193.7885 334.2701 191.9774 333.5691 190.0704 333.5691z"/></g><g><defs><path id="SVGID_15_" d="M189.0898 318.7214c7.7763.0 15.0283 4.1826 18.926 10.915 1.9201 3.3136 2.9377 7.0988 2.9353 10.9462.0024 12.0643-9.8065 21.8636-21.8613 21.8612-12.0547.0024-21.8636-9.8065-21.8612-21.8612.0-6.0285 2.4516-11.4921 6.4116-15.452C177.5977 321.173 183.0612 318.7214 189.0898 318.7214zm7.9941 21.8612c0-1.4078-.3711-2.7892-1.0702-3.9959-1.4269-2.466-4.0797-3.9983-6.924-3.9983-4.4005-.0048-7.9918 3.5817-7.9942 7.9942.0024 4.4077 3.5865 7.9918 7.9942 7.9942 2.2027.0 4.2018-.8978 5.6479-2.3439C196.1861 344.7844 197.0839 342.7853 197.0839 340.5826z"/></defs><clipPath id="SVGID_16_"><use xlink:href="#SVGID_15_" style="overflow:visible"/></clipPath><path style="clip-path:url(#SVGID_16_);fill:#f1bc42" d="M172.6595 324.15c-3.96 3.96-6.4116 9.4235-6.4116 15.452-.0024 12.0547 9.8066 21.8636 21.8613 21.8612 12.0547.0024 21.8636-9.797 21.8613-21.8612.0024-3.8474-1.0151-7.6327-2.9353-10.9462-3.8977-6.7324-11.1497-10.9151-18.926-10.9151C182.0806 317.7407 176.6171 320.1924 172.6595 324.15z"/></g></g><rect x="198.8952" y="333.6497" style="fill:#f1bc42" width="122.6266" height="13.8671"/></g></g></svg></span><span class="navbar-brand__name">NewLang</span></a>
  <div class="td-navbar-nav-scroll ms-md-auto" id="main_navbar">
    <ul class="navbar-nav">
      <li class="nav-item">
        <a class="nav-link active" href="/ru/docs/"><span>Документация</span></a>
      </li>
      <li class="nav-item">
        <a class="nav-link" href="/ru/playground/"><span>Playground</span></a>
      </li>
      <li class="nav-item">
        <a class="nav-link" href="/ru/blog/"><span>Статьи</span></a>
      </li>
      <li class="nav-item dropdown d-none d-lg-block">
        <div class="dropdown">
  <a class="nav-link dropdown-toggle" href="#" role="button" data-bs-toggle="dropdown" aria-haspopup="true" aria-expanded="false">Русский</a>
  <ul class="dropdown-menu">
    <li><a class="dropdown-item" href="/docs/">English</a></li>
    </ul>
</div></li>
      </ul>
  </div>
  <div class="d-none d-lg-block">
    <div class="td-search td-search--offline">
  <div class="td-search__icon"></div>
  <input
    type="search"
    class="td-search__input form-control"
    placeholder="Поиск по сайту…"
    aria-label="Поиск по сайту…"
    autocomplete="off"
    
    data-offline-search-index-json-src="/offline-search-index.json"
    data-offline-search-base-href="/"
    data-offline-search-max-results="10"
  >
</div>
  </div>
</div>
</nav>
    </header>
    <div class="container-fluid td-outer">
      <div class="td-main">
        <div class="row flex-xl-nowrap">
          <main class="col-12 col-md-9 col-xl-8 ps-md-5" role="main">
            




<div class="td-content">
<div class="pageinfo pageinfo-primary d-print-none">
<p>
Это многостраничный печатный вид этого раздела.
<a href="#" onclick="print();return false;">Нажмите что бы печатать</a>.
</p><p>
<a href="/ru/docs/">Вернуться к обычному просмотру страницы</a>.
</p>
</div>



<h1 class="title">Документация</h1>





    <ul>
    
  
  
  
  

  
    
    
	
<li>1: <a href="#pg-b5bb7377324fcfd7c83c1943bfd4e128">Синтаксис</a></li>


    
    <ul>
        
  
  
  
  

  
    
    
	
<li>1.1: <a href="#pg-28b53fb8430486ae7623f0a46251832e">Именование объектов</a></li>


    
  
    
    
	
<li>1.2: <a href="#pg-7103b60f94e6f8172c82283ae1f5f9e1">Пространства имен</a></li>


    
  
    
    
	
<li>1.3: <a href="#pg-ebc0228877bb5abed843b18c065dff3e">Модули и пакеты</a></li>


    
  
    
    
	
<li>1.4: <a href="#pg-bf03637ca5c035c764a5caee70b93410">Управление памятью, ссылки и совместный доступ</a></li>


    
  
    
    
	
<li>1.5: <a href="#pg-66431dc9242fce562d24bb69bdc576f3">Макросы</a></li>


    
  
    
    
	
<li>1.6: <a href="#pg-9149371511f94b03074b553a8e82848c">Системные свойства</a></li>


    
  
    
    
	
<li>1.7: <a href="#pg-04c6f8255aa249b1ff534ba0a3c6ed5f">Опции и настройки компилятора</a></li>


    
  
    
    
	
<li>1.8: <a href="#pg-8e386bb5b373d09fe8bcbec82c31b73f">Keyword syntax (DSL)</a></li>


    
  

    </ul>
    
  
    
    
	
<li>2: <a href="#pg-f887817d3f8d4d916ca9f49d5a5cd651">Типы данных</a></li>


    
    <ul>
        
  
  
  
  

  
    
    
	
<li>2.1: <a href="#pg-285f8fb6ac5a1e49e354b7f2805d8d62">Иерархия типов и обобщения</a></li>


    
  
    
    
	
<li>2.2: <a href="#pg-2e71da5909e299fdc169437e317fcce8">Числа</a></li>


    
  
    
    
	
<li>2.3: <a href="#pg-bbcf432d9aabb22fcdf6bdad4d9e0141">Символьные строки</a></li>


    
  
    
    
	
<li>2.4: <a href="#pg-5ac59b818595ba90474e2331217a70e7">Словари</a></li>


    
  
    
    
	
<li>2.5: <a href="#pg-87e458c39073ef9693aae0a127efd7d4">Классы</a></li>


    
  
    
    
	
<li>2.6: <a href="#pg-ea2890614128a399adc17f3dd15e0474">Функции</a></li>


    
  
    
    
	
<li>2.7: <a href="#pg-4bc5f061692b860fd28bbd359babdf2c">Итераторы</a></li>


    
  
    
    
	
<li>2.8: <a href="#pg-55daef0bebbb47d29e197c70931395ea">Другие типы данных</a></li>


    
  
    
    
	
<li>2.9: <a href="#pg-cf08b42ee4f3746e6fd20919aa6660c8">Нативные типы</a></li>


    
  
    
    
	
<li>2.10: <a href="#pg-d0d4eee95920a518c7da7c14c155a4d6">Преобразование типов</a></li>


    
  

    </ul>
    
  
    
    
	
<li>3: <a href="#pg-3ecbe9dca2bf163ce61c9f6a7bbee31a">Операторы и управляющие конструкции</a></li>


    
    <ul>
        
  
  
  
  

  
    
    
	
<li>3.1: <a href="#pg-4b708f286c358df8314115b9ab6f3495">Создание объектов</a></li>


    
  
    
    
	
<li>3.2: <a href="#pg-f89914599a84d0afcac7c4658db62778">Блоки кода</a></li>


    
  
    
    
	
<li>3.3: <a href="#pg-d3e59c3a58123ba89df95ba6f3f2e4c2">Математические операторы</a></li>


    
  
    
    
	
<li>3.4: <a href="#pg-4c5f23e30e3baaec755b982700349e58">Операторы сравнения и типизация</a></li>


    
  
    
    
	
<li>3.5: <a href="#pg-baeb4815377e55e87e33ba78dbb8d2b1">Условный оператор</a></li>


    
  
    
    
	
<li>3.6: <a href="#pg-7257e6b33d78b199fd60804216e19236">Оценка выражения</a></li>


    
  
    
    
	
<li>3.7: <a href="#pg-3dc86b17aec2b74ca5a44690abb43951">Операторы циклов</a></li>


    
  
    
    
	
<li>3.8: <a href="#pg-bd50d502b62e28893b4b0c4746f52c78">Менеджер контекста</a></li>


    
  
    
    
	
<li>3.9: <a href="#pg-d59803d976382d82f70daf58daf9ac0c">Ввозврат, прерывания и обработка ошибок</a></li>


    
  

    </ul>
    
  
    
    
	
<li>4: <a href="#pg-1777268c8246a0a796e4cb0a4fdf4c15">Архитектура</a></li>


    
    <ul>
        
  
  
  
  

  
    
    
	
<li>4.1: <a href="#pg-e9bfdeb90c430707fc05933872503964">Внутреннее имя и манглинг имен</a></li>


    
  
    
    
	
<li>4.2: <a href="#pg-0edf501a32548420dc5a47b09522d47e">Реализация прерываний и обработки ошибок</a></li>


    
  
    
    
	
<li>4.3: <a href="#pg-89138bfdfd307537b9369eef3039a6ea">Реализация JIT</a></li>


    
  
    
    
	
<li>4.4: <a href="#pg-3a4d642619eb08f47874dbcc8c207079">Области видимости</a></li>


    
  

    </ul>
    
  

    </ul>


<div class="content">
      <p>Основные материалы по языку программирования NewLang.</p>
<p>Описание акутально для текущей версии 4.0</p>

</div>
</div>


  
  
  
  

  
  

  
    
    
	
    

<div class="td-content" style="">
    
	<h1 id="pg-b5bb7377324fcfd7c83c1943bfd4e128">1 - Синтаксис</h1>
    <div class="lead">Правила синтаксиса и основные понятия языка программирования NewLang</div>
	<ul>
<li>Операторы разделяются точкой с запятой «;».</li>
<li>Отступы и переводы строк игнорируются.</li>
<li>Однострочные комментарии начинаются с символа «#» до перевода строки, что соответствует комментариям в стиле Python и Bash.</li>
<li>Многострочные комментарии соответствуют стилю С/С++ и должны располагаться между символами /* и */. Многосточные комментарии могут быть вложенными.</li>
<li>Последовательность команд <a href="/ru/docs/ops/block/">(блок кода)</a> заключаются в фигурные скобки &ldquo;<strong>{</strong>&rdquo; и &ldquo;<strong>}</strong>&rdquo;.</li>
<li>Большинство операторов являются выражениями и возвращают результат выполнения последней операции.</li>
</ul>

</div>



    
      
  
  
  
  

  
  

  
    
    
	
    

<div class="td-content" style="page-break-before: always">
    
	<h1 id="pg-28b53fb8430486ae7623f0a46251832e">1.1 - Именование объектов</h1>
    <div class="lead">Правила именования переменных, функций и типов данных</div>
	<p>В качестве имен объектов и типов данных можно использовать буквы, цифры и знаки подчеркивания в любых комбинациях,
при условии, что первый символ имени не является цифрой.</p>
<p>Все идентификаторы должны быть уникальны, а для избежания коллизий можно использовать <a href="/ru/docs/syntax/namespace/">пространство имен</a>
и <a href="/ru/docs/syntax/modules/">модульную структуру кода</a>, которые <em>NewLang</em> поддерживает одновременно.</p>
<p>Перегрузка <a href="/ru/docs/types/funcs/">функций</a> по типам аргументов <em>NewLang</em> отсуствует, поэтому несколько функций с однинаковым именем но разными аругментами определить нельзя,
но можно <a href="/ru/docs/types/funcs/">переопределить функцию</a>, в том числе и расширив типы принимаемых аргументов или увеличив их количество.</p>
<p>Идентификатор объекта может содержать один или несколько специальных символов - квалификаторов
(или <a href="https://en.wikipedia.org/wiki/Sigil_(computer_programming)">сигилов</a>), за которыми закрепелено определенное значение.
Идентификатор объекта который не содержит квалификатора, называется <em>простым</em>:</p>
<h3 id="sigil">Квалификаторы имен:<a class="td-heading-self-link" href="#sigil" aria-label="Heading self-link"></a></h3>
<ul>
<li>&lsquo;<strong>@</strong>&rsquo; — префикс <em>собачка</em> используется для указания имени <a href="/ru/docs/syntax/macros/">макроса</a>,
который обрабатыватся препроцессором до начала синтаксического анализа исходного текста программы.</li>
<li>&lsquo;<strong>$</strong>&rsquo; — знак доллара в начале имени объекта обозначает автоматичекое имя временной переменной,
область памяти для которой выделяется динамически во время выполнения приложения, а время <a href="/ru/docs/syntax/memory/">жизни ограничено семантикой яызка</a></li>
<li>&lsquo;<strong>::</strong>&rsquo; — двойное двоеточие является разделителем <a href="/ru/docs/syntax/namespace/">пространства имен</a>,
и является признаком <em>статического</em> объекта, область памяти для которого выделяется во время компиляции приложения или модуля.
Если имя начинается на &lsquo;<strong>::</strong>&rsquo;, то область видимости объекта будет глобальной и он будет доступен в рамках всего приложения.
В противном случае, видимость объекта будет ограничена только текущим <a href="/ru/docs/syntax/modules/">программным модулем</a>.</li>
<li>&lsquo;<strong>.</strong>&rsquo; — префикс <em>точка</em> используется при обращении к полю модуля или класса (ограничивает область видимости текущим объектом).
Префикс <em>точка</em> может использоваться при определении (вызове) функции для явной идентификации именованного аргумента,
чтобы его нельзя было перекрыть макросом препроцессора.</li>
<li>&lsquo;<strong>\</strong>&rsquo; — <em>обратный слеш</em> в начале термина обозначает имя <a href="/ru/docs/syntax/modules/">программного модуля</a>,
а так же разделяет имена каталогов в иерархии размещения программных модулей.</li>
<li>&lsquo;<strong>:</strong>&rsquo; — двоеточие в начале термина обозначает имя <a href="/ru/docs/types/">типа</a> данных или конструктор <a href="/ru/docs/types/class/">класса</a></li>
<li>&lsquo;<strong>%</strong>&rsquo; — префикс <em>знак процента</em> указывается для <a href="/ru/docs/types/native/">импортируемых символов (нативных переменных и функций)</a></li>
<li>&lsquo;<strong>^</strong>&rsquo; — символ <em>карет</em> (крышечка/домик) после имени используется для придания объекту иммутабельности (константности, не изменяемости).</li>
</ul>
<h3 id="name-lookup">Разрешение имен (name lookup)<a class="td-heading-self-link" href="#name-lookup" aria-label="Heading self-link"></a></h3>
<p>Если имя объекта не содержит <a href="/ru/docs/syntax/naming/#sigil">квалификатора</a>, оно называется <em>простым</em>.
Создание объекта с указанием <em>простого</em> имени равнозначно созданию локального объекта.</p>
<p>В других случаях, когда <em>NewLang</em> встречает <em>простое</em> имя объекта без квалификатора (<a href="https://en.wikipedia.org/wiki/Sigil_(computer_programming)">сигила</a>),
то в дело вструпает специальный алгоритм, который связывает <em>простое</em> имя, встретившееся в исходном тексте программы,
с его декларацией или конкретным объектом по его <a href="/ru/docs/arch/mangling/">внутреннему имени</a>.</p>
<p>Разрешение <em>простых</em> имен <em>без квалификатора</em> (<em>name lookup</em>, или поиск имени функции/переменной) происходит всегда в строго определенном порядке:</p>
<ul>
<li>в первую очередь происходит поиск имени среди макросов</li>
<li>далее выполняется поиск имени среди локальных объектов до объектов текущего модуля</li>
<li>в последнюю очередь выполняется поиск среди глобальных объетов с постепенным расширением пространства имен области поиска от текущей до глобальной</li>
</ul>
<p>Такая последовательность разрешение имен всегда предоставляет возможность переопределить
глобальные/локальные объекты или имена аргументов у функций для уже существующего кода без его серъезных изменений.</p>
<p>Например, для имени <code>name</code> в области имен <strong><code>ns</code></strong> поиск происходит в следующей последовательности:
<code>@name</code> -&gt; <code>$name</code> -&gt; <code>ns::name</code> -&gt; <code>::ns::name</code> -&gt; <code>::name</code>,
а для имени <code>arg</code> проверяется только <code>@arg</code>:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span>    <span style="color:#000">ns</span><span style="color:#000;font-weight:bold">::</span> <span style="color:#000;font-weight:bold">{</span>
</span></span><span style="display:flex;"><span>        <span style="color:#000">name</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">arg</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#4e9a06">&#34;value&#34;</span><span style="color:#000;font-weight:bold">);</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">};</span>
</span></span></code></pre></div><p>И в тоже время, всегда остатся возможность указать конкретный объект не зависимо от работы алгоритма разрешение <em>простых</em> имен.
Достаточно указать квалификатор в имени объекта в явном виде.</p>
<p>Например, обратиться к глобальному объекту <strong>name</strong> из пространства имен <strong>ns</strong> из примера выше, нужно по полному имени объекта <code>::ns::name</code>,
а именованнй аргумент <em>&rsquo;<strong>.</strong> arg&rsquo;</em> не будет заменен макросом <code>@arg</code>, если такой будет определен:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">::</span><span style="color:#000">ns</span><span style="color:#000;font-weight:bold">::</span><span style="color:#000">name</span><span style="color:#000;font-weight:bold">(</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">arg</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#4e9a06">&#34;value&#34;</span><span style="color:#000;font-weight:bold">);</span>
</span></span></code></pre></div><h3 id="using">Расширение поиска простанства имен<a class="td-heading-self-link" href="#using" aria-label="Heading self-link"></a></h3>
<p>Для указания нескольких областей имен для расширенного поиска при разрешение <em>простых</em> имен <em>без квалификатора</em>,
используется синтаксическая конструкция <code>... = ns::name, ns::name2;</code> или <code>@using(ns::name, ns::name2);</code> с использованием DSL.</p>
<p>Поиск в перечисленных областях имен произволится в порядке их указания до конца текущего модуля или до следущего
оператора расширенного поиска или до <code>... = _;</code>, который расширенный поиск в пространствах имен отменяет.</p>
<h3 id="forward-declaration">Предварительное объявление<a class="td-heading-self-link" href="#forward-declaration" aria-label="Heading self-link"></a></h3>
<p>В тексте программы можно ссылаться только на реально существующие (созданные) объекты.
Но для тех случаев, когда требуется сослаться на объект, который создан в другом модуле или будет создан позже,
можно сделать предварительное объявление, при котором компилятор регистриурет имя и тип объекта без его реального создания.</p>
<p>За счет предварительного объявления можно ссылаться только на статические объекты (типы данных),
или локальные поля класса о которых компилятор ещё не знает, но которые будут определены в процессе компиляции позже.</p>
<p>Для предварительного объявления можно использовать только полное квалифцированное имя,
которое должно будет в точности совпадать с именем обекта при его последующем создании.</p>
<p>Для предварительного объявления используется точто такой же синтаксис, как и при реальном <a href="/ru/docs/ops/create/">создании</a> объекта,
только с права от операторо создания должно быть указано многоточие.</p>
<p>Область видимости предварительное объявения соответствует области видимости его размещенея,
а не реальвой области видимости объекта (это касается даже глобальных объектов).</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#8f5902;font-style:italic"># Предварительное определение переменной модуля</span>
</span></span><span style="display:flex;"><span>    <span style="color:#8f5902;font-style:italic"># Действует для всего модуля</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000">var_module</span><span style="color:#000;font-weight:bold">:</span><span style="color:#000">Int32</span> <span style="color:#ce5c00;font-weight:bold">:=</span> <span style="color:#ce5c00;font-weight:bold">...</span><span style="color:#000;font-weight:bold">;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#000">func</span><span style="color:#000;font-weight:bold">()</span> <span style="color:#000;font-weight:bold">:</span><span style="color:#ce5c00;font-weight:bold">:=</span> <span style="color:#000;font-weight:bold">{</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#8f5902;font-style:italic"># Предварительное объявление с помощью DSL</span>
</span></span><span style="display:flex;"><span>        <span style="color:#8f5902;font-style:italic"># (действует только внутри тела функции)</span>
</span></span><span style="display:flex;"><span>        <span style="color:#5c35cc;font-weight:bold">@declare</span><span style="color:#000;font-weight:bold">(</span> <span style="color:#000">func2</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">arg</span><span style="color:#000;font-weight:bold">:</span><span style="color:#000">Int32</span><span style="color:#000;font-weight:bold">):</span><span style="color:#000">Int32</span> <span style="color:#000;font-weight:bold">);</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#000">var_module</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">func2</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">var_module</span><span style="color:#000;font-weight:bold">);</span>
</span></span><span style="display:flex;"><span>        <span style="color:#5c35cc;font-weight:bold">@return</span> <span style="color:#000">var_module</span><span style="color:#000;font-weight:bold">;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">};</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#000">func2</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">arg</span><span style="color:#000;font-weight:bold">:</span><span style="color:#000">Int32</span><span style="color:#000;font-weight:bold">):</span><span style="color:#000">Int32</span> <span style="color:#000;font-weight:bold">:</span><span style="color:#ce5c00;font-weight:bold">:=</span> <span style="color:#000;font-weight:bold">{</span>
</span></span><span style="display:flex;"><span>        <span style="color:#5c35cc;font-weight:bold">@return</span> <span style="color:#a40000">$</span><span style="color:#000">arg</span><span style="color:#ce5c00;font-weight:bold">*</span><span style="color:#a40000">$</span><span style="color:#000">arg</span><span style="color:#000;font-weight:bold">;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">}</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#000">var_module</span><span style="color:#000;font-weight:bold">:</span><span style="color:#000">Int32</span> <span style="color:#ce5c00;font-weight:bold">:=</span> <span style="color:#0000cf;font-weight:bold">1</span><span style="color:#000;font-weight:bold">;</span>
</span></span></code></pre></div><h3 id="args">Имена аргументов, специальные, системные имена<a class="td-heading-self-link" href="#args" aria-label="Heading self-link"></a></h3>
<p>Обозначение имен аргументов у функций очень похоже на обращение к аргументы в bash скриптах,
где &ldquo;<strong>$1</strong>&rdquo; или &ldquo;<strong>$name</strong>&rdquo; — порядковый номер или имя соответствующего аргумента.</p>
<p>Зарезервированное имя &ldquo;<strong>$0</strong>&rdquo; обозначает текущий объект, а именем &ldquo;<strong>$$</strong>&rdquo; обозначается родительский объект.</p>
<p>Все аргументы функции собранны в одном словаре со специальным имеенм <strong>$*</strong></p>
<p>Неизменяемая переменная &ldquo;<strong>$^</strong>&rdquo; содержит результат выполнения последнего оператора или блока кода.</p>
<p>Полное имя текущего модуля содержится в переменной <strong>@\\</strong>, а текущая область имен в переменной <strong>@::</strong>, т.е.:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic"># Имя файла filename.src в каталоге dir</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>ns:: <span style="color:#ce5c00;font-weight:bold">{</span> <span style="color:#8f5902;font-style:italic"># Использовать пространство имен ns</span>
</span></span><span style="display:flex;"><span>    name:: <span style="color:#ce5c00;font-weight:bold">{</span>
</span></span><span style="display:flex;"><span>        <span style="color:#8f5902;font-style:italic"># Команда препроцессора &#34;@#&#34; - преобразовать в символьную строку</span>
</span></span><span style="display:flex;"><span>        ns_str :<span style="color:#ce5c00;font-weight:bold">=</span>  @#  @::<span style="color:#000;font-weight:bold">;</span> <span style="color:#8f5902;font-style:italic"># Строка с областью имен &#34;::ns::name::&#34;</span>
</span></span><span style="display:flex;"><span>        mod_str :<span style="color:#ce5c00;font-weight:bold">=</span>  @#  @<span style="color:#4e9a06">\\</span><span style="color:#000;font-weight:bold">;</span> <span style="color:#8f5902;font-style:italic"># Строка с именем модуля &#34;\\dir\filename&#34;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#ce5c00;font-weight:bold">}</span><span style="color:#000;font-weight:bold">;</span>
</span></span><span style="display:flex;"><span><span style="color:#ce5c00;font-weight:bold">}</span><span style="color:#000;font-weight:bold">;</span>
</span></span></code></pre></div><h3 id="константы-неизменяемые-объекты">Константы (неизменяемые объекты)<a class="td-heading-self-link" href="#%d0%ba%d0%be%d0%bd%d1%81%d1%82%d0%b0%d0%bd%d1%82%d1%8b-%d0%bd%d0%b5%d0%b8%d0%b7%d0%bc%d0%b5%d0%bd%d1%8f%d0%b5%d0%bc%d1%8b%d0%b5-%d0%be%d0%b1%d1%8a%d0%b5%d0%ba%d1%82%d1%8b" aria-label="Heading self-link"></a></h3>
<h4 id="constexpr">constexpr<a class="td-heading-self-link" href="#constexpr" aria-label="Heading self-link"></a></h4>
<blockquote>
<p>constexpr позволяет определить переменные или функции таким образом, что их значение или результат может быть вычислен на этапе компиляции.
Т.е можно проводить вычисления до того, как код будет исполнен, и тем самым сэкономить драгоценные циклы процессора в рантайме.</p>
<p>Но не все так радужно. constexpr имеет свои ограничения. Например, нельзя использовать его с динамическим выделением памяти.
Так что если нужно создать constexpr вектор, который динамически изменяется во время компиляции - не выйдет.</p>
</blockquote>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span>    <span style="color:#000">square</span><span style="color:#ce5c00;font-weight:bold">^</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">arg</span><span style="color:#000;font-weight:bold">)</span> <span style="color:#ce5c00;font-weight:bold">:=</span> <span style="color:#000;font-weight:bold">{</span><span style="color:#a40000">$</span><span style="color:#000">arg</span> <span style="color:#ce5c00;font-weight:bold">*</span> <span style="color:#a40000">$</span><span style="color:#000">arg</span><span style="color:#000;font-weight:bold">};</span> <span style="color:#8f5902;font-style:italic"># Во время компиляции</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000">cube</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">arg</span><span style="color:#000;font-weight:bold">)</span> <span style="color:#000;font-weight:bold">:</span><span style="color:#ce5c00;font-weight:bold">-</span> <span style="color:#000;font-weight:bold">{</span><span style="color:#a40000">$</span><span style="color:#000">arg</span> <span style="color:#ce5c00;font-weight:bold">*</span> <span style="color:#a40000">$</span><span style="color:#000">arg</span> <span style="color:#ce5c00;font-weight:bold">*</span> <span style="color:#a40000">$</span><span style="color:#000">arg</span><span style="color:#000;font-weight:bold">};</span>  <span style="color:#8f5902;font-style:italic"># Чистая функция</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000">func</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">arg</span><span style="color:#000;font-weight:bold">)</span> <span style="color:#ce5c00;font-weight:bold">:=</span> <span style="color:#000;font-weight:bold">{</span><span style="color:#000">cube</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">arg</span><span style="color:#000;font-weight:bold">)</span> <span style="color:#ce5c00;font-weight:bold">+</span> <span style="color:#000">square</span><span style="color:#000;font-weight:bold">(</span><span style="color:#a40000">$</span><span style="color:#000">arg</span><span style="color:#000;font-weight:bold">)};</span>  <span style="color:#8f5902;font-style:italic"># Обычная функция</span>
</span></span></code></pre></div><h4 id="consteval">consteval<a class="td-heading-self-link" href="#consteval" aria-label="Heading self-link"></a></h4>
<blockquote>
<p>Отличие consteval от его братца constexpr в том, что constexpr дает выбор: если что-то можно вычислить на этапе компиляции,
отлично, но если нет — ну что ж, попробуем в рантайме. consteval же стоит на своем: если мы не можем вычислить это здесь и сейчас
(на этапе компиляции), то и в программе это выражение быть не должно.</p>
<p>Это мастхев, когда нужно гарантировать, что определенные вычисления будут выполнены на этапе компиляции,
исключая любую неопределенность и потенциальные накладные расходы в рантайме. consteval приходит на помощь,
когда нужна стопроцентная уверенность в том, что код не будет тратить лишнее время на вычисления в момент выполнения.</p>
</blockquote>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span>    <span style="color:#000">consteval</span><span style="color:#ce5c00;font-weight:bold">^</span> <span style="color:#ce5c00;font-weight:bold">:=</span> <span style="color:#4e9a06">&#34;literal&#34;</span><span style="color:#000;font-weight:bold">;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000">pi</span><span style="color:#ce5c00;font-weight:bold">^</span> <span style="color:#ce5c00;font-weight:bold">:=</span> <span style="color:#0000cf;font-weight:bold">3.141592653589793238462643</span><span style="color:#000;font-weight:bold">;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000">consteval</span><span style="color:#ce5c00;font-weight:bold">^</span> <span style="color:#ce5c00;font-weight:bold">:=</span> <span style="color:#000">square</span><span style="color:#000;font-weight:bold">(</span><span style="color:#0000cf;font-weight:bold">123</span><span style="color:#000;font-weight:bold">);</span> <span style="color:#8f5902;font-style:italic"># Ок</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000">consteval1</span><span style="color:#ce5c00;font-weight:bold">^</span> <span style="color:#ce5c00;font-weight:bold">:=</span> <span style="color:#000">square</span><span style="color:#ce5c00;font-weight:bold">^</span><span style="color:#000;font-weight:bold">(</span><span style="color:#0000cf;font-weight:bold">123</span><span style="color:#000;font-weight:bold">);</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000">consteval2</span><span style="color:#ce5c00;font-weight:bold">^</span> <span style="color:#ce5c00;font-weight:bold">:=</span> <span style="color:#000">cube</span><span style="color:#ce5c00;font-weight:bold">^</span><span style="color:#000;font-weight:bold">(</span><span style="color:#0000cf;font-weight:bold">123</span><span style="color:#000;font-weight:bold">);</span> <span style="color:#8f5902;font-style:italic"># Ok для чистых и constexpr функций</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000">consteval3</span><span style="color:#ce5c00;font-weight:bold">^</span> <span style="color:#ce5c00;font-weight:bold">:=</span> <span style="color:#000">func</span><span style="color:#ce5c00;font-weight:bold">^</span><span style="color:#000;font-weight:bold">(</span><span style="color:#0000cf;font-weight:bold">123</span><span style="color:#000;font-weight:bold">);</span> <span style="color:#8f5902;font-style:italic"># Ошибка !!!!</span>
</span></span></code></pre></div><h4 id="constinit">constinit<a class="td-heading-self-link" href="#constinit" aria-label="Heading self-link"></a></h4>
<blockquote>
<p>В отличие от constexpr, который является своего рода всегда вычисляемым выражением,
и consteval, которое требует вычисления на этапе компиляции без исключений, constinit подходит к делу более гибко.</p>
<p>constinit указывает, что переменная должна быть инициализирована во время старта программы,
до входа в main(). constinit обеспечивает инициализацию статического или потокового хранилища без динамической инициализации.
Говоря простым языком, constinit гарантирует, что переменная будет инициализирована на этапе загрузки программы,
ещё до того, как программа начнет своё выполнение. Отсюда вытекает то, в отличие от constexpr, constinit не требует,
чтобы переменная оставалась неизменной после инициализации.</p>
</blockquote>
<p>Аналог <code>constinit</code>. Присовить незменяемое значение обычной переменой. Но сама переменная в последствии может быть изменена.</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span>    <span style="color:#000">literal1</span> <span style="color:#ce5c00;font-weight:bold">:=</span> <span style="color:#4e9a06">&#34;literal&#34;</span><span style="color:#000;font-weight:bold">;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000">literal2</span> <span style="color:#ce5c00;font-weight:bold">:=</span> <span style="color:#0000cf;font-weight:bold">123</span><span style="color:#000;font-weight:bold">;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000">value</span> <span style="color:#ce5c00;font-weight:bold">:=</span> <span style="color:#000">square</span><span style="color:#000;font-weight:bold">(</span><span style="color:#0000cf;font-weight:bold">123</span><span style="color:#000;font-weight:bold">);</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000">value</span> <span style="color:#ce5c00;font-weight:bold">:=</span> <span style="color:#000">square</span><span style="color:#ce5c00;font-weight:bold">^</span><span style="color:#000;font-weight:bold">(</span><span style="color:#0000cf;font-weight:bold">123</span><span style="color:#000;font-weight:bold">);</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000">value</span> <span style="color:#ce5c00;font-weight:bold">:=</span> <span style="color:#000">cube</span><span style="color:#000;font-weight:bold">(</span><span style="color:#0000cf;font-weight:bold">123</span><span style="color:#000;font-weight:bold">);</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000">value</span> <span style="color:#ce5c00;font-weight:bold">:=</span> <span style="color:#000">cube</span><span style="color:#ce5c00;font-weight:bold">^</span><span style="color:#000;font-weight:bold">(</span><span style="color:#0000cf;font-weight:bold">123</span><span style="color:#000;font-weight:bold">);</span> <span style="color:#8f5902;font-style:italic"># Ок - вычисляется в рантайме</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000">value</span> <span style="color:#ce5c00;font-weight:bold">:=</span> <span style="color:#000">pi</span><span style="color:#000;font-weight:bold">;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000">value</span> <span style="color:#ce5c00;font-weight:bold">:=</span> <span style="color:#000">pi</span><span style="color:#ce5c00;font-weight:bold">^</span><span style="color:#000;font-weight:bold">;</span>
</span></span></code></pre></div>
</div>



    
	
  
    
    
	
    

<div class="td-content" style="page-break-before: always">
    
	<h1 id="pg-7103b60f94e6f8172c82283ae1f5f9e1">1.2 - Пространства имен</h1>
    
	<p><em>NewLang</em> поддерживает пространства имен, разделителем в которых, как и в С++, выступает двойное двоеточие &ldquo;<strong>::</strong>&rdquo;.</p>
<p>Область имен может быть указана как для отдельного индетификатора, так и для целого <a href="/ru/docs/ops/block/">блока кода</a>.</p>
<p>В отличии от <em>namespace</em> в С++, области имен в <em>NewLnag</em> используются не только для организации кода в виде логических групп
и с целью избежания конфликтов имен, но и для отнесения идентификатора, в котором явно указана область имен, к статическим объектам
(память под которые выделяется на этапе комиляции программы).</p>
<p>Глобальное имя не может быть перекрыто макросом или локальной переменной при <a href="/ru/docs/syntax/naming/#name-lookup">разрешении имен (name lookup)</a>.
Создать глобальную (статическую) переменную в текущем пространстве имен можно указав переменную препроцессора <strong>@::</strong>.</p>
<p>Для использования пространства имен в <a href="/ru/docs/ops/block/">блоке кода</a>, его нужно указать перед открывающейся фигурной скобкой.
В таком именованном блоке кода завершающие &ldquo;<strong>::</strong>&rdquo; указывать не обязательно.</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>::var ::<span style="color:#ce5c00;font-weight:bold">=</span> 0<span style="color:#000;font-weight:bold">;</span> <span style="color:#8f5902;font-style:italic"># Имя глобальной переменной в явном виде (не может быть перекрыто) </span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>ns <span style="color:#ce5c00;font-weight:bold">{</span> <span style="color:#8f5902;font-style:italic"># Можно указать равнозначное ns::</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    var ::<span style="color:#ce5c00;font-weight:bold">=</span> 0<span style="color:#000;font-weight:bold">;</span> <span style="color:#8f5902;font-style:italic"># Имя ns::var (может быть перекрыто макросом или локальной переменной)</span>
</span></span><span style="display:flex;"><span>    @::var ::<span style="color:#ce5c00;font-weight:bold">=</span> 0<span style="color:#000;font-weight:bold">;</span> <span style="color:#8f5902;font-style:italic"># Имя глобальной переменной ::ns::var (не может быть перекрыто) </span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    name:: <span style="color:#ce5c00;font-weight:bold">{</span>
</span></span><span style="display:flex;"><span>        <span style="color:#000">var</span> <span style="color:#ce5c00;font-weight:bold">=</span> 0<span style="color:#000;font-weight:bold">;</span> <span style="color:#8f5902;font-style:italic"># Обращение к переменной ns::var</span>
</span></span><span style="display:flex;"><span>        var2 ::<span style="color:#ce5c00;font-weight:bold">=</span> 0<span style="color:#000;font-weight:bold">;</span> <span style="color:#8f5902;font-style:italic"># Имя переменной будет ns::name::var2</span>
</span></span><span style="display:flex;"><span>        ::var <span style="color:#ce5c00;font-weight:bold">=</span> 1<span style="color:#000;font-weight:bold">;</span> <span style="color:#8f5902;font-style:italic"># Переменная из глобального пространства имен</span>
</span></span><span style="display:flex;"><span>    <span style="color:#ce5c00;font-weight:bold">}</span><span style="color:#000;font-weight:bold">;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    :: <span style="color:#ce5c00;font-weight:bold">{</span> <span style="color:#8f5902;font-style:italic"># Глобальное пространство имен</span>
</span></span><span style="display:flex;"><span>        <span style="color:#000">var</span> <span style="color:#ce5c00;font-weight:bold">=</span> 1<span style="color:#000;font-weight:bold">;</span>  <span style="color:#8f5902;font-style:italic"># Имя глобальной переменной ::var (может быть перекрыто) </span>
</span></span><span style="display:flex;"><span>        ::ns::var <span style="color:#ce5c00;font-weight:bold">=</span> 0<span style="color:#000;font-weight:bold">;</span> <span style="color:#8f5902;font-style:italic"># Имя другой глобальной переменной (не может быть перекрыто) </span>
</span></span><span style="display:flex;"><span>    <span style="color:#ce5c00;font-weight:bold">}</span><span style="color:#000;font-weight:bold">;</span>
</span></span><span style="display:flex;"><span><span style="color:#ce5c00;font-weight:bold">}</span><span style="color:#000;font-weight:bold">;</span>
</span></span></code></pre></div><h2 id="пространство-имен-модули-и-пакеты">Пространство имен, модули и пакеты<a class="td-heading-self-link" href="#%d0%bf%d1%80%d0%be%d1%81%d1%82%d1%80%d0%b0%d0%bd%d1%81%d1%82%d0%b2%d0%be-%d0%b8%d0%bc%d0%b5%d0%bd-%d0%bc%d0%be%d0%b4%d1%83%d0%bb%d0%b8-%d0%b8-%d0%bf%d0%b0%d0%ba%d0%b5%d1%82%d1%8b" aria-label="Heading self-link"></a></h2>
<p>Пространство имен в <em>NewLang</em> поддерживает одновременно с <a href="/ru/docs/syntax/modules/">модульной структурой кода</a> как в языках Java и Python
и при указании полного имени объекта, программные модули и пространства имен можно объединять.</p>
<p>Например, полное имя переменой можно записать с указанием программного модуля <code>\root\dir\module::ns::name::var</code>,
где <strong>root</strong> и <strong>dir</strong> это каталоги в файловой системе относительно текущего модуля, а <strong>module</strong> — имя файла, т.е. <em>root/dir/module.nlp</em>.</p>
<h2 id="пространство-имен-и-ооп">Пространство имен и ООП<a class="td-heading-self-link" href="#%d0%bf%d1%80%d0%be%d1%81%d1%82%d1%80%d0%b0%d0%bd%d1%81%d1%82%d0%b2%d0%be-%d0%b8%d0%bc%d0%b5%d0%bd-%d0%b8-%d0%be%d0%be%d0%bf" aria-label="Heading self-link"></a></h2>
<p>В <em>NewLang</em> не применяется декорирование (манглинг) имен, основанный на типах аргументов функций.</p>
<p>Тем не менее при создания уникальных идентификаторов для методов <a href="/ru/docs/types/class/">классов</a> <em>NewLang</em> использует подход, похожий на применяемый в языке Python.
При создании <a href="/ru/docs/types/class/">метода класса</a> создается глобальная функция с именем класса и именем метода, объединенные через разделитель &ldquo;<strong>::</strong>&rdquo;.</p>
<p>Например, для класса <code>:NewClass</code> при создании метода <code>method</code> будет создана функция с именем <code>NewClass::method</code>.</p>
<p>Такая схема наименований методов полностью соответствует именованию функций в пространстве имен,
и тем самым позволяет определять методы класса вне тела самого класса, просто указав нужное имя в пространстве имен или в явном виде.</p>
<p>Пример создания метода класса <em>NewClass</em> в области имен:</p>
<pre tabindex="0"><code>    NewClass::  {
        method() := { };
    }
</code></pre><p>Пример создания метода класса <em>NewClass</em> с указанием полного имени:</p>
<pre tabindex="0"><code>    NewClass::method() := { };
</code></pre>
</div>



    
	
  
    
    
	
    

<div class="td-content" style="page-break-before: always">
    
	<h1 id="pg-ebc0228877bb5abed843b18c065dff3e">1.3 - Модули и пакеты</h1>
    
	<p>В <em>NewLang</em> реализована концепция программных модулей и пакетов - которая повторяет идею иерархического расположения файлов
в каталогах файловой системы, примерно так же, как это сделано в языке Python, но разделителем имен выступает не точка,
а символ &ldquo;<strong>\</strong>&rdquo; (как разделитель каталогов в Windows).</p>
<p><em>Имя модуля может содержать только строчные английские буквы или цифры.
Данное ограничение связано с прямым отображением имен модулей на объекты в файловой системе,
так как у разных файловых систем могут быть различные возможности с поддержкой кодировок
и разные требования к преобразованию регистров символов.</em></p>
<p>Под модулем в <em>NewLang</em> понимается <strong>файл</strong> исходным кодом (с расширением *.src).
Модули предназначены для того, чтобы в них хранить часто используемые функции, классы, константы и т.п.
Их можно условно разделить на модули и программы: программы предназначены для непосредственного запуска,
а модули для импортирования их в другие программы, но функционально модули и программы ничем между собой не отличаются.</p>
<h3 id="thread-local">Объекты модуля<a class="td-heading-self-link" href="#thread-local" aria-label="Heading self-link"></a></h3>
<p>Все объекты, определенные внутри одного модуля без указания глобального простанства имен, видны только в рамках текущего файла.</p>
<p>Время жизни статической и локальной переменных модуля одинаковые, и ограничены временм жизни самого модуля,
но статическая и локальная переменные модуля отличаются с точки зрения многопоточности.</p>
<p>Статическая переменная модуля всегда будет в единственном экземпляре для всех потоков,
тогда как локальная переменная модуля будет для каждого потока своя (аналог <em>thread_local</em> (C++11)).</p>
<h3 id="как-импортировать-модули">Как импортировать модули?<a class="td-heading-self-link" href="#%d0%ba%d0%b0%d0%ba-%d0%b8%d0%bc%d0%bf%d0%be%d1%80%d1%82%d0%b8%d1%80%d0%be%d0%b2%d0%b0%d1%82%d1%8c-%d0%bc%d0%be%d0%b4%d1%83%d0%bb%d0%b8" aria-label="Heading self-link"></a></h3>
<p>Относительное имя программного модуля начинается на символ &ldquo;<strong>\</strong>&rdquo;,
и в этом случае расположение файла программного модуля указывается относительно текущего файла.</p>
<p>Абсолютное имя программного модуля начинается на два символа &ldquo;<strong>\\</strong>&rdquo;
и указывает на файл модуля относительно каталога текущего исполняемого файла
(или в списке каталогов для поиска программных модулей,
который можно переопределить, например, с помощью аргументов командной строки).</p>
<p>Полное имя текущего модуля (файла) содержится в переменной препроцессора &lsquo;<strong>@\\</strong>&rsquo;.</p>
<p>Самый простой способ импортировать модуль, это записать его имя со скобками как при вызове функции.
Причем в скобках можно передать аргументы для инициализации модуля, список импортируемых функций и т.д.</p>
<p>Так как <em>NewLang</em> разрабатывается как компилируемый язык, то загрузка модулей возможна как статически, так и динамически
(очень похоже на статическую и динамическую ликновку с dll библиотеками).</p>
<ul>
<li>\dir\module() - статическая загрузка модуля по относительному пути</li>
<li>\\root\dir\module() - статическая загрузка модуля по абсолютному пути</li>
<li>\\(<strong>&quot;<strong>каталог\файл</strong>&quot;</strong>) - динамическая загрузка модуля во время выполнения программы</li>
</ul>
<p>При динамической линковке, компиляция исходного кода модуля и все проверки будут выполнятся только во время выполнения приложения,
тогда как статическая загрузка модуля позволяет выявить возможные ошибки еще на этапе компиляции программы.</p>
<p><em>По умолчанию, при статической линковке модуля, импортируются все его макросы, функции и переменные модуля,
<strong>тогда как при динамической загрузке моуля, макросы не импортируются</strong>.</em> ?????????????????????????????????????????????????????????????</p>
<h3 id="package">Что такое пакет в <em>NewLang</em>?<a class="td-heading-self-link" href="#package" aria-label="Heading self-link"></a></h3>
<p>Пакет в <em>NewLang</em> – это имя <strong>каталога</strong>, который включает в себя другие каталоги и модули и при этом содержит дополнительный файл __init__.src.</p>
<p>Пакеты используются как дополнение к пространству имен, что позволяет работать с модулями через указание уровня вложенности (через символ <strong>\</strong>).
Но в отличии от Python и Java, где модули и пакеты <em>заменяют</em> собой пространство имен (<a href="/ru/docs/syntax/namespace/">namespace</a>),
в <em>NewLang</em> модульная структура и области имен используются одновременно и при указании полного имени объекта,
программные модули и пространства имен можно объединять.</p>
<p>Например, полное имя переменой можно записать с указанием программного модуля <code>\root\dir\module::ns::name::var</code>,
где <strong>root</strong> и <strong>dir</strong> это каталоги в файловой системе относительно текущего моделя, а <strong>module</strong> — имя файла, т.е. <em>root/dir/module.src</em></p>
<p>Для импортирования пакетов используется тот же синтаксис, что и для работы с модулями.</p>
<h3 id="использование-пакетов">Использование пакетов<a class="td-heading-self-link" href="#%d0%b8%d1%81%d0%bf%d0%be%d0%bb%d1%8c%d0%b7%d0%be%d0%b2%d0%b0%d0%bd%d0%b8%d0%b5-%d0%bf%d0%b0%d0%ba%d0%b5%d1%82%d0%be%d0%b2" aria-label="Heading self-link"></a></h3>
<p>Рассмотрим следующую структуру пакета:</p>
<pre tabindex="0"><code>    fincalc
    |-- __init__.src
    |-- simper.src
    |-- compper.src
    |-- annuity.src
</code></pre><p>Пакет <em>fincalc</em> содержит в себе модули для работы с простыми процентами (simper.src), сложными процентами (compper.src) и аннуитетами (annuity.src).
Файл __init__.src в отличии от Python, не может быть пустым, а должен в явном виде содержать команды загрузки модулей, входящих в пакет</p>
<p>Например для нашего случая содержимое __init__.src может быть вот таким:</p>
<pre tabindex="0"><code>    \simper();
    \compper();
    \annuity();
</code></pre><p>Для использования функции <em>fp</em> из модуля для работы с простыми процентами, можно использовать один из следующих вариантов
(для сравнения приведен аналогичный код на Python, когда это возможно):</p>
<h4 id="импорт-одного-модуля-без-указания-псевдонима">Импорт одного модуля без указания псевдонима:<a class="td-heading-self-link" href="#%d0%b8%d0%bc%d0%bf%d0%be%d1%80%d1%82-%d0%be%d0%b4%d0%bd%d0%be%d0%b3%d0%be-%d0%bc%d0%be%d0%b4%d1%83%d0%bb%d1%8f-%d0%b1%d0%b5%d0%b7-%d1%83%d0%ba%d0%b0%d0%b7%d0%b0%d0%bd%d0%b8%d1%8f-%d0%bf%d1%81%d0%b5%d0%b2%d0%b4%d0%be%d0%bd%d0%b8%d0%bc%d0%b0" aria-label="Heading self-link"></a></h4>
<p>Python:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span>    <span style="color:#204a87;font-weight:bold">import</span> <span style="color:#000">fincalc.simper</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000">fv</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">fincalc</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">simper</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">fv</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">pv</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">i</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">n</span><span style="color:#000;font-weight:bold">)</span>
</span></span></code></pre></div><p>NewLang:</p>
<pre tabindex="0"><code>    \fincalc\simper();
    fv := \fincalc\simper::fv(pv, i, n);
</code></pre><h4 id="с-указанием-псевдонима-имени-модуля">С указанием псевдонима имени модуля:<a class="td-heading-self-link" href="#%d1%81-%d1%83%d0%ba%d0%b0%d0%b7%d0%b0%d0%bd%d0%b8%d0%b5%d0%bc-%d0%bf%d1%81%d0%b5%d0%b2%d0%b4%d0%be%d0%bd%d0%b8%d0%bc%d0%b0-%d0%b8%d0%bc%d0%b5%d0%bd%d0%b8-%d0%bc%d0%be%d0%b4%d1%83%d0%bb%d1%8f" aria-label="Heading self-link"></a></h4>
<p>Python:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span>    <span style="color:#204a87;font-weight:bold">import</span> <span style="color:#000">fincalc.simper</span> <span style="color:#204a87;font-weight:bold">as</span> <span style="color:#000">sp</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000">fv</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">sp</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">fv</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">pv</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">i</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">n</span><span style="color:#000;font-weight:bold">)</span>
</span></span></code></pre></div><p>NewLang:</p>
<pre tabindex="0"><code>    sp := \fincalc\simper();
    fv := sp.fv(pv, i, n);
</code></pre><h4 id="импорт-одной-конкретной-функции">Импорт одной конкретной функции:<a class="td-heading-self-link" href="#%d0%b8%d0%bc%d0%bf%d0%be%d1%80%d1%82-%d0%be%d0%b4%d0%bd%d0%be%d0%b9-%d0%ba%d0%be%d0%bd%d0%ba%d1%80%d0%b5%d1%82%d0%bd%d0%be%d0%b9-%d1%84%d1%83%d0%bd%d0%ba%d1%86%d0%b8%d0%b8" aria-label="Heading self-link"></a></h4>
<p>Python:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span>    <span style="color:#204a87;font-weight:bold">from</span> <span style="color:#000">fincalc</span> <span style="color:#204a87;font-weight:bold">import</span> <span style="color:#000">fv</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000">result</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">fv</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">pv</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">i</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">n</span><span style="color:#000;font-weight:bold">)</span>
</span></span></code></pre></div><p>NewLang:</p>
<pre tabindex="0"><code>    \fincalc\simper(__import__=&#34;fv&#34;);
    result := fv(pv, i, n);
</code></pre><h4 id="импорт-всего-пакета">Импорт всего пакета:<a class="td-heading-self-link" href="#%d0%b8%d0%bc%d0%bf%d0%be%d1%80%d1%82-%d0%b2%d1%81%d0%b5%d0%b3%d0%be-%d0%bf%d0%b0%d0%ba%d0%b5%d1%82%d0%b0" aria-label="Heading self-link"></a></h4>
<p>NewLang:</p>
<pre tabindex="0"><code>    \fincalc();
    result := fv(pv, i, n);
</code></pre>
</div>



    
	
  
    
    
	
    

<div class="td-content" style="page-break-before: always">
    
	<h1 id="pg-bf03637ca5c035c764a5caee70b93410">1.4 - Управление памятью, ссылки и совместный доступ</h1>
    
	<p><a href="https://habr.com/ru/companies/otus/articles/763810/">https://habr.com/ru/companies/otus/articles/763810/</a>
<a href="https://habr.com/ru/articles/764420/">https://habr.com/ru/articles/764420/</a></p>
<ul>
<li>Последовательная согласованность отсутствует (отсутствуют атомарныти типы)</li>
</ul>
<p>Любой язык программирования так или иначе вынужден управлять оперативной памятью.
В <em>NewLang</em> реализовано автоматическое управление памятью без сборщика мусора.</p>
<p>За основу была взята модель &ldquo;владения&rdquo; из языка Rust, но она переработана под концепцию сильных
и слабых указателей (аналоги <em>shared_ptr</em> и <em>weak_ptr</em> из С++),
где каждое значение в памяти может иметь только одну переменную-владельца с <em>сильным</em> указателем.</p>
<p>И когда такая переменная-владелец уходит из области видимости, счетчик ссылок уменьшается и при достжении нуля память освобождается.</p>
<p>Фактически, это автоматическое управление памятью с помощью подсчёта ссылок на этапе компиляции и без использования сборщика мусора.</p>
<p>Существование ссылок на объекты предполагает и возможность
одновременного доступа к данным из нескольких потоков выполнения.
Из-за чего управление памятью включает в себя и элементы межпотокового взаимодействия,
так как совместное владение ссылками по любому будет требовать каких либо
механизмов синхронизации доступа к разеделяемой памяти объектов.</p>
<p>Поэтому, при определении объекта указывается, какие типы ссылок допускается создавать на него,
а так-же какая используется модель совместного доступа к переменной.</p>
<p>Весь механизм подсчета ссылок и проверки их корректности реализован на <strong>уровне синтаксиса</strong>.
В рантайме выполняется только контроль идентификатора потока для однопоточных ссылок, а все остальные проверки выполняются во время компиляции.</p>
<h2 id="управление-памятью-и-терминология">Управление памятью и терминология<a class="td-heading-self-link" href="#%d1%83%d0%bf%d1%80%d0%b0%d0%b2%d0%bb%d0%b5%d0%bd%d0%b8%d0%b5-%d0%bf%d0%b0%d0%bc%d1%8f%d1%82%d1%8c%d1%8e-%d0%b8-%d1%82%d0%b5%d1%80%d0%bc%d0%b8%d0%bd%d0%be%d0%bb%d0%be%d0%b3%d0%b8%d1%8f" aria-label="Heading self-link"></a></h2>
<ul>
<li>
<p>Врчную выделить или освобондить память нельзя</p>
</li>
<li>
<p>Любой объект - это ссылка на область памяти с данным. Память выделяется и освобожадется автоматически при создании/удалении объектов</p>
</li>
<li>
<p>Ссылки на объекты, с точки зрения <em>владения</em>, могут быть:</p>
<ul>
<li><em>Сильные/Владеющие</em> ссылки (аналог <em>shared_ptr</em> из С++), а фактические, это переменная которая хранит значение объекта.</li>
<li><em>Слабые/Не владеющие</em> ссылки (аналог <em>weak_ptr</em> из С++) - указатели на другим объекты которые
перед использованием требуют обязательного захвата (т.е. преобразования в <em>сильную ссылку</em>).</li>
</ul>
</li>
<li>
<p>Ссылки на объекты, с точки зрения <em>совместного доступа</em>, могут быть:</p>
<ul>
<li><em>Легкие</em> - ссылки без объекта синхронизации</li>
<li><em>Тяжелые</em> - ссылки с объектом синхронизации совметсного доступа (мьютексом).</li>
</ul>
</li>
<li>
<p>Переменные - владельцы объектов (в них хранятся ссылки) могут быть двух видов:</p>
<ul>
<li><strong><a href="https://en.wikipedia.org/wiki/Local_variable">локальные (контролируемые)</a></strong> -
область жизни локальных переменных строго ограничена и определяется правилами синтаксиса языка (аргументы и локальные переменные функций, потоков и т.д.).</li>
<li><strong>не контролируемые</strong> - глобальные или статические переменные, динамически создаваемые объекты, время жизни которых компилятор не контролирует.</li>
</ul>
</li>
<li>
<p>Когда локальная переменная удаляется - уменьшается счетчик ссылок, а при достижении нуля - объект освобождается.</p>
</li>
<li>
<p>Каждый объект может иметь только одну <em>не контролируемую</em> переменную с <em>сильной</em> ссылкой
и произвольное количество любых дргуих типов ссылок в <em>локальных (контролируемых)</em> переменных.</p>
</li>
<li>
<p>Для <em>не контролируемых</em> переменных разрешается делать только <em>слабые</em> ссылки,
которые перед использованием требуется захватить, например в <em>локальную (контролируемую)</em> переменную.</p>
</li>
<li>
<p>Управление временем жизни объекта включает в себя не только управлением памятью,
но и при необходимости, создаются механизмы синхронизации доступа к ней.
Для этого при определении переменной, описываются возможные типы ссылок, которые разрешено на неё получать:</p>
<ul>
<li>без создания ссылок, т.е. компилятор не даст создать ссылку на данную переменную,
а совместный доступ к такой переменой будет не возможен</li>
<li>возможно создание <em>легкой</em> ссылки (&quot;<strong>&amp;</strong>&quot;).
Компилятору при генерации машинного кода не нужно создавать объект синхронизации доступа к переменной.<br>
<em>Ссылки для полей структур или объектов могут быть только <em>легкими</em>.</em></li>
<li>разрешено создавать ссылки с монопольным доступом (&quot;<strong>&amp;&amp;</strong>&quot;).
Компилятор автоматически создает не рекурсивный мьютекс для синхронизации доступа к переменной,
т.е. ссылка у этой переменной будет <em>тяжелой</em>.</li>
<li>разрешено создавать ссылки с рекурсивным доступом (&quot;<strong>&amp;*</strong>&quot;).
Компилятор автоматически создает рекурсивный мьютекс (его можно захватывать несколько раз),
а ссылка у этой переменной будет <em>тяжелой</em>.</li>
<li><em>легкая</em> ссылка может быть создана для совместного доступа (&quot;<strong>&amp;?</strong>&quot;),
но её захват и синхронизация доступа к ней возможен только при <a href="/ru/docs/ops/with/">групповом</a> захвате ссылок.</li>
</ul>
</li>
<li>
<p>Все виды ссылок могут быть константными (&quot;<strong>&amp;^</strong>&quot;, &ldquo;<strong>&amp;&amp;^</strong>&rdquo; или &ldquo;<strong>&amp;*^</strong>&rdquo;),
т.е. только для чтения (и в случае константных объектов, таким ссылкам мьютекс не потребуется).</p>
</li>
<li>
<p>Захват <em>слабой</em> ссылки может быть индивидуальным или <a href="/ru/docs/ops/with/">групповым</a>
с сохранением результата в <em>локальную (контролируемую)</em> переменную.
Такое использование логики захвата объекта на уровне синтаксиса языка гарантирует последующее
автоматическое освобождение временной переменной, что равнозначно невозможности создания циклических ссылок.</p>
</li>
<li>
<p>Переменная со <em>слабой/не владеющей</em> ссылкой создается только тогда, когда
в правой части операции присвоения присутствует любой из операторов получения ссылки
(<strong>&amp;</strong>, <strong>&amp;&amp;</strong>, <strong>&amp;*</strong> или <strong>&amp;^</strong>, <strong>&amp;&amp;^</strong>, <strong>&amp;*^</strong>).</p>
</li>
<li>
<p>Во всех остальных случаях создается переменная владелец с сильной/владеющей ссылкой (если это разрешено).</p>
</li>
</ul>
<h3 id="захват-ссылки-и-значение-переменной">Захват ссылки и значение переменной<a class="td-heading-self-link" href="#%d0%b7%d0%b0%d1%85%d0%b2%d0%b0%d1%82-%d1%81%d1%81%d1%8b%d0%bb%d0%ba%d0%b8-%d0%b8-%d0%b7%d0%bd%d0%b0%d1%87%d0%b5%d0%bd%d0%b8%d0%b5-%d0%bf%d0%b5%d1%80%d0%b5%d0%bc%d0%b5%d0%bd%d0%bd%d0%be%d0%b9" aria-label="Heading self-link"></a></h3>
<ul>
<li>Захват ссылки - это преобразование <em>слабой</em> ссылки в <em>сильную</em> с её сохранением в контролируемую переменую
с инкрементом счетчика ссылок и возможностью доступа к значению объекта. Это очень похоже на заимствование (Borrowing) в Rust,
так как тоже позволяет использовать данные, находящиеся во владении другой переменной, но без перехода владения.</li>
</ul>
<p>Для захвата ссылок используются операторы:</p>
<ul>
<li>&lsquo;<strong>*</strong>&rsquo; или &lsquo;<strong>*( &hellip; )</strong>&rsquo; - автоматический выбор типа доступа (чтения/запись или только чтение)</li>
<li>&lsquo;<strong>*^</strong>&rsquo; или &lsquo;<strong>*^( &hellip; )</strong>&rsquo; - захват доступа только для чтения</li>
<li>&lsquo;<strong>**( &hellip; )</strong>&rsquo; - <a href="/ru/docs/ops/with/">групповой</a> захват ссылок в <em>локальные (контролируемые)</em> переменные</li>
<li><strong>()</strong> после имени переменной - создание копии значения переменной (глубокое клонирование) ???????????????????????????????????</li>
</ul>
<p>Упрощенный условный пример:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span>    <span style="color:#000">ref</span> <span style="color:#ce5c00;font-weight:bold">:=</span> <span style="color:#ce5c00;font-weight:bold">&amp;</span> <span style="color:#000">owner</span><span style="color:#000;font-weight:bold">;</span>  <span style="color:#8f5902;font-style:italic"># переменная ref - слабая ссылка на owner</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000">ref_ro</span> <span style="color:#ce5c00;font-weight:bold">:=</span> <span style="color:#ce5c00;font-weight:bold">&amp;^</span> <span style="color:#000">owner</span><span style="color:#000;font-weight:bold">;</span>  <span style="color:#8f5902;font-style:italic"># слабая ссылка на owner только для чтения</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#000">val</span> <span style="color:#ce5c00;font-weight:bold">:=</span> <span style="color:#ce5c00;font-weight:bold">*</span> <span style="color:#000">ref</span><span style="color:#000;font-weight:bold">;</span>  <span style="color:#8f5902;font-style:italic"># Автоматический захват только для чтения </span>
</span></span><span style="display:flex;"><span>    <span style="color:#ce5c00;font-weight:bold">*</span><span style="color:#000">ref</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">val</span><span style="color:#000;font-weight:bold">;</span>    <span style="color:#8f5902;font-style:italic"># Автоматический захват для чтения/записи</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#000">val</span> <span style="color:#ce5c00;font-weight:bold">:=</span> <span style="color:#ce5c00;font-weight:bold">*^</span> <span style="color:#000">ref</span><span style="color:#000;font-weight:bold">;</span> <span style="color:#8f5902;font-style:italic"># Захват только для чтения</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#000">val</span> <span style="color:#ce5c00;font-weight:bold">:=</span> <span style="color:#ce5c00;font-weight:bold">*^</span> <span style="color:#000">ref_ro</span><span style="color:#000;font-weight:bold">;</span> 
</span></span><span style="display:flex;"><span>    <span style="color:#000">val</span> <span style="color:#ce5c00;font-weight:bold">:=</span> <span style="color:#ce5c00;font-weight:bold">*</span> <span style="color:#000">ref_ro</span><span style="color:#000;font-weight:bold">;</span>  <span style="color:#8f5902;font-style:italic"># Автоматический захват только для чтения</span>
</span></span><span style="display:flex;"><span>    <span style="color:#ce5c00;font-weight:bold">*</span><span style="color:#000">ref_ro</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">val</span><span style="color:#000;font-weight:bold">;</span>    <span style="color:#8f5902;font-style:italic"># Ошибка - ссылка только для чтения !!!</span>
</span></span><span style="display:flex;"><span>    <span style="color:#ce5c00;font-weight:bold">*^</span> <span style="color:#000">ref_ro</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">val</span><span style="color:#000;font-weight:bold">;</span>  <span style="color:#8f5902;font-style:italic"># Ошибка - недопустима конструкция (захват lval - только для чтения)</span>
</span></span></code></pre></div><ul>
<li>Слабую ссылку можно захватить (превратить в сильную) сохранив результат в локальной переменной,
после чего работать с локальной переменной &ldquo;по значению&rdquo;
без необходимости захватытвать ссылку при каждом обращении к переменной.</li>
<li>Значения переменных со слабыми ссылками можно копировать в другие переменные без ограничений.</li>
<li>Значение переменной с сильной ссылкой нельзя скопировать в другую переменную или поле объекта,
но можно клонировать данные или обменяться значениями &ldquo;<strong>:=:</strong>&rdquo; с другой переменной с сильной ссылкой (swap).</li>
</ul>
<p>Примеры владения:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span>    <span style="color:#000">owner</span> <span style="color:#ce5c00;font-weight:bold">:=</span> <span style="color:#4e9a06">&#34;string&#34;</span><span style="color:#000;font-weight:bold">;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000">other</span> <span style="color:#ce5c00;font-weight:bold">:=</span> <span style="color:#4e9a06">&#34;string 2&#34;</span><span style="color:#000;font-weight:bold">;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#000">owner</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">other</span><span style="color:#000;font-weight:bold">;</span> <span style="color:#8f5902;font-style:italic"># Ошибка - нельзя копировать!</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000">owner</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">other</span><span style="color:#000;font-weight:bold">();</span> <span style="color:#8f5902;font-style:italic"># Глубокое клонирование данных</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000">owner</span> <span style="color:#ce5c00;font-weight:bold">:=</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#000">other</span><span style="color:#000;font-weight:bold">;</span> <span style="color:#8f5902;font-style:italic"># Обмен значениями (swap)</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000">other</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">_</span><span style="color:#000;font-weight:bold">;</span> <span style="color:#8f5902;font-style:italic"># Очистка данных объекта</span>
</span></span></code></pre></div><ul>
<li>Переменную, содержащую ссылку на ссылку создать нельзя,
но можно создать ссылочный тип и после этого создать переменную-ссылку на этот тип данных.</li>
</ul>
<p>Упрощенный условный пример:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span>    <span style="color:#000">value</span> <span style="color:#ce5c00;font-weight:bold">:=</span> <span style="color:#0000cf;font-weight:bold">123</span><span style="color:#000;font-weight:bold">;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">:</span><span style="color:#000">RefInt</span> <span style="color:#ce5c00;font-weight:bold">:=</span> <span style="color:#ce5c00;font-weight:bold">&amp;</span> <span style="color:#000">Integer</span><span style="color:#000;font-weight:bold">;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000">ref_int</span> <span style="color:#000;font-weight:bold">:</span><span style="color:#000">RefInt</span> <span style="color:#ce5c00;font-weight:bold">:=</span> <span style="color:#ce5c00;font-weight:bold">&amp;</span> <span style="color:#000">value</span><span style="color:#000;font-weight:bold">;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000">ref_ref</span> <span style="color:#ce5c00;font-weight:bold">:=</span> <span style="color:#ce5c00;font-weight:bold">&amp;</span> <span style="color:#000">ref_int</span><span style="color:#000;font-weight:bold">;</span>
</span></span><span style="display:flex;"><span>    
</span></span></code></pre></div><ul>
<li>Если переменная владелец разрешает создавать ссылки на объект, тогда при обращении к такой переменой
требуется выполнять захват объекта для обеспечения работы механизма совместного доступа.</li>
</ul>
<h2 id="ссылки-и-совместный-доступ">Ссылки и совместный доступ<a class="td-heading-self-link" href="#%d1%81%d1%81%d1%8b%d0%bb%d0%ba%d0%b8-%d0%b8-%d1%81%d0%be%d0%b2%d0%bc%d0%b5%d1%81%d1%82%d0%bd%d1%8b%d0%b9-%d0%b4%d0%be%d1%81%d1%82%d1%83%d0%bf" aria-label="Heading self-link"></a></h2>
<p>Управление временем жизни переменной включает в себя не только управление памятью,
но и механизм синхронизации для монопольного/раздельного доступа к объектам из разных потоков.</p>
<p>Примеры ссылок:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span>    <span style="color:#ce5c00;font-weight:bold">&amp;</span> <span style="color:#000">local</span> <span style="color:#ce5c00;font-weight:bold">:=</span> <span style="color:#0000cf;font-weight:bold">123</span><span style="color:#000;font-weight:bold">;</span>     <span style="color:#8f5902;font-style:italic"># Разрешено создание ссылок только в текущем потоке</span>
</span></span><span style="display:flex;"><span>    <span style="color:#ce5c00;font-weight:bold">&amp;&amp;</span> <span style="color:#000">thread</span> <span style="color:#ce5c00;font-weight:bold">:=</span> <span style="color:#0000cf;font-weight:bold">456</span><span style="color:#000;font-weight:bold">;</span>   <span style="color:#8f5902;font-style:italic"># Разрешено создание ссылок с монопольным доступом в любом потоке</span>
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    <span style="color:#000">ref</span> <span style="color:#ce5c00;font-weight:bold">:=</span> <span style="color:#ce5c00;font-weight:bold">&amp;</span> <span style="color:#000">local</span><span style="color:#000;font-weight:bold">;</span>     <span style="color:#8f5902;font-style:italic"># Создание слабой ссылки на local</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000">ref2</span> <span style="color:#ce5c00;font-weight:bold">:=</span> <span style="color:#ce5c00;font-weight:bold">&amp;&amp;</span> <span style="color:#000">local</span><span style="color:#000;font-weight:bold">;</span>   <span style="color:#8f5902;font-style:italic"># Ошибка! многопоточные ссылки не разрешены</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000">ref_th</span> <span style="color:#ce5c00;font-weight:bold">:=</span> <span style="color:#ce5c00;font-weight:bold">&amp;&amp;</span> <span style="color:#000">thread</span><span style="color:#000;font-weight:bold">;</span>  <span style="color:#8f5902;font-style:italic"># Создание слабой ссылки на thread </span>
</span></span><span style="display:flex;"><span>                          <span style="color:#8f5902;font-style:italic"># c монопольной блокировкой доступа</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#000">local</span> <span style="color:#ce5c00;font-weight:bold">+=</span> <span style="color:#0000cf;font-weight:bold">1</span><span style="color:#000;font-weight:bold">;</span> <span style="color:#8f5902;font-style:italic"># ОК</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000">thread</span>  <span style="color:#ce5c00;font-weight:bold">+=</span> <span style="color:#0000cf;font-weight:bold">1</span><span style="color:#000;font-weight:bold">;</span> <span style="color:#8f5902;font-style:italic"># Ошибка, требуется захват объекта с разеляемым доступом</span>
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    <span style="color:#ce5c00;font-weight:bold">*</span><span style="color:#000">local</span> <span style="color:#ce5c00;font-weight:bold">+=</span> <span style="color:#0000cf;font-weight:bold">1</span><span style="color:#000;font-weight:bold">;</span> <span style="color:#8f5902;font-style:italic"># ОК, оператор захвата игнорируется</span>
</span></span><span style="display:flex;"><span>    <span style="color:#ce5c00;font-weight:bold">*</span><span style="color:#000">thread</span>  <span style="color:#ce5c00;font-weight:bold">+=</span> <span style="color:#0000cf;font-weight:bold">1</span><span style="color:#000;font-weight:bold">;</span> <span style="color:#8f5902;font-style:italic"># Захват объекта (как захват слабой ссылки)</span>
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    <span style="color:#000">ref</span> <span style="color:#ce5c00;font-weight:bold">+=</span> <span style="color:#0000cf;font-weight:bold">1</span><span style="color:#000;font-weight:bold">;</span>   <span style="color:#8f5902;font-style:italic"># Ошибка, требуется захват слабой ссылки</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000">ref_th</span> <span style="color:#ce5c00;font-weight:bold">+=</span> <span style="color:#0000cf;font-weight:bold">1</span><span style="color:#000;font-weight:bold">;</span>   <span style="color:#8f5902;font-style:italic"># Ошибка, требуется захват слабой ссылки</span>
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    <span style="color:#ce5c00;font-weight:bold">*</span><span style="color:#000">ref</span> <span style="color:#ce5c00;font-weight:bold">+=</span> <span style="color:#0000cf;font-weight:bold">1</span><span style="color:#000;font-weight:bold">;</span>   
</span></span><span style="display:flex;"><span>    <span style="color:#ce5c00;font-weight:bold">*</span><span style="color:#000">ref_th</span> <span style="color:#ce5c00;font-weight:bold">+=</span> <span style="color:#0000cf;font-weight:bold">1</span><span style="color:#000;font-weight:bold">;</span>
</span></span></code></pre></div><p>Операторы захвата ссылки и синхронизации доступа к объекту выполняются только для одного действия над переменной.
Но захват объекта синхронизации, это относительно медленная операция и выполнять её для каждого действия над переменной не рационально.</p>
<p>Для того, чтобы однократно захватить объект(ы) синхронизации для выполнения сразу нескольких действий
над переменными можно захватить объект в локальную переменую или использовать <a href="/ru/docs/ops/with/">менеджер контекста</a>.</p>
<h3 id="пример-программы">Пример программы<a class="td-heading-self-link" href="#%d0%bf%d1%80%d0%b8%d0%bc%d0%b5%d1%80-%d0%bf%d1%80%d0%be%d0%b3%d1%80%d0%b0%d0%bc%d0%bc%d1%8b" aria-label="Heading self-link"></a></h3>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span>    <span style="color:#000">rand</span><span style="color:#000;font-weight:bold">():</span><span style="color:#000">Int32</span> <span style="color:#000;font-weight:bold">:</span><span style="color:#ce5c00;font-weight:bold">:=</span> <span style="color:#ce5c00;font-weight:bold">%</span><span style="color:#000">rand</span><span style="color:#ce5c00;font-weight:bold">...</span><span style="color:#000;font-weight:bold">;</span> <span style="color:#8f5902;font-style:italic"># Создание объекта</span>
</span></span><span style="display:flex;"><span>    <span style="color:#ce5c00;font-weight:bold">@</span><span style="color:#000;font-weight:bold">(</span> <span style="color:#000">rand</span><span style="color:#000;font-weight:bold">():</span><span style="color:#000">Int32</span> <span style="color:#000;font-weight:bold">);</span> <span style="color:#8f5902;font-style:italic"># Предварительное объявление (объект должен быть создан в другом месте)</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000">rand</span><span style="color:#000;font-weight:bold">():</span><span style="color:#000">Int32</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#ce5c00;font-weight:bold">...</span><span style="color:#000;font-weight:bold">;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#000">usleep</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">usec</span><span style="color:#000;font-weight:bold">:</span><span style="color:#000">DWord64</span><span style="color:#000;font-weight:bold">):</span><span style="color:#204a87;font-weight:bold">None</span> <span style="color:#ce5c00;font-weight:bold">:=</span> <span style="color:#ce5c00;font-weight:bold">%</span><span style="color:#000">usleep</span><span style="color:#ce5c00;font-weight:bold">...</span><span style="color:#000;font-weight:bold">;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000">printf</span><span style="color:#000;font-weight:bold">(</span><span style="color:#204a87">format</span><span style="color:#000;font-weight:bold">:</span><span style="color:#000">FmtChar</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#ce5c00;font-weight:bold">...</span><span style="color:#000;font-weight:bold">):</span><span style="color:#000">Int32</span> <span style="color:#ce5c00;font-weight:bold">:=</span> <span style="color:#ce5c00;font-weight:bold">%</span><span style="color:#000">printf</span><span style="color:#ce5c00;font-weight:bold">...</span><span style="color:#000;font-weight:bold">;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#000">func</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">count</span><span style="color:#000;font-weight:bold">:</span><span style="color:#000">Integer</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">target</span><span style="color:#000;font-weight:bold">:</span><span style="color:#000">String</span><span style="color:#000;font-weight:bold">)</span> <span style="color:#ce5c00;font-weight:bold">:=</span> <span style="color:#000;font-weight:bold">{</span>
</span></span><span style="display:flex;"><span>        <span style="color:#a40000">$</span><span style="color:#204a87">iter</span> <span style="color:#ce5c00;font-weight:bold">:=</span> <span style="color:#5c35cc;font-weight:bold">@iter</span><span style="color:#000;font-weight:bold">(</span> <span style="color:#0000cf;font-weight:bold">1.</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#a40000">$</span><span style="color:#000">count</span> <span style="color:#000;font-weight:bold">);</span> <span style="color:#8f5902;font-style:italic"># Итератор для диапазона от 1 до $count</span>
</span></span><span style="display:flex;"><span>        <span style="color:#5c35cc;font-weight:bold">@while</span><span style="color:#000;font-weight:bold">(</span> <span style="color:#5c35cc;font-weight:bold">@curr</span><span style="color:#000;font-weight:bold">(</span><span style="color:#a40000">$</span><span style="color:#204a87">iter</span><span style="color:#000;font-weight:bold">)</span> <span style="color:#000;font-weight:bold">)</span> <span style="color:#000;font-weight:bold">{</span>   <span style="color:#8f5902;font-style:italic"># Цикл, пока итератор валидный</span>
</span></span><span style="display:flex;"><span>            
</span></span><span style="display:flex;"><span>            <span style="color:#a40000">$</span><span style="color:#000">step</span> <span style="color:#ce5c00;font-weight:bold">:=</span> <span style="color:#5c35cc;font-weight:bold">@next</span><span style="color:#000;font-weight:bold">(</span><span style="color:#a40000">$</span><span style="color:#204a87">iter</span><span style="color:#000;font-weight:bold">);</span>  <span style="color:#8f5902;font-style:italic"># Получить текущий и перейти на следующий элемент итератора</span>
</span></span><span style="display:flex;"><span>            
</span></span><span style="display:flex;"><span>            <span style="color:#000">printf</span><span style="color:#000;font-weight:bold">(</span><span style="color:#4e9a06">&#39;Number </span><span style="color:#4e9a06">%d</span><span style="color:#4e9a06"> from </span><span style="color:#4e9a06">%s</span><span style="color:#4e9a06">!&#39;</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#a40000">$</span><span style="color:#000">step</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#a40000">$</span><span style="color:#000">target</span><span style="color:#000;font-weight:bold">);</span>
</span></span><span style="display:flex;"><span>                
</span></span><span style="display:flex;"><span>            <span style="color:#000">usleep</span><span style="color:#000;font-weight:bold">(</span> <span style="color:#000">rand</span><span style="color:#000;font-weight:bold">()</span> <span style="color:#ce5c00;font-weight:bold">%</span> <span style="color:#0000cf;font-weight:bold">1000</span> <span style="color:#000;font-weight:bold">);</span>    <span style="color:#8f5902;font-style:italic"># Случайная задержка</span>
</span></span><span style="display:flex;"><span>        <span style="color:#000;font-weight:bold">}</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">}</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#000">thread</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000;font-weight:bold">:</span><span style="color:#000">Thread</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">func</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#0000cf;font-weight:bold">5</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#4e9a06">&#39;thread&#39;</span><span style="color:#000;font-weight:bold">);</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#000">thread</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">start</span><span style="color:#000;font-weight:bold">();</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#000">func</span><span style="color:#000;font-weight:bold">(</span><span style="color:#0000cf;font-weight:bold">5</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#4e9a06">&#39;main&#39;</span><span style="color:#000;font-weight:bold">);</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#000">thread</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">join</span><span style="color:#000;font-weight:bold">();</span>
</span></span></code></pre></div><pre tabindex="0"><code class="language-pyton" data-lang="pyton">    Number 1 from the thread!
    Number 1 from the main!
    Number 2 from the thread!
    Number 2 from the main!
    Number 3 from the thread!
    Number 4 from the thread!
    Number 3 from the main!
    Number 4 from the main!
    Number 5 from the main!
    Number 5 from the thread!
</code></pre><p>Примеры ссылок:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span>    <span style="color:#ce5c00;font-weight:bold">&amp;</span> <span style="color:#a40000">$</span><span style="color:#000">local</span> <span style="color:#ce5c00;font-weight:bold">:=</span> <span style="color:#0000cf;font-weight:bold">123</span><span style="color:#000;font-weight:bold">;</span>     <span style="color:#8f5902;font-style:italic"># Разрешено получение легких ссылок</span>
</span></span><span style="display:flex;"><span>    <span style="color:#ce5c00;font-weight:bold">&amp;&amp;</span> <span style="color:#a40000">$</span><span style="color:#000">thread</span> <span style="color:#ce5c00;font-weight:bold">:=</span> <span style="color:#0000cf;font-weight:bold">456</span><span style="color:#000;font-weight:bold">;</span>   <span style="color:#8f5902;font-style:italic"># Доступ к переменной требует захвата тяжелой ссылки</span>
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    <span style="color:#a40000">$</span><span style="color:#000">ref</span> <span style="color:#ce5c00;font-weight:bold">:=</span> <span style="color:#ce5c00;font-weight:bold">&amp;</span> <span style="color:#a40000">$</span><span style="color:#000">local</span><span style="color:#000;font-weight:bold">;</span>     <span style="color:#8f5902;font-style:italic"># получение слабой ссылки на local</span>
</span></span><span style="display:flex;"><span>    <span style="color:#a40000">$</span><span style="color:#000">ref2</span> <span style="color:#ce5c00;font-weight:bold">:=</span> <span style="color:#ce5c00;font-weight:bold">&amp;&amp;</span> <span style="color:#a40000">$</span><span style="color:#000">local</span><span style="color:#000;font-weight:bold">;</span>   <span style="color:#8f5902;font-style:italic"># Ошибка! Тяжелой многопоточные ссылки не разрешены</span>
</span></span><span style="display:flex;"><span>    <span style="color:#a40000">$</span><span style="color:#000">ref_th</span> <span style="color:#ce5c00;font-weight:bold">:=</span> <span style="color:#ce5c00;font-weight:bold">&amp;&amp;</span> <span style="color:#a40000">$</span><span style="color:#000">thread</span><span style="color:#000;font-weight:bold">;</span>  <span style="color:#8f5902;font-style:italic"># Получение слабой ссылки на thread </span>
</span></span><span style="display:flex;"><span>                            <span style="color:#8f5902;font-style:italic"># c монопольной блокировкой доступа</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#a40000">$</span><span style="color:#000">local</span> <span style="color:#ce5c00;font-weight:bold">+=</span> <span style="color:#0000cf;font-weight:bold">1</span><span style="color:#000;font-weight:bold">;</span> <span style="color:#8f5902;font-style:italic"># ОК (для легких ссылок блокировка объекта не требуется)</span>
</span></span><span style="display:flex;"><span>    <span style="color:#a40000">$</span><span style="color:#000">thread</span>  <span style="color:#ce5c00;font-weight:bold">+=</span> <span style="color:#0000cf;font-weight:bold">1</span><span style="color:#000;font-weight:bold">;</span> <span style="color:#8f5902;font-style:italic"># ОК (захват объекта происходит автоматически)</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#a40000">$</span><span style="color:#000">ref</span> <span style="color:#ce5c00;font-weight:bold">+=</span> <span style="color:#0000cf;font-weight:bold">1</span><span style="color:#000;font-weight:bold">;</span>   <span style="color:#8f5902;font-style:italic"># Ошибка, требуется захват легкой слабой ссылки</span>
</span></span><span style="display:flex;"><span>    <span style="color:#a40000">$</span><span style="color:#000">ref_th</span> <span style="color:#ce5c00;font-weight:bold">+=</span> <span style="color:#0000cf;font-weight:bold">1</span><span style="color:#000;font-weight:bold">;</span>   <span style="color:#8f5902;font-style:italic"># Ошибка, требуется захват тяжолой слабой ссылки</span>
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    <span style="color:#ce5c00;font-weight:bold">*</span><span style="color:#a40000">$</span><span style="color:#000">local</span> <span style="color:#ce5c00;font-weight:bold">+=</span> <span style="color:#0000cf;font-weight:bold">1</span><span style="color:#000;font-weight:bold">;</span> <span style="color:#8f5902;font-style:italic"># ОК</span>
</span></span><span style="display:flex;"><span>    <span style="color:#ce5c00;font-weight:bold">*</span><span style="color:#a40000">$</span><span style="color:#000">thread</span>  <span style="color:#ce5c00;font-weight:bold">+=</span> <span style="color:#0000cf;font-weight:bold">1</span><span style="color:#000;font-weight:bold">;</span> <span style="color:#8f5902;font-style:italic"># ОК</span>
</span></span><span style="display:flex;"><span>    <span style="color:#ce5c00;font-weight:bold">*</span><span style="color:#a40000">$</span><span style="color:#000">ref</span> <span style="color:#ce5c00;font-weight:bold">+=</span> <span style="color:#0000cf;font-weight:bold">1</span><span style="color:#000;font-weight:bold">;</span>   <span style="color:#8f5902;font-style:italic"># ОК (только захват ссылки, блокировка игнорируется)</span>
</span></span><span style="display:flex;"><span>    <span style="color:#ce5c00;font-weight:bold">*</span><span style="color:#a40000">$</span><span style="color:#000">ref_th</span> <span style="color:#ce5c00;font-weight:bold">+=</span> <span style="color:#0000cf;font-weight:bold">1</span><span style="color:#000;font-weight:bold">;</span>   <span style="color:#8f5902;font-style:italic"># ОК (захват ссылки и блокироваки доступа)</span>
</span></span></code></pre></div><h2 id="менеджер-контекста">Менеджер контекста<a class="td-heading-self-link" href="#%d0%bc%d0%b5%d0%bd%d0%b5%d0%b4%d0%b6%d0%b5%d1%80-%d0%ba%d0%be%d0%bd%d1%82%d0%b5%d0%ba%d1%81%d1%82%d0%b0" aria-label="Heading self-link"></a></h2>
<p>Операторы захвата ссылки и синхронизации доступа к объекту выполняются только для одного действия над переменной.
Но захват объекта синхронизации, это относительно медленная операция и выполнять её для каждого действия над переменной не рационально.</p>
<p>Для того, чтобы однократно захватить объект(ы) синхронизации для выполнения сразу нескольких действий
над переменными используется <a href="/ru/docs/ops/with/">менеджер контекста</a>.</p>

</div>



    
	
  
    
    
	
    

<div class="td-content" style="page-break-before: always">
    
	<h1 id="pg-66431dc9242fce562d24bb69bdc576f3">1.5 - Макросы</h1>
    
	<p>Макросы используются и для превращеня исходного кода <em>NewLang</em> в более привычный синтаксис на основе <a href="https://newlang.net/syntax_dsl.html">ключевых слов</a>, так как такой тест гораздо легче воспринимается при последующем чтении исходного кода.</p>
<p>Макросы в <strong>NewLang</strong>, это один или несколько последовательных терминов, которые заменяются на другой термин
или на целую синтаксическую конструкцию (последовательность лексем).</p>
<p>Макросы обработываются во время работы <strong>лексера</strong>, т.е. перед передачей последовательности лексем в парсер,
что позволяет с помощью маросов изменять фрагменты синтаксиса языка, например, при реализации собственных диалектов DSL.</p>
<h3 id="определение-макросов">Определение макросов<a class="td-heading-self-link" href="#%d0%be%d0%bf%d1%80%d0%b5%d0%b4%d0%b5%d0%bb%d0%b5%d0%bd%d0%b8%d0%b5-%d0%bc%d0%b0%d0%ba%d1%80%d0%be%d1%81%d0%be%d0%b2" aria-label="Heading self-link"></a></h3>
<p>Определение макросов аналогично <a href="/ru/docs/ops/create/">определению</a> других объектов и состоит из трех частей
<strong>&lt;имя макроса&gt; &lt;оператор создания/присвоения&gt; &lt;тело макроса&gt;</strong> и завершающая точка с запятой &ldquo;<strong>;</strong>&rdquo;,
т.е. применяются обычные операторы <strong>::=</strong>(<strong>::-</strong>), <strong>=</strong> или <strong>:=</strong>(<strong>:-</strong>) для создания нового или переопределения уже существующего объекта,
а имя макроса указывается между двумя символами <strong>&quot;@@&quot;</strong> и может содержать одну или нескольких лексем (терминов).</p>
<p>Все макросы относятся к глобальному пространству имен, поэтому первый термин в имени макроса должен быть уникальным,
иначе он будет прекрывать локальные и глобальные переменные при <a href="/ru/docs/syntax/naming/">разрешении имен</a>,
если они записаны в тексте программы без <a href="/ru/docs/syntax/naming/#sigil">квалификаторов (сигилов)</a>.</p>
<p>С помощью операторов <strong>::-</strong> и <strong>:-</strong> создаются чистые (гигиеничные) макросы, аргументы и переменные в которых гарантированно не пересекаются с пространством имен программы.</p>
<p>Телом макроса могут быть корректное выражение языка, последовательность лексем (которые заключается в двойные собачки <strong>&quot;@@&quot;</strong>,
т.е. <strong><code>@@ лексема1 лексема1 @@</code></strong>) или обычная текстовая строка (которую нужно указать между тройными собачками <strong>&quot;@@@&quot;</strong>, т.е. <strong><code>@@@ текстовая строка @@@</code></strong>).</p>
<p>В имени макроса после первого термина могут присутствовать один или несколько шаблонов.
<em>Шаблон</em> — это термин, который при сопоставлении последовательности лексем с идентификатором макроса
может заменяться любым другим одиночным термином (т.е. фактически это сопоставление по образцу/шаблону).</p>
<p>Для создания термина-шаблона в начале его идентификатора нужно поставить знак доллара (что соответствует квалификатору локальной переменой),
т.е. имя макроса <code>@@ FUNC $name @@</code> будет соответствовать последовательности лексем как <code>FUNC my_func_name</code>, так и <code>FUNC other_name_func</code>.</p>
<p>Для удаления макроса используется специальный синтаксис: <code>@@@@ name @@@@;</code> или <code>@@@@ два термина @@@@;</code>,
т.е. необходимо указать идентификатор макроса между четырмя символами <strong>&quot;@@@@&quot;</strong>.</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>    <span style="color:#8f5902;font-style:italic"># Тело макроса из текстовой строки (как в препроцессоре С/С++)</span>
</span></span><span style="display:flex;"><span>    @@macro_str@@ :<span style="color:#ce5c00;font-weight:bold">=</span> @@@ строка - тело макроса @@@<span style="color:#000;font-weight:bold">;</span> <span style="color:#8f5902;font-style:italic"># Строка для лексера</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#8f5902;font-style:italic"># Удаления макроса @macro_str</span>
</span></span><span style="display:flex;"><span>    @@@@ macro_str @@@@<span style="color:#000;font-weight:bold">;</span>
</span></span></code></pre></div><h3 id="args">Аргументы макросов и их раскрытие<a class="td-heading-self-link" href="#args" aria-label="Heading self-link"></a></h3>
<p>Макросы можно определять как с аргументами (параметрами в скобках), так и без них.
Если макрос был определен с аргументами, то их проверка будет выполнятся макропроцессором при определении и раскрытии макроса.
Если макрос был определен без аргументов, то их наличие макропроцессором игнорируется.</p>
<p>Макропроцессор считает макросы с аргументами и без оных идентичными, то нельзя создать два макроса
с одинаковыми именами, один из которых будет с аргументами (скобками), а другой без них.</p>
<p>Поэтому, если требуется использовать макрос в двух разных вариантах (с аргументами и без оных),
следует определять макрос без аргументов и в этом случае контроль параметров будет выполнятся компилятором.</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>    @@ macro @@ :<span style="color:#ce5c00;font-weight:bold">=</span> term<span style="color:#000;font-weight:bold">;</span> <span style="color:#8f5902;font-style:italic"># Макрос без аргументов</span>
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    macro<span style="color:#ce5c00;font-weight:bold">(</span>args<span style="color:#ce5c00;font-weight:bold">)</span><span style="color:#000;font-weight:bold">;</span> <span style="color:#8f5902;font-style:italic"># ОК -&gt; term(args);</span>
</span></span><span style="display:flex;"><span>    macro<span style="color:#000;font-weight:bold">;</span> <span style="color:#8f5902;font-style:italic"># ОК -&gt; term;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#8f5902;font-style:italic"># Но </span>
</span></span><span style="display:flex;"><span>    @@ call<span style="color:#ce5c00;font-weight:bold">()</span> @@ :<span style="color:#ce5c00;font-weight:bold">=</span> term<span style="color:#ce5c00;font-weight:bold">()</span><span style="color:#000;font-weight:bold">;</span> 
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    call<span style="color:#ce5c00;font-weight:bold">()</span><span style="color:#000;font-weight:bold">;</span> <span style="color:#8f5902;font-style:italic"># ОК -&gt; term();</span>
</span></span><span style="display:flex;"><span>    call<span style="color:#000;font-weight:bold">;</span> <span style="color:#8f5902;font-style:italic"># Ошибка (@call определен с аргументами) </span>
</span></span></code></pre></div><p>Если при определении макроса указаны аргументы, то место для их вставки в теле макроса
записывается как имя локальной переменой, перед которой добавлен символ <strong>&quot;@&quot;</strong>, т.е. <strong>@$arg</strong>.</p>
<p>Место для вставки числа реально переданных аргументов отмечается лексемой <strong>&quot;@$#&quot;</strong>.
Если требуется вставить переданные аргументы в виде словаря, то место для вставки отмечается лексемой <strong>&quot;@$*&quot;</strong>.</p>
<p>Если макрос принимае произвольное количество аргументов (аргуметы макроса завершает многоточие),
то место их вставки в тело макроса отмечается лексемой <strong>&quot;@$&hellip;&quot;</strong>.</p>
<p>По аналогии с препроцессором С/С++, для соединения двух лексем в одну, в теле макроса используется оператор <strong>&quot;@##&quot;</strong>,
а для преобразование лексемы в текстову строку применяется операторы <strong>@#</strong>, <strong>@#&quot;</strong> или <strong>@#&rsquo;</strong>, например,
<code>@@macro($arg)@@ := @@ func_ @## @$arg( @#&quot; arg ) @;</code>, тогда вызов <code>macro(name);</code> будет преобразован в <code>func_name (&quot;name&quot;);</code></p>
<p>Примеры использования макросов:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span>    <span style="color:#8f5902;font-style:italic"># Обычные макросы (тело макроса корректное выражение)</span>
</span></span><span style="display:flex;"><span>    <span style="color:#ce5c00;font-weight:bold">@@</span> <span style="color:#000">macro</span> <span style="color:#ce5c00;font-weight:bold">@@</span>        <span style="color:#ce5c00;font-weight:bold">:=</span> <span style="color:#000">replace</span><span style="color:#000;font-weight:bold">();</span>
</span></span><span style="display:flex;"><span>    <span style="color:#ce5c00;font-weight:bold">@@</span> <span style="color:#000">macro2</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">arg</span><span style="color:#000;font-weight:bold">)</span> <span style="color:#ce5c00;font-weight:bold">@@</span>  <span style="color:#ce5c00;font-weight:bold">:=</span> <span style="color:#000;font-weight:bold">{</span> <span style="color:#000">call</span><span style="color:#000;font-weight:bold">(</span><span style="color:#ce5c00;font-weight:bold">@</span><span style="color:#a40000">$</span><span style="color:#000">arg</span><span style="color:#000;font-weight:bold">);</span> <span style="color:#000">call</span><span style="color:#000;font-weight:bold">()};</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#8f5902;font-style:italic"># Тело макросов из последовательности лексем</span>
</span></span><span style="display:flex;"><span>    <span style="color:#ce5c00;font-weight:bold">@@</span> <span style="color:#204a87;font-weight:bold">if</span><span style="color:#000;font-weight:bold">(</span><span style="color:#ce5c00;font-weight:bold">...</span><span style="color:#000;font-weight:bold">)</span> <span style="color:#ce5c00;font-weight:bold">@@</span>    <span style="color:#ce5c00;font-weight:bold">:=</span> <span style="color:#ce5c00;font-weight:bold">@@</span> <span style="color:#000;font-weight:bold">[</span> <span style="color:#ce5c00;font-weight:bold">@</span><span style="color:#a40000">$</span><span style="color:#ce5c00;font-weight:bold">...</span> <span style="color:#000;font-weight:bold">]</span><span style="color:#ce5c00;font-weight:bold">--&gt;</span> <span style="color:#ce5c00;font-weight:bold">@@</span><span style="color:#000;font-weight:bold">;</span> <span style="color:#8f5902;font-style:italic"># Выражение может быть не полным</span>
</span></span><span style="display:flex;"><span>    <span style="color:#ce5c00;font-weight:bold">@@</span> <span style="color:#204a87;font-weight:bold">elif</span><span style="color:#000;font-weight:bold">(</span><span style="color:#ce5c00;font-weight:bold">...</span><span style="color:#000;font-weight:bold">)</span> <span style="color:#ce5c00;font-weight:bold">@@</span>  <span style="color:#ce5c00;font-weight:bold">:=</span> <span style="color:#ce5c00;font-weight:bold">@@</span> <span style="color:#000;font-weight:bold">,[</span> <span style="color:#ce5c00;font-weight:bold">@</span><span style="color:#a40000">$</span><span style="color:#ce5c00;font-weight:bold">...</span> <span style="color:#000;font-weight:bold">]</span><span style="color:#ce5c00;font-weight:bold">--&gt;</span> <span style="color:#ce5c00;font-weight:bold">@@</span><span style="color:#000;font-weight:bold">;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#ce5c00;font-weight:bold">@@</span> <span style="color:#204a87;font-weight:bold">else</span> <span style="color:#ce5c00;font-weight:bold">@@</span>       <span style="color:#ce5c00;font-weight:bold">:=</span> <span style="color:#ce5c00;font-weight:bold">@@</span> <span style="color:#000;font-weight:bold">,[</span><span style="color:#ce5c00;font-weight:bold">...</span><span style="color:#000;font-weight:bold">]</span><span style="color:#ce5c00;font-weight:bold">--&gt;</span> <span style="color:#ce5c00;font-weight:bold">@@</span><span style="color:#000;font-weight:bold">;</span>
</span></span><span style="display:flex;"><span> 
</span></span><span style="display:flex;"><span>    <span style="color:#8f5902;font-style:italic"># Запись условного оператора с использованием </span>
</span></span><span style="display:flex;"><span>    <span style="color:#8f5902;font-style:italic"># определенных выше макросов</span>
</span></span><span style="display:flex;"><span>    <span style="color:#5c35cc;font-weight:bold">@if</span><span style="color:#000;font-weight:bold">(</span> <span style="color:#000">condition</span> <span style="color:#000;font-weight:bold">){</span>
</span></span><span style="display:flex;"><span>        <span style="color:#ce5c00;font-weight:bold">...</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">}</span> <span style="color:#5c35cc;font-weight:bold">@elif</span><span style="color:#000;font-weight:bold">(</span> <span style="color:#000">condition2</span> <span style="color:#000;font-weight:bold">)</span> <span style="color:#000;font-weight:bold">{</span>
</span></span><span style="display:flex;"><span>        <span style="color:#ce5c00;font-weight:bold">...</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">}</span> <span style="color:#5c35cc;font-weight:bold">@else</span> <span style="color:#000;font-weight:bold">{</span>
</span></span><span style="display:flex;"><span>        <span style="color:#ce5c00;font-weight:bold">...</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">};</span>
</span></span></code></pre></div><p>Например цикл до 5:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span>    <span style="color:#000">count</span> <span style="color:#ce5c00;font-weight:bold">:=</span> <span style="color:#0000cf;font-weight:bold">1</span><span style="color:#000;font-weight:bold">;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">[</span> <span style="color:#0000cf;font-weight:bold">1</span> <span style="color:#000;font-weight:bold">]</span> <span style="color:#ce5c00;font-weight:bold">&lt;-&gt;</span> <span style="color:#000;font-weight:bold">{</span>
</span></span><span style="display:flex;"><span>        <span style="color:#000;font-weight:bold">[</span> <span style="color:#000">count</span> <span style="color:#ce5c00;font-weight:bold">&gt;</span> <span style="color:#0000cf;font-weight:bold">5</span> <span style="color:#000;font-weight:bold">]</span> <span style="color:#ce5c00;font-weight:bold">--&gt;</span> <span style="color:#000;font-weight:bold">{</span>
</span></span><span style="display:flex;"><span>            <span style="color:#ce5c00;font-weight:bold">--</span> <span style="color:#0000cf;font-weight:bold">42</span> <span style="color:#ce5c00;font-weight:bold">--</span><span style="color:#000;font-weight:bold">;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#000;font-weight:bold">};</span>
</span></span><span style="display:flex;"><span>        <span style="color:#000">count</span><span style="color:#ce5c00;font-weight:bold">+=</span><span style="color:#0000cf;font-weight:bold">1</span><span style="color:#000;font-weight:bold">;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">};</span>
</span></span></code></pre></div><p>Будет выглядеть более привычно:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span>    <span style="color:#000">count</span> <span style="color:#ce5c00;font-weight:bold">:=</span> <span style="color:#0000cf;font-weight:bold">1</span><span style="color:#000;font-weight:bold">;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#5c35cc;font-weight:bold">@while</span><span style="color:#000;font-weight:bold">(</span> <span style="color:#000">true</span> <span style="color:#000;font-weight:bold">)</span> <span style="color:#000;font-weight:bold">{</span>
</span></span><span style="display:flex;"><span>        <span style="color:#5c35cc;font-weight:bold">@if</span><span style="color:#000;font-weight:bold">(</span> <span style="color:#000">count</span> <span style="color:#ce5c00;font-weight:bold">&gt;</span> <span style="color:#0000cf;font-weight:bold">5</span> <span style="color:#000;font-weight:bold">)</span> <span style="color:#000;font-weight:bold">{</span>
</span></span><span style="display:flex;"><span>            <span style="color:#5c35cc;font-weight:bold">@return</span> <span style="color:#0000cf;font-weight:bold">42</span><span style="color:#000;font-weight:bold">;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#000;font-weight:bold">};</span>
</span></span><span style="display:flex;"><span>        <span style="color:#000">count</span> <span style="color:#ce5c00;font-weight:bold">+=</span> <span style="color:#0000cf;font-weight:bold">1</span><span style="color:#000;font-weight:bold">;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">};</span>
</span></span></code></pre></div>

<div class="pageinfo pageinfo-primary">
<h3 id="далее-идеи-на-будущее">Далее идеи на будущее<a class="td-heading-self-link" href="#%d0%b4%d0%b0%d0%bb%d0%b5%d0%b5-%d0%b8%d0%b4%d0%b5%d0%b8-%d0%bd%d0%b0-%d0%b1%d1%83%d0%b4%d1%83%d1%89%d0%b5%d0%b5" aria-label="Heading self-link"></a></h3>
<h3 id="символьное-программирование">Символьное программирование<a class="td-heading-self-link" href="#%d1%81%d0%b8%d0%bc%d0%b2%d0%be%d0%bb%d1%8c%d0%bd%d0%be%d0%b5-%d0%bf%d1%80%d0%be%d0%b3%d1%80%d0%b0%d0%bc%d0%bc%d0%b8%d1%80%d0%be%d0%b2%d0%b0%d0%bd%d0%b8%d0%b5" aria-label="Heading self-link"></a></h3>

</div>

<blockquote>
<p>Символьное программирование, часто называемое декларативным программированием, представляет собой парадигму программирования, которая использует математическую логику, отношения и символы для представления знаний и помощи в решении проблем. Вместо того, чтобы сосредотачиваться на описании последовательности операций, необходимых для выполнения вычислений, как в императивном программировании, символическое программирование делает упор на выражении отношений и ограничений между структурами данных, уделяя особое внимание «что», а не «как».</p>
<p>В контексте парадигм программирования символическое программирование часто противопоставляется процедурному или императивному программированию, где программы определяют пошаговые процедуры для достижения своих целей. В то время как императивное программирование фокусируется на описании потока управления с использованием таких конструкций, как циклы и условные выражения, для управления выполнением, символическое программирование сосредоточено на выражении фактов о проблеме и позволяет выполнению естественным образом выводить последующие последствия из предоставленной информации.</p>
<p>Одним из основных преимуществ символьного программирования является его способность обеспечивать более высокий уровень абстракции, что упрощает анализ кода и снижает вероятность ошибок. Непосредственно выражая отношения и ограничения, символическое программирование позволяет разработчикам сосредоточиться на моделировании и спецификации проблем, позволяя базовой системе управлять реализацией и выполнением алгоритмов.</p>
<p>Существует несколько языков программирования и сред, использующих парадигму символьного программирования, например Prolog, Lisp и Haskell. Например, Пролог — это язык логического программирования, который позволяет разработчикам выражать взаимосвязи и факты о проблемных областях, в то время как выполнение автоматически обосновывает и извлекает новые факты на основе исходной информации. В том же духе Лисп, функциональный язык программирования, использует символьные вычисления для манипулирования структурами данных и выполнения сложных операций над ними, используя краткий и математически обоснованный синтаксис. Haskell, еще один функциональный язык программирования, использует строгую типизацию и ленивые вычисления, чтобы обеспечить символическое рассуждение и облегчить эффективное создание программ.</p>
<p>Символьное программирование может быть полезным в широком спектре проблемных областей, включая искусственный интеллект, экспертные системы, программирование логики ограничений и символьную математику, среди других. Более высокий уровень абстракции, обеспечиваемый декларативными языками программирования, облегчает разработку сложных систем, сводя к минимуму вероятность ошибки и улучшая удобство обслуживания. В частности, использование символьного программирования в искусственном интеллекте позволяет разработчикам создавать системы представления знаний и механизмы рассуждения, которые можно применять для обработки естественного языка, машинного обучения и автоматического доказательства теорем.</p>
</blockquote>
<p>Различие между символьным программированием и препроцессором</p>
<ul>
<li>Задача препроцессора - раскрыть(расширить) макрос, тогда как при символьном программировании нужно сокращать (сворачивать) выражения</li>
<li>Препроцессор обрабатывает последовательности лексем (плоские данные), тогда как символьное программирование оперирует выражениями (деревом лексем)</li>
<li>Макрос у препроцессора идентифицируется первым термином, и если макрос не может быть раскрыт, то возникает ошибка. В символьном программировани требуется точное соответствие всего выражения и только в этом случае производится сокращение выражения.</li>
</ul>
<p>Предпосылки для реализации символьного программирования
Компилятор - интерепретатор с REPL и обработка AST как во время компиляции, так и во время выполнения.
Необходимо добавить конструкции для определения правил символьного программрования (чистые функции?)
Необходимо добавить конструкцию для вычисления выражений в символьном программировании.</p>
<p>Wolfram
<a href="https://habr.com/ru/articles/772984/">https://habr.com/ru/articles/772984/</a></p>
<pre tabindex="0"><code>diffRules = {
  Sin[x] -&gt; Cos[x], 
  Cos[x] -&gt; -Sin[x], 
  x^2 -&gt; 2*x, 
  x -&gt; 1, 
  Log[x] -&gt; 1/x
}; 
</code></pre><pre tabindex="0"><code>diffRules := (
  Sin(x) @-&gt; Cos(x), 
  Cos(x) @-&gt; -Sin(x), 
  x^2  @-&gt;  2*x,
  x @-&gt; 1, 
  Log(x) @-&gt; 1\x,
); 

expr @-&gt; Sin(x) - x^2 + Log(x);  

# И применим к нему правила дифференцирования

#expr /. diffRules
#(* 1/x - 2 x + Cos[x] *)

sym := SymEval(expr, diffRules);
res := Eval(sym, x=0.123);
</code></pre><pre tabindex="0"><code>expr = a^2 + 3 * b^3 - c^4 + 2 * x^2 - x + 4*c + 3

И я хочу это выражение линеаризовать, т.е. отбросить все степени выше первой. Я могу сделать это напрямую, как в примерах выше:

expr /. {
  a^2 -&gt; 0, 
  b^3 -&gt; 0, 
  c^4 -&gt; 0, 
  x^2 -&gt; 0
}
(* 3 + 4 c - x *)

Но это слишком неудобно. Что если я не знаю ни точную степень, ни имя переменной? Как просто указать, что нужно заменить все места, где встречается возведение в степень на ноль? Это можно сделать при помощи шаблонов вот так:

expr /. Power[_, _] -&gt; 0
(* 3 + 4 c - x *)

Либо вот так:

expr /. _ ^ _ -&gt; 0
(* 3 + 4 c - x *)
</code></pre><pre tabindex="0"><code>:diffRules() := {
  {@ Sin(x) @} ::- {@ Cos(x) @};
  Cos(x) @-&gt; -Sin(x), 
  x^2  @-&gt;  2*x,
  x @-&gt; 1, 
  Log(x) @-&gt; 1\x,
}; 

expr @-&gt; Sin(x) - x^2 + Log(x);  

# И применим к нему правила дифференцирования

#expr /. diffRules
#(* 1/x - 2 x + Cos[x] *)

sym := SymEval(expr, diffRules);
res := Eval(sym, x=0.123);
</code></pre>
</div>



    
	
  
    
    
	
    

<div class="td-content" style="page-break-before: always">
    
	<h1 id="pg-9149371511f94b03074b553a8e82848c">1.6 - Системные свойства</h1>
    
	<h3 id="системные-свойства">Системные свойства<a class="td-heading-self-link" href="#%d1%81%d0%b8%d1%81%d1%82%d0%b5%d0%bc%d0%bd%d1%8b%d0%b5-%d1%81%d0%b2%d0%be%d0%b9%d1%81%d1%82%d0%b2%d0%b0" aria-label="Heading self-link"></a></h3>
<p>Несмотря на то, что не все объекты <em>NewLang</em> являются классами с точки зрения <a href="/ru/docs/types/class/">реализованной концепции ООП</a>,
тем не менее, каждый объект имеет системные свойства, которые можно считать во время выполнения как обычные свойства объекта:</p>
<h4 id="у-всех-переменных-объектов-есть-системные-свойства">У всех переменных (объектов) есть системные свойства<a class="td-heading-self-link" href="#%d1%83-%d0%b2%d1%81%d0%b5%d1%85-%d0%bf%d0%b5%d1%80%d0%b5%d0%bc%d0%b5%d0%bd%d0%bd%d1%8b%d1%85-%d0%be%d0%b1%d1%8a%d0%b5%d0%ba%d1%82%d0%be%d0%b2-%d0%b5%d1%81%d1%82%d1%8c-%d1%81%d0%b8%d1%81%d1%82%d0%b5%d0%bc%d0%bd%d1%8b%d0%b5-%d1%81%d0%b2%d0%be%d0%b9%d1%81%d1%82%d0%b2%d0%b0" aria-label="Heading self-link"></a></h4>
<ul>
<li>
<p>__name__ - краткое имя переменной (объекта)</p>
</li>
<li>
<p>__full_name__ - полное имя переменной, включая имя модуля и пространство имен</p>
</li>
<li>
<p>__type__ - текущий тип переменной. Может изменится при некоторых операциях</p>
</li>
<li>
<p>__type_fixed__ - тип переменной (объекта) который не может измениться (ограничитель)</p>
</li>
<li>
<p>__module__ - имя модуля в котором определена переменная (объект)</p>
</li>
<li>
<p>__class__ - имя класса переменной или пусто, если объект не является классом</p>
</li>
<li>
<p>__base__ - словарь со списком базовых классов или пусто, если объект не является классом</p>
</li>
<li>
<p>__size__ - количество элементов у объекта, если применимо или :None</p>
</li>
<li>
<p>__doc__ - документация по текущему объекту (если есть, иначе пустая строка)</p>
</li>
<li>
<p>__str__ - строковое представление объекта для дампа</p>
</li>
<li>
<p>__source__ - исходный текст модуля или функции</p>
</li>
</ul>
<h4 id="системные-свойства-у-модулей">Системные свойства у модулей<a class="td-heading-self-link" href="#%d1%81%d0%b8%d1%81%d1%82%d0%b5%d0%bc%d0%bd%d1%8b%d0%b5-%d1%81%d0%b2%d0%be%d0%b9%d1%81%d1%82%d0%b2%d0%b0-%d1%83-%d0%bc%d0%be%d0%b4%d1%83%d0%bb%d0%b5%d0%b9" aria-label="Heading self-link"></a></h4>
<ul>
<li>__file__ - полный путь к файлу модуля (соответствует С/С++ макросу __FILE__)</li>
<li>__timestamp__ - дата и время последней модификации файла модуля (соответствует макросу С/С++  __TIMESTAMP__)</li>
<li>__md5__ - хеш исходных данных модуля (соответствует макросу __MD5__)</li>
</ul>
<h2 id="dsl">DSL<a class="td-heading-self-link" href="#dsl" aria-label="Heading self-link"></a></h2>
<h3 id="особенности-ассоциативной-памяти">Особенности ассоциативной памяти<a class="td-heading-self-link" href="#%d0%be%d1%81%d0%be%d0%b1%d0%b5%d0%bd%d0%bd%d0%be%d1%81%d1%82%d0%b8-%d0%b0%d1%81%d1%81%d0%be%d1%86%d0%b8%d0%b0%d1%82%d0%b8%d0%b2%d0%bd%d0%be%d0%b9-%d0%bf%d0%b0%d0%bc%d1%8f%d1%82%d0%b8" aria-label="Heading self-link"></a></h3>
<p>Синтаксис языка <em>NewLang</em> основан на строгих правилах без использования ключевых слов,
и как бы он не выглядел логичным, ассоциация по ключевым словам вспоминается гораздо легче, например <strong>if</strong>,
чем комбинация <em>минус минус правая угловая скобка</em> <strong>&ndash;&gt;</strong>.
Из-за этого имеет смысл использовать не &ldquo;чистый&rdquo; базовый синтаксис, а более привычный диалект с использованием ключевых слов.</p>
<h3 id="синтаксис-на-ключевых-словах">Синтаксис на ключевых словах<a class="td-heading-self-link" href="#%d1%81%d0%b8%d0%bd%d1%82%d0%b0%d0%ba%d1%81%d0%b8%d1%81-%d0%bd%d0%b0-%d0%ba%d0%bb%d1%8e%d1%87%d0%b5%d0%b2%d1%8b%d1%85-%d1%81%d0%bb%d0%be%d0%b2%d0%b0%d1%85" aria-label="Heading self-link"></a></h3>
<p>В файле dsl.nlp находится набор макросов, которые расширяют базовый синтаксис <em>NewLang</em>, основанный на правилах,
набором предопределенных ключевых слов как в классических языках программирования.
А при необходимости, их можно адаптировать или дополнить под собственную предметную область.</p>
<h2 id="константы">Константы<a class="td-heading-self-link" href="#%d0%ba%d0%be%d0%bd%d1%81%d1%82%d0%b0%d0%bd%d1%82%d1%8b" aria-label="Heading self-link"></a></h2>
<h3 id="логические">Логические<a class="td-heading-self-link" href="#%d0%bb%d0%be%d0%b3%d0%b8%d1%87%d0%b5%d1%81%d0%ba%d0%b8%d0%b5" aria-label="Heading self-link"></a></h3>
<ul>
<li><strong>true</strong> - 1</li>
<li><strong>yes</strong>  - 1</li>
<li><strong>false</strong> - 0</li>
<li><strong>no</strong> - 0</li>
</ul>
<h3 id="системные-имена">Системные имена<a class="td-heading-self-link" href="#%d1%81%d0%b8%d1%81%d1%82%d0%b5%d0%bc%d0%bd%d1%8b%d0%b5-%d0%b8%d0%bc%d0%b5%d0%bd%d0%b0" aria-label="Heading self-link"></a></h3>
<ul>
<li><strong>this</strong> - Текущий объект (<strong>$0</strong>)</li>
<li><strong>parent</strong> - Родительский объект (<strong>$$</strong>)</li>
<li><strong>last</strong> - Результат выполнения последнего оператора (<strong>$^</strong>)</li>
</ul>
<p>!!!!!!!!- <strong>args</strong> - Все аргументы функции (<strong>$*</strong>)</p>
<p>!!!!!!!!- <strong>sys</strong> - Системный контекст запущенной программы (<strong>@@</strong>)
!!!!!!!!- <strong>current</strong> - Текущий модуль (<strong>@$</strong>)
!!!!!!!!- <strong>cmd</strong> - Все аргументы выполняющегося приложения из командной строки (<strong>@*</strong>)</p>
<p>!!!!!!!!!!1### Типовые функции и проверки
!!!!!!!!!!- <strong>run(&lsquo;filename&rsquo;)</strong> - Выполнить указанный файл (<strong>@@(&lsquo;filename&rsquo;)</strong>)
!!!!!!!!!!- <strong>ifmain</strong> - Проверка, если текущий модуль основной (<strong>[@$.$0] &ndash;&gt;</strong> { &hellip; })
!!!!!!!!!!- <strong>ifload</strong> - Проверка, если текущий модуль загружается впервые (<strong>[@$.<strong>load</strong>] &ndash;&gt;</strong> { &hellip; })</p>
<h3 id="операторы">Операторы<a class="td-heading-self-link" href="#%d0%be%d0%bf%d0%b5%d1%80%d0%b0%d1%82%d0%be%d1%80%d1%8b" aria-label="Heading self-link"></a></h3>
<ul>
<li>
<p><strong>match(cond)</strong> - Оператор <a href="/ru/docs/ops/match/">оценки выражения</a></p>
</li>
<li>
<p><strong>if(&hellip;)</strong> - Первый условный оператор (<strong>[$*]&ndash;&gt;</strong> { &hellip; })</p>
</li>
<li>
<p><strong>elif(&hellip;)</strong> - Второй и все последующие (<strong>,[$*]&ndash;&gt;</strong> { &hellip; })</p>
</li>
<li>
<p><strong>else</strong> - Оператор <em>иначе</em> (<strong>,[_]&ndash;&gt;</strong> { &hellip; })</p>
</li>
<li>
<p><strong>while(cond)</strong> - Оператор цикла с предусловием (<strong>[@$cond] &lt;-&gt;</strong> { &hellip; } )</p>
</li>
<li>
<p><strong>dowhile(cond)</strong> - Оператор цикла с постусловием ({ &hellip; } <strong>&lt;-&gt;[@$cond]</strong>)</p>
</li>
<li>
<p><strong>iter(obj, &hellip; )</strong> - Создание итератора ( <strong>@$obj</strong> ? (@$*) )</p>
</li>
<li>
<p><strong>next(obj, &hellip; )</strong> - Следующий элемент итератора ( <strong>@$obj</strong> ! ($*) )</p>
</li>
<li>
<p><strong>curr(obj, &hellip; )</strong> - Текущий элемент итератора ( <strong>@$obj</strong> !? ($*) )</p>
</li>
<li>
<p><strong>first(obj)</strong> - Перейти на первый элемент итератора ( <strong>@$obj</strong> !! )</p>
</li>
<li>
<p><strong>all(obj)</strong> - Получить сразу все элементы итератора ( <strong>@$obj</strong> ??)</p>
</li>
</ul>
<h3 id="прерывания">Прерывания<a class="td-heading-self-link" href="#%d0%bf%d1%80%d0%b5%d1%80%d1%8b%d0%b2%d0%b0%d0%bd%d0%b8%d1%8f" aria-label="Heading self-link"></a></h3>
<ul>
<li>
<p><strong>return</strong> - Положительное прерывание (<strong>++</strong>)</p>
</li>
<li>
<p><strong>return(&hellip;)</strong>- Положительное прерывание с возвратом значения (<strong>++</strong> @$value <strong>++</strong>)</p>
</li>
<li>
<p><strong>error</strong> - Отрицательное прерывание (<strong>--</strong>)</p>
</li>
<li>
<p><strong>error(&hellip;)</strong> - Отрицательное прерывание с возвратом значения (<strong>--</strong> @$value <strong>--</strong>)</p>
</li>
<li>
<p><strong>break+</strong> и <strong>break-</strong> - Выход из цикла:</p>
</li>
</ul>
<pre tabindex="0"><code>    while(...) {+
        ++ :Break ++   
    +}
    while(...) {-
        -- :Break --
    -}
</code></pre><ul>
<li><strong>continue+</strong> и <strong>continue-</strong> - В начало цикла:</li>
</ul>
<pre tabindex="0"><code>    while(...) {+
        ++ :Continue ++   
    +}
    while(...) {-
        -- :Continue --
    -}
</code></pre><p>obj {
.field = 1;
.prop();
};</p>
<p>#Python</p>
<h1 id="1-without-using-with-statement">1) without using with statement<a class="td-heading-self-link" href="#1-without-using-with-statement" aria-label="Heading self-link"></a></h1>
<p>file = open(&lsquo;file_path&rsquo;, &lsquo;w&rsquo;)
file.write(&lsquo;hello world !&rsquo;)
file.close()</p>
<h1 id="2-without-using-with-statement">2) without using with statement<a class="td-heading-self-link" href="#2-without-using-with-statement" aria-label="Heading self-link"></a></h1>
<p>file = open(&lsquo;file_path&rsquo;, &lsquo;w&rsquo;)
try:
file.write(&lsquo;hello world&rsquo;)
finally:
file.close()</p>
<p>open(&lsquo;file_path&rsquo;, &lsquo;w&rsquo;) {
.write(&lsquo;hello world !&rsquo;);
.close();
}</p>
<p>Python3</p>
<h1 id="using-with-statement">using with statement<a class="td-heading-self-link" href="#using-with-statement" aria-label="Heading self-link"></a></h1>
<p>with open(&lsquo;file_path&rsquo;, &lsquo;w&rsquo;) as file:
file.write(&lsquo;hello world !&rsquo;)</p>
<h1 id="a-simple-file-writer-object">a simple file writer object<a class="td-heading-self-link" href="#a-simple-file-writer-object" aria-label="Heading self-link"></a></h1>
<p>class MessageWriter(object):
def <strong>init</strong>(self, file_name):
self.file_name = file_name</p>
<pre><code>def __enter__(self):
    self.file = open(self.file_name, 'w')
    return self.file

def __exit__(self, *args):
    self.file.close()
</code></pre>
<h1 id="using-with-statement-with-messagewriter">using with statement with MessageWriter<a class="td-heading-self-link" href="#using-with-statement-with-messagewriter" aria-label="Heading self-link"></a></h1>
<p>with MessageWriter(&lsquo;my_file.txt&rsquo;) as xfile:
xfile.write(&lsquo;hello world&rsquo;)</p>
<h1 id="a-simple-file-writer-object-1">a simple file writer object<a class="td-heading-self-link" href="#a-simple-file-writer-object-1" aria-label="Heading self-link"></a></h1>
<p>:MessageWriter {
def <strong>init</strong>(self, file_name):
self.file_name = file_name</p>
<pre><code>def __enter__(self):
    self.file = open(self.file_name, 'w')
    return self.file

def __exit__(self, *args):
    self.file.close()
</code></pre>
<p>}</p>
<h1 id="using-with-statement-with-messagewriter-1">using with statement with MessageWriter<a class="td-heading-self-link" href="#using-with-statement-with-messagewriter-1" aria-label="Heading self-link"></a></h1>
<p>MessageWriter(&lsquo;my_file.txt&rsquo;) {
.write(&lsquo;hello world&rsquo;);
};</p>
<p>from contextlib import contextmanager</p>
<p>class MessageWriter(object):
def <strong>init</strong>(self, filename):
self.file_name = filename</p>
<pre><code>@contextmanager
def open_file(self):
    try:
        file = open(self.file_name, 'w')
        yield file
    finally:
        file.close()
</code></pre>
<h1 id="usage">usage<a class="td-heading-self-link" href="#usage" aria-label="Heading self-link"></a></h1>
<p>message_writer = MessageWriter(&lsquo;hello.txt&rsquo;)
with message_writer.open_file() as my_file:
my_file.write(&lsquo;hello world&rsquo;)</p>
<p>:MessageWriter(object) {
def <strong>init</strong>(self, filename):
self.file_name = filename</p>
<pre><code>@contextmanager
def open_file(self):
    try:
        file = open(self.file_name, 'w')
        yield file
    finally:
        file.close()
</code></pre>
<p>}</p>
<h1 id="usage-1">usage<a class="td-heading-self-link" href="#usage-1" aria-label="Heading self-link"></a></h1>
<p>message_writer = MessageWriter(&lsquo;hello.txt&rsquo;)
with message_writer.open_file() as my_file:
my_file.write(&lsquo;hello world&rsquo;)</p>
<h1 id="приложения">Приложения<a class="td-heading-self-link" href="#%d0%bf%d1%80%d0%b8%d0%bb%d0%be%d0%b6%d0%b5%d0%bd%d0%b8%d1%8f" aria-label="Heading self-link"></a></h1>
<h2 id="предопределенные-макросы">Предопределенные макросы<a class="td-heading-self-link" href="#%d0%bf%d1%80%d0%b5%d0%b4%d0%be%d0%bf%d1%80%d0%b5%d0%b4%d0%b5%d0%bb%d0%b5%d0%bd%d0%bd%d1%8b%d0%b5-%d0%bc%d0%b0%d0%ba%d1%80%d0%be%d1%81%d1%8b" aria-label="Heading self-link"></a></h2>
<p>При работе парсера <em>NewLang</em> автоматически формируются несколько зарезервированных макросов, часть из которых соответствуют макросам препроцессора у С/С++.
Данные предопределенные макросы можно использовать как обычные константы.</p>
<ul>
<li>
<p>__FILE__ или __FILE_NAME__ - имя и полный путь текущего файла</p>
</li>
<li>
<p>__LINE__ или __FILE_LINE__ - содержит номер текущей строки в файле</p>
</li>
<li>
<p>__FILE_TIMESTAMP__ - дату и время последней модификации текущего файла в строковом представлении</p>
</li>
<li>
<p>__FILE_MD5__ - md5 хеш текущего файла в строковом виде</p>
</li>
<li>
<p>__COUNTER__ - целочисленный счетчик, который увеличивает свое значение при каждом обращении</p>
</li>
<li>
<p>__DATE__ - дата начала запуска компилятора (имеет одно и тоже значение для всех обрабатываемых файлов)</p>
</li>
<li>
<p>__TIME__ - время начала запуска компилятора (имеет одно и тоже значение для всех обрабатываемых файлов)</p>
</li>
<li>
<p>__TIMESTAMP__ - дату и время начала запуска компилятора (например: &ldquo;Fri 19 Aug 13:32:58 2016&rdquo;)</p>
</li>
<li>
<p>__TIMESTAMP_ISO__ - дату и время начала запуска компилятора в формате ISO (например: &ldquo;2013-07-06T00:50:06Z&rdquo;)</p>
</li>
<li>
<p>__NLC_VER__ - Страшая и младшая версия компилятора NewLang (8 битное число, по 4 бита на цифру)</p>
</li>
<li>
<p>__NLC_DATE_BUILD__ - текстовая строка с датой сборки компилятора NewLang (например, &ldquo;23.06.04 20:51:39&rdquo;)</p>
</li>
<li>
<p>__NLC_SOURCE_GIT__ - текстовая строка с идентификатором исходных файлов NewLang git репозитория, использованных при сборке компилятора (например, &ldquo;v0.3.0-fef8c371&rdquo;)</p>
</li>
<li>
<p>__NLC_SOURCE_BUILD__ - дата сборки и git идентификатор исходных файлов NewLang одной текстовой строкой (например, &ldquo;v0.3.0-fef8c371 23.06.04 20:51:39&rdquo;)</p>
</li>
</ul>

</div>



    
	
  
    
    
	
    

<div class="td-content" style="page-break-before: always">
    
	<h1 id="pg-04c6f8255aa249b1ff534ba0a3c6ed5f">1.7 - Опции и настройки компилятора</h1>
    
	<h2 id="прагмы">Прагмы<a class="td-heading-self-link" href="#%d0%bf%d1%80%d0%b0%d0%b3%d0%bc%d1%8b" aria-label="Heading self-link"></a></h2>
<h3 id="предварительное-объевления-объектов">Предварительное объевления объектов<a class="td-heading-self-link" href="#%d0%bf%d1%80%d0%b5%d0%b4%d0%b2%d0%b0%d1%80%d0%b8%d1%82%d0%b5%d0%bb%d1%8c%d0%bd%d0%be%d0%b5-%d0%be%d0%b1%d1%8a%d0%b5%d0%b2%d0%bb%d0%b5%d0%bd%d0%b8%d1%8f-%d0%be%d0%b1%d1%8a%d0%b5%d0%ba%d1%82%d0%be%d0%b2" aria-label="Heading self-link"></a></h3>
<p>@__PRAGMA_DECLARE__</p>
<pre tabindex="0"><code>    @__PRAGMA_DECLARE__( func(arg) );
</code></pre><h3 id="импорт-нативной-функции--переменной">Импорт нативной функции / переменной<a class="td-heading-self-link" href="#%d0%b8%d0%bc%d0%bf%d0%be%d1%80%d1%82-%d0%bd%d0%b0%d1%82%d0%b8%d0%b2%d0%bd%d0%be%d0%b9-%d1%84%d1%83%d0%bd%d0%ba%d1%86%d0%b8%d0%b8--%d0%bf%d0%b5%d1%80%d0%b5%d0%bc%d0%b5%d0%bd%d0%bd%d0%be%d0%b9" aria-label="Heading self-link"></a></h3>
<p>@__PRAGMA_NATIVE__</p>
<pre tabindex="0"><code>    // import native int printf(char *format, ...)
    @__PRAGMA_NATIVE__( printf(format:FmtChar, ...):Int32 );
</code></pre><h3 id="управление-диагностикой-компилятора">Управление диагностикой компилятора<a class="td-heading-self-link" href="#%d1%83%d0%bf%d1%80%d0%b0%d0%b2%d0%bb%d0%b5%d0%bd%d0%b8%d0%b5-%d0%b4%d0%b8%d0%b0%d0%b3%d0%bd%d0%be%d1%81%d1%82%d0%b8%d0%ba%d0%be%d0%b9-%d0%ba%d0%be%d0%bc%d0%bf%d0%b8%d0%bb%d1%8f%d1%82%d0%be%d1%80%d0%b0" aria-label="Heading self-link"></a></h3>
<p>@__PRAGMA_DIAG__ -</p>
<pre tabindex="0"><code>        @__PRAGMA_DIAG__(push)
        @__PRAGMA_DIAG__(ignored, &#34;-Wundef&#34;)
        @__PRAGMA_DIAG__(warning, &#34;-Wformat&#34; , &#34;-Wundef&#34;, &#34;-Wuninitialized&#34;)
        @__PRAGMA_DIAG__(error, &#34;-Wuninitialized&#34;)
        @__PRAGMA_DIAG__(pop)
</code></pre><p>@__PRAGMA_MESSAGE__</p>
<pre tabindex="0"><code>    #pragma message &#34;Compiling &#34; __FILE__ &#34;...&#34;
    @__PRAGMA_MESSAGE__(&#34;Compiling &#34;, __FILE__, &#34;...&#34;)


    #define DO_PRAGMA(x) _Pragma (#x)
    #define TODO(x) DO_PRAGMA(message (&#34;TODO - &#34; #x))

    @@TODO( ... )@@ := @__PRAGMA_MESSAGE__(&#34;TODO - &#34;, @#...)

    @TODO(Remember to fix this)  # note: TODO - Remember to fix this
</code></pre><p>@__PRAGMA_WARNING__
@__PRAGMA_ERROR__</p>
<ul>
<li>@__PRAGMA_LOCATION__</li>
</ul>
<pre tabindex="0"><code>        // #line 303 &#34;location.hh&#34;
        // Prototype - @__PRAGMA_LOCATION__( pop )
        // Prototype - @__PRAGMA_LOCATION__( push ) or @__PRAGMA_LOCATION__( push, &#39;filename&#39;) or @__PRAGMA_LOCATION__( push, &#39;filename&#39;, line)
        // Prototype - @__PRAGMA_LOCATION__( line ) or @__PRAGMA_LOCATION__( line, &#39;filename&#39;)
</code></pre><h2 id="управление-макросами">Управление макросами<a class="td-heading-self-link" href="#%d1%83%d0%bf%d1%80%d0%b0%d0%b2%d0%bb%d0%b5%d0%bd%d0%b8%d0%b5-%d0%bc%d0%b0%d0%ba%d1%80%d0%be%d1%81%d0%b0%d0%bc%d0%b8" aria-label="Heading self-link"></a></h2>
<p>@__PRAGMA_EXPECTED__ - Следующий символ должен быть одним из списка</p>
<pre tabindex="0"><code>    @__PRAGMA_EXPECTED__( @\ {, @\ {*, @\ {+ ) 
        { }

    @__PRAGMA_EXPECTED__( @\ {, @\ {*, @\ {+) 
        {+ +}
</code></pre><p>@__PRAGMA_UNEXPECTED__ - Запретить использование перечисленных символов</p>
<pre tabindex="0"><code>    @__PRAGMA_UNEXPECTED__( @\{, @\{*, @\{+) 
        {- -}
    @__PRAGMA_UNEXPECTED__( @\{*, @\{+)
        {   }
</code></pre><p>@__PRAGMA_NO_MACRO__ - Следующий символ не макрос</p>
<h3 id="аннотации">Аннотации<a class="td-heading-self-link" href="#%d0%b0%d0%bd%d0%bd%d0%be%d1%82%d0%b0%d1%86%d0%b8%d0%b8" aria-label="Heading self-link"></a></h3>
<p>@__ANNOTATION_SET__</p>
<pre tabindex="0"><code>    @__ANNOTATION_SET__(name)
    @__ANNOTATION_SET__(name, &#34;value&#34;)
    @__ANNOTATION_SET__(name, 1)
</code></pre><p>@__ANNOTATION_IIF__</p>
<h3 id="не-используется-заготовки-на-будущее">Не используется (заготовки на будущее)<a class="td-heading-self-link" href="#%d0%bd%d0%b5-%d0%b8%d1%81%d0%bf%d0%be%d0%bb%d1%8c%d0%b7%d1%83%d0%b5%d1%82%d1%81%d1%8f-%d0%b7%d0%b0%d0%b3%d0%be%d1%82%d0%be%d0%b2%d0%ba%d0%b8-%d0%bd%d0%b0-%d0%b1%d1%83%d0%b4%d1%83%d1%89%d0%b5%d0%b5" aria-label="Heading self-link"></a></h3>
<p>@__PRAGMA_IGNORE__</p>
<pre tabindex="0"><code>        static const char * ignore_space = &#34;space&#34;;
        static const char * ignore_indent = &#34;indent&#34;;
        static const char * ignore_comment = &#34;comment&#34;;
        static const char * ignore_crlf = &#34;crlf&#34;;
</code></pre><ul>
<li>
<p>@__PRAGMA_INDENT_BLOCK__</p>
</li>
<li>
<p>@__PRAGMA_MACRO__ -</p>
</li>
<li>
<p>@__PRAGMA_MACRO_COND__</p>
</li>
<li>
<p>@__PRAGMA_FINALIZE__</p>
</li>
</ul>

</div>



    
	
  
    
    
	
    

<div class="td-content" style="page-break-before: always">
    
	<h1 id="pg-8e386bb5b373d09fe8bcbec82c31b73f">1.8 - Keyword syntax (DSL)</h1>
    
	<h3 id="особенности-ассоциативной-памяти">Особенности ассоциативной памяти<a class="td-heading-self-link" href="#%d0%be%d1%81%d0%be%d0%b1%d0%b5%d0%bd%d0%bd%d0%be%d1%81%d1%82%d0%b8-%d0%b0%d1%81%d1%81%d0%be%d1%86%d0%b8%d0%b0%d1%82%d0%b8%d0%b2%d0%bd%d0%be%d0%b9-%d0%bf%d0%b0%d0%bc%d1%8f%d1%82%d0%b8" aria-label="Heading self-link"></a></h3>
<p>Синтаксис языка <em>NewLang</em> основан на строгих правилах без использования ключевых слов,
и как бы он не выглядел логичным, ассоциация по ключевым словам вспоминается гораздо легче, например <strong>if</strong>,
чем комбинация <em>минус минус правая угловая скобка</em> <strong>&ndash;&gt;</strong>.
Из-за этого имеет смысл использовать не &ldquo;чистый&rdquo; базовый синтаксис, а более привычный диалект с использованием ключевых слов.</p>
<p><em>NewLang</em> уже содержит набор макросов, которые расширяют базовый синтаксис <em>NewLang</em>, основанный на правилах,
набором предопределенных ключевых слов как в классических языках программирования,
которые можно адаптировать или дополнить под собственную предметную область.</p>
<h3 id="константы">Константы<a class="td-heading-self-link" href="#%d0%ba%d0%be%d0%bd%d1%81%d1%82%d0%b0%d0%bd%d1%82%d1%8b" aria-label="Heading self-link"></a></h3>
<ul>
<li>
<p><em>@true</em> - 1</p>
</li>
<li>
<p><em>@yes</em>  - 1</p>
</li>
<li>
<p><em>@false</em> - 0</p>
</li>
<li>
<p><em>@no</em> - 0</p>
</li>
<li>
<p><em>@this</em> или <em>@self</em> - Текущий объект</p>
</li>
<li>
<p><em>@super</em> - Родительский объект</p>
</li>
<li>
<p><em>@latter</em> или <em>@last</em>- Результат выполенения последнего оператора Result of the last operation</p>
</li>
</ul>
<h3 id="логические-операторы">Логические операторы<a class="td-heading-self-link" href="#%d0%bb%d0%be%d0%b3%d0%b8%d1%87%d0%b5%d1%81%d0%ba%d0%b8%d0%b5-%d0%be%d0%bf%d0%b5%d1%80%d0%b0%d1%82%d0%be%d1%80%d1%8b" aria-label="Heading self-link"></a></h3>
<ul>
<li><em>@and</em> - Логическое <strong>И</strong></li>
<li><em>@or</em> - Логическое <strong>ИЛИ</strong></li>
<li><em>@xor</em> - Логическое <strong>Исключающее ИЛИ</strong></li>
<li><em>@not(value)</em> - Логическое отрицание</li>
</ul>
<h3 id="операторы">Операторы<a class="td-heading-self-link" href="#%d0%be%d0%bf%d0%b5%d1%80%d0%b0%d1%82%d0%be%d1%80%d1%8b" aria-label="Heading self-link"></a></h3>
<ul>
<li>
<p><em>@if(&hellip;)</em> - Первый условный оператор</p>
</li>
<li>
<p><em>@elif(&hellip;)</em> - Второй и все последующие условные операторы</p>
</li>
<li>
<p><em>@else</em> - Оператор <em>иначе</em></p>
</li>
<li>
<p><em>@while(&hellip;)</em> - Оператор цикла с предусловием</p>
</li>
<li>
<p><em>@dowhile(&hellip;)</em> - Оператор цикла с постусловием</p>
</li>
<li>
<p><em>@loop</em> - Оператор безконечного цикла</p>
</li>
<li>
<p><em>@break $label</em> - Оператор выхода из именованного именованного блока кода</p>
</li>
<li>
<p><em>@continue $label</em> - Оператор прехода на начало именованного блока кода</p>
</li>
<li>
<p><em>@return( result )</em> - Оператор возврата значения и выхода из функции</p>
</li>
<li>
<p><em>@throw( error )</em> - Оператор создания исключения и возврата ошибки</p>
</li>
<li>
<p><em>@match( &hellip; )</em> - Оператор оценки выражения</p>
</li>
<li>
<p><em>@case( &hellip; )</em> - Оператор сравнения с образцом</p>
</li>
<li>
<p><em>@default</em> - Оператор выбора по улочанию</p>
</li>
<li>
<p><em>@iter(obj, &hellip; )</em> - Создание итератора</p>
</li>
<li>
<p><em>@next(obj, &hellip; )</em> - Получить следующий элемент итератора</p>
</li>
<li>
<p><em>@curr(obj, &hellip; )</em> - Получить текущий элемент итератора</p>
</li>
<li>
<p><em>@first(obj)</em> - Перейти на первый элемент итератора</p>
</li>
<li>
<p><em>@all(obj)</em> - Получить сразу все элементы итератора</p>
</li>
<li>
<p><em>@exit(code)</em> - Завершить выполнение программы и вернуть код завершения</p>
</li>
<li>
<p><em>@abort()</em> - Прервать выполнение программы без сброса буферов на диск</p>
</li>
<li>
<p><em>@using(&hellip;)</em> - Использовать перечисленные пространства имен при <a href="/ru/docs/syntax/naming/#using">name lookup</a></p>
</li>
</ul>
<h2 id="встроенные-функции-и-проверки">Встроенные функции и проверки<a class="td-heading-self-link" href="#%d0%b2%d1%81%d1%82%d1%80%d0%be%d0%b5%d0%bd%d0%bd%d1%8b%d0%b5-%d1%84%d1%83%d0%bd%d0%ba%d1%86%d0%b8%d0%b8-%d0%b8-%d0%bf%d1%80%d0%be%d0%b2%d0%b5%d1%80%d0%ba%d0%b8" aria-label="Heading self-link"></a></h2>
<ul>
<li>
<p><em>print(format:FmtChar, &hellip;):Int32</em> - Аналог С/С++ функции printf</p>
</li>
<li>
<p><em>srand(init:Int32):None</em> - Задать начальное значение для генератору псевдослучайных чисел</p>
</li>
<li>
<p><em>rand():Int32</em> - Получить псевдослучайное число</p>
</li>
<li>
<p><em>@static_assert( &hellip; )</em> - Вычислить выражение и проверить его на истинность во время компиляции</p>
</li>
<li>
<p><em>@assert( &hellip; )</em> - Вычислить выражение и проверить его на истинность во время выполенения</p>
</li>
<li>
<p><em>@verify( &hellip; )</em> - Вычислить выражение и проверить его на истинность во время выполенения</p>
</li>
</ul>
<p><em>Если запустить компилятор с флагом <code>--nlc-no-assert</code>, тогда рантайм проверки <code>@assert</code> удаляются из текста программы,
а вычисления внутри <code>@verify</code> выполняются, но их результат игнорируется.</em></p>
<h2 id="предопределенные-макросы">Предопределенные макросы<a class="td-heading-self-link" href="#%d0%bf%d1%80%d0%b5%d0%b4%d0%be%d0%bf%d1%80%d0%b5%d0%b4%d0%b5%d0%bb%d0%b5%d0%bd%d0%bd%d1%8b%d0%b5-%d0%bc%d0%b0%d0%ba%d1%80%d0%be%d1%81%d1%8b" aria-label="Heading self-link"></a></h2>
<p>При работе парсера <em>NewLang</em> автоматически формируются несколько зарезервированных макросов,
часть из которых соответствуют макросам препроцессора у С/С++.
Данные предопределенные макросы можно использовать как обычные константы.</p>
<ul>
<li>
<p>__FILE__ или __FILE_NAME__ - имя и полный путь текущего файла</p>
</li>
<li>
<p>__LINE__ или __FILE_LINE__ - содержит номер текущей строки в файле</p>
</li>
<li>
<p>__FILE_TIMESTAMP__ - дату и время последней модификации текущего файла в строковом представлении</p>
</li>
<li>
<p>__FILE_MD5__ - md5 хеш текущего файла в строковом виде</p>
</li>
<li>
<p>__COUNTER__ - целочисленный счетчик, который увеличивает свое значение при каждом обращении</p>
</li>
<li>
<p>__DATE__ - дата начала запуска компилятора (имеет одно и тоже значение для всех обрабатываемых файлов)</p>
</li>
<li>
<p>__TIME__ - время начала запуска компилятора (имеет одно и тоже значение для всех обрабатываемых файлов)</p>
</li>
<li>
<p>__TIMESTAMP__ - дату и время начала запуска компилятора (например: &ldquo;Fri 19 Aug 13:32:58 2016&rdquo;)</p>
</li>
<li>
<p>__TIMESTAMP_ISO__ - дату и время начала запуска компилятора в формате ISO (например: &ldquo;2013-07-06T00:50:06Z&rdquo;)</p>
</li>
<li>
<p>__NLC_VER__ - Страшая и младшая версия компилятора NewLang (8 битное число, по 4 бита на цифру)</p>
</li>
<li>
<p>__NLC_DATE_BUILD__ - текстовая строка с датой сборки компилятора NewLang (например, &ldquo;23.06.04 20:51:39&rdquo;)</p>
</li>
<li>
<p>__NLC_SOURCE_GIT__ - текстовая строка с идентификатором исходных файлов NewLang git репозитория, использованных при сборке компилятора (например, &ldquo;v0.3.0-fef8c371&rdquo;)</p>
</li>
<li>
<p>__NLC_SOURCE_BUILD__ - дата сборки и git идентификатор исходных файлов NewLang одной текстовой строкой (например, &ldquo;v0.3.0-fef8c371 23.06.04 20:51:39&rdquo;)</p>
</li>
</ul>

</div>



    
	
  

    
	
  
    
    
	
    

<div class="td-content" style="page-break-before: always">
    
	<h1 id="pg-f887817d3f8d4d916ca9f49d5a5cd651">2 - Типы данных</h1>
    
	<p><em>NewLang</em> является языком с динамической типизацией и явное указание типа переменной не обязательно
и на прямую не влияет на размер памяти, котрую она занимает.
Тип переменных используется при проверке их совместимости, когда существующему объекту присваивается другое значение.</p>
<p>Присвоение нового значения переменной возможно только тогда, когда типы данных между собой совместимы или допускают автоматическое приведение.
Это справедливо как во время компиляции исходного теста, так и во время выполнения.</p>
<p><em>NewLang</em> имеет закрытую иерархическую систему типов, т.е. любой новый тип данных, которые создает пользователь,
обязательно должен быть наследником от уже существующего.
Это напоминает реализуцию ООП в яызке Java, где каждый класс имеет в своем составе наследников <em>Object</em>.</p>
<p>За счет закрытой иерархии типов реализуется и парадигма <a href="/ru/docs/types/generics/">обобщённого программирования (generics)</a>.</p>
<p>Каждый тип данных имеет <em>краткое имя</em> и функцию - конструктор.</p>
<p><em>Краткое имя</em> типа всегда начинается с символа двоеточия &ldquo;<strong>:</strong>&rdquo;
и определяется в <a href="/ru/docs/syntax/namespace/">глобальной области видимости</a>.</p>
<p>Функция - конструктора типа, имеет тоже самое <em>краткое имя</em> типа, но без символа двоеточия &ldquo;<strong>:</strong>&rdquo;,
и как и любая функция может располагаться в пользовательском <a href="/ru/docs/syntax/namespace/">пространстве имен</a>.</p>
<p>Создать новый экземпляр типа нужно вызвать функцию - конструтор типа.</p>
<p>Создать новый экземпляр типа данных можно записав <em>краткое имя типа</em> как вызов функции,
либо вызвать непосредственно функцию - конструтор типа, с указанием её полного пространства имен.</p>
<p>Типы данных могут быть синонимами, т.е. два типа данных могут иметь одинаковое <em>краткое имя</em>,
(соответствено, и одитнаковые функции конструкторы),
но сами функции должны располагаться в разных областях <a href="/ru/docs/syntax/namespace/">пространства имен</a>.</p>
<p>В этом случае, создание объекта - синонима типа, требует вызова функции конструктора с указанием её полного пространства имен,
в противном случае будет вызвана функция согласно алгоритму <a href="/ru/docs/syntax/naming/">разрешения имен (name lookup). </a>.</p>
<p>Возможно явное приведение одного типа данных к дргуому.
Для этого применяется <em>краткое имя</em> (которое начинается с символа двоеточия &ldquo;<strong>:</strong>&rdquo;), как вызов функции,
в параметрах которой передается один или несколько объектов, тип которых нужно привести к требуемому.</p>
<p>Типы данных разделяются на простые и сложные (составные).</p>
<p>Простые типы данных не могут  Поля у простых типов данных не могут быть расширены</p>
<p>Создание типов происходит согласно <a href="/ru/docs/ops/create/">правилам синтаксиса</a>.
Имя типа всегда начинается с символа двоеточия &ldquo;<strong>:</strong>&rdquo; и определяется в <a href="/ru/docs/syntax/namespace/">глобальной области видимости</a>.
Создание сложных <a href="/ru/docs/types/class/">типов (классов)</a>, может располагаться в пользовательском <a href="/ru/docs/syntax/namespace/">пространстве имен</a>.</p>
<h2 id="-в-том-числе-и-конструктор-классовrudocstypesclass">, в том числе и <a href="/ru/docs/types/class/">конструктор классов</a>,<a class="td-heading-self-link" href="#-%d0%b2-%d1%82%d0%be%d0%bc-%d1%87%d0%b8%d1%81%d0%bb%d0%b5-%d0%b8-%d0%ba%d0%be%d0%bd%d1%81%d1%82%d1%80%d1%83%d0%ba%d1%82%d0%be%d1%80-%d0%ba%d0%bb%d0%b0%d1%81%d1%81%d0%be%d0%b2rudocstypesclass" aria-label="Heading self-link"></a></h2>

</div>



    
      
  
  
  
  

  
  

  
    
    
	
    

<div class="td-content" style="page-break-before: always">
    
	<h1 id="pg-285f8fb6ac5a1e49e354b7f2805d8d62">2.1 - Иерархия типов и обобщения</h1>
    
	<p><em>NewLang</em> имеет закрытую систему типов. т.е. любой новый тип данных, которые создает пользователь,
обязательно должен быть наследником одного из уже существующих, т.е. расширять один из них.
Такой поход напоминает создание классов в языке Java, в котором каждый новый класс имеет в своих родителях класс Object.</p>
<p>С помощью обобщений (generics) можно писать код, который может работать с любым совместимым типом данных.</p>
<p>Фрагмент иерархии типов данных (<a href="/ru/docs/types/strings/">строки</a> и <a href="/ru/docs/types/numbers/">числа</a>,
а в скобках указаны синонимы типов):</p>
<pre tabindex="0"><code>:Any -+-&gt; :Arithmetic -+-&gt; :Tensor -+-&gt; :Integer --&gt; :Int64   ...  --&gt; :Int8 --&gt; :Bool
      |                |            |               (:DWord64)        (:Char)
      |                |            |                                 (:Byte)
      |                |            |
      |                |            +-&gt; :Number --&gt; :Float64 --&gt; :Float32 --&gt; :Float16 --&gt; ...
      |                |            |              (:Double)    (:Single)
      |                |            |
      |                |            +-&gt; :Complex ...
      |                | 
      |                +-&gt; :Rational
      | 
      +-&gt; :String -+-&gt; :StrChar
      |            |  (:FmtChar)
      |            |
      |            +-&gt; :StrWide
      |               (:FmtWide)
      |            
      |
     ...
</code></pre><h3 id="обобщенные-типы">Обобщенные типы<a class="td-heading-self-link" href="#%d0%be%d0%b1%d0%be%d0%b1%d1%89%d0%b5%d0%bd%d0%bd%d1%8b%d0%b5-%d1%82%d0%b8%d0%bf%d1%8b" aria-label="Heading self-link"></a></h3>
<ul>
<li><strong>:Any</strong> - обобщенный тип для всех остальных типов данных</li>
<li><strong>:Arithmetic</strong> - обобщенный тип для всех числовых типов</li>
<li><strong>:Tensor</strong> - обобщенный тип для чисел, которые можно представить в машинном формате</li>
<li><strong>:Integer</strong> - обощенный тип для всех <em>целочисленных</em> типов данных</li>
<li><strong>:Number</strong> - обощенный тип для всех чисел с <em>плавающей точкой</em></li>
<li><strong>:Complex</strong> - обощенный тип для всех <em>комплексных</em> чисел</li>
<li><strong>:String</strong> - обощенный тип для текстовых строк</li>
</ul>
<h4 id="примеры-определения-функций-с-обобщенными-типами">Примеры определения функций с обобщенными типами<a class="td-heading-self-link" href="#%d0%bf%d1%80%d0%b8%d0%bc%d0%b5%d1%80%d1%8b-%d0%be%d0%bf%d1%80%d0%b5%d0%b4%d0%b5%d0%bb%d0%b5%d0%bd%d0%b8%d1%8f-%d1%84%d1%83%d0%bd%d0%ba%d1%86%d0%b8%d0%b9-%d1%81-%d0%be%d0%b1%d0%be%d0%b1%d1%89%d0%b5%d0%bd%d0%bd%d1%8b%d0%bc%d0%b8-%d1%82%d0%b8%d0%bf%d0%b0%d0%bc%d0%b8" aria-label="Heading self-link"></a></h4>
<pre tabindex="0"><code>    only_int8(arg:Int8):Int8 :=  ... ;   # Функиця принимает и возвращает только :Int8

    any_int(arg:Integer):Integer :=  ... ;  # Функиця принимает и возвращает только целые числа

    any_tensor(arg:Tensor):Tensor :=  ... ;# Функиця принимает и возвращает любые машинные типы чисел
    
    any_any1(arg:Any):None :=  ... ; # Функиця принимает любой тип аргумента и ничего не возвращает 

    any_any2(arg) :=  ... ;     # Тип не указан - функиця можен принимать и возвращать любой тип
</code></pre>
</div>



    
	
  
    
    
	
    

<div class="td-content" style="page-break-before: always">
    
	<h1 id="pg-2e71da5909e299fdc169437e317fcce8">2.2 - Числа</h1>
    
	<p><em>NewLang</em> является языком с динамической типизацией и явное указание типа не влияет на размер памяти, занимаемой переменной.
Информация о типах используется при проверке их совместимости, когда существующему объекту присваивается значение другого типа.
Такая операция возможна только тогда, когда типы совместимы между собой и допускают автоматическое приведение.
Это справедливо как во время парсинга/компиляции исходного теста, так и во время выполнения в режимах интерпретатора и/или скомпилированного файла.</p>
<h3 id="арифметические-типы">Арифметические типы<a class="td-heading-self-link" href="#%d0%b0%d1%80%d0%b8%d1%84%d0%bc%d0%b5%d1%82%d0%b8%d1%87%d0%b5%d1%81%d0%ba%d0%b8%d0%b5-%d1%82%d0%b8%d0%bf%d1%8b" aria-label="Heading self-link"></a></h3>
<p>Все числа (кроме рациональных) в <em>NewLang</em> являются тензорами, т.е. массивами одного типа с произвольным количеством измерений и одинаковым размером столбцов в каждом.
Единичное число, это тоже тензор нулевого размера.</p>
<p>Поддерживаются только знаковые целые числа, т.к. в без знаковых числах особая нужда отсутствует,
а проблем с ними можно найти очень много на ровном месте.</p>
<blockquote>
<p><em>Проблемы без знаковых чисел (из интернета):</em><br>
Во-первых, вычитание двух без знаковых чисел, например 3 и 5. 3 минус 5 равно 4294967294,
т.к. -2 не может быть представлено как без знаковое число.
Во-вторых, непредвиденное поведение может возникнуть при смешивании целочисленных значений со знаком и без знака.
С++ может свободно преобразовывать числа со знаком и без знака, но не проверяет диапазон, чтобы убедиться,
что вы не переполняете свой тип данных.</p>
</blockquote>
<p>Имена встроенных арифметических типов: :Int8, :Int16, :Int32, :Int64, :Float16, :Float32, :Float64, :Complex16, :Complex32, :Complex64 говорят сами за себя.
И хотя среди них присуствуют названия, присущие беззнаковым числам (:Byte, :Word, :DWord и т.д.),
они являются синонимами и применяются для взаимодействия с <a href="/ru/docs/types/native/">нативным C++ кодом</a>.</p>
<h4 id="bool">Логический тип<a class="td-heading-self-link" href="#bool" aria-label="Heading self-link"></a></h4>
<p>Отдельным типом идет логический тип :Bool, который может принимать значения только 0 или 1 (<em>false</em>/<em>true</em> соответственно),
и в зависимости от выполняемой операции тоже может быть отнесен к целочисленным типам,
так и не входить в их состав (данный подход интерпретации логического типа данных был взят из библиотеки Torch).</p>
<blockquote>
<pre tabindex="0"><code>// Treat bool as a distinct &#34;category,&#34; to be consistent with type promotion
// rules (e.g. `bool_tensor + 5 -&gt; int64_tensor`). If `5` was in the same
// category as `bool_tensor`, we would not promote. Differing categories
// implies `bool_tensor += 5` is disallowed.
//
// NB: numpy distinguishes &#34;unsigned&#34; as a category to get the desired
// `bool_tensor + 5 -&gt; int64_tensor` behavior. We don&#39;t, because:
// * We don&#39;t want the performance hit of checking the runtime sign of Scalars.
// * `uint8_tensor + 5 -&gt; int64_tensor` would be undesirable.
</code></pre></blockquote>
<h3 id="indexing">Индексация тензоров<a class="td-heading-self-link" href="#indexing" aria-label="Heading self-link"></a></h3>
<p>Доступ к элементам тензора происходит по целочисленному индексу, который начинается с 0.
Для многомерного тензора, индексы элемента перечисляются в квадратных скобках через запятую.
Поддерживается доступ к элементам через отрицательный индекс, который обрабатывается точно так же,
как в Python (-1 последний элемент, -2 предпоследний и т.д.).</p>
<p>В качесте индекса тензора могут быть использованы диапазоны которые обработываются точно так же как и в Python, а так же значение :None и многоточие <code>...</code>.
Значение <em>:None</em>, т.е. отсуствие индекса, означает произвольный размер тензора в <em>одном</em> конкретном измерении,
тогда как многоточие <code>...</code> обозначет произвольную размерность <em>в любом</em> количестве измерений (поэтому может встречаться в индексе тензора только однократно).</p>
<p>Литерал тензор в тексте программы записывается в квадратных скобках с обязательной завершающей запятой,
т.е. <code>[1, 2,]</code> — это литерал одномерный тензор из двух чисел. После закрывающей скобки тип тензора может быть указан в явном виде.
Если тип не указан, то он выводится автоматически на основании указанных данных и выбирается минимально возможный байтовый размер,
который позволяет сохранить все значения без потери точности.</p>
<p>Примеры создания тензоров и преобразования их размерности можно посмотреть <a href="/ru/docs/types/convert/">тут</a>.</p>
<h3 id="rational">Рациональные числа<a class="td-heading-self-link" href="#rational" aria-label="Heading self-link"></a></h3>
<p>Для вычислений с неограниченной точностью в <em>NewLang</em> используются отдельный тип - рациональные числа.
Они записываются в форме обыкновенной дроби, в которой числитель должен быть <em>целым</em> числом, а знаменатель <em>натуральным</em> (целым без нуля).
В качестве разделителя дроби используется обратная косая черта, т.е. <code>1\1</code> - рациональное число 1, <code>-5\1</code> - рациональное числа -5 и т.д.</p>

</div>



    
	
  
    
    
	
    

<div class="td-content" style="page-break-before: always">
    
	<h1 id="pg-bbcf432d9aabb22fcdf6bdad4d9e0141">2.3 - Символьные строки</h1>
    
	<h2 id="символьные-строки">Символьные строки<a class="td-heading-self-link" href="#%d1%81%d0%b8%d0%bc%d0%b2%d0%be%d0%bb%d1%8c%d0%bd%d1%8b%d0%b5-%d1%81%d1%82%d1%80%d0%be%d0%ba%d0%b8" aria-label="Heading self-link"></a></h2>
<p><strong>NewLang</strong> поддерживает два типа строк:</p>
<ul>
<li><em>:StrChar</em> - универсальные байтовые UTF-8 строки</li>
<li><em>:StrWide</em> - системные символьные (широкие символы)</li>
</ul>
<p>Единичным элементом универсальной UTF-8 строки является один байт,
тогда как у системных символьных строк единичным элементом строки является широкий символ <em>wchar_t</em>.</p>
<p>И хотя строки различаются типами единичного элемента строки, но внутреннее представление у обоих типов строк одинаковое.
Все данные символьных строки хранятся в виде универсальной байтовой UTF-8 последовательности.</p>
<h3 id="StrChar">Байтовые строки <em>:StrChar</em><a class="td-heading-self-link" href="#StrChar" aria-label="Heading self-link"></a></h3>
<p>Единичным элементом универсальной байтовой строки является один байт (точнее <em>:Int8</em>, т.е. 8-ми битное целое число со знаком).
Количество символов байтовой строки возвращается в байтах и обращение к элементу строки по индексу происходит к байту символьной последовательности.
<em>Так как данные строки интерпретируется как последовательность UTF-8 символов, нужно соблюдать осторожность при изменении отдельных байт!</em></p>
<h3 id="StrWide">Системные строки <em>:StrWide</em><a class="td-heading-self-link" href="#StrWide" aria-label="Heading self-link"></a></h3>
<p>Единичным элементом системной строки является широкий символ <em>wchar_t</em>, а количество элементов системной символьной строки возвращается в широких символах.
Размер типа <em>wchar_t</em> зависит от операционной системы, поэтому размер одного символа :StrWide в Windows будет 2 байта, а в Linux 4 байта,
что связано с их особенностями реализации.</p>
<p>Основоне назначение системных строк - упрощение работы в текстовом терминале,
так как один символ всегда соответствует одному знакоместу без необходимости постоянного конвертирования кодовых точек UTF-8.</p>
<h3 id="format">Форматирование строк<a class="td-heading-self-link" href="#format" aria-label="Heading self-link"></a></h3>
<p>К любой переменной можно обратиться как к функции (указав после её имени круглые скобки) для создания копии/клона объекта,
а для строк, такую операцию можно использовать как шаблон при форматировании данных.</p>
<p>Форматирование строк можно сделать двумая способами:</p>
<ul>
<li>
<p>Задать строку формата с указанием типов выводимых данных (строка формата соотвествует форматированию в стандартной функции <a href="https://en.wikipedia.org/wiki/Printf">printf</a>).
Для применения такого варината форматирования у строки формата необходимо указать соответствующий тип данных
(<em>:FmtChar</em> или <em>:FmtWide</em> для обычных и широких символов соответствено).<br>
При таком способе форматирования, именнованные аргументы использовать нельзя,
а компилятор проверяет типы передаваемых значений на соответствие строке формата только <em>во время компиляции</em> текста программы.<br>
<em>Данный тип форматной строки можно использовать как последний аргумент функции для проверки
типов всех последующих аргументов на соотвестие строки формата.</em></p>
</li>
<li>
<p>Во всех остальных случаях в качестве строки формата можно использовать любые строки и именованные аргументы,
а сам формат соотвествует строке формата из библиотеки <a href="https://fmt.dev/latest/syntax.html">{fmt}</a>.<br>
Единствено отличие заключается в возможности указания не только порядкового номера аргумента, но и его имени.<br>
Проверка аргументов на соответствие строки формата производится во время клонирования строки как во время компиляции,
так и во время выполняения программы.<br>
<em>Данный способ форматирования используется по умолчанию для любых типов строк,
но проверка строки формата не выполняется в аргументах функции.</em></p>
</li>
</ul>
<p><em>Например:</em></p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span>    <span style="color:#a40000">$</span><span style="color:#000">fmt</span> <span style="color:#ce5c00;font-weight:bold">:=</span> <span style="color:#4e9a06">&#39;</span><span style="color:#4e9a06">%s</span><span style="color:#4e9a06">: </span><span style="color:#4e9a06">%d</span><span style="color:#4e9a06">&#39;</span><span style="color:#000;font-weight:bold">:</span><span style="color:#000">FmtChar</span><span style="color:#000;font-weight:bold">;</span> <span style="color:#8f5902;font-style:italic"># Форматирование как в printf</span>
</span></span><span style="display:flex;"><span>    <span style="color:#a40000">$</span><span style="color:#000">result</span> <span style="color:#ce5c00;font-weight:bold">:=</span> <span style="color:#a40000">$</span><span style="color:#000">fmt</span><span style="color:#000;font-weight:bold">(</span><span style="color:#4e9a06">&#39;value&#39;</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#0000cf;font-weight:bold">123</span><span style="color:#000;font-weight:bold">);</span> <span style="color:#8f5902;font-style:italic"># &#34;value: 123&#34; - Check compile time only! </span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#a40000">$</span><span style="color:#000">template</span> <span style="color:#ce5c00;font-weight:bold">:=</span> <span style="color:#4e9a06">&#34;</span><span style="color:#4e9a06">{name}</span><span style="color:#4e9a06"> </span><span style="color:#4e9a06">{0}</span><span style="color:#4e9a06">&#34;</span><span style="color:#000;font-weight:bold">;</span> <span style="color:#8f5902;font-style:italic"># fmt::format equivalent &#34;{1} {0}&#34;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#a40000">$</span><span style="color:#000">result</span> <span style="color:#ce5c00;font-weight:bold">:=</span> <span style="color:#a40000">$</span><span style="color:#000">template</span><span style="color:#000;font-weight:bold">(</span><span style="color:#4e9a06">&#34;шаблон&#34;</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">name</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#4e9a06">&#34;Строка&#34;</span><span style="color:#000;font-weight:bold">);</span> <span style="color:#8f5902;font-style:italic"># result = &#34;Строка шаблон&#34;</span>
</span></span></code></pre></div>
</div>



    
	
  
    
    
	
    

<div class="td-content" style="page-break-before: always">
    
	<h1 id="pg-5ac59b818595ba90474e2331217a70e7">2.4 - Словари</h1>
    
	<h2 id="объектно-ориентированное-программирование">Объектно ориентированное программирование<a class="td-heading-self-link" href="#%d0%be%d0%b1%d1%8a%d0%b5%d0%ba%d1%82%d0%bd%d0%be-%d0%be%d1%80%d0%b8%d0%b5%d0%bd%d1%82%d0%b8%d1%80%d0%be%d0%b2%d0%b0%d0%bd%d0%bd%d0%be%d0%b5-%d0%bf%d1%80%d0%be%d0%b3%d1%80%d0%b0%d0%bc%d0%bc%d0%b8%d1%80%d0%be%d0%b2%d0%b0%d0%bd%d0%b8%d0%b5" aria-label="Heading self-link"></a></h2>
<p><em>NewLang</em> поддерживает следующую концепцию объектно-ориентированного программирования:</p>
<p>Каждый объект представляет собой отдельный тип данных, который наследуется от другого типа или от одного из его наследников (что очень похоже на концепцию объектов в языке Java), а экземпляр конкретного класса создается путем вызова его типа.</p>
<p>Наследование поддерживается для типов словарь (<em>:Dictionary</em>) и класс (<em>:Class</em>) и всех их потомков.</p>
<h3 id="словарь">Словарь<a class="td-heading-self-link" href="#%d1%81%d0%bb%d0%be%d0%b2%d0%b0%d1%80%d1%8c" aria-label="Heading self-link"></a></h3>
<p>Словарь (<em>:Dictionary</em>) — набор данных произвольного типа с доступом к отдельным элементам по целочисленному индексу или по имени элемента при его наличии (это похоже и на tuple и на структуру одновременно). Словари отличаются от <a href="https://newlang.net/type_nor.html">тензоров</a> тем, что всегда имеют только одно измерение, но каждый элемент может содержать произвольное количество элементов любого типа, в том числе и другие словари.</p>
<p>Доступ к элементам словаря происходит по имени элемента, которое записывается через точку от имени переменной, либо по целочисленному индексу. Индекс начинается с 0 и как у тензоров, тоже может быть отрицательным (индекс элемента от &ldquo;конца&rdquo;).</p>
<pre tabindex="0"><code># Новый тип (класс) :NewClass
:Dict := :Dictionary() {
    _ := 1; # У поля данных имя отсутствует
    two := 2;
    name := 3; 
};
dict := :Dict(); # Экземпляр класса (1, two=2, name=3,):Dict
dict2 := :Dict(two=42); # Экземпляр класса (1, two=42, name=100,):Dict
dict3 := dict2(99, name=0); # Копия объекта dict2 (99, two=42, name=0,):Dict
</code></pre><p><em>В будущем можно будет добавить возможность указывать индексы элементов словаря с помощь диапазонов</em></p>
<pre tabindex="0"><code>$dict = :Dict[10](first=1, 4..4 = 29, 2..3 = 15, , 2..3 = 15, 7..9..2 = 7); #(first=1, 0, 15, 15, 29, 0, 0, 7, 0, 7,)
</code></pre><h4 id="словарь-как-литерал">Словарь как литерал<a class="td-heading-self-link" href="#%d1%81%d0%bb%d0%be%d0%b2%d0%b0%d1%80%d1%8c-%d0%ba%d0%b0%d0%ba-%d0%bb%d0%b8%d1%82%d0%b5%d1%80%d0%b0%d0%bb" aria-label="Heading self-link"></a></h4>
<p>Литерал с типом «словарь» в тексте программы записывается в круглых скобках с обязательной завершающей запятой, т. е. <code>(,)</code> — пустой словарь, <code>(1, 2= «2», name=3,)</code>. Для указания конкретного типа объекта у литерала, его необходимо указать после закрывающей скобки, т.е. <code>(1, two= «2», name=3,):Dict</code>.</p>
<p>Важный момент! Хоть такой объект и будет иметь указанный тип, но он будет &ldquo;неполноценным&rdquo; и содержать только те данные, которые были явно указаны в скобках, что не гарантирует корректного создания реального объекта, т.к. для создания &ldquo;правильного&rdquo; объекта требуется вызвать его тип, т.е. <code>:Dict();</code></p>
<p>Такой способ создания литералов классов используется в основном в различных операциях сравнения типов и &ldquo;утиной типизации&rdquo;, т.к. не требует доступа к рантайму, да и сам класс может быть не определен.</p>
<h3 id="перечисление-структура-и-объединение">Перечисление, структура и объединение<a class="td-heading-self-link" href="#%d0%bf%d0%b5%d1%80%d0%b5%d1%87%d0%b8%d1%81%d0%bb%d0%b5%d0%bd%d0%b8%d0%b5-%d1%81%d1%82%d1%80%d1%83%d0%ba%d1%82%d1%83%d1%80%d0%b0-%d0%b8-%d0%be%d0%b1%d1%8a%d0%b5%d0%b4%d0%b8%d0%bd%d0%b5%d0%bd%d0%b8%d0%b5" aria-label="Heading self-link"></a></h3>
<p>Существуют три отдельных типа данных, <em>:Enum</em>, <em>:Struct</em> и <em>:Union</em> — которые так же являются словарями, но на их элементы накладываются определённые ограничения. Каждый элемент должен иметь уникальное имя, а его тип данных должен быть простым, т.е. числом или строкой фиксированного размера. Эти типы данных одновременно относятся к группе <a href="/ru/docs/types/native/">нативных типов</a> и могут быть представлены в двоичном виде в одной области машинной памяти.</p>

</div>



    
	
  
    
    
	
    

<div class="td-content" style="page-break-before: always">
    
	<h1 id="pg-87e458c39073ef9693aae0a127efd7d4">2.5 - Классы</h1>
    
	<p>Тип данных <em>:Class</em> аналогичен словарю, но все его поля обязаны иметь имена (хотя доступ к свойствам класса по индексу так же возможен).
При создании экземпляра класса, создается новый тип, для которого копируются свойства и методы всех родителей.</p>
<p>Создание нового сложного типа (класса), происходит согласно <a href="/ru/docs/ops/create/">правилам синтаксиса</a> как создание нового типа
как функции в пользовательском <a href="/ru/docs/syntax/namespace/">пространстве имен</a>.
Имя типа является именем нового класса, а его вызов как функции будет вызовом конструктора.
Области видимости <a href="/ru/docs/arch/visibility.">тут</a></p>
<p>Синтаксис создание класса выглядит следующим образом:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic"># Новый тип (класс) :NewClass</span>
</span></span><span style="display:flex;"><span><span style="color:#000">ns</span><span style="color:#000;font-weight:bold">::</span><span style="color:#000">NewClass</span><span style="color:#000;font-weight:bold">()</span> <span style="color:#ce5c00;font-weight:bold">:=</span> <span style="color:#000;font-weight:bold">:</span><span style="color:#000">Class</span><span style="color:#000;font-weight:bold">()</span> <span style="color:#000;font-weight:bold">{</span> <span style="color:#8f5902;font-style:italic"># Родительские класс или несколько классов через запятую</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#8f5902;font-style:italic"># Конструктор класса - весь блок кода с определением полей и методов</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#ce5c00;font-weight:bold">@</span><span style="color:#000;font-weight:bold">::</span><span style="color:#000">static</span> <span style="color:#ce5c00;font-weight:bold">:=</span> <span style="color:#0000cf;font-weight:bold">1</span><span style="color:#000;font-weight:bold">;</span> <span style="color:#8f5902;font-style:italic"># Поле класса (у всех объектов одно значение)</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000">static</span> <span style="color:#ce5c00;font-weight:bold">:=</span> <span style="color:#0000cf;font-weight:bold">1</span><span style="color:#000;font-weight:bold">;</span> <span style="color:#8f5902;font-style:italic"># Поле класса (у всех объектов одно значение)</span>
</span></span><span style="display:flex;"><span>    <span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">field</span> <span style="color:#ce5c00;font-weight:bold">:=</span> <span style="color:#0000cf;font-weight:bold">1</span><span style="color:#000;font-weight:bold">;</span> <span style="color:#8f5902;font-style:italic"># Поле объекта</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000">func</span><span style="color:#000;font-weight:bold">()</span> <span style="color:#ce5c00;font-weight:bold">:=</span> <span style="color:#000;font-weight:bold">{};</span> <span style="color:#8f5902;font-style:italic"># Метод класса всегда статический</span>
</span></span><span style="display:flex;"><span>    <span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">method</span><span style="color:#000;font-weight:bold">()</span> <span style="color:#ce5c00;font-weight:bold">:=</span> <span style="color:#000;font-weight:bold">{};</span> <span style="color:#8f5902;font-style:italic"># Метод объекта (у каждого объекта свой)</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#ce5c00;font-weight:bold">~</span><span style="color:#000">NewClass</span><span style="color:#000;font-weight:bold">()</span> <span style="color:#000;font-weight:bold">:</span><span style="color:#ce5c00;font-weight:bold">:=</span> <span style="color:#000;font-weight:bold">{</span> <span style="color:#8f5902;font-style:italic"># Деструктор класса</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">};</span>
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">};</span>
</span></span><span style="display:flex;"><span><span style="color:#000">obj</span> <span style="color:#ce5c00;font-weight:bold">:=</span> <span style="color:#000">ns</span><span style="color:#000;font-weight:bold">::</span><span style="color:#000">NewClass</span><span style="color:#000;font-weight:bold">();</span> <span style="color:#8f5902;font-style:italic"># Экземпляр класса</span>
</span></span></code></pre></div><p>Так как <em>NewLang</em> реализует полный набор вариантов проверок при создании объектов,
то переопределения наследуемых функций не требует никаких ключевых слов:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#000">NewClass2</span><span style="color:#000;font-weight:bold">()</span> <span style="color:#ce5c00;font-weight:bold">:=</span> <span style="color:#000">NewClass</span> <span style="color:#000;font-weight:bold">{</span> <span style="color:#8f5902;font-style:italic"># Новый класс на базе существующего</span>
</span></span><span style="display:flex;"><span>    <span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">field</span> <span style="color:#000;font-weight:bold">:</span><span style="color:#ce5c00;font-weight:bold">:=</span> <span style="color:#0000cf;font-weight:bold">2</span><span style="color:#000;font-weight:bold">;</span>    <span style="color:#8f5902;font-style:italic"># Будет ошибка, т.к. поле field уже есть в базовом классе</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000">method</span><span style="color:#000;font-weight:bold">()</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000;font-weight:bold">{};</span>  <span style="color:#8f5902;font-style:italic"># Аналог override, т.к. method должен существовать в базовом классе</span>
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">};</span>
</span></span></code></pre></div><h2 id="импорт-нативных-классов--косяки">Импорт нативных классов  &lt;КОСЯКИ!!!!!&gt;<a class="td-heading-self-link" href="#%d0%b8%d0%bc%d0%bf%d0%be%d1%80%d1%82-%d0%bd%d0%b0%d1%82%d0%b8%d0%b2%d0%bd%d1%8b%d1%85-%d0%ba%d0%bb%d0%b0%d1%81%d1%81%d0%be%d0%b2--%d0%ba%d0%be%d1%81%d1%8f%d0%ba%d0%b8" aria-label="Heading self-link"></a></h2>
<p>Так же новый класс можно создать на базе нативного класса C++ с определенными ограничениями:</p>
<ul>
<li>У нативных классов можно импортировть только <em>публичные не статические методы</em> (не виртуальные???)</li>
<li>Импорт перегруженных методы пока под вопросом?</li>
<li>Импортировать и использовать поля нельзя из-за их определения как смещения в объекте, а не адресом в памяти, как тело функции.</li>
<li>Статические поля класса и статические методы использовать нельзя из-за отсутсвия на них ссылки в глобальной таблице имен.</li>
<li>У виртуальных функций есть адрес в глобальной таблице имен, но как их вызывать, пока не понятно.</li>
<li>Импортируемые методы могут удаляться из приложения линкером, если на них нет ссылки (если они не используются).</li>
<li>Используется только один нативный констурктор, который указывается при определении функции контруктора класса перед фигурными скобками.</li>
</ul>
<p>При импорте нативного класса, он указывается в качестве родителя с указанием полного пространства имен.
Вызов нативного конструктора происходит автоматически перед выполенением конструктора объекта.
Вызов нативнного деструктора происходит автоматически при удалении объекта.</p>
<p>Определение нативного класса С++:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-cpp" data-lang="cpp"><span style="display:flex;"><span><span style="color:#204a87;font-weight:bold">namespace</span> <span style="color:#000">ns</span> <span style="color:#000;font-weight:bold">{</span>
</span></span><span style="display:flex;"><span>    <span style="color:#204a87;font-weight:bold">class</span> <span style="color:#000">NativeClassCPP</span> <span style="color:#000;font-weight:bold">{</span>
</span></span><span style="display:flex;"><span>        <span style="color:#204a87;font-weight:bold">int</span> <span style="color:#000">day</span><span style="color:#000;font-weight:bold">;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#204a87;font-weight:bold">int</span> <span style="color:#000">month</span><span style="color:#000;font-weight:bold">;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#204a87;font-weight:bold">int</span> <span style="color:#000">year</span><span style="color:#000;font-weight:bold">;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#204a87;font-weight:bold">public</span><span style="color:#ce5c00;font-weight:bold">:</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#000">NativeClassCPP</span><span style="color:#000;font-weight:bold">()</span><span style="color:#ce5c00;font-weight:bold">:</span> <span style="color:#000">NativeClassCPP</span><span style="color:#000;font-weight:bold">(</span><span style="color:#0000cf;font-weight:bold">0</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#0000cf;font-weight:bold">0</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#0000cf;font-weight:bold">0</span><span style="color:#000;font-weight:bold">)</span> <span style="color:#000;font-weight:bold">{</span>
</span></span><span style="display:flex;"><span>        <span style="color:#000;font-weight:bold">}</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#000">NativeClassCPP</span><span style="color:#000;font-weight:bold">(</span><span style="color:#204a87;font-weight:bold">int</span> <span style="color:#000">day</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#204a87;font-weight:bold">int</span> <span style="color:#000">month</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#204a87;font-weight:bold">int</span> <span style="color:#000">year</span> <span style="color:#000;font-weight:bold">)</span> <span style="color:#000;font-weight:bold">{</span>
</span></span><span style="display:flex;"><span>            <span style="color:#000">setDate</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">day</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">month</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">year</span><span style="color:#000;font-weight:bold">);</span>
</span></span><span style="display:flex;"><span>        <span style="color:#000;font-weight:bold">}</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#000">std</span><span style="color:#ce5c00;font-weight:bold">::</span><span style="color:#000">string</span> <span style="color:#000">message</span><span style="color:#000;font-weight:bold">()</span>  <span style="color:#000;font-weight:bold">{</span>
</span></span><span style="display:flex;"><span>            <span style="color:#204a87;font-weight:bold">return</span> <span style="color:#000">std</span><span style="color:#ce5c00;font-weight:bold">::</span><span style="color:#000">string</span><span style="color:#000;font-weight:bold">(</span><span style="color:#4e9a06">&#34;</span><span style="color:#4e9a06">\n</span><span style="color:#4e9a06">NativeClass C++ message</span><span style="color:#4e9a06">\n</span><span style="color:#4e9a06">&#34;</span><span style="color:#000;font-weight:bold">);</span>
</span></span><span style="display:flex;"><span>        <span style="color:#000;font-weight:bold">}</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#204a87;font-weight:bold">void</span> <span style="color:#000">setDate</span><span style="color:#000;font-weight:bold">(</span><span style="color:#204a87;font-weight:bold">int</span> <span style="color:#000">date_day</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#204a87;font-weight:bold">int</span> <span style="color:#000">date_month</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#204a87;font-weight:bold">int</span> <span style="color:#000">date_year</span><span style="color:#000;font-weight:bold">)</span> <span style="color:#000;font-weight:bold">{</span>
</span></span><span style="display:flex;"><span>            <span style="color:#000">day</span>   <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">date_day</span><span style="color:#000;font-weight:bold">;</span>
</span></span><span style="display:flex;"><span>            <span style="color:#000">month</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">date_month</span><span style="color:#000;font-weight:bold">;</span>
</span></span><span style="display:flex;"><span>            <span style="color:#000">year</span>  <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">date_year</span><span style="color:#000;font-weight:bold">;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#000;font-weight:bold">}</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#204a87;font-weight:bold">void</span> <span style="color:#000">getDate</span><span style="color:#000;font-weight:bold">()</span> <span style="color:#000;font-weight:bold">{</span>
</span></span><span style="display:flex;"><span>            <span style="color:#000">cout</span> <span style="color:#ce5c00;font-weight:bold">&lt;&lt;</span> <span style="color:#4e9a06">&#34;date: &#34;</span> <span style="color:#ce5c00;font-weight:bold">&lt;&lt;</span> <span style="color:#000">day</span> <span style="color:#ce5c00;font-weight:bold">&lt;&lt;</span> <span style="color:#4e9a06">&#34;.&#34;</span> <span style="color:#ce5c00;font-weight:bold">&lt;&lt;</span> <span style="color:#000">month</span> <span style="color:#ce5c00;font-weight:bold">&lt;&lt;</span> <span style="color:#4e9a06">&#34;.&#34;</span> <span style="color:#ce5c00;font-weight:bold">&lt;&lt;</span> <span style="color:#000">year</span> <span style="color:#ce5c00;font-weight:bold">&lt;&lt;</span> <span style="color:#000">endl</span><span style="color:#000;font-weight:bold">;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#000;font-weight:bold">}</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">};</span>
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">};</span>
</span></span></code></pre></div><p>Импорт нативного класса:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#000;font-weight:bold">:</span><span style="color:#000">NativeClass</span> <span style="color:#ce5c00;font-weight:bold">:=</span> <span style="color:#ce5c00;font-weight:bold">%</span><span style="color:#000">ns</span><span style="color:#000;font-weight:bold">::</span><span style="color:#000">NativeClassCPP</span> <span style="color:#000;font-weight:bold">{</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#8f5902;font-style:italic"># Конструктор класса</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000">NativeClass</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">day</span><span style="color:#000;font-weight:bold">:</span><span style="color:#000">Int32</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#0000cf;font-weight:bold">0</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">month</span><span style="color:#000;font-weight:bold">:</span><span style="color:#000">Int32</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#0000cf;font-weight:bold">0</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">year</span><span style="color:#000;font-weight:bold">:</span><span style="color:#000">Int32</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#0000cf;font-weight:bold">0</span><span style="color:#000;font-weight:bold">)</span> <span style="color:#000;font-weight:bold">:</span><span style="color:#ce5c00;font-weight:bold">:=</span> <span style="color:#ce5c00;font-weight:bold">%</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">day</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">month</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">year</span><span style="color:#000;font-weight:bold">)</span> <span style="color:#000;font-weight:bold">{</span> 
</span></span><span style="display:flex;"><span>    <span style="color:#8f5902;font-style:italic"># Будет вызываться  NativeClassCPP(int day, int month, int year )</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">}</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#000">getDate</span><span style="color:#000;font-weight:bold">():</span><span style="color:#204a87;font-weight:bold">None</span> <span style="color:#000;font-weight:bold">:</span><span style="color:#ce5c00;font-weight:bold">:=</span> <span style="color:#ce5c00;font-weight:bold">%</span><span style="color:#000">getDate</span> <span style="color:#ce5c00;font-weight:bold">...</span><span style="color:#000;font-weight:bold">;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000">Message</span><span style="color:#000;font-weight:bold">():</span><span style="color:#000">StdString</span>  <span style="color:#000;font-weight:bold">:</span><span style="color:#ce5c00;font-weight:bold">:=</span> <span style="color:#ce5c00;font-weight:bold">%</span><span style="color:#000">message</span> <span style="color:#ce5c00;font-weight:bold">...</span><span style="color:#000;font-weight:bold">;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000">setDate</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">day</span><span style="color:#000;font-weight:bold">:</span><span style="color:#000">Int32</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">month</span><span style="color:#000;font-weight:bold">:</span><span style="color:#000">Int32</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#204a87">int</span> <span style="color:#000">year</span><span style="color:#000;font-weight:bold">:</span><span style="color:#000">Int32</span><span style="color:#000;font-weight:bold">):</span><span style="color:#204a87;font-weight:bold">None</span> <span style="color:#000;font-weight:bold">:</span><span style="color:#ce5c00;font-weight:bold">:=</span> <span style="color:#ce5c00;font-weight:bold">%</span><span style="color:#000">setDate</span><span style="color:#ce5c00;font-weight:bold">...</span><span style="color:#000;font-weight:bold">;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#ce5c00;font-weight:bold">~</span><span style="color:#000">NativeClass</span><span style="color:#000;font-weight:bold">()</span> <span style="color:#000;font-weight:bold">:</span><span style="color:#ce5c00;font-weight:bold">:=</span> <span style="color:#000;font-weight:bold">{</span>
</span></span><span style="display:flex;"><span>        <span style="color:#8f5902;font-style:italic"># Деструктор для нативного объекта вызывается автоматически</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">};</span>
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">};</span>
</span></span><span style="display:flex;"><span><span style="color:#000">obj</span> <span style="color:#ce5c00;font-weight:bold">:=</span> <span style="color:#000;font-weight:bold">:</span><span style="color:#000">NativeClass</span><span style="color:#000;font-weight:bold">();</span> <span style="color:#8f5902;font-style:italic"># Экземпляр класса</span>
</span></span><span style="display:flex;"><span><span style="color:#000">obj</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">setDate</span><span style="color:#000;font-weight:bold">(</span><span style="color:#0000cf;font-weight:bold">26</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#0000cf;font-weight:bold">03</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#0000cf;font-weight:bold">2024</span><span style="color:#000;font-weight:bold">);</span>
</span></span><span style="display:flex;"><span><span style="color:#000">obj</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">Message</span><span style="color:#000;font-weight:bold">();</span>
</span></span></code></pre></div><h2 id="интерфейсы-именование-методов-классов-и-пространства-имен">Интерфейсы, именование методов классов и пространства имен<a class="td-heading-self-link" href="#%d0%b8%d0%bd%d1%82%d0%b5%d1%80%d1%84%d0%b5%d0%b9%d1%81%d1%8b-%d0%b8%d0%bc%d0%b5%d0%bd%d0%be%d0%b2%d0%b0%d0%bd%d0%b8%d0%b5-%d0%bc%d0%b5%d1%82%d0%be%d0%b4%d0%be%d0%b2-%d0%ba%d0%bb%d0%b0%d1%81%d1%81%d0%be%d0%b2-%d0%b8-%d0%bf%d1%80%d0%be%d1%81%d1%82%d1%80%d0%b0%d0%bd%d1%81%d1%82%d0%b2%d0%b0-%d0%b8%d0%bc%d0%b5%d0%bd" aria-label="Heading self-link"></a></h2>
<p>Для создания уникальных идентификаторов на основе имен методов классов, <em>NewLang</em> использует подход, похожий на применяемый в языке Python.
При создании метода класса, создается глобальная функция с именем класса и именем метода, объединенные через разделитель области имен.
Например, в классе <code>NewClass2</code> при создании метода <code>method</code> будет создана функция с именем <code>::NewClass2::method</code>.</p>
<p>Такая схема наименований методов полностью соответствует именованию функций в пространствах имен,
и тем самым позволяет определять классы c чистыми виртуальными функциями (методами без реализации),
а в последствии определять их в пространстве имен или указав полное имя в явном виде.</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#000">ns</span><span style="color:#000;font-weight:bold">::</span> <span style="color:#000;font-weight:bold">{</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000">NewClass3</span> <span style="color:#ce5c00;font-weight:bold">:=</span> <span style="color:#000">NewClass</span><span style="color:#000;font-weight:bold">()</span> <span style="color:#000;font-weight:bold">{</span> <span style="color:#8f5902;font-style:italic"># Новый класс на базе существующего</span>
</span></span><span style="display:flex;"><span>        <span style="color:#000">virtual</span><span style="color:#000;font-weight:bold">()</span> <span style="color:#ce5c00;font-weight:bold">:=</span> <span style="color:#000">_</span><span style="color:#000;font-weight:bold">;</span> <span style="color:#8f5902;font-style:italic"># Виртуальный метод</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">};</span>
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">};</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#000">obj</span> <span style="color:#ce5c00;font-weight:bold">:=</span> <span style="color:#000">ns</span><span style="color:#000;font-weight:bold">::</span><span style="color:#000">NewClass3</span><span style="color:#000;font-weight:bold">();</span> <span style="color:#8f5902;font-style:italic"># объект создать нельзя, будет ошибка</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic"># Определить функцию для виртуального метода</span>
</span></span><span style="display:flex;"><span><span style="color:#000">ns</span><span style="color:#000;font-weight:bold">::</span><span style="color:#000">NewClass3</span><span style="color:#000;font-weight:bold">::</span><span style="color:#000">virtual</span><span style="color:#000;font-weight:bold">()</span> <span style="color:#ce5c00;font-weight:bold">:=</span> <span style="color:#000;font-weight:bold">{};</span> 
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#000">obj</span> <span style="color:#ce5c00;font-weight:bold">:=</span> <span style="color:#000">ns</span><span style="color:#000;font-weight:bold">::</span><span style="color:#000">NewClass3</span><span style="color:#000;font-weight:bold">();</span> <span style="color:#8f5902;font-style:italic"># ОК</span>
</span></span></code></pre></div><h2 id="конструкторы-деструкторы-и-финализаторы-у-объектов">Конструкторы, деструкторы и финализаторы у объектов<a class="td-heading-self-link" href="#%d0%ba%d0%be%d0%bd%d1%81%d1%82%d1%80%d1%83%d0%ba%d1%82%d0%be%d1%80%d1%8b-%d0%b4%d0%b5%d1%81%d1%82%d1%80%d1%83%d0%ba%d1%82%d0%be%d1%80%d1%8b-%d0%b8-%d1%84%d0%b8%d0%bd%d0%b0%d0%bb%d0%b8%d0%b7%d0%b0%d1%82%d0%be%d1%80%d1%8b-%d1%83-%d0%be%d0%b1%d1%8a%d0%b5%d0%ba%d1%82%d0%be%d0%b2" aria-label="Heading self-link"></a></h2>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#000">ns</span><span style="color:#000;font-weight:bold">::</span><span style="color:#000">NewClass</span><span style="color:#000;font-weight:bold">()</span> <span style="color:#ce5c00;font-weight:bold">:=</span>  <span style="color:#000">Class</span><span style="color:#000;font-weight:bold">()</span> <span style="color:#000;font-weight:bold">{</span>    <span style="color:#8f5902;font-style:italic"># Новый класс на базе существующего</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#8f5902;font-style:italic"># Блок кода функции - конструктор объекта</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#000">__NewClass__</span><span style="color:#000;font-weight:bold">()</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000;font-weight:bold">{</span><span style="color:#ce5c00;font-weight:bold">...</span><span style="color:#000;font-weight:bold">};</span> <span style="color:#8f5902;font-style:italic"># Метод с системным именем типа - деструктор объекта (вызывается сразу после удаления)</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#000">_NewClass</span><span style="color:#000;font-weight:bold">()</span> <span style="color:#ce5c00;font-weight:bold">:=</span> <span style="color:#000;font-weight:bold">{</span><span style="color:#ce5c00;font-weight:bold">...</span><span style="color:#000;font-weight:bold">};</span> <span style="color:#8f5902;font-style:italic"># Скрытый метод с именем типа - защищенный конструктор объекта ?????????????????</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000">__NewClass</span><span style="color:#000;font-weight:bold">()</span> <span style="color:#ce5c00;font-weight:bold">:=</span> <span style="color:#000;font-weight:bold">{</span><span style="color:#ce5c00;font-weight:bold">...</span><span style="color:#000;font-weight:bold">};</span> <span style="color:#8f5902;font-style:italic"># Скрытый метод с именем типа - приватный конструктор объекта ?????????????????</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">:</span><span style="color:#000">NewClass</span><span style="color:#000;font-weight:bold">(</span><span style="color:#204a87">type</span><span style="color:#000;font-weight:bold">)</span> <span style="color:#000;font-weight:bold">:</span><span style="color:#ce5c00;font-weight:bold">:=</span> <span style="color:#000;font-weight:bold">{</span><span style="color:#ce5c00;font-weight:bold">...</span><span style="color:#000;font-weight:bold">}:</span><span style="color:#000">NewClass</span><span style="color:#000;font-weight:bold">;</span> <span style="color:#8f5902;font-style:italic"># Функция для приведения типа объекта $type к типу :NewClass</span>
</span></span><span style="display:flex;"><span>    <span style="color:#ce5c00;font-weight:bold">~</span><span style="color:#000">NewClass</span><span style="color:#000;font-weight:bold">()</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000;font-weight:bold">{</span><span style="color:#ce5c00;font-weight:bold">...</span><span style="color:#000;font-weight:bold">};</span> <span style="color:#8f5902;font-style:italic"># Скрытый метод - финализатор (вызывается перед освобождением памяти)</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#000">__equals__</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">obj</span><span style="color:#000;font-weight:bold">):</span><span style="color:#000">Bool</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000;font-weight:bold">{</span> <span style="color:#000">__compare__</span><span style="color:#000;font-weight:bold">(</span><span style="color:#a40000">$</span><span style="color:#000">obj</span><span style="color:#000;font-weight:bold">)</span> <span style="color:#ce5c00;font-weight:bold">==</span> <span style="color:#0000cf;font-weight:bold">0</span> <span style="color:#000;font-weight:bold">};</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000">__compare__</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">obj</span><span style="color:#000;font-weight:bold">):</span><span style="color:#000">Int8</span> <span style="color:#ce5c00;font-weight:bold">=</span>  <span style="color:#000;font-weight:bold">{</span> <span style="color:#000;font-weight:bold">::</span> <span style="color:#000">__compare__</span><span style="color:#000;font-weight:bold">(</span><span style="color:#5c35cc;font-weight:bold">@this</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#a40000">$</span><span style="color:#000">obj</span><span style="color:#000;font-weight:bold">)</span> <span style="color:#000;font-weight:bold">};</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#000">_</span><span style="color:#000;font-weight:bold">()</span> <span style="color:#ce5c00;font-weight:bold">:=</span> <span style="color:#000;font-weight:bold">{</span><span style="color:#ce5c00;font-weight:bold">...</span><span style="color:#000;font-weight:bold">};</span> <span style="color:#8f5902;font-style:italic"># ?????????????????????????????????????</span>
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">};</span>
</span></span></code></pre></div><p>extension methods !</p>
<blockquote>
<p>Пишу на С++ последние лет 20, до этого ещё Delphi лет 10. С годами полностью отошёл от ООП в сторону data-driven design.
Классы — практически структуры, из методов как правило только декоративные геттеры.
Всё остальное — это просто функции с понятными названиями, сигнатурами и операндами-объектами таких вот классов-носителей данных и состояния.
Получается, очень легко дышится и чистенько — состояния изолированы в структуры, логика изолирована в функции.
Конечно, в C++ всё довольно печально с ООП как таковым, поскольку нет механизма <strong>extension methods — это когда вы собираете методы в класс из разных единиц трансляции</strong>
из-за этого, обычные функции C++ значительно удобнее методов класса</p>
</blockquote>
<blockquote>
<p>Основная мысль, которая почти всегда теряется при обсуждении ООП, это то, зачем он нужен и в чем его суть. Все сводится к инструментам, их правильном и неправильном использовании, практичных архитектурах и оверинженеринге.</p>
<p>Мне кажется самая главная мысль очень проста. Сложная программа это сложное состояние.
Проблема в том, что сложно следить за всей возможной суперпозицией всех деталей состояния.
Небольшое состояние гораздо проще валидировать и постоянно поддерживать целостным.
Если ты собираешь сложное состояние из простых целостных состояний, то его тоже проще поддерживать целостным (потому что нужно следить только за высокоуровневым состоянием, но не за всеми деталями)</p>
<p>Соответственно ООП - это способ описания программы как набора иерархии изолированных состояний, где операции по изменению состояний максимально приближены к состоянию.</p>
<p>Точно так же как сложную функцию можно представить как последовательность простых, так и сложное состояние можно представить комбинацией простых состояний.
Изоляция и контроль состояний и есть основная идея ООП.</p>
<p>ФП подходит с другой стороны - максимально старается избежать состояния и работать только с текущим контекстом. Подход не лишен логики, но любая программа - это прежде всего состояние.</p>
<p>Все остальное - лишь инструменты и особенности реализации. ООП может быть реализовано почти на любом языке самыми разными инструментами и не обязательно требует интерфейсов, классов, сообщений, инкапсуляции и т.д. Но разумеется современные ООП языки хорошо адаптированы для такого способа описания. В конечном итоге если подсказки или области видимости действительно не дают тебе менять состояние объекта - это и есть прямая польза на этапе понимания и доработки твоего кода. Тебе просто не нужно думать и знать о состоянии объекта, когда ты с ним не работаешь.</p>
</blockquote>
<blockquote>
<p>Главное в ООП - это то, что есть данные, и есть методы которые напрямую работают с этими данными. Это то, что можно засунуть в один объект. Другой объект, который хочет получить данные из первого объекта, обязан пользоваться публичными методами.</p>
<p>Это упрощает поддержку обратной совместимости, упрощает изоляцию объектов, упрощает версионирование в случае многократного использования одними объектами других объектов.</p>
<p>И опять таки, суть не в том, что это чем-то напоминает рест-апи или библиотеки, а в том, что это парадигма программирования, которая упрощает организацию разработки сложных проектов, в которых задействовано много разработчиков.</p>
<p>Все остальные штуки - наследование, интерфейсы и все другое - это не суть ООП, а различные варианты решения или оптимизации различных кейсов</p>
</blockquote>

</div>



    
	
  
    
    
	
    

<div class="td-content" style="page-break-before: always">
    
	<h1 id="pg-ea2890614128a399adc17f3dd15e0474">2.6 - Функции</h1>
    
	<p>Определение функции происходит с помощью операторов <a href="/ru/docs/ops/create/">создания объектов</a>,
имя функции должно соответствовать <a href="/ru/docs/syntax/naming/">правилам именования</a>,
после которого указываются круглые скобки. <em>В настоящий момент поддерживается создание функций только в качестве статических объектов
с однократной инициализацией с помощью оператора &lsquo;<strong>::=</strong>&rsquo;</em>;</p>
<p>Телом функции должен быть <a href="/ru/docs/ops/block/">блок кода</a>, который располагается в пространстве имен определения этой функции.</p>
<p>Функции поддерживают аргументы по умолчанию, а сами аргументы указываются как в Python,
т.е. вначале идут обязательные, далее идут аргументы со значениями по умолчанию,
где его имя отделяется от дефолтного значения знаком равно &ldquo;<strong>=</strong>&rdquo;.</p>
<p>Если функция допускает обработку произвольного количества аргументов,
то последним в списке параметров должно быть указано многоточие &ldquo;<strong>&hellip;</strong>&rdquo;.</p>
<p>У аргументов функции может быть указан допустимый тип данных.
Тип возвращаемого значения указывается после закрывающей скобки.</p>
<p><em>У аргументов и у типа возвращаемого значения можно указать сразу несколько допустимых типов данных.</em></p>
<p><em>Для этого их необходимо перечислить через запятую и заключить в угловые скобки, т.е.</em>*</p>
<pre tabindex="0"><code>func(arg:&lt;:Int8, :Int16, :Int32&gt;): &lt;:Int8, :Int16, :Int32&gt; ::= {$arg*$arg};
</code></pre><hr>
<p>*) Данная функциональность запланирована, но пока не реализована</p>
<p>Для создания функций используются те же правила синтаксиса и операторы, что и для создания переменных, только после имени функции обязательно должны быть указаны круглые скобки.</p>
<p>Синтаксис <em>NewLang</em> поддерживает два типа функций: обычные и чистые функции.</p>
<h2 id="обычные-функции">Обычные функции<a class="td-heading-self-link" href="#%d0%be%d0%b1%d1%8b%d1%87%d0%bd%d1%8b%d0%b5-%d1%84%d1%83%d0%bd%d0%ba%d1%86%d0%b8%d0%b8" aria-label="Heading self-link"></a></h2>
<p>Обычная функция — такие функции являются именно обычными функциями в понимании С/С++.
Внутри них можно писать совершенно любой код, включая проверки условий, циклы, вызовы других функций и т.д.
?????????????????????????????</p>
<pre tabindex="0"><code>hello(str) ::= { 
  $printf ::= :Pointer(&#39;printf(format:FmtChar, ...):Int32&#39;);
  $printf(&#39;call: %s&#39;, $str);
  $str;
};
hello(&#39;Привет, мир!&#39;);
</code></pre><h2 id="чистые-функции">Чистые функции<a class="td-heading-self-link" href="#%d1%87%d0%b8%d1%81%d1%82%d1%8b%d0%b5-%d1%84%d1%83%d0%bd%d0%ba%d1%86%d0%b8%d0%b8" aria-label="Heading self-link"></a></h2>
<p>Чистая функция — это тоже обычная функция, только в том смысле, какой в него вкладывает функциональное программирование.</p>
<p><em>У чистой функции отсутствует доступ к контексту и глобальным переменным, поэтому она может обрабатывать только те данные,
которые были ей переданы в качестве аргументов</em>.</p>
<p>Создание чистой функции происходит с помощью операторов <strong>:-</strong> или <strong>::-</strong>, а сам оператор заимствован из языка Пролог.
????????????????????????????????
Чистые фунции, так же как и обычные, тоже могут быть только статическими объектами, поэтому их нельзя определять с именами лоакльных объектов.</p>
<pre tabindex="0"><code>Sum2(arg1, arg2) ::- {$arg1+$arg2;}; # Тоже самое, но если функция с таким именем уже существует, то будет ошибка

???????????????????????????????????????????????????
Sum1(arg1, arg2) :- {$arg1+$arg2;}; # Создать или переопределить простую функцию, которая возвращает сумму аргументов
</code></pre><h3 id="лямбда-функции">Лямбда функции<a class="td-heading-self-link" href="#%d0%bb%d1%8f%d0%bc%d0%b1%d0%b4%d0%b0-%d1%84%d1%83%d0%bd%d0%ba%d1%86%d0%b8%d0%b8" aria-label="Heading self-link"></a></h3>
<p>Лямбда функции, это анонимная функция без указания имени, т.е. вместо имени функции стоит подчерк, и её нельзя вызвать по имени.
Но зато лямбда функцию можно передавать как аругмент в другие функции, например при создании <a href="/ru/docs/types/iter/">итератора</a>.</p>
<pre tabindex="0"><code>  _()::={ ... };
</code></pre><h3 id="корутины">Корутины<a class="td-heading-self-link" href="#%d0%ba%d0%be%d1%80%d1%83%d1%82%d0%b8%d0%bd%d1%8b" aria-label="Heading self-link"></a></h3>
<p>Любую функцию можно определить как корутину (сопрограмма, Coroutine) - функция, выполнение которой можно прерываться явно методами языка программирования.
В отличие от прерывания выполнения потока (thread), который реализован средствами ОС и его переключение происходит неявно и в произвольный момент времени.</p>
<pre tabindex="0"><code>  func() ::= (){ ... };
</code></pre><h2 id="переопределение-функций">Переопределение функций<a class="td-heading-self-link" href="#%d0%bf%d0%b5%d1%80%d0%b5%d0%be%d0%bf%d1%80%d0%b5%d0%b4%d0%b5%d0%bb%d0%b5%d0%bd%d0%b8%d0%b5-%d1%84%d1%83%d0%bd%d0%ba%d1%86%d0%b8%d0%b9" aria-label="Heading self-link"></a></h2>
<p>Перегрузка функций по типам аргументов <em>NewLang</em> отсуствует, поэтому нельзя создать несколько функций с однинаковым именем, но разными типами аругментов.
Но можно переопределить функцию с помощью оператора &ldquo;<strong>[]=</strong>&rdquo;, а в теле новой функции обратиться к первоначальной функции по системному имени &ldquo;<strong>$$</strong>&rdquo;.</p>
<blockquote>
<p>«Требование от субтипов: пусть φ(x) — свойство, доказуемое относительно объектов x типа T. Тогда φ(y) должно быть истинно для объектов y типа S, где S — субтип T»12.</p>
</blockquote>
<blockquote>
<p>Это называется принципом подстановки Лисков.
Я не буду вдаваться в подробности, но основной смысл в том, что любое предусловие (для типов, данных или состояния)
параметров не может быть строже, чем для супертипа, а любое постусловие не может быть слабее, чем у супертипа13.
Эта формулировка связана с методологией контрактного программирования, зародившегося примерно в то же время.</p>
</blockquote>
<p>Новая функция должна иметь аргументы, <a href="/ru/docs/types/generics/">совместимые</a> с типом аргумента первоначальной функцией.</p>
<pre tabindex="0"><code>    func(arg:Int8):Int8 ::=  ... ;

    func(arg:Int16):Int16 =  ... ; # ОК Int8 -&gt; Int16

    func(arg:String):Int16 =  ... ;  # Ошибка String -&gt; Int16

    func(arg:Int16, arg2:Int16):Int16 =  ... ;

    func(arg:Integer, ...):Integer =  ... ; # ОК обобщенные тип
</code></pre>
</div>



    
	
  
    
    
	
    

<div class="td-content" style="page-break-before: always">
    
	<h1 id="pg-4bc5f061692b860fd28bbd359babdf2c">2.7 - Итераторы</h1>
    
	<p>Итераторы в <em>NewLang</em>, как и в остальных языках программирования, предназначены для перебора элементов. Но, в отличии от итераторов в С++, итераторы <em>NewLang</em> являются самостоятельными объектами, а не указателями на отдельные элементы объекта-контейнера. Итераторы <em>NewLang</em> поддерживают фильтрацию элементов по имени за счет использования функций обратного вызова.</p>
<p>Для работы с итераторами используется следующий синтаксис:</p>
<ul>
<li><strong>?</strong> или <strong>?(</strong> текст <strong>)</strong> - создание итератора без фильтра или с <em>regex</em> фильтрацией по имени поля</li>
<li><strong>?(</strong> func, args&hellip; <strong>)</strong> - создание итератора с использованием <a href="/ru/docs/types/funcs/">лямбда функции или функции обратного вызова</a></li>
<li><strong>!</strong> или <strong>!(</strong> количество возвращаемых элементов <strong>)</strong> - перебор элементов итератора</li>
<li><strong>?!</strong> или <strong>!?</strong> - получить текущий элемент без перемещение курсора</li>
<li><strong>!!</strong> - сбросить указатель итератора в начальное состояние (на первый элемент)</li>
<li><strong>??</strong> - создать итератор и сразу его выполнить, возвращая все значения в виде элементов словаря максимально возможного размера.
Это своего рода синтаксический сахар для краткой записи последовательности команд <code>?; !(9223372036854775807);</code>,
что удобно использовать при отладке для вывода значений переменных.</li>
</ul>
<p>Для работы с итераторами можно использовании DSL операторы:</p>
<ul>
<li><strong>iter()</strong> - Создать итератор (<strong>?</strong>)</li>
<li><strong>next()</strong> - перебор элементов итератора (<strong>!</strong> или <strong>!(</strong> количество возвращаемых элементов <strong>)</strong>)</li>
<li><strong>curr()</strong> -  Получить текущий элемент без перемещение курсора (<strong>?!</strong> или <strong>!?</strong>)</li>
<li><strong>first()</strong> - Сбросить указатель итератора на первый элемент (<strong>!!</strong>)</li>
<li><strong>all()</strong> - Создать итератор и сразу его выполнить (<strong>??</strong>)</li>
</ul>
<p>Примеры создания итераторов с разными фильтрами отбора данных:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#204a87">iter</span> <span style="color:#ce5c00;font-weight:bold">:=</span> <span style="color:#204a87">dict</span> <span style="color:#a40000">?</span> <span style="color:#000;font-weight:bold">(</span><span style="color:#4e9a06">&#34;name&#34;</span><span style="color:#000;font-weight:bold">);</span> <span style="color:#8f5902;font-style:italic"># Создание итератора для значений с указанным именем</span>
</span></span><span style="display:flex;"><span><span style="color:#204a87">iter</span> <span style="color:#ce5c00;font-weight:bold">:=</span> <span style="color:#204a87">dict</span> <span style="color:#a40000">?</span> <span style="color:#000;font-weight:bold">(</span><span style="color:#4e9a06">&#34;regex.&#34;</span><span style="color:#000;font-weight:bold">);</span> <span style="color:#8f5902;font-style:italic"># Создание итератора для полей с префиксом &#34;regex&#34;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic"># Чистая функция для фильтрации по значению</span>
</span></span><span style="display:flex;"><span><span style="color:#204a87">filter</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">value</span><span style="color:#000;font-weight:bold">)</span> <span style="color:#000;font-weight:bold">:</span><span style="color:#ce5c00;font-weight:bold">-</span> <span style="color:#000;font-weight:bold">{</span> <span style="color:#a40000">$</span><span style="color:#000">value</span> <span style="color:#ce5c00;font-weight:bold">&amp;&amp;</span> <span style="color:#a40000">$</span><span style="color:#000">value</span> <span style="color:#ce5c00;font-weight:bold">&lt;</span> <span style="color:#0000cf;font-weight:bold">10</span><span style="color:#000;font-weight:bold">;</span> <span style="color:#000;font-weight:bold">};</span> 
</span></span><span style="display:flex;"><span><span style="color:#204a87">iter</span> <span style="color:#ce5c00;font-weight:bold">:=</span> <span style="color:#204a87">dict</span> <span style="color:#a40000">?</span> <span style="color:#000;font-weight:bold">(</span><span style="color:#204a87">filter</span><span style="color:#000;font-weight:bold">);</span> <span style="color:#8f5902;font-style:italic"># Создание итератора для значений меньше 10</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#000">equal</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">value</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">arg</span><span style="color:#000;font-weight:bold">)</span> <span style="color:#ce5c00;font-weight:bold">:=</span> <span style="color:#000;font-weight:bold">{</span> <span style="color:#a40000">$</span><span style="color:#000">value</span> <span style="color:#ce5c00;font-weight:bold">==</span> <span style="color:#000">arg</span> <span style="color:#000;font-weight:bold">};</span> <span style="color:#8f5902;font-style:italic"># Обычная функция</span>
</span></span><span style="display:flex;"><span><span style="color:#204a87">iter</span> <span style="color:#ce5c00;font-weight:bold">:=</span> <span style="color:#204a87">dict</span> <span style="color:#a40000">?</span> <span style="color:#000;font-weight:bold">(</span><span style="color:#000">equal</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#0000cf;font-weight:bold">100</span><span style="color:#000;font-weight:bold">);</span> <span style="color:#8f5902;font-style:italic"># Создать итератор только для значений 100</span>
</span></span></code></pre></div><p>Оператор перебора элементов итератора <strong>!</strong> возвращает текущий элемент и сдвигает указатель на следующий. Точнее, на количество считанных элементов, так как прочитать элементы из итератора можно не только по одному, а и заданными порциями, например по 10 за один раз, <code>iter ! (10);</code>.</p>
<p>Если указать количество считываемых элементов <strong>!(0)</strong>, то будет возвращен сам элемент, но для значений отличных от нуля будет возвращаться не элемент данных, а словарь с данными, считанными из итератора. Из-за этого операторы <strong>!</strong> и <strong>!(0)</strong> <strong>НЕ</strong> эквивалентны, т.к. по разному обрабатывают конец данных.</p>
<p>Лучше всего это показать на примерах для словаря с пятью элементами:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#204a87">dict</span> <span style="color:#ce5c00;font-weight:bold">:=</span> <span style="color:#000;font-weight:bold">(</span><span style="color:#0000cf;font-weight:bold">1</span><span style="color:#000;font-weight:bold">,</span><span style="color:#0000cf;font-weight:bold">2</span><span style="color:#000;font-weight:bold">,</span><span style="color:#0000cf;font-weight:bold">3</span><span style="color:#000;font-weight:bold">,</span><span style="color:#0000cf;font-weight:bold">4</span><span style="color:#000;font-weight:bold">,</span><span style="color:#0000cf;font-weight:bold">5</span><span style="color:#000;font-weight:bold">,)</span><span style="color:#a40000">?</span><span style="color:#000;font-weight:bold">;</span> <span style="color:#8f5902;font-style:italic"># Создать итератор для словаря</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#204a87">dict</span><span style="color:#a40000">!</span><span style="color:#000;font-weight:bold">;</span> <span style="color:#8f5902;font-style:italic"># -&gt; 1</span>
</span></span><span style="display:flex;"><span><span style="color:#204a87">dict</span><span style="color:#a40000">!</span><span style="color:#000;font-weight:bold">;</span> <span style="color:#8f5902;font-style:italic"># -&gt; 2</span>
</span></span><span style="display:flex;"><span><span style="color:#204a87">dict</span><span style="color:#a40000">!</span><span style="color:#000;font-weight:bold">;</span> <span style="color:#8f5902;font-style:italic"># -&gt; 3</span>
</span></span><span style="display:flex;"><span><span style="color:#204a87">dict</span><span style="color:#a40000">!</span><span style="color:#000;font-weight:bold">;</span> <span style="color:#8f5902;font-style:italic"># -&gt; 4</span>
</span></span><span style="display:flex;"><span><span style="color:#204a87">dict</span><span style="color:#a40000">!</span><span style="color:#000;font-weight:bold">;</span> <span style="color:#8f5902;font-style:italic"># -&gt; 5</span>
</span></span><span style="display:flex;"><span><span style="color:#204a87">dict</span><span style="color:#a40000">!</span><span style="color:#000;font-weight:bold">;</span> <span style="color:#8f5902;font-style:italic"># -&gt; будет исключение &#34;конец итератора&#34;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic"># Но</span>
</span></span><span style="display:flex;"><span><span style="color:#204a87">dict</span> <span style="color:#a40000">!</span><span style="color:#000;font-weight:bold">(</span><span style="color:#0000cf;font-weight:bold">0</span><span style="color:#000;font-weight:bold">);</span> <span style="color:#8f5902;font-style:italic"># -&gt; (1,)</span>
</span></span><span style="display:flex;"><span><span style="color:#204a87">dict</span> <span style="color:#a40000">!</span><span style="color:#000;font-weight:bold">(</span><span style="color:#0000cf;font-weight:bold">0</span><span style="color:#000;font-weight:bold">);</span> <span style="color:#8f5902;font-style:italic"># -&gt; (2,)</span>
</span></span><span style="display:flex;"><span><span style="color:#204a87">dict</span> <span style="color:#a40000">!</span><span style="color:#000;font-weight:bold">(</span><span style="color:#0000cf;font-weight:bold">0</span><span style="color:#000;font-weight:bold">);</span> <span style="color:#8f5902;font-style:italic"># -&gt; (3,)</span>
</span></span><span style="display:flex;"><span><span style="color:#204a87">dict</span> <span style="color:#a40000">!</span><span style="color:#000;font-weight:bold">(</span><span style="color:#0000cf;font-weight:bold">0</span><span style="color:#000;font-weight:bold">);</span> <span style="color:#8f5902;font-style:italic"># -&gt; (4,)</span>
</span></span><span style="display:flex;"><span><span style="color:#204a87">dict</span> <span style="color:#a40000">!</span><span style="color:#000;font-weight:bold">(</span><span style="color:#0000cf;font-weight:bold">0</span><span style="color:#000;font-weight:bold">);</span> <span style="color:#8f5902;font-style:italic"># -&gt; (5,)</span>
</span></span><span style="display:flex;"><span><span style="color:#204a87">dict</span> <span style="color:#a40000">!</span><span style="color:#000;font-weight:bold">(</span><span style="color:#0000cf;font-weight:bold">0</span><span style="color:#000;font-weight:bold">);</span> <span style="color:#8f5902;font-style:italic"># -&gt; (,) - вернется пустой словарь</span>
</span></span></code></pre></div><p>Так же для чтения итератора можно указывать и отрицательное количество элементов. В этом случае будет возвращаться словарь всегда указанного размера, но элементы в словаре будут присутствовать только в случае чтения реальных данных из итератора:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#204a87">dict</span> <span style="color:#ce5c00;font-weight:bold">:=</span> <span style="color:#000;font-weight:bold">(</span><span style="color:#0000cf;font-weight:bold">1</span><span style="color:#000;font-weight:bold">,</span><span style="color:#0000cf;font-weight:bold">2</span><span style="color:#000;font-weight:bold">,</span><span style="color:#0000cf;font-weight:bold">3</span><span style="color:#000;font-weight:bold">,</span><span style="color:#0000cf;font-weight:bold">4</span><span style="color:#000;font-weight:bold">,</span><span style="color:#0000cf;font-weight:bold">5</span><span style="color:#000;font-weight:bold">,)</span> <span style="color:#a40000">?</span><span style="color:#000;font-weight:bold">;</span> <span style="color:#8f5902;font-style:italic"># Итератор для словаря с пятью элементами</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#204a87">dict</span> <span style="color:#a40000">!</span><span style="color:#000;font-weight:bold">(</span><span style="color:#0000cf;font-weight:bold">3</span><span style="color:#000;font-weight:bold">);</span> <span style="color:#8f5902;font-style:italic"># -&gt; (1,2,3,)</span>
</span></span><span style="display:flex;"><span><span style="color:#204a87">dict</span> <span style="color:#a40000">!</span><span style="color:#000;font-weight:bold">(</span><span style="color:#0000cf;font-weight:bold">3</span><span style="color:#000;font-weight:bold">);</span> <span style="color:#8f5902;font-style:italic"># -&gt; (4,5,)</span>
</span></span><span style="display:flex;"><span><span style="color:#204a87">dict</span> <span style="color:#a40000">!</span><span style="color:#000;font-weight:bold">(</span><span style="color:#0000cf;font-weight:bold">3</span><span style="color:#000;font-weight:bold">);</span> <span style="color:#8f5902;font-style:italic"># -&gt; (,)</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic"># Но</span>
</span></span><span style="display:flex;"><span><span style="color:#204a87">dict</span> <span style="color:#a40000">!</span><span style="color:#000;font-weight:bold">(</span><span style="color:#ce5c00;font-weight:bold">-</span><span style="color:#0000cf;font-weight:bold">3</span><span style="color:#000;font-weight:bold">);</span> <span style="color:#8f5902;font-style:italic"># -&gt; (1,2,3,)</span>
</span></span><span style="display:flex;"><span><span style="color:#204a87">dict</span> <span style="color:#a40000">!</span><span style="color:#000;font-weight:bold">(</span><span style="color:#ce5c00;font-weight:bold">-</span><span style="color:#0000cf;font-weight:bold">3</span><span style="color:#000;font-weight:bold">);</span> <span style="color:#8f5902;font-style:italic"># -&gt; (4,5, :IteratorEnd)</span>
</span></span><span style="display:flex;"><span><span style="color:#204a87">dict</span> <span style="color:#a40000">!</span><span style="color:#000;font-weight:bold">(</span><span style="color:#ce5c00;font-weight:bold">-</span><span style="color:#0000cf;font-weight:bold">3</span><span style="color:#000;font-weight:bold">);</span> <span style="color:#8f5902;font-style:italic"># -&gt; (:IteratorEnd, :IteratorEnd, :IteratorEnd)</span>
</span></span></code></pre></div>
</div>



    
	
  
    
    
	
    

<div class="td-content" style="page-break-before: always">
    
	<h1 id="pg-55daef0bebbb47d29e197c70931395ea">2.8 - Другие типы данных</h1>
    
	<h3 id="пусто-none">Пусто (:None)<a class="td-heading-self-link" href="#%d0%bf%d1%83%d1%81%d1%82%d0%be-none" aria-label="Heading self-link"></a></h3>
<p><em>:None</em> (пусто) — не содержит значения (точнее имеет одно значение <em>:None</em>). Указывается в тексте программы как один подчерк «_». Значение <em>None</em> имеют не инициализированные переменные и при попытке чтения из такой переменной возникает ошибка.</p>
<p>Тип переменной может быть явно указан или выведен автоматически из присваиваемого значения. Присвоить новое значение уже инициализированной переменной можно только для совместимого типа, так как неявное преобразование типов не допускаются.</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>    <span style="color:#000">$var</span> :<span style="color:#ce5c00;font-weight:bold">=</span> _<span style="color:#000;font-weight:bold">;</span> <span style="color:#8f5902;font-style:italic"># Создать не инициализированную переменную</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000">$var2</span> :<span style="color:#ce5c00;font-weight:bold">=</span> var<span style="color:#000;font-weight:bold">;</span> <span style="color:#8f5902;font-style:italic"># Ошибка!!! Нельзя прочитать не инициализированную переменную var</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000">$var</span> <span style="color:#ce5c00;font-weight:bold">=</span> 1000<span style="color:#000;font-weight:bold">;</span> <span style="color:#8f5902;font-style:italic"># У переменной будет тип Short (минимальный размер для хранения значения)</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000">$var</span> <span style="color:#ce5c00;font-weight:bold">=</span> 0,5<span style="color:#000;font-weight:bold">;</span> <span style="color:#8f5902;font-style:italic"># Ошибка!!! Short ← Float не совместимы</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000">$var</span> <span style="color:#ce5c00;font-weight:bold">=</span> _<span style="color:#000;font-weight:bold">;</span> <span style="color:#8f5902;font-style:italic"># Очистить значение переменной</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000">$var</span> <span style="color:#ce5c00;font-weight:bold">=</span> 0,5<span style="color:#000;font-weight:bold">;</span> <span style="color:#8f5902;font-style:italic"># Теперь можно, т. к. None совместим с любым типом</span>
</span></span></code></pre></div><h3 id="диапазон-range">Диапазон (:Range)<a class="td-heading-self-link" href="#%d0%b4%d0%b8%d0%b0%d0%bf%d0%b0%d0%b7%d0%be%d0%bd-range" aria-label="Heading self-link"></a></h3>
<p>Диапазон — специальный тип данных, являющейся приблизительным аналогом типа «генератор» в Python. К диапазону можно обращаться как к итератору и он будет поочередно выдавать элементы в указанном интервале с заданным шагом. Диапазон в тексте программы указывается как два или три элемента через две точки, например 1..5 — диапазон от единицы до пяти с шагом по умолчанию 1. В качестве параметров диапазона можно указывать не только литералы, но и имена переменных и даже рациональные числа. Например, 0,1..$stop..0,1 — диапазон от 0,1 до значения, указанного в переменной $stop с шагом 0,1 или 0..1\10 - диапазон рациональных числе от 0 до 10.</p>
<p>Диапазон целых чисел можно использовать в качестве индекса у тензоров (точнее, у любых объектов, которые допускают доступ к своим элементам по индексу, т.е. тензоры, словари и текстовые строки). Фактический, это поведение аналогично slice в языке Python и array[1:5] в Python означает тоже самое, что и array[1..5] в <em>NewLang</em>.</p>
<p>В качестве индекса у тензоров еще можно указать произвольное количество измерений с помощью многоточия, т.е.</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>    <span style="color:#000">$tensor</span><span style="color:#ce5c00;font-weight:bold">[</span>…, 0<span style="color:#ce5c00;font-weight:bold">]</span> <span style="color:#ce5c00;font-weight:bold">=</span> 0<span style="color:#000;font-weight:bold">;</span> <span style="color:#8f5902;font-style:italic"># Обнулить все первые элементы в каждом измерении.</span>
</span></span></code></pre></div><p><em>В будущем можно будет добавить возможность указывать индексы элементов с помощь диапазонов</em></p>
<pre tabindex="0"><code>$tensor = :Tensor[12](4..4 = 29, 2..3 = 15, , 7..9..2 = 7, 10 ...); # [0, 0, 15, 15, 29, 0, 0, 7, 0, 7, 10, 10,]
</code></pre><h3 id="поток-thread">Поток (:Thread)<a class="td-heading-self-link" href="#%d0%bf%d0%be%d1%82%d0%be%d0%ba-thread" aria-label="Heading self-link"></a></h3>
<p>Поток — специальный тип данных, который запускает функцию в отдельном потоке, который выполнтеся паралельно основному потоку приложения.
Поток созадется в остановленном виде и для его запуска необходимо вызвать метод start(), а чтобы дождаться завершения потока вызывается метод join().</p>
<pre tabindex="0"><code>    rand():Int32 := %rand;
    usleep(usec:DWord64):None := %usleep;
    printf(format:FmtChar, ...):Int32 := %printf;

    func(count:Integer, target:String) := {
        $iter := 1..$count?; # Итератор для диапазона от 1 до $count
        [ $iter ?! ] &lt;-&gt; {   # Цикл, пока итератор валидный
            
            $step := $iter!;  # Получить текущий и перейти на следующий элемент итератора
            
            printf(&#39;Number %d from %s!&#39;, $step, $target);
                
            usleep( rand() % 1000 );    # Случайная задержка

        }
    }

    thread = :Thread(func, 5, &#39;thread&#39;);

    thread.start();

    func(5, &#39;main&#39;);

    thread.join();
</code></pre><p>Number 1 from the thread!
Number 1 from the main!
Number 2 from the thread!
Number 2 from the main!
Number 3 from the thread!
Number 4 from the thread!
Number 3 from the main!
Number 4 from the main!
Number 5 from the main!
Number 5 from the thread!</p>
<p>Условные переменные (condvars).
Сходны с событиями, но не являются объектами, занимающими память — используется только адрес переменной,
понятие «содержимое переменной» не существует, в качестве условной переменной может использоваться адрес произвольного объекта.
В отличие от событий, установка условной переменной в просигнализированное состояние не влечёт за собой никаких последствий в случае,
если на данный момент нет потоков, ожидающих на переменной. Установка события в аналогичном случае влечёт за собой запоминание состояния
«просигнализировано» внутри самого события, после чего следующие потоки, желающие ожидать события, продолжают исполнение немедленно без остановки.
Для полноценного использования такого объекта необходима также операция «освободить mutex и ожидать условную переменную атомарно».
Активно используются в UNIX-подобных ОС.
Дискуссии о преимуществах и недостатках событий и условных переменных являются заметной частью дискуссий о преимуществах и недостатках Windows и UNIX.</p>
<p>ERESOURCE. Мьютекс, поддерживающий рекурсивный захват, с семантикой разделяемого или эксклюзивного захвата.
Семантика: объект может быть либо свободен, либо захвачен произвольным числом потоков разделяемым образом,
либо захвачен всего одним потоком эксклюзивным образом. Любые попытки осуществить захваты, нарушающее это правило,
приводят к блокировке потока до тех пор, пока объект не освободится так, чтобы сделать захват разрешённым.
Также есть операции вида TryToAcquire — никогда не блокирует поток, либо захватывает, либо (если нужна блокировка) возвращает FALSE,
ничего не делая. Используется в ядре Windows, особенно в файловых системах — так, например,
любому кем-то открытому дисковому файлу соответствует структура FCB, в которой есть 2 таких объекта для синхронизации доступа к размеру файла.
Один из них — paging IO resource — захватывается эксклюзивно только в пути обрезания файла, и гарантирует,
что в момент обрезания на файле нет активного ввода-вывода от кэша и от отображения в память.</p>
<h3 id="интерфейс-операционной-системы-system">Интерфейс операционной системы (:System)<a class="td-heading-self-link" href="#%d0%b8%d0%bd%d1%82%d0%b5%d1%80%d1%84%d0%b5%d0%b9%d1%81-%d0%be%d0%bf%d0%b5%d1%80%d0%b0%d1%86%d0%b8%d0%be%d0%bd%d0%bd%d0%be%d0%b9-%d1%81%d0%b8%d1%81%d1%82%d0%b5%d0%bc%d1%8b-system" aria-label="Heading self-link"></a></h3>
<p>Для доступа к различным функциям операционной системы <em>NewLang</em> предоставляет специальный тип данных <strong>:System</strong>.
Он позволяет запускать системные команды и переопределять для них параметры системного окружения.</p>
<p>Выполнение команды происходит при вызове метода <code>run()</code>, которому нужно передать имя системной команды и при необходимости дополнительные аргументы командной строки.</p>
<p>Результат выполнения команды (текстовый вывод, код завершения и т.д.) доступен как отдельные свойства объекта.</p>
<p>Пример:</p>
<pre tabindex="0"><code>    :System().run(&#34;echo&#34;, &#34;Hello from the other side!&#34;);

    os := :System();
    
    home_dir := os.run(&#34;cd&#34;, &#34;~&#34;);
    printf(&#34;`cd ~` ran with exit code %d&#34;, os.exitcode());

    unknown_dir := os.run(&#34;cd&#34;, &#34;doesnotexist&#34;);
    printf(&#34;`cd doesnotexis` ran with exit code %d&#34;, os.exitcode());
</code></pre><p>Первая строка делает запускает команду echo.</p>
<p>Потом создается объект :System и далее мы создаем две переменные, в которых хранятся результаты этой выполнения команды <code>cd</code>,
которые изменяют каталог на домашнюю папку и на несуществующую папку.</p>
<p>Запустив этот файл, мы увидим:</p>
<pre tabindex="0"><code>    Hello from the other side!
    `cd ~` ran with exit code 0
    sh: line 0: cd: doesnotexist: No such file or directory
    `cd doesnotexist` ran with exit code 256
</code></pre><p>Первая строка - результат выполнения команды echo.</p>
<p>Далее команда <code>cd</code> выполняется успешно и изменяет каталог на домашний. Следовательно, код возврата ноль, который получаем с помощью вызова метода exitcode().</p>
<p>Последняя команда <code>cd</code> выполняется с ошибкой, так как пытается изменить каталог на несуществующую папку.</p>
<h4 id="простой-варинат-выполнение-системной-команды">Простой варинат выполнение системной команды<a class="td-heading-self-link" href="#%d0%bf%d1%80%d0%be%d1%81%d1%82%d0%be%d0%b9-%d0%b2%d0%b0%d1%80%d0%b8%d0%bd%d0%b0%d1%82-%d0%b2%d1%8b%d0%bf%d0%be%d0%bb%d0%bd%d0%b5%d0%bd%d0%b8%d0%b5-%d1%81%d0%b8%d1%81%d1%82%d0%b5%d0%bc%d0%bd%d0%be%d0%b9-%d0%ba%d0%be%d0%bc%d0%b0%d0%bd%d0%b4%d1%8b" aria-label="Heading self-link"></a></h4>
<p>Есть упрощенный вариант выполнения системной команды с помощью заключения строки выполнения в обратные кавычки (как в bash).</p>
<pre tabindex="0"><code>    `echo Hello from the other side!`;
</code></pre><p>В этом случае системная команда <code>:System.run()</code> сразу выполняется, а её текстовый вывод сохраняется в текстовую строку с широкими символами (:StrWide).</p>
<p>Чтобы получить код возврата (например, чтобы проверить результат завершения на ошибки), можно обратится к результату выполнения последней команды <code>$^.exitcode()</code>
или сохранить результат выполнения предыдущей команды в отдельную переменню, которая будет иметь тип <em>:System</em>.</p>
<pre tabindex="0"><code>    `echo Hello from the other side!`;
    res := $^;
    printf(&#34;`cd doesnotexis` ran with exit code %d&#34;, res.exitcode());
</code></pre><h2 id="в-дальнейшем-планируется-расширить-возможности-интерфейса-с-операционной-системой">В дальнейшем планируется расширить возможности интерфейса с операционной системой<a class="td-heading-self-link" href="#%d0%b2-%d0%b4%d0%b0%d0%bb%d1%8c%d0%bd%d0%b5%d0%b9%d1%88%d0%b5%d0%bc-%d0%bf%d0%bb%d0%b0%d0%bd%d0%b8%d1%80%d1%83%d0%b5%d1%82%d1%81%d1%8f-%d1%80%d0%b0%d1%81%d1%88%d0%b8%d1%80%d0%b8%d1%82%d1%8c-%d0%b2%d0%be%d0%b7%d0%bc%d0%be%d0%b6%d0%bd%d0%be%d1%81%d1%82%d0%b8-%d0%b8%d0%bd%d1%82%d0%b5%d1%80%d1%84%d0%b5%d0%b9%d1%81%d0%b0-%d1%81-%d0%be%d0%bf%d0%b5%d1%80%d0%b0%d1%86%d0%b8%d0%be%d0%bd%d0%bd%d0%be%d0%b9-%d1%81%d0%b8%d1%81%d1%82%d0%b5%d0%bc%d0%be%d0%b9" aria-label="Heading self-link"></a></h2>
<ul>
<li>фоновое выполнение программ (useless_cat_call = subprocess.run([&ldquo;cat&rdquo;], stdout=subprocess.PIPE, text=True, input=&ldquo;Hello from the other side&rdquo;))</li>
<li>переназначение ввода/вывода (list_dir = subprocess.Popen([&ldquo;ls&rdquo;, &ldquo;-l&rdquo;]); list_dir.wait())</li>
<li>чтение/изменние перемнных окржения</li>
</ul>
<h3 id="еще-пример-возможностей-для-расширения">Еще пример возможностей для расширения<a class="td-heading-self-link" href="#%d0%b5%d1%89%d0%b5-%d0%bf%d1%80%d0%b8%d0%bc%d0%b5%d1%80-%d0%b2%d0%be%d0%b7%d0%bc%d0%be%d0%b6%d0%bd%d0%be%d1%81%d1%82%d0%b5%d0%b9-%d0%b4%d0%bb%d1%8f-%d1%80%d0%b0%d1%81%d1%88%d0%b8%d1%80%d0%b5%d0%bd%d0%b8%d1%8f" aria-label="Heading self-link"></a></h3>
<ul>
<li>os.name - имя операционной системы. Доступные варианты: &lsquo;posix&rsquo;, &rsquo;nt&rsquo;, &lsquo;mac&rsquo;, &lsquo;os2&rsquo;, &lsquo;ce&rsquo;, &lsquo;java&rsquo;.</li>
<li>os.environ - словарь переменных окружения. Изменяемый (можно добавлять и удалять переменные окружения).</li>
<li>os.getlogin() - имя пользователя, вошедшего в терминал (Unix).</li>
<li>os.getpid() - текущий id процесса.</li>
<li>os.uname() - информация об ОС. возвращает объект с атрибутами: sysname - имя операционной системы, nodename - имя машины в сети (определяется реализацией), release - релиз, version - версия, machine - идентификатор машины.</li>
<li>os.access(path, mode, *, dir_fd=None, effective_ids=False, follow_symlinks=True) - проверка доступа к объекту у текущего пользователя. Флаги: os.F_OK - объект существует, os.R_OK - доступен на чтение, os.W_OK - доступен на запись, os.X_OK - доступен на исполнение.</li>
<li>os.chdir(path) - смена текущей директории.</li>
<li>os.chmod(path, mode, *, dir_fd=None, follow_symlinks=True) - смена прав доступа к объекту (mode - восьмеричное число).</li>
<li>os.chown(path, uid, gid, *, dir_fd=None, follow_symlinks=True) - меняет id владельца и группы (Unix).</li>
<li>os.getcwd() - текущая рабочая директория.</li>
<li>os.link(src, dst, *, src_dir_fd=None, dst_dir_fd=None, follow_symlinks=True) - создаёт жёсткую ссылку.</li>
<li>os.listdir(path=&quot;.&quot;) - список файлов и директорий в папке.</li>
<li>os.mkdir(path, mode=0o777, *, dir_fd=None) - создаёт директорию. OSError, если директория существует.</li>
<li>os.makedirs(path, mode=0o777, exist_ok=False) - создаёт директорию, создавая при этом промежуточные директории.</li>
<li>os.remove(path, *, dir_fd=None) - удаляет путь к файлу.</li>
<li>os.rename(src, dst, *, src_dir_fd=None, dst_dir_fd=None) - переименовывает файл или директорию из src в dst.</li>
<li>os.renames(old, new) - переименовывает old в new, создавая промежуточные директории.</li>
<li>os.replace(src, dst, *, src_dir_fd=None, dst_dir_fd=None) - переименовывает из src в dst с принудительной заменой.</li>
<li>os.rmdir(path, *, dir_fd=None) - удаляет пустую директорию.</li>
<li>os.removedirs(path) - удаляет директорию, затем пытается удалить родительские директории, и удаляет их рекурсивно, пока они пусты.</li>
<li>os.symlink(source, link_name, target_is_directory=False, *, dir_fd=None) - создаёт символическую ссылку на объект.</li>
<li>os.sync() - записывает все данные на диск (Unix).</li>
<li>os.truncate(path, length) - обрезает файл до длины length.</li>
<li>os.utime(path, times=None, *, ns=None, dir_fd=None, follow_symlinks=True) - модификация времени последнего доступа и изменения файла. Либо times - кортеж (время доступа в секундах, время изменения в секундах), либо ns - кортеж (время доступа в наносекундах, время изменения в наносекундах).</li>
<li>os.walk(top, topdown=True, onerror=None, followlinks=False) - генерация имён файлов в дереве каталогов, сверху вниз (если topdown равен True), либо снизу вверх (если False). Для каждого каталога функция walk возвращает кортеж (путь к каталогу, список каталогов, список файлов).</li>
<li>os.system(command) - исполняет системную команду, возвращает код её завершения (в случае успеха 0).</li>
<li>os.urandom(n) - n случайных байт. Возможно использование этой функции в криптографических целях.</li>
</ul>

</div>



    
	
  
    
    
	
    

<div class="td-content" style="page-break-before: always">
    
	<h1 id="pg-cf08b42ee4f3746e6fd20919aa6660c8">2.9 - Нативные типы</h1>
    
	<h2 id="нативные-типы-данных">Нативные типы данных<a class="td-heading-self-link" href="#%d0%bd%d0%b0%d1%82%d0%b8%d0%b2%d0%bd%d1%8b%d0%b5-%d1%82%d0%b8%d0%bf%d1%8b-%d0%b4%d0%b0%d0%bd%d0%bd%d1%8b%d1%85" aria-label="Heading self-link"></a></h2>
<p>Нативными (машинные) данными могут быть как переменные, так и функции, а имя нативных объектов начинается на символ процента &ldquo;<strong>%</strong>&rdquo;.</p>
<p>В случае переменных, это двоичные данные, которые располагаются в одной неразрывной области машинной памяти по определенному адресу и имеют строго определенный формат.</p>
<p>Чтобы использовать уже существующие библиотеки, нужно импортировать нативный объект,
тем самым создав объкт NewLang, но с реализацией на другом языке, например на С/С++.</p>
<p>Синтаксис импорта нативных объектов такой же, как и для <a href="/ru/docs/ops/create/">создания</a> обычных объектов языка,
только в качестве правого операнда в операторе создания требуется указать имя нативнного объекта.</p>
<p>При импорте нативного объекта необходимо всегда указывать типы переменных, а также типы аргументов и возвращаемых значений для функций.</p>
<p>Если типы данных у создаваемого и нативного объекта совпадают (т.е. не требуется преобразование типов),
то нативное имя объекта можно указать с многоточием, которое означает, что типы данных будут повторять заданные у левого операнда.</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#000;font-weight:bold">:</span><span style="color:#000">FILE</span> <span style="color:#000;font-weight:bold">:</span><span style="color:#ce5c00;font-weight:bold">:=</span> <span style="color:#000;font-weight:bold">:</span><span style="color:#000">Plain</span><span style="color:#000;font-weight:bold">;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#000">fopen</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">filename</span><span style="color:#000;font-weight:bold">:</span><span style="color:#000">StrChar</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">modes</span><span style="color:#000;font-weight:bold">:</span><span style="color:#000">StrChar</span><span style="color:#000;font-weight:bold">):</span><span style="color:#000">FILE</span> <span style="color:#000;font-weight:bold">:</span><span style="color:#ce5c00;font-weight:bold">:=</span> <span style="color:#ce5c00;font-weight:bold">%</span><span style="color:#000">fopen</span><span style="color:#ce5c00;font-weight:bold">...</span><span style="color:#000;font-weight:bold">;</span>
</span></span><span style="display:flex;"><span><span style="color:#000">fclose</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">f</span><span style="color:#000;font-weight:bold">:</span><span style="color:#000">FILE</span><span style="color:#000;font-weight:bold">):</span><span style="color:#000">Int32</span> <span style="color:#000;font-weight:bold">:</span><span style="color:#ce5c00;font-weight:bold">:=</span> <span style="color:#ce5c00;font-weight:bold">%</span><span style="color:#000">fclose</span><span style="color:#ce5c00;font-weight:bold">...</span><span style="color:#000;font-weight:bold">;</span>
</span></span><span style="display:flex;"><span><span style="color:#000">fflush</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">f</span><span style="color:#000;font-weight:bold">:</span><span style="color:#000">FILE</span><span style="color:#000;font-weight:bold">):</span><span style="color:#000">Int32</span> <span style="color:#000;font-weight:bold">:</span><span style="color:#ce5c00;font-weight:bold">:=</span> <span style="color:#ce5c00;font-weight:bold">%</span><span style="color:#000">fflush</span><span style="color:#ce5c00;font-weight:bold">...</span><span style="color:#000;font-weight:bold">;</span>
</span></span><span style="display:flex;"><span><span style="color:#000">fprintf</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">f</span><span style="color:#000;font-weight:bold">:</span><span style="color:#000">FILE</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#204a87">format</span><span style="color:#000;font-weight:bold">:</span><span style="color:#000">FmtChar</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#ce5c00;font-weight:bold">...</span><span style="color:#000;font-weight:bold">):</span><span style="color:#000">Int32</span> <span style="color:#000;font-weight:bold">:</span><span style="color:#ce5c00;font-weight:bold">:=</span> <span style="color:#ce5c00;font-weight:bold">%</span><span style="color:#000">fprintf</span><span style="color:#ce5c00;font-weight:bold">...</span><span style="color:#000;font-weight:bold">;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#000">fremove</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">filename</span><span style="color:#000;font-weight:bold">:</span><span style="color:#000">String</span><span style="color:#000;font-weight:bold">):</span><span style="color:#000">Int32</span> <span style="color:#000;font-weight:bold">:</span><span style="color:#ce5c00;font-weight:bold">:=</span> <span style="color:#ce5c00;font-weight:bold">%</span><span style="color:#000">remove</span><span style="color:#ce5c00;font-weight:bold">...</span><span style="color:#000;font-weight:bold">;</span>
</span></span><span style="display:flex;"><span><span style="color:#000">frename</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">old</span><span style="color:#000;font-weight:bold">:</span><span style="color:#000">String</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">new</span><span style="color:#000;font-weight:bold">:</span><span style="color:#000">String</span><span style="color:#000;font-weight:bold">):</span><span style="color:#000">Int32</span> <span style="color:#000;font-weight:bold">:</span><span style="color:#ce5c00;font-weight:bold">:=</span> <span style="color:#ce5c00;font-weight:bold">%</span><span style="color:#000">rename</span><span style="color:#ce5c00;font-weight:bold">...</span><span style="color:#000;font-weight:bold">;</span>
</span></span></code></pre></div>

<div class="pageinfo pageinfo-primary">
<p>Последующее описание находится в процессе разработки.</p>

</div>

<h3 id="pointer--указатель-на-системную-область-памяти-или-нативную-функцию">:Pointer — указатель на системную область памяти или нативную функцию<a class="td-heading-self-link" href="#pointer--%d1%83%d0%ba%d0%b0%d0%b7%d0%b0%d1%82%d0%b5%d0%bb%d1%8c-%d0%bd%d0%b0-%d1%81%d0%b8%d1%81%d1%82%d0%b5%d0%bc%d0%bd%d1%83%d1%8e-%d0%be%d0%b1%d0%bb%d0%b0%d1%81%d1%82%d1%8c-%d0%bf%d0%b0%d0%bc%d1%8f%d1%82%d0%b8-%d0%b8%d0%bb%d0%b8-%d0%bd%d0%b0%d1%82%d0%b8%d0%b2%d0%bd%d1%83%d1%8e-%d1%84%d1%83%d0%bd%d0%ba%d1%86%d0%b8%d1%8e" aria-label="Heading self-link"></a></h3>
<p>Так как любой программе приходится взаимодействовать с внешним миром,
то по неволе приходится закладывать возможность использования других библиотек и системы типов данных,
и для этих целей служит тип <em>:Pointer</em>. Он создается при импорте функций из внешних библиотек и вручную его создать нельзя.
Но можно вывести его значение, например для отладки.</p>
<h3 id="plain--указатель-на-представление-данных-в-бинарном-виде">:Plain — указатель на представление данных в бинарном виде<a class="td-heading-self-link" href="#plain--%d1%83%d0%ba%d0%b0%d0%b7%d0%b0%d1%82%d0%b5%d0%bb%d1%8c-%d0%bd%d0%b0-%d0%bf%d1%80%d0%b5%d0%b4%d1%81%d1%82%d0%b0%d0%b2%d0%bb%d0%b5%d0%bd%d0%b8%d0%b5-%d0%b4%d0%b0%d0%bd%d0%bd%d1%8b%d1%85-%d0%b2-%d0%b1%d0%b8%d0%bd%d0%b0%d1%80%d0%bd%d0%be%d0%bc-%d0%b2%d0%b8%d0%b4%d0%b5" aria-label="Heading self-link"></a></h3>
<p>Для взаимодействия с внешними библиотеками требуется еще и обмен данными.
И для этих целей служит тип данных <em>:Plain</em> — который также является указателем, но на двоичное представление данных в области памяти.
Конечно, если их можно представить в виде одного фрагмента.</p>
<h3 id="перечисление-структура-и-объединение">Перечисление, структура и объединение<a class="td-heading-self-link" href="#%d0%bf%d0%b5%d1%80%d0%b5%d1%87%d0%b8%d1%81%d0%bb%d0%b5%d0%bd%d0%b8%d0%b5-%d1%81%d1%82%d1%80%d1%83%d0%ba%d1%82%d1%83%d1%80%d0%b0-%d0%b8-%d0%be%d0%b1%d1%8a%d0%b5%d0%b4%d0%b8%d0%bd%d0%b5%d0%bd%d0%b8%d0%b5" aria-label="Heading self-link"></a></h3>
<p><em>:Enum</em>, <em>:Struct</em> и <em>:Union</em> — это такие же <a href="http://localhost:1313/ru/docs/types/dicts/#%D0%BF%D0%B5%D1%80%D0%B5%D1%87%D0%B8%D1%81%D0%BB%D0%B5%D0%BD%D0%B8%D0%B5-%D1%81%D1%82%D1%80%D1%83%D0%BA%D1%82%D1%83%D1%80%D0%B0-%D0%B8-%D0%BE%D0%B1%D1%8A%D0%B5%D0%B4%D0%B8%D0%BD%D0%B5%D0%BD%D0%B8%D0%B5">словари</a>, только на их элементы накладываются определённые ограничения. Каждый элемент должен иметь уникальное имя, а его тип данных должен быть простым, т.е. числом или строкой фиксированного размера. Эти типы данных так же относятся к группе <em>:Plain</em> и могут быть представлены в двоичном виде в одной области машинной памяти.</p>

</div>



    
	
  
    
    
	
    

<div class="td-content" style="page-break-before: always">
    
	<h1 id="pg-d0d4eee95920a518c7da7c14c155a4d6">2.10 - Преобразование типов</h1>
    
	<p>Несмотря на динамическую типизацию языка, если тип переменной указан явно, то автоматическое приведение типов не выполняется,
и чтобы присвоить переменой значение не совместимого типа, требуется его явное преобразование.</p>
<p>Так как символьные названия типов относятся к деталям реализации, то явное преобразование в конкретный тип данных производится
с помощью вызова функции с именем типа, т.е. :Bool(), :StrWide(), :Int64() и т.д.</p>
<p>Примеры:</p>
<h2 id="строки-и-тензоры">Строки и тензоры<a class="td-heading-self-link" href="#%d1%81%d1%82%d1%80%d0%be%d0%ba%d0%b8-%d0%b8-%d1%82%d0%b5%d0%bd%d0%b7%d0%be%d1%80%d1%8b" aria-label="Heading self-link"></a></h2>
<pre tabindex="0"><code># Создать тензор из строки широких символов с автоматическим выводом размера и типа данных
#(тип Int32 будет на системах с Linux, а под Windows тип тензора будет Int16)
&gt; tstr := :Tensor[...](&#34;Тест&#34;); 
[1058, 1077, 1089, 1090,]:Int32

# Тоже самое, но тензор заданной размерности
&gt; t2 := :Tensor[2,2](&#34;Тест&#34;);
[
  [1058, 1077,], [1089, 1090,],
]:Int32

# Создать символьную строку из тензора
&gt; :StrWide(tstr) 
Тест

# Изменить тип данных тензора без изменения размерности
&gt; :Float64[...](t2) 
[
  [1058, 1077,], [1089, 1090,],
]:Float64

# Изменить размерность тензора и его тип 
# (в данном случае с частичной потерей данных)
&gt; t3 := :Int8[4]( t2 ) 
[34, 53, 65, 66,]:Int8

# Логическое значение - скаляр
&gt;:Bool( [0, 53, 65, 66,] ); 
1:Bool

# Или так (тензор нулевой размерности)
&gt;:Bool[0]( [0, 53, 65, 66,] ); 
1:Bool

# Тензор логических значений без изменения размера 
&gt;:Bool[_]( [0, 53, 65, 66,] ); 
[0, 1, 1, 1,]:Bool
</code></pre><h2 id="словари">Словари<a class="td-heading-self-link" href="#%d1%81%d0%bb%d0%be%d0%b2%d0%b0%d1%80%d0%b8" aria-label="Heading self-link"></a></h2>
<pre tabindex="0"><code># Создать тензор из словаря с автоматическим выводом размера 
&gt;:Tensor[...]( (1,2,3,) ); 
[1, 2, 3,]:Int8

# Преобразовать байтовую строку в одномерный тензор
&gt;:Tensor[_]( &#39;first second&#39; ) 
[102, 105, 114, 115, 116, 32, 115, 101, 99, 111, 110, 100,]:Int8

# Получаем тензор из словаря с такими же данными
&gt;:Tensor[...]( (&#39;first&#39;, space=32, second=&#39;second&#39;,) ) 
[102, 105, 114, 115, 116, 32, 115, 101, 99, 111, 110, 100,]:Int8

# Логическое значение - скаляр
&gt;:Bool( (0,1,2,3,) ); 
1:Bool

# Тензор логических значений
&gt;:Bool[...]( (0,1,2,3,) ); 
[0, 1, 1, 1]:Bool


# Различия между  &#34;...&#34; и &#34;_&#34;

# Автоматический вывод размеров измерений
&gt;:Tensor[...]( ((1,2,3,), (4,5,6,), (7,8,9,),) ); 
[ 
    [1, 2, 3,], [4, 5, 6,], [7, 8, 9,]
]:Int8

# Одномерный тензор с произвольным размером
&gt;:Tensor[_]( ((1,2,3,), (4,5,6,), (7,8,9,),) ); 
[ 1, 2, 3, 4, 5, 6, 7, 8, 9,]:Int8
</code></pre>
</div>



    
	
  

    
	
  
    
    
	
    

<div class="td-content" style="page-break-before: always">
    
	<h1 id="pg-3ecbe9dca2bf163ce61c9f6a7bbee31a">3 - Операторы и управляющие конструкции</h1>
    
	<p>Один из самых недооценных операторов, которй отсутствует в большинстве высокоуровневых языков программирования,
это переменная с результатом выполнения предыдущей операции. В <em>NewLang</em> это системная переменная <strong>$^</strong> (или DSL макрос <strong>@result</strong>),
в которой всегда хранится результат выполнения последней операции (оператора).</p>
<p>Это чем-то похоже на глобальное значние error(), но не только для кода ошибки, а для значения любого оператора.</p>
<p>При её использовании многие синтаксические конструкции языка значительно упрощаются, так как не требуется предусматривать определение
локальных переменных для сохранения промежуточных данных, например при возникновении ошибки.</p>

</div>



    
      
  
  
  
  

  
  

  
    
    
	
    

<div class="td-content" style="page-break-before: always">
    
	<h1 id="pg-4b708f286c358df8314115b9ab6f3495">3.1 - Создание объектов</h1>
    
	

<div class="pageinfo pageinfo-primary">
<h5 id="область-видимости-объекта--время-жизни-объекта">Область видимости объекта =/= время жизни объекта<a class="td-heading-self-link" href="#%d0%be%d0%b1%d0%bb%d0%b0%d1%81%d1%82%d1%8c-%d0%b2%d0%b8%d0%b4%d0%b8%d0%bc%d0%be%d1%81%d1%82%d0%b8-%d0%be%d0%b1%d1%8a%d0%b5%d0%ba%d1%82%d0%b0--%d0%b2%d1%80%d0%b5%d0%bc%d1%8f-%d0%b6%d0%b8%d0%b7%d0%bd%d0%b8-%d0%be%d0%b1%d1%8a%d0%b5%d0%ba%d1%82%d0%b0" aria-label="Heading self-link"></a></h5>
<p>Область видимости объекта определяется его расположением в программном коде (блоки кода, пространство имен, модели и т.д.)
Объект может существовать, но может быть не доступен из текущей области видимости.</p>
<h5 id="имя-объекта-создание-объекта-и-его-расположение">Имя объекта, создание объекта и его расположение<a class="td-heading-self-link" href="#%d0%b8%d0%bc%d1%8f-%d0%be%d0%b1%d1%8a%d0%b5%d0%ba%d1%82%d0%b0-%d1%81%d0%be%d0%b7%d0%b4%d0%b0%d0%bd%d0%b8%d0%b5-%d0%be%d0%b1%d1%8a%d0%b5%d0%ba%d1%82%d0%b0-%d0%b8-%d0%b5%d0%b3%d0%be-%d1%80%d0%b0%d1%81%d0%bf%d0%be%d0%bb%d0%be%d0%b6%d0%b5%d0%bd%d0%b8%d0%b5" aria-label="Heading self-link"></a></h5>
<p>Имя объекта - его уникальный идентификатор, который однозначно определяется местом его расположения (нахождение сильной ссылки на объект).
Имя у объекта может быть всегда, даже тогда, когда сам объект физически еще не создан (например при предварительном объявлении).</p>

</div>

<h3 id="создания-объектов-и-присвоения-новых-значений">Создания объектов и присвоения новых значений<a class="td-heading-self-link" href="#%d1%81%d0%be%d0%b7%d0%b4%d0%b0%d0%bd%d0%b8%d1%8f-%d0%be%d0%b1%d1%8a%d0%b5%d0%ba%d1%82%d0%be%d0%b2-%d0%b8-%d0%bf%d1%80%d0%b8%d1%81%d0%b2%d0%be%d0%b5%d0%bd%d0%b8%d1%8f-%d0%bd%d0%be%d0%b2%d1%8b%d1%85-%d0%b7%d0%bd%d0%b0%d1%87%d0%b5%d0%bd%d0%b8%d0%b9" aria-label="Heading self-link"></a></h3>
<p>Для создания объектов и присвоения им новых значений в NewLang используется несколько операторов:</p>
<ul>
<li>&ldquo;<strong>::=</strong>&rdquo; или &ldquo;<strong>::-</strong>&rdquo; - используется для создания только новых объектов.
Если объект с таким именем был определен ранее, то произойдет ошибка компиляции.</li>
<li>&ldquo;<strong>:=</strong>&rdquo; или &ldquo;<strong>:-</strong>&rdquo; - используется для создания новых объектов с возможностью перекрытия имен.
Если локальный объект с таким именем был определен ранее, то новый объект будет его перекрывать.</li>
<li>&ldquo;<strong>=</strong>&rdquo; - применяется только для присвоения значения уже существующим объектам.
Если объект с указанным именем отсутствует, то возникает ошибка компиляции.</li>
<li>&ldquo;<strong>:=:</strong>&rdquo; - Оператор не создает нового объекта, а обменивает значения уже существуюих (переменные должны иметь одинаковые/совместимые типы данных).</li>
</ul>
<p>?????????????????????????????????????</p>
<ul>
<li>&ldquo;<strong>[]=</strong>&rdquo; - добавлеят новый элемент к словарю или переопределяет созданное ранее имя <a href="/ru/docs/types/funcs/">функции</a> или <a href="/ru/docs/types/class/">метод класса</a>.
Похож на оператор присвоения значения &ldquo;<strong>=</strong>&rdquo;, но в отличии от него не <em>удаляет</em> старое значение, а сохраняет его в стек переопределнных имен,
и к старому значению можно обратиться по системному имени &ldquo;<strong>$$</strong>&rdquo; ????????????????? <a href="/ru/">*)</a>. Не может применяться к макросам.</li>
</ul>
<p>Использование трех разных видов операторов для создания/изменения объектов позволяет более гибко контролировать подобные операции и выявлять логические ошибки в коде на более раннем этапе.</p>
<p>Например, при определении класса <code>:NewClass2</code>:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>    :NewClass :<span style="color:#ce5c00;font-weight:bold">=</span> :Class<span style="color:#ce5c00;font-weight:bold">()</span> <span style="color:#ce5c00;font-weight:bold">{</span> <span style="color:#8f5902;font-style:italic"># Базовый класс</span>
</span></span><span style="display:flex;"><span>        filed ::<span style="color:#ce5c00;font-weight:bold">=</span> 2<span style="color:#000;font-weight:bold">;</span> <span style="color:#8f5902;font-style:italic"># Однократная инициализация (статическоого) члена класса</span>
</span></span><span style="display:flex;"><span>        method<span style="color:#ce5c00;font-weight:bold">()</span> ::<span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#ce5c00;font-weight:bold">{}</span><span style="color:#000;font-weight:bold">;</span> <span style="color:#8f5902;font-style:italic"># Регистрация метода</span>
</span></span><span style="display:flex;"><span>    <span style="color:#ce5c00;font-weight:bold">}</span><span style="color:#000;font-weight:bold">;</span>
</span></span><span style="display:flex;"><span>    :NewClass2 :<span style="color:#ce5c00;font-weight:bold">=</span> :NewClass<span style="color:#ce5c00;font-weight:bold">()</span> <span style="color:#ce5c00;font-weight:bold">{</span>
</span></span><span style="display:flex;"><span>        filed ::<span style="color:#ce5c00;font-weight:bold">=</span> 2<span style="color:#000;font-weight:bold">;</span> <span style="color:#8f5902;font-style:italic"># Будет ошибка, т.к. field уже есть в базовом классе</span>
</span></span><span style="display:flex;"><span>        method<span style="color:#ce5c00;font-weight:bold">()</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#ce5c00;font-weight:bold">{}</span><span style="color:#000;font-weight:bold">;</span> <span style="color:#8f5902;font-style:italic"># Аналог override, т.к. method должен существовать в базовом классе</span>
</span></span><span style="display:flex;"><span>    <span style="color:#ce5c00;font-weight:bold">}</span><span style="color:#000;font-weight:bold">;</span>
</span></span></code></pre></div><p>Если же контролировать момент создание объектов и присвоения им значений не требуется, то можно пользоваться единственным оператором <strong>:=</strong>.</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span>    <span style="color:#000">var</span> <span style="color:#ce5c00;font-weight:bold">:=</span> <span style="color:#0000cf;font-weight:bold">1.0</span><span style="color:#000;font-weight:bold">;</span> <span style="color:#8f5902;font-style:italic"># Создать новую переменную var без явного указания типа</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000">var</span> <span style="color:#ce5c00;font-weight:bold">:=</span> <span style="color:#0000cf;font-weight:bold">100</span><span style="color:#000;font-weight:bold">;</span> <span style="color:#8f5902;font-style:italic"># Присвоить новое значение уже существующей переменной</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000">printf</span><span style="color:#000;font-weight:bold">(</span><span style="color:#204a87">format</span><span style="color:#000;font-weight:bold">:</span><span style="color:#000">FmtChar</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#ce5c00;font-weight:bold">...</span><span style="color:#000;font-weight:bold">):</span><span style="color:#000">Int32</span> <span style="color:#000;font-weight:bold">:</span><span style="color:#ce5c00;font-weight:bold">:=</span> <span style="color:#ce5c00;font-weight:bold">%</span><span style="color:#000">printf</span><span style="color:#ce5c00;font-weight:bold">...</span><span style="color:#000;font-weight:bold">;</span> 
</span></span><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic"># Создать новый или переопределить printf ???????????????????????????????????????????</span>
</span></span></code></pre></div><h3 id="expand">Присваивание значения сразу нескольким переменным и оператор распаковки словаря<a class="td-heading-self-link" href="#expand" aria-label="Heading self-link"></a></h3>
<p><em>NewLang</em> поддерживает операцию присваивания значения сразу нескольким переменным,
которые должны быть перечислены через запятую слева от оператора присвоения.
С правой стороны от оператора присвоения может находится только одно значение.
А для обмена занчениями двух переменных, вместо традиционной записи:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span>    <span style="color:#000">a</span><span style="color:#000;font-weight:bold">,</span><span style="color:#000">b</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">b</span><span style="color:#000;font-weight:bold">,</span><span style="color:#000">a</span><span style="color:#000;font-weight:bold">;</span>
</span></span></code></pre></div><p>Нужно использовать отдельный оператор обмена:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span>    <span style="color:#000">a</span> <span style="color:#ce5c00;font-weight:bold">:=</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#000">b</span><span style="color:#000;font-weight:bold">;</span>
</span></span></code></pre></div><p>В качестве правого операнда в операторе присвоения допускается использовать оператор распаковки словаря <strong>&hellip;</strong> (многоточие),
который можно использовать и при передаче аргументов в функцию.</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span>    <span style="color:#000">args</span> <span style="color:#ce5c00;font-weight:bold">:=</span> <span style="color:#000;font-weight:bold">(</span><span style="color:#000">arg1</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#0000cf;font-weight:bold">1</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">arg2</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#0000cf;font-weight:bold">2</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#0000cf;font-weight:bold">3</span><span style="color:#000;font-weight:bold">,</span><span style="color:#0000cf;font-weight:bold">4</span><span style="color:#000;font-weight:bold">,);</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000">call</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">arg</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#0000cf;font-weight:bold">0</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#ce5c00;font-weight:bold">...</span> <span style="color:#000">args</span><span style="color:#000;font-weight:bold">);</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#8f5902;font-style:italic"># Что равносильно вызову</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000">call</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">arg</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#0000cf;font-weight:bold">0</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">arg1</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#0000cf;font-weight:bold">1</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">arg2</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#0000cf;font-weight:bold">2</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#0000cf;font-weight:bold">3</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#0000cf;font-weight:bold">4</span><span style="color:#000;font-weight:bold">);</span>
</span></span></code></pre></div><p>Словарь может быть указан и с левой стороны от оператора присвоения.
Таким образом можно записать самый простой способ перебора всех его элементов:
<code>item, dictionary := ... dictionary;</code>, т.е. когда первый элемент словаря сохраняется в переменную <code>item</code>, а из самого словаря удаляется,
и так в цикле пока словарь не станет пустым.</p>
<p>Пример реализации цикла <em>foreach</em> для суммирования всех элементов словаря (или одномерного тензора)
с использованием оператора раскрытия словаря (списка):</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span>    <span style="color:#000">summa</span> <span style="color:#ce5c00;font-weight:bold">:=</span> <span style="color:#0000cf;font-weight:bold">0</span><span style="color:#000;font-weight:bold">;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000">dictionary</span> <span style="color:#ce5c00;font-weight:bold">:=</span> <span style="color:#000;font-weight:bold">(</span><span style="color:#0000cf;font-weight:bold">1</span><span style="color:#000;font-weight:bold">,</span><span style="color:#0000cf;font-weight:bold">2</span><span style="color:#000;font-weight:bold">,</span><span style="color:#0000cf;font-weight:bold">3</span><span style="color:#000;font-weight:bold">,</span><span style="color:#0000cf;font-weight:bold">4</span><span style="color:#000;font-weight:bold">,</span><span style="color:#0000cf;font-weight:bold">5</span><span style="color:#000;font-weight:bold">,);</span>
</span></span><span style="display:flex;"><span>    <span style="color:#5c35cc;font-weight:bold">@while</span><span style="color:#000;font-weight:bold">(</span> <span style="color:#000">dictionary</span> <span style="color:#000;font-weight:bold">)</span> <span style="color:#000;font-weight:bold">{</span>
</span></span><span style="display:flex;"><span>        <span style="color:#8f5902;font-style:italic"># Первый элемент словаря перемещается в item</span>
</span></span><span style="display:flex;"><span>        <span style="color:#000">item</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">dictionary</span> <span style="color:#ce5c00;font-weight:bold">:=</span> <span style="color:#ce5c00;font-weight:bold">...</span> <span style="color:#000">dictionary</span><span style="color:#000;font-weight:bold">;</span> 
</span></span><span style="display:flex;"><span>        <span style="color:#000">summa</span> <span style="color:#ce5c00;font-weight:bold">+=</span> <span style="color:#000">item</span><span style="color:#000;font-weight:bold">;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">};</span>
</span></span></code></pre></div><h2 id="comprehensions">Заполнение данными<a class="td-heading-self-link" href="#comprehensions" aria-label="Heading self-link"></a></h2>
<p>При заполнении данными <em>размерных</em> тензоров существует краткий способ указания их начальных значений.
Для этого используется многоточие в следующих вариантах:</p>
<ul>
<li>
<p><code>:Tensor[10](2,3, ...)</code> - повторение <em><strong>всех</strong></em> предыдущих данных до полного заполнения тензора,
что равносильно записи <code>:Tensor[10](2,3,  2,3,  2,3,  2,3,  2,3)</code>.</p>
</li>
<li>
<p><code>:Tensor[10](2, 3, ... 42 ...)</code> - заполнение значением <code>42</code> до конца тензора,
что равносильно записи <code>:Tensor[10](2,3, 42,42,42,42,42,42,42,42)</code>.</p>
</li>
<li>
<p><code>:Tensor[10](2, 3, ... rand() ...)</code> - заполнение до конца тензора значением, которое будет возвращать функция.
Указанная функция будет вызываться для <strong>каждого элемента</strong> до полного заполнения тензора (8 раз).</p>
</li>
<li>
<p><code>:Tensor[10]( rand(), rand(), ...)</code> - заполнение тензора <em>двумя</em> произвольными заначениями,
то есть функция <code>rand()</code> будет вызвана дважды для двух первых элементов,
после чего эти значения будут использоваться до полного заполнения тензора (как в первом примере).</p>
</li>
<li>
<p><code>:Tensor[10]( ... 0..0.99..0.1 )</code> - заполнение тензора элементами диапазона, что равносильно записи<br>
<code>:Tensor[10](0, 0.1, 0.2, 0.3, 0.4, 0.5, 0.6, 0.7, 0.8, 0.9)</code>. Раскрытие диапазона создает
фиксированное количество значений. Поэтому в данном примере размерность тензора можно не указывать,
так как она будет создана автоматически.</p>
</li>
<li>
<p><code>:Tensor[15]( ... 0..5  ,  ... )</code> - заполнение тензора элементами диапазона с их повторением до заданного размера тензора:
<code>:Tensor(0, 1, 2, 3, 4, 0, 1, 2, 3, 4, 0, 1, 2, 3, 4)</code></p>
</li>
</ul>
<h3 id="заполнение-данными-в-словарях-и-аргументах-функций">Заполнение данными в словарях и аргументах функций<a class="td-heading-self-link" href="#%d0%b7%d0%b0%d0%bf%d0%be%d0%bb%d0%bd%d0%b5%d0%bd%d0%b8%d0%b5-%d0%b4%d0%b0%d0%bd%d0%bd%d1%8b%d0%bc%d0%b8-%d0%b2-%d1%81%d0%bb%d0%be%d0%b2%d0%b0%d1%80%d1%8f%d1%85-%d0%b8-%d0%b0%d1%80%d0%b3%d1%83%d0%bc%d0%b5%d0%bd%d1%82%d0%b0%d1%85-%d1%84%d1%83%d0%bd%d0%ba%d1%86%d0%b8%d0%b9" aria-label="Heading self-link"></a></h3>
<p>Предыдущие способы заполнения данными возможны только для тензоров фиксированного размера,
так как позволяют получить произвольное количество значений,
но их можно применять только в конце списка значения для инициализации.</p>
<p>Операторы раскрытия словаря или диапазона создают ограниченное количество значений,
но за счет этого их можно использовать не только для инициализации тензоров,
но и в качестве начальных значений у словарей или создания аргументов при вызове функций,
причем в произвольном месте, а не только в конце списка инициализации:</p>
<ul>
<li>
<p><code>:Tensor( ... 0..0.99..0.1 )</code> - заполнение тензора без указания его размера элементами диапазона,
что равносильно записи  <code>:Tensor(0, 0.1, 0.2, 0.3, 0.4, 0.5, 0.6, 0.7, 0.8, 0.9)</code></p>
</li>
<li>
<p><code>funtcion( 0, ... dict, 42 )</code> - раскрытие словаря как индивидуальных <em>не именованных</em> аргументов функции,
к примеру funtcion( 0, 1, 2, 3, 42), если словарь <code>dict</code> содержал три элемента <code>1</code>, <code>2</code> и <code>3</code>.</p>
</li>
<li>
<p><code>funtcion( ...  ... dict, end=4)</code> - раскрытие словаря как индивидуальных <strong>именованных</strong> аргументов функции.
Если словарь <em>dict</em> будет содержать элементы <code>(1, two=2, three=3,)</code>,
то это будет равносильно вызову функции <code>funtcion( 1, two=2, three=3, end=4)</code>.</p>
</li>
</ul>

</div>



    
	
  
    
    
	
    

<div class="td-content" style="page-break-before: always">
    
	<h1 id="pg-f89914599a84d0afcac7c4658db62778">3.2 - Блоки кода</h1>
    
	<p>Блок кода, это сгруппированный набор идущих подряд инструкций, которые выполняются как единое целое
с возвращением результата выполнения последней из них.
Блок кода, как и любая синтаксическая конструкция языка, должен завершаться точкой с запятой &ldquo;<strong>;</strong>&rdquo;.</p>
<p>Блоки кода используются для ограничения области видимости переменных.
С их помощью определяется иерархия области имен и реализуется система именования свойств и методов для классов.
Именованные блоки кода могут выступать в качестве локальных меток для передачи потока выполнения.</p>
<p>За счет того, что к блоку кода можно обратится как к единой инструкции, они могут использоваться в других операторах.
Тело функции, также представляет собой блока кода, который располагается в пространстве имен определения этой функции.</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#000">ns</span><span style="color:#000;font-weight:bold">::</span> <span style="color:#000;font-weight:bold">{</span> <span style="color:#8f5902;font-style:italic"># Пространство имен ns</span>
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    <span style="color:#000">name</span> <span style="color:#000;font-weight:bold">{</span>
</span></span><span style="display:flex;"><span>        <span style="color:#8f5902;font-style:italic"># Пространство имен ns::name</span>
</span></span><span style="display:flex;"><span>        <span style="color:#8f5902;font-style:italic"># В конце имени &#34;::&#34; можно не указывать</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">};</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">::</span> <span style="color:#000;font-weight:bold">{</span> 
</span></span><span style="display:flex;"><span>        <span style="color:#8f5902;font-style:italic"># Глобальное пространство имен</span>
</span></span><span style="display:flex;"><span>        <span style="color:#ce5c00;font-weight:bold">...</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">};</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">{</span>
</span></span><span style="display:flex;"><span>        <span style="color:#8f5902;font-style:italic"># Локальная переменная до завершения блока кода</span>
</span></span><span style="display:flex;"><span>        <span style="color:#a40000">$</span><span style="color:#000">local</span> <span style="color:#000;font-weight:bold">:</span><span style="color:#ce5c00;font-weight:bold">:=</span> <span style="color:#0000cf;font-weight:bold">0</span><span style="color:#000;font-weight:bold">;</span> 
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">};</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#a40000">$</span><span style="color:#000">local</span><span style="color:#000;font-weight:bold">;</span> <span style="color:#8f5902;font-style:italic"># &lt;-- Ошибка! Локальная переменная не видна</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">};</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#000">func_name</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">val</span><span style="color:#000;font-weight:bold">)</span> <span style="color:#000;font-weight:bold">:</span><span style="color:#ce5c00;font-weight:bold">:=</span> <span style="color:#000;font-weight:bold">{</span>  
</span></span><span style="display:flex;"><span>    <span style="color:#8f5902;font-style:italic"># Блок кода func_name::</span>
</span></span><span style="display:flex;"><span>    <span style="color:#5c35cc;font-weight:bold">@if</span><span style="color:#000;font-weight:bold">(</span><span style="color:#a40000">$</span><span style="color:#000">val</span><span style="color:#000;font-weight:bold">)</span> <span style="color:#000;font-weight:bold">{</span>
</span></span><span style="display:flex;"><span>        <span style="color:#ce5c00;font-weight:bold">...</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">}</span> <span style="color:#5c35cc;font-weight:bold">@else</span> <span style="color:#000;font-weight:bold">{</span>
</span></span><span style="display:flex;"><span>        <span style="color:#ce5c00;font-weight:bold">...</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">};</span>
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">};</span>
</span></span></code></pre></div><h3 id="typed">Оформление блока кода<a class="td-heading-self-link" href="#typed" aria-label="Heading self-link"></a></h3>
<p>Блок кода всегда начинается и заканчивается на фигурные скобки («<strong>{</strong>» и «<strong>}</strong>») и завершается точкой с запятой &ldquo;<strong>;</strong>&rdquo;.
Существуют блоки кода, которые перехватывают потоки выполнения, с помощью которых реализуются <a href="/ru/docs/ops/throw/">возврат и обработка ошибок</a>.</p>
<p>Тип возвращаемого значения блоком кода можно указать в явном виде.
Для этого, после завершающей фигурной скобки, нужно указать разрешенный тип,
после чего компилятор будет проверят корретность данных внутрие блока кода, которые могут быть возвращены.</p>
<p>Можно указать сразу несколько типов, перечислив их через запятую в угловых скобрах.</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">{</span>
</span></span><span style="display:flex;"><span>        <span style="color:#000">op1</span><span style="color:#000;font-weight:bold">;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#000">op2</span><span style="color:#000;font-weight:bold">;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">};</span>   <span style="color:#8f5902;font-style:italic"># &lt;--- Контроль типа возврата не производится</span>
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">{</span>
</span></span><span style="display:flex;"><span>        <span style="color:#000">op1</span><span style="color:#000;font-weight:bold">;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#000">op2</span><span style="color:#000;font-weight:bold">;</span>    <span style="color:#8f5902;font-style:italic"># &lt;--- Проверка типа возвращаемого значения</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">}</span> <span style="color:#000;font-weight:bold">:</span><span style="color:#000">Type</span><span style="color:#000;font-weight:bold">;</span>    <span style="color:#8f5902;font-style:italic"># &lt;--- Разрешенный тип</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">{</span>     
</span></span><span style="display:flex;"><span>        <span style="color:#000">op1</span><span style="color:#000;font-weight:bold">;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#000">op2</span><span style="color:#000;font-weight:bold">;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#ce5c00;font-weight:bold">...</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">}:</span> <span style="color:#ce5c00;font-weight:bold">&lt;</span><span style="color:#000;font-weight:bold">:</span><span style="color:#000">Type1</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000;font-weight:bold">:</span><span style="color:#000">Type2</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000;font-weight:bold">:</span><span style="color:#000">Type3</span><span style="color:#ce5c00;font-weight:bold">&gt;</span><span style="color:#000;font-weight:bold">;</span>  <span style="color:#8f5902;font-style:italic"># &lt;--- Несколько разрешенных типов возврата</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">{</span>     
</span></span><span style="display:flex;"><span>        <span style="color:#000">op1</span><span style="color:#000;font-weight:bold">;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#000">op2</span><span style="color:#000;font-weight:bold">;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#ce5c00;font-weight:bold">...</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">}:</span> <span style="color:#ce5c00;font-weight:bold">&lt;</span> <span style="color:#ce5c00;font-weight:bold">...</span> <span style="color:#ce5c00;font-weight:bold">&gt;</span><span style="color:#000;font-weight:bold">;</span>  <span style="color:#8f5902;font-style:italic"># &lt;--- Разрешен любой тип возвращаемого значения</span>
</span></span></code></pre></div><h3 id="embed">Расширенный синтаксис<a class="td-heading-self-link" href="#embed" aria-label="Heading self-link"></a></h3>
<p>Расширенный синтаксис с нативным исходным кодом на языке реализации (С++), это тоже блок кода.
Он начинается и заканчивается на фигурные скобки со знаком процента («<strong>{%</strong>» и «<strong>%}</strong>»).</p>
<p>Внутри блока кода с расширенным синтаксисом можно применять произвольные элементы языка реализации (С++),
но нужно иметь ввиду, что расширенный синтаксис является исходным текстом программы и напрямую подстваляется
и выходной текст трансплайтера во время компиляции файла.</p>
<p>С помощью блока кода с расширенным синтаксисом можно реализовать разные элементы, которые отсуствуют в основном синтаксисе,
например, безусловный переход на заданную метку.</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span>    <span style="color:#ce5c00;font-weight:bold">@@</span> <span style="color:#000">label</span> <span style="color:#a40000">$</span><span style="color:#000">name</span> <span style="color:#ce5c00;font-weight:bold">@@</span> <span style="color:#000;font-weight:bold">:</span><span style="color:#ce5c00;font-weight:bold">:=</span> <span style="color:#ce5c00;font-weight:bold">@@@</span> <span style="color:#000;font-weight:bold">{</span><span style="color:#ce5c00;font-weight:bold">%</span>  <span style="color:#ce5c00;font-weight:bold">@</span><span style="color:#a40000">$</span><span style="color:#000">name</span><span style="color:#000;font-weight:bold">:;</span>  <span style="color:#ce5c00;font-weight:bold">%</span><span style="color:#000;font-weight:bold">}</span>  <span style="color:#ce5c00;font-weight:bold">@@@</span><span style="color:#000;font-weight:bold">;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#ce5c00;font-weight:bold">@@</span> <span style="color:#000">goto</span> <span style="color:#a40000">$</span><span style="color:#000">label</span> <span style="color:#ce5c00;font-weight:bold">@@</span> <span style="color:#000;font-weight:bold">:</span><span style="color:#ce5c00;font-weight:bold">:=</span> <span style="color:#ce5c00;font-weight:bold">@@@</span> <span style="color:#000;font-weight:bold">{</span><span style="color:#ce5c00;font-weight:bold">%</span>  <span style="color:#000">goto</span> <span style="color:#ce5c00;font-weight:bold">@</span><span style="color:#a40000">$</span><span style="color:#000">label</span><span style="color:#000;font-weight:bold">;</span>  <span style="color:#ce5c00;font-weight:bold">%</span><span style="color:#000;font-weight:bold">}</span>  <span style="color:#ce5c00;font-weight:bold">@@@</span><span style="color:#000;font-weight:bold">;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#5c35cc;font-weight:bold">@goto</span> <span style="color:#000">label_for_goto</span><span style="color:#000;font-weight:bold">;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#8f5902;font-style:italic"># Skip this code</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#5c35cc;font-weight:bold">@label</span> <span style="color:#000">label_for_goto</span><span style="color:#000;font-weight:bold">;</span>
</span></span><span style="display:flex;"><span>    
</span></span></code></pre></div><p>Взаимодействие расширенного синтаксиса с основным кодом программы происходит
путем обращения к локальным объектам или макросам программы изнутри блока кода.
Но для этого, имя объекта должно быть указано полностью, включая все квалификаторы имени.</p>
<p>Если есть необходимость обратится к статическому объекту, его имя нужно заменить макросом,
так как символ двоеточия используется в синтаксисе языков C/C++.</p>


<div class="pageinfo pageinfo-primary">
<p>Начиная с версии C++26 взаимодействие с расширенным синтаксисом может быть нарушено!</p>
<blockquote>
<p>Add the same characters @, $, and ` to the basic character set [C++26] P2558R2</p>
</blockquote>

</div>

<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-cpp" data-lang="cpp"><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#f57900">factorial</span> <span style="color:#000;font-weight:bold">:</span><span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#0000cf;font-weight:bold">1000</span><span style="color:#000;font-weight:bold">;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#ce5c00;font-weight:bold">::</span><span style="color:#f57900">result</span> <span style="color:#000;font-weight:bold">:</span><span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#0000cf;font-weight:bold">1</span><span style="color:#a40000">\</span><span style="color:#0000cf;font-weight:bold">1</span><span style="color:#000;font-weight:bold">;</span>  <span style="color:#8f5902;font-style:italic">/* Rational number */</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#a40000">@@</span> <span style="color:#000">res</span> <span style="color:#a40000">@@</span> <span style="color:#ce5c00;font-weight:bold">::=</span> <span style="color:#ce5c00;font-weight:bold">::</span><span style="color:#000">result</span><span style="color:#000;font-weight:bold">;</span>
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">{</span><span style="color:#ce5c00;font-weight:bold">%</span>  
</span></span><span style="display:flex;"><span>        <span style="color:#8f5902;font-style:italic">// Source on the C++
</span></span></span><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic"></span>        <span style="color:#204a87;font-weight:bold">for</span><span style="color:#000;font-weight:bold">(</span> <span style="color:#204a87;font-weight:bold">int</span> <span style="color:#000">i</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#0000cf;font-weight:bold">2</span><span style="color:#000;font-weight:bold">;</span> <span style="color:#000">i</span> <span style="color:#ce5c00;font-weight:bold">&lt;=</span> <span style="color:#204a87;font-weight:bold">static_cast</span><span style="color:#ce5c00;font-weight:bold">&lt;</span><span style="color:#204a87;font-weight:bold">unsigned</span> <span style="color:#204a87;font-weight:bold">int</span><span style="color:#ce5c00;font-weight:bold">&gt;</span><span style="color:#000;font-weight:bold">(</span> <span style="color:#a40000">$</span><span style="color:#000">factorial</span> <span style="color:#000;font-weight:bold">);</span> <span style="color:#000">i</span><span style="color:#ce5c00;font-weight:bold">++</span> <span style="color:#000;font-weight:bold">){</span>
</span></span><span style="display:flex;"><span>            <span style="color:#a40000">@</span><span style="color:#000">res</span> <span style="color:#ce5c00;font-weight:bold">*=</span> <span style="color:#000">i</span><span style="color:#000;font-weight:bold">;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#000;font-weight:bold">}</span>
</span></span><span style="display:flex;"><span>        
</span></span><span style="display:flex;"><span>        <span style="color:#000">printf</span><span style="color:#000;font-weight:bold">(</span><span style="color:#4e9a06">&#34;</span><span style="color:#4e9a06">\n</span><span style="color:#4e9a06">Factorial %i! = %s</span><span style="color:#4e9a06">\n</span><span style="color:#4e9a06">&#34;</span><span style="color:#000;font-weight:bold">,</span> 
</span></span><span style="display:flex;"><span>            <span style="color:#204a87;font-weight:bold">static_cast</span><span style="color:#ce5c00;font-weight:bold">&lt;</span><span style="color:#204a87;font-weight:bold">unsigned</span> <span style="color:#204a87;font-weight:bold">int</span><span style="color:#ce5c00;font-weight:bold">&gt;</span><span style="color:#000;font-weight:bold">(</span> <span style="color:#a40000">$</span><span style="color:#000">factorial</span> <span style="color:#000;font-weight:bold">),</span> 
</span></span><span style="display:flex;"><span>            <span style="color:#204a87;font-weight:bold">static_cast</span><span style="color:#ce5c00;font-weight:bold">&lt;</span><span style="color:#204a87;font-weight:bold">const</span> <span style="color:#204a87;font-weight:bold">char</span> <span style="color:#ce5c00;font-weight:bold">*&gt;</span><span style="color:#000;font-weight:bold">(</span> <span style="color:#a40000">@</span><span style="color:#000">res</span> <span style="color:#000;font-weight:bold">));</span>
</span></span><span style="display:flex;"><span>        <span style="color:#8f5902;font-style:italic"># std::cout &lt;&lt; &#34;Factorial &#34; &lt;&lt;  static_cast&lt;unsigned int&gt;( $factorial );
</span></span></span><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic"></span>        <span style="color:#8f5902;font-style:italic"># std::cout &lt;&lt; &#34;! = &#34; &lt;&lt; static_cast&lt;const char *&gt;( @res ) &lt;&lt; std::endl;
</span></span></span><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic"></span>    <span style="color:#ce5c00;font-weight:bold">%</span><span style="color:#000;font-weight:bold">}</span>
</span></span></code></pre></div>
</div>



    
	
  
    
    
	
    

<div class="td-content" style="page-break-before: always">
    
	<h1 id="pg-d3e59c3a58123ba89df95ba6f3f2e4c2">3.3 - Математические операторы</h1>
    
	<p>Все математические операторы имеют парный аналог с присвоением значения:</p>
<ul>
<li><strong>+</strong> и <strong>+=</strong> — сложение арифметических типов данных;</li>
<li><strong>-</strong> и <strong>-=</strong> — вычитание арифметических типов данных;</li>
<li><strong>/</strong> и <strong>/=</strong> — деление (результат число с плавающей точкой);</li>
<li><strong>//</strong> и <strong>//=</strong> — целочисленное деление с округлением к меньшему числу (как в Python);</li>
<li><strong>*</strong> и <strong>*=</strong> — умножение (он же используется и для повторения текстовых строк);</li>
<li><strong>%</strong> и <strong>%=</strong> — остаток от целочисленного деления;</li>
</ul>
<p>Отдельный оператор для возведения в степень отсуствует.</p>
<h3 id="операторы-двоичного-сдвига--пока-не-реализованы">Операторы двоичного сдвига <em>*) пока не реализованы</em><a class="td-heading-self-link" href="#%d0%be%d0%bf%d0%b5%d1%80%d0%b0%d1%82%d0%be%d1%80%d1%8b-%d0%b4%d0%b2%d0%be%d0%b8%d1%87%d0%bd%d0%be%d0%b3%d0%be-%d1%81%d0%b4%d0%b2%d0%b8%d0%b3%d0%b0--%d0%bf%d0%be%d0%ba%d0%b0-%d0%bd%d0%b5-%d1%80%d0%b5%d0%b0%d0%bb%d0%b8%d0%b7%d0%be%d0%b2%d0%b0%d0%bd%d1%8b" aria-label="Heading self-link"></a></h3>
<ul>
<li><strong>.&lt;.</strong> - Битовый сдвиг влево</li>
<li><strong>.&gt;.</strong> - Битовый сдвиг вправо</li>
<li><strong>.&gt;&gt;.</strong> - Битовый сдвиг вправо с заполнением знакового бита</li>
<li><strong>.&amp;.</strong> - Битовый оператор И</li>
<li><strong>.|.</strong> - Битовый оператор ИЛИ</li>
<li><strong>.^.</strong> - Битовый оператор ИСКЛЮЧАЮЩЕЕ ИЛИ</li>
<li><strong>.~.</strong> - Битовый унарный оператор НЕ (инверсии)</li>
</ul>

</div>



    
	
  
    
    
	
    

<div class="td-content" style="page-break-before: always">
    
	<h1 id="pg-4c5f23e30e3baaec755b982700349e58">3.4 - Операторы сравнения и типизация</h1>
    
	<h3 id="арифметическое-сравнение">Арифметическое сравнение<a class="td-heading-self-link" href="#%d0%b0%d1%80%d0%b8%d1%84%d0%bc%d0%b5%d1%82%d0%b8%d1%87%d0%b5%d1%81%d0%ba%d0%be%d0%b5-%d1%81%d1%80%d0%b0%d0%b2%d0%bd%d0%b5%d0%bd%d0%b8%d0%b5" aria-label="Heading self-link"></a></h3>
<p>Операторы арифметического сравнения представленными классическими <strong>&lt;</strong>, <strong>&gt;</strong>, <strong>&lt;=</strong>, <strong>&gt;=</strong>, <strong>==</strong> и <strong>!=</strong>.
Они использются для сравнения между собой скаляров и рациональных чисел, а операторы сранвения на равенство <strong>==</strong> и <strong>!=</strong>,
позвоялют сравнивать между собой в том числе и матрицы.</p>
<h3 id="операторы-сравнения">Операторы сравнения<a class="td-heading-self-link" href="#%d0%be%d0%bf%d0%b5%d1%80%d0%b0%d1%82%d0%be%d1%80%d1%8b-%d1%81%d1%80%d0%b0%d0%b2%d0%bd%d0%b5%d0%bd%d0%b8%d1%8f" aria-label="Heading self-link"></a></h3>
<ul>
<li>
<p><strong>==</strong> и <strong>!=</strong> — операторы сравнения с автоматическим приведением совместимых типов для любых объектов</p>
</li>
<li>
<p><strong>==</strong> и <strong>!=</strong> — операторы сравнения с автоматическим приведением совместимых типов для любых объектов</p>
</li>
<li>
<p><strong>===</strong> и <strong>!==</strong> — операторы точного сравнения для любых объектов (автоматического приведения типов не выполняется).
Для объектов сравниваются адреса размещения</p>
</li>
</ul>
<h3 id="строгая-статическая-номинальная-типизация">Строгая статическая (номинальная) типизация<a class="td-heading-self-link" href="#%d1%81%d1%82%d1%80%d0%be%d0%b3%d0%b0%d1%8f-%d1%81%d1%82%d0%b0%d1%82%d0%b8%d1%87%d0%b5%d1%81%d0%ba%d0%b0%d1%8f-%d0%bd%d0%be%d0%bc%d0%b8%d0%bd%d0%b0%d0%bb%d1%8c%d0%bd%d0%b0%d1%8f-%d1%82%d0%b8%d0%bf%d0%b8%d0%b7%d0%b0%d1%86%d0%b8%d1%8f" aria-label="Heading self-link"></a></h3>
<p>Строгая статическая номинальная проверка типа объектов во время любых операций производится автоматически
во время компиляции исходного текста программы, если хотя бы у одной из переменных
при опеределении был указан её тип в явном виде.</p>
<p>Результат статической номинальной проверки типов будет успешным, если тип правого объекта может быть автоматически преобразован
к типу левого операнда или тип правого операнада присутствует у левого в иерархии наследования.</p>
<h3 id="instanceof">Динамическая номинальная типизация<a class="td-heading-self-link" href="#instanceof" aria-label="Heading self-link"></a></h3>
<p>Для проверки имени типа (класса) объекта во время выполнения используется оператор тильда &ldquo;<strong>~</strong>&rdquo;.
Это таже номинальная проверка типов, но только во время выполнения приложения.
Левым операндом должен быть проверяемый объект, а правым — тип с которым сравнивается левый оператор.</p>
<p>Правый оператор может быть строкой литералом, переменной строкового типа или именем проверяемого класса непосредственно.
Результатом операции будет истина, если правый операнд содержит название класса проверяемого объекта
или он присутствует у него в иерархии наследования.</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span>    <span style="color:#000">name</span> <span style="color:#ce5c00;font-weight:bold">:=</span> <span style="color:#4e9a06">&#34;class&#34;</span><span style="color:#000;font-weight:bold">;</span> <span style="color:#8f5902;font-style:italic"># Строковая переменная с именем класса</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000">var</span> <span style="color:#ce5c00;font-weight:bold">~</span> <span style="color:#000">name</span><span style="color:#000;font-weight:bold">;</span> 
</span></span><span style="display:flex;"><span>    <span style="color:#000">var</span> <span style="color:#ce5c00;font-weight:bold">~</span> <span style="color:#000;font-weight:bold">:</span><span style="color:#000">class</span><span style="color:#000;font-weight:bold">;</span> <span style="color:#8f5902;font-style:italic"># Сравнение с типом</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000">var</span> <span style="color:#ce5c00;font-weight:bold">~</span> <span style="color:#4e9a06">&#34;class&#34;</span><span style="color:#000;font-weight:bold">;</span> <span style="color:#8f5902;font-style:italic"># Имя типа как строка литерал</span>
</span></span></code></pre></div><h3 id="duck-typing">Динамическая утиная типизация<a class="td-heading-self-link" href="#duck-typing" aria-label="Heading self-link"></a></h3>
<p>Оператор утиной типизации, два символа тильды &ldquo;<strong>~~</strong>&rdquo;.
Проверяемым типом является левый оператор, а правый выступает в роли облазца для сравнения.
Для простых типов сравнивается совместимость типа левого операнда по отношению к правому.
А для словарей и классов в левом операнде проверяется наличие всех имен полей, присутствующих у правого операнда, т.е.:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span>    <span style="color:#8f5902;font-style:italic"># Истина (т. е. левый операнд словарь)</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">(</span><span style="color:#000">field1</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#4e9a06">&#34;value&#34;</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">field2</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#0000cf;font-weight:bold">2</span><span style="color:#000;font-weight:bold">,)</span> <span style="color:#ce5c00;font-weight:bold">~~</span> <span style="color:#000;font-weight:bold">();</span> 
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#8f5902;font-style:italic"># Тоже истина (т. к. поле field1 присутствует у левого операнда)</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">(</span><span style="color:#000">field1</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#4e9a06">&#34;value&#34;</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">field2</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#0000cf;font-weight:bold">2</span><span style="color:#000;font-weight:bold">,)</span> <span style="color:#ce5c00;font-weight:bold">~~</span> <span style="color:#000;font-weight:bold">(</span><span style="color:#000">field1</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#000">_</span><span style="color:#000;font-weight:bold">);</span> 
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#8f5902;font-style:italic"># Ложь, т.к. поле not_found у левого операнда отсутствует</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">(</span><span style="color:#000">field1</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#4e9a06">&#34;value&#34;</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">field2</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#0000cf;font-weight:bold">2</span><span style="color:#000;font-weight:bold">,)</span> <span style="color:#ce5c00;font-weight:bold">~~</span> <span style="color:#000;font-weight:bold">(</span><span style="color:#000">not_found</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#000">_</span><span style="color:#000;font-weight:bold">);</span> 
</span></span></code></pre></div><h3 id="строгая-утиная-типизация">Строгая утиная типизация<a class="td-heading-self-link" href="#%d1%81%d1%82%d1%80%d0%be%d0%b3%d0%b0%d1%8f-%d1%83%d1%82%d0%b8%d0%bd%d0%b0%d1%8f-%d1%82%d0%b8%d0%bf%d0%b8%d0%b7%d0%b0%d1%86%d0%b8%d1%8f" aria-label="Heading self-link"></a></h3>
<p>Строгая утиная типизация &ldquo;<strong>~~~</strong>&rdquo; для простых типов сравнивается идентичности типов без учета совместимости,
а для составных типов происходит сравнение всех свойств с помощью оператора строгого равенства.</p>
<p>Для данной операции, пустой тип совместим только с другим пустим типом.</p>

</div>



    
	
  
    
    
	
    

<div class="td-content" style="page-break-before: always">
    
	<h1 id="pg-baeb4815377e55e87e33ba78dbb8d2b1">3.5 - Условный оператор</h1>
    
	<p>В качестве оператора проверки условия используется синтаксическая конструкция, которая соответствует по смыслу термину «следует»,
т.е. два тире и угловая скобка <strong>--&gt;</strong>. Такая запись условного оператора очень похожа на математическую и легко объединяется
в последовательности для проверки множественных условий вида «else if».</p>
<p>В общем случае условный оператор имеет вид: <strong>[</strong> условие <strong>] --&gt; {</strong> действие <strong>};</strong> или
с условием иначе <strong>[</strong> условие <strong>] --&gt; {</strong> действие <strong>}, [&hellip;] --&gt; {</strong> действие иначе <strong>};</strong></p>
<p>Для наглядности записанный с отступами:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">[</span> <span style="color:#000">условие1</span> <span style="color:#000;font-weight:bold">]</span> <span style="color:#ce5c00;font-weight:bold">--&gt;</span> <span style="color:#000;font-weight:bold">{</span> <span style="color:#000">действие1</span> <span style="color:#000;font-weight:bold">},</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">[</span> <span style="color:#000">условие2</span> <span style="color:#000;font-weight:bold">]</span> <span style="color:#ce5c00;font-weight:bold">--&gt;</span> <span style="color:#000">действие2</span><span style="color:#000;font-weight:bold">,</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">[</span> <span style="color:#000">условие3</span> <span style="color:#000;font-weight:bold">]</span> <span style="color:#ce5c00;font-weight:bold">--&gt;</span> <span style="color:#000">действие3</span><span style="color:#000;font-weight:bold">,</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">[</span><span style="color:#ce5c00;font-weight:bold">...</span><span style="color:#000;font-weight:bold">]</span> <span style="color:#ce5c00;font-weight:bold">--&gt;</span> <span style="color:#000;font-weight:bold">{</span><span style="color:#000">действие_иначе</span><span style="color:#000;font-weight:bold">};</span>
</span></span></code></pre></div><p>Или тоже самое, но с использованием <a href="/ru/docs/syntax/dsl/">макросов DSL</a>.:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span>    <span style="color:#5c35cc;font-weight:bold">@if</span><span style="color:#000;font-weight:bold">(</span> <span style="color:#000">условие1</span> <span style="color:#000;font-weight:bold">)</span> <span style="color:#000;font-weight:bold">{</span> 
</span></span><span style="display:flex;"><span>        <span style="color:#000">действие1</span> 
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">}</span> <span style="color:#5c35cc;font-weight:bold">@elif</span><span style="color:#000;font-weight:bold">(</span> <span style="color:#000">условие2</span> <span style="color:#000;font-weight:bold">)</span> <span style="color:#000">действие2</span>
</span></span><span style="display:flex;"><span>    <span style="color:#5c35cc;font-weight:bold">@elif</span><span style="color:#000;font-weight:bold">(</span> <span style="color:#000">условие3</span> <span style="color:#000;font-weight:bold">)</span> <span style="color:#000">действие3</span>
</span></span><span style="display:flex;"><span>    <span style="color:#5c35cc;font-weight:bold">@else</span> <span style="color:#000;font-weight:bold">{</span> 
</span></span><span style="display:flex;"><span>        <span style="color:#000">действие_иначе</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">};</span>
</span></span></code></pre></div>
</div>



    
	
  
    
    
	
    

<div class="td-content" style="page-break-before: always">
    
	<h1 id="pg-7257e6b33d78b199fd60804216e19236">3.6 - Оценка выражения</h1>
    
	<p>Синтаксическая конструкция с помощью которой реализуется примерный аналог оператора <em>switch</em> или <em>match</em> выглядит следующим образом:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">[</span> <span style="color:#a40000">$</span><span style="color:#000">var</span> <span style="color:#000;font-weight:bold">]</span> <span style="color:#ce5c00;font-weight:bold">==&gt;</span> <span style="color:#000;font-weight:bold">{</span>
</span></span><span style="display:flex;"><span>        <span style="color:#000;font-weight:bold">[</span><span style="color:#0000cf;font-weight:bold">1</span><span style="color:#000;font-weight:bold">]</span> <span style="color:#ce5c00;font-weight:bold">--&gt;</span> <span style="color:#000;font-weight:bold">{</span> <span style="color:#000">code</span> <span style="color:#000;font-weight:bold">};</span> <span style="color:#8f5902;font-style:italic"># Выполнится проверка условия $var == 1</span>
</span></span><span style="display:flex;"><span>        <span style="color:#000;font-weight:bold">[</span><span style="color:#0000cf;font-weight:bold">1</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#0000cf;font-weight:bold">2</span><span style="color:#000;font-weight:bold">]</span> <span style="color:#ce5c00;font-weight:bold">--&gt;</span> <span style="color:#000;font-weight:bold">{</span> <span style="color:#000">code</span> <span style="color:#000;font-weight:bold">};</span> <span style="color:#8f5902;font-style:italic"># Выполнится проверка условия ($var == 1 || $var == 2)</span>
</span></span><span style="display:flex;"><span>        <span style="color:#000;font-weight:bold">[</span><span style="color:#ce5c00;font-weight:bold">...</span><span style="color:#000;font-weight:bold">]</span> <span style="color:#ce5c00;font-weight:bold">--&gt;</span> <span style="color:#000;font-weight:bold">{</span> <span style="color:#000">code</span> <span style="color:#000">default</span> <span style="color:#000;font-weight:bold">};</span> <span style="color:#8f5902;font-style:italic"># Ветка условия иначе</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">};</span>
</span></span></code></pre></div><p>Или тоже самое, но с использованием <a href="/ru/docs/syntax/dsl/">макросов из модуля dsl</a>:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span>    <span style="color:#5c35cc;font-weight:bold">@match</span><span style="color:#000;font-weight:bold">(</span> <span style="color:#a40000">$</span><span style="color:#000">var</span> <span style="color:#000;font-weight:bold">)</span> <span style="color:#ce5c00;font-weight:bold">==&gt;</span> <span style="color:#000;font-weight:bold">{</span>
</span></span><span style="display:flex;"><span>        <span style="color:#5c35cc;font-weight:bold">@case</span><span style="color:#000;font-weight:bold">(</span> <span style="color:#0000cf;font-weight:bold">1</span> <span style="color:#000;font-weight:bold">)</span> <span style="color:#000;font-weight:bold">{</span> <span style="color:#000">code</span> <span style="color:#000;font-weight:bold">};</span>
</span></span><span style="display:flex;"><span>        <span style="color:#5c35cc;font-weight:bold">@case</span><span style="color:#000;font-weight:bold">(</span> <span style="color:#0000cf;font-weight:bold">1</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#0000cf;font-weight:bold">2</span> <span style="color:#000;font-weight:bold">)</span> <span style="color:#000;font-weight:bold">{</span> <span style="color:#000">code</span> <span style="color:#000;font-weight:bold">};</span>
</span></span><span style="display:flex;"><span>        <span style="color:#5c35cc;font-weight:bold">@default</span> <span style="color:#000;font-weight:bold">{</span> <span style="color:#000">code</span> <span style="color:#000">default</span> <span style="color:#000;font-weight:bold">};</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">};</span>
</span></span></code></pre></div><p>Этот оператор очень похож на <em>Pattern Matching</em>, но все же не является сопоставлением с образцом,
а скорее более краткая запись множественного оператора сравнения,
так как в качестве оператора для оценки могут быть использован любые имеющиеся операторы сравнения на равенство:</p>
<ul>
<li><strong>==&gt;</strong> — проверка на равенство с приведением типов;</li>
<li><strong>===&gt;</strong> — проверка на точное равенство;</li>
<li><strong>~&gt;</strong> — проверка типа (имени класса);</li>
<li><strong>~~&gt;</strong> — утиная типизация;</li>
<li><strong>~~~&gt;</strong> — строгая утиная типизация.</li>
</ul>
<p>Но если в качестве оператора сравнения использовать оператор утиной типизации, то оценка выражения превращается в классический <em>Pattern Matching</em>:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span>    <span style="color:#a40000">$</span><span style="color:#000">value</span> <span style="color:#ce5c00;font-weight:bold">:=</span> <span style="color:#000;font-weight:bold">(</span><span style="color:#000">f1</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#0000cf;font-weight:bold">1</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">f2</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#4e9a06">&#34;2&#34;</span><span style="color:#000;font-weight:bold">,);</span>
</span></span><span style="display:flex;"><span>    <span style="color:#5c35cc;font-weight:bold">@match</span><span style="color:#000;font-weight:bold">(</span> <span style="color:#a40000">$</span><span style="color:#000">value</span> <span style="color:#000;font-weight:bold">)</span> <span style="color:#ce5c00;font-weight:bold">~~&gt;</span> <span style="color:#000;font-weight:bold">{</span>
</span></span><span style="display:flex;"><span>        <span style="color:#5c35cc;font-weight:bold">@case</span><span style="color:#000;font-weight:bold">((</span><span style="color:#000">f1</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#000">_</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000;font-weight:bold">),</span> <span style="color:#000;font-weight:bold">(</span><span style="color:#000">f1</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#000">_</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">f2</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#0000cf;font-weight:bold">0</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000;font-weight:bold">))</span> <span style="color:#000;font-weight:bold">{</span> <span style="color:#ce5c00;font-weight:bold">...</span> <span style="color:#000">code</span> <span style="color:#ce5c00;font-weight:bold">...</span> <span style="color:#000;font-weight:bold">};</span> <span style="color:#8f5902;font-style:italic"># Поле f2 отсутствует или число </span>
</span></span><span style="display:flex;"><span>        <span style="color:#5c35cc;font-weight:bold">@case</span><span style="color:#000;font-weight:bold">((</span><span style="color:#000">f1</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#000">_</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">f2</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#4e9a06">&#34;&#34;</span><span style="color:#000;font-weight:bold">,),</span> <span style="color:#000;font-weight:bold">(</span><span style="color:#000">f1</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#000">_</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">f2</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#4e9a06">&#39;&#39;</span><span style="color:#000;font-weight:bold">,))</span> <span style="color:#000;font-weight:bold">{</span> <span style="color:#ce5c00;font-weight:bold">...</span> <span style="color:#000">code</span> <span style="color:#ce5c00;font-weight:bold">...</span> <span style="color:#000;font-weight:bold">};</span> <span style="color:#8f5902;font-style:italic"># Поле f2 строка</span>
</span></span><span style="display:flex;"><span>        <span style="color:#5c35cc;font-weight:bold">@default</span> <span style="color:#000;font-weight:bold">{</span> <span style="color:#ce5c00;font-weight:bold">...</span> <span style="color:#000">code</span> <span style="color:#000">default</span> <span style="color:#ce5c00;font-weight:bold">...</span> <span style="color:#000;font-weight:bold">};</span> <span style="color:#8f5902;font-style:italic"># Код по умолчанию</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">};</span>
</span></span></code></pre></div>
</div>



    
	
  
    
    
	
    

<div class="td-content" style="page-break-before: always">
    
	<h1 id="pg-3dc86b17aec2b74ca5a44690abb43951">3.7 - Операторы циклов</h1>
    
	<p>Для записи циклов используются оператор <strong>&lt;-&gt;</strong>, который ставится между условием цикла (проверкой логического выражения) и телом цикла.
Условие цикла записывается в квадратных скобках и в зависимости от взаимного расположения цикл может быть с предусловием (while)
или постусловием (dowhile):</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>    <span style="color:#ce5c00;font-weight:bold">[</span>условие <span style="color:#204a87;font-weight:bold">while</span><span style="color:#ce5c00;font-weight:bold">]</span> &lt;-&gt; <span style="color:#ce5c00;font-weight:bold">{</span>
</span></span><span style="display:flex;"><span>        тело цикла <span style="color:#204a87;font-weight:bold">while</span>
</span></span><span style="display:flex;"><span>    <span style="color:#ce5c00;font-weight:bold">}</span><span style="color:#000;font-weight:bold">;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#ce5c00;font-weight:bold">{</span>
</span></span><span style="display:flex;"><span>        тело цикла <span style="color:#204a87;font-weight:bold">do</span> <span style="color:#204a87;font-weight:bold">while</span>
</span></span><span style="display:flex;"><span>    <span style="color:#ce5c00;font-weight:bold">}</span> &lt;-&gt; <span style="color:#ce5c00;font-weight:bold">[</span>условие <span style="color:#204a87;font-weight:bold">do</span> <span style="color:#204a87;font-weight:bold">while</span><span style="color:#ce5c00;font-weight:bold">]</span><span style="color:#000;font-weight:bold">;</span>
</span></span></code></pre></div><p>Цикл с предусловием (<strong>while</strong>) поддерживает конструкцию <strong>else</strong>, которая выполняется, если условие входа в цикл не было выполнено.</p>
<blockquote>
<p><em>Внимание!</em>
<em>Это поведение отличается от аналогичных конструкций в языке Python, у которого секция <strong>else</strong> выполняется всегда, кроме прерывания цикла по break.</em></p>
</blockquote>
<p>Ветка <strong>else</strong> у оператора цикла записывается так же как и ветка <em>иначе</em> в условном операторе, т.е.</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">[</span> <span style="color:#000">cond</span> <span style="color:#000;font-weight:bold">]</span> <span style="color:#ce5c00;font-weight:bold">&lt;-&gt;</span> <span style="color:#000;font-weight:bold">{</span>
</span></span><span style="display:flex;"><span>        <span style="color:#ce5c00;font-weight:bold">...</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">},[</span><span style="color:#ce5c00;font-weight:bold">...</span><span style="color:#000;font-weight:bold">]</span> <span style="color:#ce5c00;font-weight:bold">--&gt;</span> <span style="color:#000;font-weight:bold">{</span>
</span></span><span style="display:flex;"><span>        <span style="color:#ce5c00;font-weight:bold">...</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">};</span>
</span></span></code></pre></div><p>Или тоже самое, но с использованием <a href="/ru/docs/syntax/dsl/">макросов из модуля dsl</a>:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span>    <span style="color:#5c35cc;font-weight:bold">@while</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">cond</span><span style="color:#000;font-weight:bold">)</span> <span style="color:#000;font-weight:bold">{</span>
</span></span><span style="display:flex;"><span>        <span style="color:#ce5c00;font-weight:bold">...</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">}</span> <span style="color:#5c35cc;font-weight:bold">@else</span> <span style="color:#000;font-weight:bold">{</span>
</span></span><span style="display:flex;"><span>        <span style="color:#ce5c00;font-weight:bold">...</span> <span style="color:#8f5902;font-style:italic"># Выполнится, только если cond будет false при входе в цикл</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">};</span>
</span></span></code></pre></div><p>Пример реализации цикла foreach для суммирования всех элементов словаря (или одномерного тензора) с использованием оператора раскрытия списка:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span>    <span style="color:#000">summa</span> <span style="color:#ce5c00;font-weight:bold">:=</span> <span style="color:#0000cf;font-weight:bold">0</span><span style="color:#000;font-weight:bold">;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#204a87">dict</span> <span style="color:#ce5c00;font-weight:bold">:=</span> <span style="color:#000;font-weight:bold">(</span><span style="color:#0000cf;font-weight:bold">1</span><span style="color:#000;font-weight:bold">,</span><span style="color:#0000cf;font-weight:bold">2</span><span style="color:#000;font-weight:bold">,</span><span style="color:#0000cf;font-weight:bold">3</span><span style="color:#000;font-weight:bold">,</span><span style="color:#0000cf;font-weight:bold">4</span><span style="color:#000;font-weight:bold">,</span><span style="color:#0000cf;font-weight:bold">5</span><span style="color:#000;font-weight:bold">,);</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">[</span> <span style="color:#204a87">dict</span> <span style="color:#000;font-weight:bold">]</span> <span style="color:#ce5c00;font-weight:bold">&lt;-&gt;</span> <span style="color:#000;font-weight:bold">{</span> <span style="color:#8f5902;font-style:italic"># Условие цикла, пока есть данные</span>
</span></span><span style="display:flex;"><span>        <span style="color:#8f5902;font-style:italic"># Результат оператора распаковка словаря - первый элемент перемещается в item</span>
</span></span><span style="display:flex;"><span>        <span style="color:#000">item</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#204a87">dict</span> <span style="color:#ce5c00;font-weight:bold">:=</span> <span style="color:#ce5c00;font-weight:bold">...</span> <span style="color:#204a87">dict</span><span style="color:#000;font-weight:bold">;</span> 
</span></span><span style="display:flex;"><span>        <span style="color:#000">summa</span> <span style="color:#ce5c00;font-weight:bold">+=</span> <span style="color:#000">item</span><span style="color:#000;font-weight:bold">;</span> <span style="color:#8f5902;font-style:italic"># Вычисление суммы всех элементов словаря</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">};</span>
</span></span></code></pre></div>
</div>



    
	
  
    
    
	
    

<div class="td-content" style="page-break-before: always">
    
	<h1 id="pg-bd50d502b62e28893b4b0c4746f52c78">3.8 - Менеджер контекста</h1>
    
	<p>Одиночный оператор захвата <a href="/ru/docs/syntax/memory/">ссылки и синхронизации доступа</a> к объекту &lsquo;<strong>*</strong>&rsquo; или &lsquo;<strong>*(&hellip;)</strong>&rsquo;
выполняется только для одной переменной при использовании в одном действии.
Но захват ссылки и объекта синхронизации, это относительно медленная операция и выполнять её для каждого действия над переменной не рационально.</p>
<p>Для того, чтобы захватить одновременно сразу несколько объектов синхронизации
для выполнения группы последовательных действий используется менеджер контекста.</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span>    <span style="color:#ce5c00;font-weight:bold">**</span><span style="color:#000;font-weight:bold">(</span> <span style="color:#000">val1</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#ce5c00;font-weight:bold">*</span><span style="color:#000">ref1</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">val2</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#ce5c00;font-weight:bold">*</span><span style="color:#000">ref2</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">__timeout__</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#0000cf;font-weight:bold">10000</span> <span style="color:#000;font-weight:bold">){</span>
</span></span><span style="display:flex;"><span>        <span style="color:#ce5c00;font-weight:bold">...</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">};</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#ce5c00;font-weight:bold">**</span><span style="color:#000;font-weight:bold">(</span> <span style="color:#ce5c00;font-weight:bold">...</span> <span style="color:#000;font-weight:bold">){</span>
</span></span><span style="display:flex;"><span>        <span style="color:#ce5c00;font-weight:bold">...</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">}</span> <span style="color:#000;font-weight:bold">,</span> <span style="color:#000;font-weight:bold">[</span><span style="color:#ce5c00;font-weight:bold">...</span><span style="color:#000;font-weight:bold">]</span> <span style="color:#000;font-weight:bold">{</span>
</span></span><span style="display:flex;"><span>        <span style="color:#8f5902;font-style:italic"># Ветка else при ошибке захвата ссылки</span>
</span></span><span style="display:flex;"><span>        <span style="color:#8f5902;font-style:italic"># Информация об ошибке в переменной $^</span>
</span></span><span style="display:flex;"><span>        <span style="color:#ce5c00;font-weight:bold">...</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">};</span>
</span></span></code></pre></div><p>Или таже самая запись с использованием <a href="/ru/docs/syntax/dsl/">макросов DSL</a>:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span>    <span style="color:#5c35cc;font-weight:bold">@with</span><span style="color:#000;font-weight:bold">(</span> <span style="color:#000">val1</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#ce5c00;font-weight:bold">*</span><span style="color:#000">ref1</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">val2</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#ce5c00;font-weight:bold">*</span><span style="color:#000">ref2</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">__timeout__</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#0000cf;font-weight:bold">10000</span> <span style="color:#000;font-weight:bold">){</span>
</span></span><span style="display:flex;"><span>        <span style="color:#ce5c00;font-weight:bold">...</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">};</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#5c35cc;font-weight:bold">@with</span><span style="color:#000;font-weight:bold">(</span> <span style="color:#ce5c00;font-weight:bold">...</span> <span style="color:#000;font-weight:bold">){</span>
</span></span><span style="display:flex;"><span>        <span style="color:#ce5c00;font-weight:bold">...</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">}</span> <span style="color:#5c35cc;font-weight:bold">@else</span> <span style="color:#000;font-weight:bold">{</span>
</span></span><span style="display:flex;"><span>        <span style="color:#8f5902;font-style:italic"># Ветка else при ошибке захвата ссылки</span>
</span></span><span style="display:flex;"><span>        <span style="color:#8f5902;font-style:italic"># Информация об ошибке в переменной $^</span>
</span></span><span style="display:flex;"><span>        <span style="color:#ce5c00;font-weight:bold">...</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">};</span>
</span></span></code></pre></div><h3 id="захват-легких-ссылок-совместного-доступа">Захват легких ссылок совместного доступа<a class="td-heading-self-link" href="#%d0%b7%d0%b0%d1%85%d0%b2%d0%b0%d1%82-%d0%bb%d0%b5%d0%b3%d0%ba%d0%b8%d1%85-%d1%81%d1%81%d1%8b%d0%bb%d0%be%d0%ba-%d1%81%d0%be%d0%b2%d0%bc%d0%b5%d1%81%d1%82%d0%bd%d0%be%d0%b3%d0%be-%d0%b4%d0%be%d1%81%d1%82%d1%83%d0%bf%d0%b0" aria-label="Heading self-link"></a></h3>
<p>При захвате обычной легкой ссылки всегда сравнивается идентификатор текущего потока с идентифкатором потока - владельца объекта.
Использование обычных легких ссылок допускается только в рамках одного потока - владельца объекта.</p>
<p>Чтобы можно было использовать ссылки на легкие объекты в других потоках, для них требуется создать легкие ссылки для совместного доступа (&quot;<strong>&amp;?</strong>&quot;).</p>
<p>Захват легких ссылок для совместного доступа возможен только с помощью оператора группового захвата,
при условии, что как миниму одна из первых ссылок будет <em>тяжелой</em>. т.е. с реализованным объектом синхронизации.</p>
<p>Пример реализации критической секции с помощью оператора группового захвата <em>@with</em>
и статической переменной <em>@::sync</em> в качестве флага блокировки доступа:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span>    <span style="color:#8f5902;font-style:italic"># Функция для вызова в разных потоках</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000">show</span><span style="color:#000;font-weight:bold">(</span> <span style="color:#ce5c00;font-weight:bold">&amp;</span><span style="color:#a40000">?</span> <span style="color:#000">win1</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#ce5c00;font-weight:bold">&amp;</span><span style="color:#a40000">?</span> <span style="color:#000">win2</span><span style="color:#000;font-weight:bold">)</span> <span style="color:#ce5c00;font-weight:bold">:=</span> <span style="color:#000;font-weight:bold">{</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#ce5c00;font-weight:bold">&amp;&amp;</span> <span style="color:#ce5c00;font-weight:bold">@</span><span style="color:#000;font-weight:bold">::</span><span style="color:#000">sync</span> <span style="color:#ce5c00;font-weight:bold">:=</span> <span style="color:#5c35cc;font-weight:bold">@false</span><span style="color:#000;font-weight:bold">;</span> <span style="color:#8f5902;font-style:italic"># Global (static) synchronization object</span>
</span></span><span style="display:flex;"><span>        <span style="color:#5c35cc;font-weight:bold">@with</span> <span style="color:#000;font-weight:bold">(</span><span style="color:#ce5c00;font-weight:bold">*</span><span style="color:#000">sync</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">w1</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#ce5c00;font-weight:bold">*</span><span style="color:#000">win1</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">w2</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#ce5c00;font-weight:bold">*</span><span style="color:#000">win2</span><span style="color:#000;font-weight:bold">){</span>
</span></span><span style="display:flex;"><span>            <span style="color:#ce5c00;font-weight:bold">...</span> <span style="color:#8f5902;font-style:italic"># Критическая  секция</span>
</span></span><span style="display:flex;"><span>        <span style="color:#000;font-weight:bold">}</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">}</span>
</span></span></code></pre></div><h3 id="расширенный-синтаксис-определения-ссылок">Расширенный синтаксис определения ссылок<a class="td-heading-self-link" href="#%d1%80%d0%b0%d1%81%d1%88%d0%b8%d1%80%d0%b5%d0%bd%d0%bd%d1%8b%d0%b9-%d1%81%d0%b8%d0%bd%d1%82%d0%b0%d0%ba%d1%81%d0%b8%d1%81-%d0%be%d0%bf%d1%80%d0%b5%d0%b4%d0%b5%d0%bb%d0%b5%d0%bd%d0%b8%d1%8f-%d1%81%d1%81%d1%8b%d0%bb%d0%be%d0%ba" aria-label="Heading self-link"></a></h3>
<p>При определении переменной, у которой допускается создание ссылок и синхронизация доступа, можно указать дополнительные параметры работы.
Это делается с помощью указания системных параметров в типе разрешенных ссылок при определении объекта.</p>
<p>Условный пример:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    <span style="color:#ce5c00;font-weight:bold">&amp;&amp;</span> <span style="color:#000">sync</span><span style="color:#000;font-weight:bold">;</span> <span style="color:#8f5902;font-style:italic"># Объект синхронизации</span>
</span></span><span style="display:flex;"><span>    <span style="color:#ce5c00;font-weight:bold">&amp;&amp;</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">__timeout__</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#0000cf;font-weight:bold">1000</span><span style="color:#000;font-weight:bold">)</span> <span style="color:#000">sync_other</span><span style="color:#000;font-weight:bold">;</span> <span style="color:#8f5902;font-style:italic"># Объект синхронизации c таймаутом на блокировку</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#204a87;font-weight:bold">with</span><span style="color:#000;font-weight:bold">(</span><span style="color:#ce5c00;font-weight:bold">*</span><span style="color:#000">sync_other</span><span style="color:#000;font-weight:bold">)</span> <span style="color:#000;font-weight:bold">{</span> <span style="color:#8f5902;font-style:italic"># Блокировка с таймаутом</span>
</span></span><span style="display:flex;"><span>        <span style="color:#ce5c00;font-weight:bold">...</span> 
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">}</span> 
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#8f5902;font-style:italic"># Переменная value с конкретным объектом синхроинзации</span>
</span></span><span style="display:flex;"><span>    <span style="color:#ce5c00;font-weight:bold">&amp;</span><span style="color:#a40000">?</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">sync</span><span style="color:#000;font-weight:bold">)</span> <span style="color:#000">value</span> <span style="color:#ce5c00;font-weight:bold">:=</span> <span style="color:#0000cf;font-weight:bold">123</span><span style="color:#000;font-weight:bold">;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#204a87;font-weight:bold">with</span><span style="color:#000;font-weight:bold">(</span><span style="color:#ce5c00;font-weight:bold">*</span><span style="color:#000">sync</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">lock</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#ce5c00;font-weight:bold">*</span><span style="color:#000">value</span><span style="color:#000;font-weight:bold">)</span> <span style="color:#000;font-weight:bold">{</span> <span style="color:#8f5902;font-style:italic"># ОК</span>
</span></span><span style="display:flex;"><span>        <span style="color:#ce5c00;font-weight:bold">...</span> 
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">}</span> 
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#204a87;font-weight:bold">with</span><span style="color:#000;font-weight:bold">(</span><span style="color:#ce5c00;font-weight:bold">*</span><span style="color:#000">sync_other</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">val</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#ce5c00;font-weight:bold">*</span><span style="color:#000">value</span><span style="color:#000;font-weight:bold">)</span> <span style="color:#000;font-weight:bold">{</span> <span style="color:#8f5902;font-style:italic"># Ошибка компиляции </span>
</span></span><span style="display:flex;"><span>        <span style="color:#8f5902;font-style:italic"># для синхронизации должен использоваться sync</span>
</span></span><span style="display:flex;"><span>        <span style="color:#ce5c00;font-weight:bold">...</span> 
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">}</span> 
</span></span></code></pre></div><h3 id="автоматическое-освобождение-ресурсов">Автоматическое освобождение ресурсов<a class="td-heading-self-link" href="#%d0%b0%d0%b2%d1%82%d0%be%d0%bc%d0%b0%d1%82%d0%b8%d1%87%d0%b5%d1%81%d0%ba%d0%be%d0%b5-%d0%be%d1%81%d0%b2%d0%be%d0%b1%d0%be%d0%b6%d0%b4%d0%b5%d0%bd%d0%b8%d0%b5-%d1%80%d0%b5%d1%81%d1%83%d1%80%d1%81%d0%be%d0%b2" aria-label="Heading self-link"></a></h3>
<p>Менеджер контекста, кроме захвата слабых ссылок в локальные переменные и блокировки доступа,
одновременно с этим позволяет выделять и освобождать ресурсы,
автоматически вызывая декструктор локального объекта при выходе из блока кода оператора.</p>
<p>Освобождение ресурсов (вызов <a href="/ru/docs/types/class/">деструктора у объекта</a>) происходит до попадания в ветку <em>else</em>, если она присутствует.</p>
<p>Самый популярный пример использования менеджера контекста -
связанные операции открытия, чтения/записи и закрытия файла в одном блоке кода.</p>
<p>Например:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span>    <span style="color:#8f5902;font-style:italic"># Фрагмент определения класса File</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000">File</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">name</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">mode</span><span style="color:#000;font-weight:bold">)</span> <span style="color:#ce5c00;font-weight:bold">:=</span> <span style="color:#000;font-weight:bold">:</span><span style="color:#000">Class</span><span style="color:#000;font-weight:bold">()</span> <span style="color:#000;font-weight:bold">{</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">file</span> <span style="color:#000;font-weight:bold">:</span><span style="color:#ce5c00;font-weight:bold">:=</span> <span style="color:#000">fopen</span><span style="color:#000;font-weight:bold">(</span><span style="color:#a40000">$</span><span style="color:#000">name</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#a40000">$</span><span style="color:#000">mode</span><span style="color:#000;font-weight:bold">);</span> <span style="color:#8f5902;font-style:italic"># Handle file</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#ce5c00;font-weight:bold">~</span><span style="color:#000">File</span><span style="color:#000;font-weight:bold">()</span> <span style="color:#ce5c00;font-weight:bold">:=</span> <span style="color:#000;font-weight:bold">{</span> <span style="color:#8f5902;font-style:italic"># Destructor of class</span>
</span></span><span style="display:flex;"><span>            <span style="color:#5c35cc;font-weight:bold">@if</span><span style="color:#000;font-weight:bold">(</span><span style="color:#5c35cc;font-weight:bold">@this.file</span><span style="color:#000;font-weight:bold">){</span>
</span></span><span style="display:flex;"><span>                <span style="color:#000">fclose</span><span style="color:#000;font-weight:bold">(</span><span style="color:#5c35cc;font-weight:bold">@this.file</span><span style="color:#000;font-weight:bold">);</span>
</span></span><span style="display:flex;"><span>                <span style="color:#5c35cc;font-weight:bold">@this.file</span> <span style="color:#ce5c00;font-weight:bold">:=</span> <span style="color:#000">_</span><span style="color:#000;font-weight:bold">;</span>
</span></span><span style="display:flex;"><span>            <span style="color:#000;font-weight:bold">}</span>
</span></span><span style="display:flex;"><span>        <span style="color:#000;font-weight:bold">}</span>
</span></span><span style="display:flex;"><span>        <span style="color:#ce5c00;font-weight:bold">...</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">};</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#5c35cc;font-weight:bold">@with</span><span style="color:#000;font-weight:bold">(</span> <span style="color:#000">file</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000;font-weight:bold">:</span><span style="color:#000">File</span><span style="color:#000;font-weight:bold">(</span><span style="color:#4e9a06">&#39;some_file&#39;</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#4e9a06">&#39;w&#39;</span><span style="color:#000;font-weight:bold">)</span> <span style="color:#000;font-weight:bold">)</span> <span style="color:#000;font-weight:bold">{</span>
</span></span><span style="display:flex;"><span>        <span style="color:#000">file</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">write</span><span style="color:#000;font-weight:bold">(</span><span style="color:#4e9a06">&#39;Oppa!&#39;</span><span style="color:#000;font-weight:bold">);</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">};</span>
</span></span></code></pre></div><p>Код выше открывает файл, записывает в него данные и закрывает файл при выходе из блока кода.</p>
<p>Этот код эквивалентен следующему на Python:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span>    <span style="color:#204a87;font-weight:bold">with</span> <span style="color:#204a87">open</span><span style="color:#000;font-weight:bold">(</span><span style="color:#4e9a06">&#39;some_file&#39;</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#4e9a06">&#39;w&#39;</span><span style="color:#000;font-weight:bold">)</span> <span style="color:#204a87;font-weight:bold">as</span> <span style="color:#000">file</span><span style="color:#000;font-weight:bold">:</span>
</span></span><span style="display:flex;"><span>        <span style="color:#000">file</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">write</span><span style="color:#000;font-weight:bold">(</span><span style="color:#4e9a06">&#39;Oppa!&#39;</span><span style="color:#000;font-weight:bold">)</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#8f5902;font-style:italic"># Или без менеджера контекста</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000">file</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#204a87">open</span><span style="color:#000;font-weight:bold">(</span><span style="color:#4e9a06">&#39;some_file&#39;</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#4e9a06">&#39;w&#39;</span><span style="color:#000;font-weight:bold">)</span>
</span></span><span style="display:flex;"><span>    <span style="color:#204a87;font-weight:bold">try</span><span style="color:#000;font-weight:bold">:</span>
</span></span><span style="display:flex;"><span>        <span style="color:#000">file</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">write</span><span style="color:#000;font-weight:bold">(</span><span style="color:#4e9a06">&#39;Oppa!&#39;</span><span style="color:#000;font-weight:bold">)</span>
</span></span><span style="display:flex;"><span>    <span style="color:#204a87;font-weight:bold">finally</span><span style="color:#000;font-weight:bold">:</span>
</span></span><span style="display:flex;"><span>        <span style="color:#000">file</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">close</span><span style="color:#000;font-weight:bold">()</span>
</span></span></code></pre></div><p>Более сложный пример чтение файла с одновремнным захватом ссылки на буфер и обработкой ошибок:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span>    <span style="color:#5c35cc;font-weight:bold">@with</span><span style="color:#000;font-weight:bold">(</span> <span style="color:#000">file</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000;font-weight:bold">:</span><span style="color:#000">File</span><span style="color:#000;font-weight:bold">(</span><span style="color:#4e9a06">&#39;some_file&#39;</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#4e9a06">&#39;r&#39;</span><span style="color:#000;font-weight:bold">),</span> <span style="color:#000">buffer</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#ce5c00;font-weight:bold">*</span><span style="color:#000">ref_buffer</span> <span style="color:#000;font-weight:bold">)</span> <span style="color:#000;font-weight:bold">{</span>
</span></span><span style="display:flex;"><span>        <span style="color:#000">file</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">read</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">buffer</span><span style="color:#000;font-weight:bold">);</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">}</span> <span style="color:#5c35cc;font-weight:bold">@else</span> <span style="color:#000;font-weight:bold">{</span>
</span></span><span style="display:flex;"><span>        <span style="color:#5c35cc;font-weight:bold">@match</span><span style="color:#000;font-weight:bold">(</span><span style="color:#5c35cc;font-weight:bold">@latter</span><span style="color:#000;font-weight:bold">){</span>
</span></span><span style="display:flex;"><span>            <span style="color:#5c35cc;font-weight:bold">@case</span><span style="color:#000;font-weight:bold">(</span> <span style="color:#000;font-weight:bold">:</span><span style="color:#000">ErrorLock</span> <span style="color:#000;font-weight:bold">)</span> <span style="color:#000;font-weight:bold">{</span> <span style="color:#ce5c00;font-weight:bold">/*</span> <span style="color:#000">Ошибка</span> <span style="color:#000">захвата</span> <span style="color:#000">ссылки</span> <span style="color:#000">ref_buffer</span> <span style="color:#ce5c00;font-weight:bold">*/</span> <span style="color:#000;font-weight:bold">};</span>
</span></span><span style="display:flex;"><span>            <span style="color:#5c35cc;font-weight:bold">@case</span><span style="color:#000;font-weight:bold">(</span> <span style="color:#000;font-weight:bold">:</span><span style="color:#000">ErrorOpenFile</span> <span style="color:#000;font-weight:bold">)</span> <span style="color:#000;font-weight:bold">{</span> <span style="color:#ce5c00;font-weight:bold">/*</span> <span style="color:#000">Ошибка</span> <span style="color:#000">открытия</span> <span style="color:#000">для</span> <span style="color:#000">записи</span> <span style="color:#000">файла</span> <span style="color:#000">some_file</span> <span style="color:#ce5c00;font-weight:bold">*/</span> <span style="color:#000;font-weight:bold">};</span>
</span></span><span style="display:flex;"><span>            <span style="color:#5c35cc;font-weight:bold">@case</span><span style="color:#000;font-weight:bold">(</span> <span style="color:#000;font-weight:bold">:</span><span style="color:#000">ErrorReadWrite</span> <span style="color:#000;font-weight:bold">)</span> <span style="color:#000;font-weight:bold">{</span> <span style="color:#ce5c00;font-weight:bold">/*</span> <span style="color:#000">Ошибка</span> <span style="color:#000">чтения</span><span style="color:#ce5c00;font-weight:bold">-</span><span style="color:#000">записи</span> <span style="color:#000">в</span> <span style="color:#000">файл</span> <span style="color:#000">some_file</span> <span style="color:#ce5c00;font-weight:bold">*/</span> <span style="color:#000;font-weight:bold">};</span>
</span></span><span style="display:flex;"><span>            <span style="color:#5c35cc;font-weight:bold">@default</span> <span style="color:#5c35cc;font-weight:bold">@forward</span><span style="color:#000;font-weight:bold">;</span> <span style="color:#ce5c00;font-weight:bold">/*</span> <span style="color:#000">Остальные</span> <span style="color:#000">ошибки</span> <span style="color:#000">пробросить</span> <span style="color:#000">дальше</span> <span style="color:#ce5c00;font-weight:bold">*/</span>
</span></span><span style="display:flex;"><span>        <span style="color:#000;font-weight:bold">};</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">};</span>
</span></span></code></pre></div><p>Использование менеджера контекста - это гарантия закрытия файла и освобождения буфера вне зависимости от того,
как будет завершён вложенный код. Распространенный паттерн использования контекстных менеджеров - блокирование и разблокирование ресурсов
при многопоточном доступе к объетам, а также закрытие открытых файлов или освобождение захваченных ресурсов.</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#000">printf</span><span style="color:#000;font-weight:bold">(</span><span style="color:#204a87">format</span><span style="color:#000;font-weight:bold">:</span><span style="color:#000">FmtChar</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#ce5c00;font-weight:bold">...</span><span style="color:#000;font-weight:bold">):</span><span style="color:#000">Int32</span> <span style="color:#ce5c00;font-weight:bold">:=</span> <span style="color:#ce5c00;font-weight:bold">%</span><span style="color:#000">printf</span><span style="color:#ce5c00;font-weight:bold">...</span><span style="color:#000;font-weight:bold">;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#ce5c00;font-weight:bold">&amp;&amp;</span> <span style="color:#000">holder</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#000">Integer</span><span style="color:#000;font-weight:bold">[]</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000;font-weight:bold">[,];</span> <span style="color:#8f5902;font-style:italic"># Empty tensor</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#000">Runnable</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">cnt</span><span style="color:#000;font-weight:bold">:</span><span style="color:#000">Integer</span><span style="color:#000;font-weight:bold">)</span> <span style="color:#ce5c00;font-weight:bold">:=</span> <span style="color:#000;font-weight:bold">{</span>
</span></span><span style="display:flex;"><span>        <span style="color:#a40000">$</span><span style="color:#000">i</span> <span style="color:#ce5c00;font-weight:bold">:=</span> <span style="color:#0000cf;font-weight:bold">1</span><span style="color:#000;font-weight:bold">;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#5c35cc;font-weight:bold">@while</span><span style="color:#000;font-weight:bold">(</span> <span style="color:#a40000">$</span><span style="color:#000">i</span> <span style="color:#ce5c00;font-weight:bold">&lt;=</span> <span style="color:#a40000">$</span><span style="color:#000">cnt</span> <span style="color:#000;font-weight:bold">)</span> <span style="color:#000;font-weight:bold">{</span>
</span></span><span style="display:flex;"><span>            <span style="color:#ce5c00;font-weight:bold">*</span><span style="color:#000">holder</span> <span style="color:#000;font-weight:bold">[]</span><span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#a40000">$</span><span style="color:#000">i</span><span style="color:#000;font-weight:bold">;</span>  <span style="color:#8f5902;font-style:italic"># Lock and add new value</span>
</span></span><span style="display:flex;"><span>            <span style="color:#a40000">$</span><span style="color:#000">i</span> <span style="color:#ce5c00;font-weight:bold">+=</span> <span style="color:#0000cf;font-weight:bold">1</span><span style="color:#000;font-weight:bold">;</span>
</span></span><span style="display:flex;"><span>            <span style="color:#5c35cc;font-weight:bold">@if</span><span style="color:#000;font-weight:bold">(</span> <span style="color:#a40000">$</span><span style="color:#000">i</span> <span style="color:#ce5c00;font-weight:bold">%</span> <span style="color:#000;font-weight:bold">(</span><span style="color:#a40000">$</span><span style="color:#000">cnt</span> <span style="color:#ce5c00;font-weight:bold">//</span> <span style="color:#0000cf;font-weight:bold">10</span><span style="color:#000;font-weight:bold">)</span> <span style="color:#ce5c00;font-weight:bold">==</span> <span style="color:#0000cf;font-weight:bold">0</span><span style="color:#000;font-weight:bold">)</span> <span style="color:#000;font-weight:bold">{</span>
</span></span><span style="display:flex;"><span>                <span style="color:#5c35cc;font-weight:bold">@with</span><span style="color:#000;font-weight:bold">(</span><span style="color:#ce5c00;font-weight:bold">*</span><span style="color:#000">holder</span><span style="color:#000;font-weight:bold">){</span> <span style="color:#8f5902;font-style:italic"># Lock only</span>
</span></span><span style="display:flex;"><span>                    <span style="color:#000">printf</span><span style="color:#000;font-weight:bold">(</span><span style="color:#4e9a06">&#34;.&#34;</span><span style="color:#000;font-weight:bold">);</span>
</span></span><span style="display:flex;"><span>                <span style="color:#000;font-weight:bold">}</span>
</span></span><span style="display:flex;"><span>            <span style="color:#000;font-weight:bold">}</span>
</span></span><span style="display:flex;"><span>        <span style="color:#000;font-weight:bold">}</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">}</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#a40000">$</span><span style="color:#000">count</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#0000cf;font-weight:bold">10000</span><span style="color:#000;font-weight:bold">;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#000">thread1</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000;font-weight:bold">:</span><span style="color:#000">Thread</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">Runnable</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#a40000">$</span><span style="color:#000">count</span><span style="color:#000;font-weight:bold">);</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000">thread2</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000;font-weight:bold">:</span><span style="color:#000">Thread</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">Runnable</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#a40000">$</span><span style="color:#000">count</span><span style="color:#000;font-weight:bold">);</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000">thread3</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000;font-weight:bold">:</span><span style="color:#000">Thread</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">Runnable</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#a40000">$</span><span style="color:#000">count</span><span style="color:#000;font-weight:bold">);</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000">thread4</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000;font-weight:bold">:</span><span style="color:#000">Thread</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">Runnable</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#a40000">$</span><span style="color:#000">count</span><span style="color:#000;font-weight:bold">);</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000">thread5</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000;font-weight:bold">:</span><span style="color:#000">Thread</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">Runnable</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#a40000">$</span><span style="color:#000">count</span><span style="color:#000;font-weight:bold">);</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#000">thread1</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">start</span><span style="color:#000;font-weight:bold">();</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000">thread2</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">start</span><span style="color:#000;font-weight:bold">();</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000">thread3</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">start</span><span style="color:#000;font-weight:bold">();</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000">thread4</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">start</span><span style="color:#000;font-weight:bold">();</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000">thread5</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">start</span><span style="color:#000;font-weight:bold">();</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#000">thread1</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">join</span><span style="color:#000;font-weight:bold">();</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000">thread2</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">join</span><span style="color:#000;font-weight:bold">();</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000">thread3</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">join</span><span style="color:#000;font-weight:bold">();</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000">thread4</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">join</span><span style="color:#000;font-weight:bold">();</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000">thread5</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">join</span><span style="color:#000;font-weight:bold">();</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#5c35cc;font-weight:bold">@assert</span><span style="color:#000;font-weight:bold">(</span><span style="color:#ce5c00;font-weight:bold">*</span><span style="color:#000">holder</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">size</span><span style="color:#000;font-weight:bold">()</span> <span style="color:#ce5c00;font-weight:bold">==</span> <span style="color:#0000cf;font-weight:bold">5</span><span style="color:#ce5c00;font-weight:bold">*</span><span style="color:#a40000">$</span><span style="color:#000">count</span><span style="color:#000;font-weight:bold">);</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000">printf</span><span style="color:#000;font-weight:bold">(</span><span style="color:#4e9a06">&#34;Complete </span><span style="color:#4e9a06">%d</span><span style="color:#4e9a06">!</span><span style="color:#4e9a06">\n</span><span style="color:#4e9a06">&#34;</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#ce5c00;font-weight:bold">*</span><span style="color:#000">holder</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">size</span><span style="color:#000;font-weight:bold">());</span>
</span></span></code></pre></div><p>Вывод:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>    &gt;..................................................
</span></span><span style="display:flex;"><span>    &gt;Complete 50000!
</span></span><span style="display:flex;"><span>    &gt;_
</span></span></code></pre></div>
</div>



    
	
  
    
    
	
    

<div class="td-content" style="page-break-before: always">
    
	<h1 id="pg-d59803d976382d82f70daf58daf9ac0c">3.9 - Ввозврат, прерывания и обработка ошибок</h1>
    
	<p>Последовательность команд <a href="/ru/docs/ops/block/">(блок кода)</a> можно прервать в любом месте с помощью специальных операторов.</p>
<p>Для этого используются две разные команды, которые условно можно назвать <em>положительным</em> и <em>отрицательным</em> прерыванием потока выполнения,
что примерно соответствует семантике их записи.
&ldquo;Отрицательное&rdquo; прерывание записывается в виде двух минусов, а &ldquo;положительное&rdquo; прерывание в виде двух плюсов, т.е. <strong>--</strong> или <strong>++</strong>.</p>
<p>Оператор прерывания не возвращает никакого значения (точнее, возвращает пустое значение).
Чтобы прерывание вернуло другое значение, возвращаемые данные нужно записать между парой соответствующих символов,
т.е. <strong>--</strong> 100 <strong>--</strong>, что является примерным аналогом оператора <code>return 100;</code>
в других языках программирования, а <strong>++</strong>&lsquo;Строка&rsquo;<strong>++</strong> - аналогом <code>return 'Строка';</code>.</p>
<h3 id="local">Локальный переход<a class="td-heading-self-link" href="#local" aria-label="Heading self-link"></a></h3>
<p>Именованные <a href="/ru/docs/ops/block/">блоки кода</a> могут выступать в качестве локальных меток для передачи потока выполнения.
Если перед оператором прерывания указать <a href="/ru/docs/syntax/namespace/">пространство имен</a>,
то оператор прерывания станет <em>именованным</em> и будет действовать только для указанного блока кода.</p>
<p>В этом случае <em>отрицательное</em> прерывание будет работать как оператор <strong>continue</strong>,
передавая поток выполнения на первую инструкцию блока кода,
а <em>положительное</em> прерывание как оператор <strong>break</strong>, выходя из него.</p>
<p>Локальная передача потока управления работает с <em>именованными</em> блоками кода,
поэтому переход в начало блока кода или выход из него,
возможны в том числе и изнутри нескольких вложенных именнованных блоков кода.</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span>    <span style="color:#000">b1</span> <span style="color:#ce5c00;font-weight:bold">:=</span> <span style="color:#0000cf;font-weight:bold">1</span><span style="color:#000;font-weight:bold">;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#8f5902;font-style:italic"># Бесконечный цикл с именованным блоком кода</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">[</span><span style="color:#0000cf;font-weight:bold">1</span><span style="color:#000;font-weight:bold">]</span> <span style="color:#ce5c00;font-weight:bold">&lt;-&gt;</span> <span style="color:#000">outer_loop</span><span style="color:#000;font-weight:bold">::</span> <span style="color:#000;font-weight:bold">{</span> 
</span></span><span style="display:flex;"><span>        <span style="color:#8f5902;font-style:italic"># Именованный блок кода outer_loop</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#000">b2</span> <span style="color:#ce5c00;font-weight:bold">:=</span> <span style="color:#0000cf;font-weight:bold">1</span><span style="color:#000;font-weight:bold">;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#000;font-weight:bold">[</span><span style="color:#0000cf;font-weight:bold">1</span><span style="color:#000;font-weight:bold">]</span> <span style="color:#ce5c00;font-weight:bold">&lt;-&gt;</span> <span style="color:#000">inner_loop</span> <span style="color:#000;font-weight:bold">{</span>
</span></span><span style="display:flex;"><span>            <span style="color:#8f5902;font-style:italic"># Именованный блок кода inner_loop</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>            <span style="color:#000">printf</span><span style="color:#000;font-weight:bold">(</span><span style="color:#4e9a06">&#34;Values: b1=</span><span style="color:#4e9a06">%d</span><span style="color:#4e9a06">, b2=</span><span style="color:#4e9a06">%d</span><span style="color:#4e9a06">&#34;</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">b1</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">b2</span><span style="color:#000;font-weight:bold">);</span>
</span></span><span style="display:flex;"><span>            
</span></span><span style="display:flex;"><span>            <span style="color:#8f5902;font-style:italic"># Проверка условий</span>
</span></span><span style="display:flex;"><span>            <span style="color:#000;font-weight:bold">[</span><span style="color:#000">b1</span> <span style="color:#ce5c00;font-weight:bold">==</span> <span style="color:#0000cf;font-weight:bold">2</span> <span style="color:#ce5c00;font-weight:bold">&amp;&amp;</span> <span style="color:#000">b2</span> <span style="color:#ce5c00;font-weight:bold">==</span> <span style="color:#0000cf;font-weight:bold">2</span><span style="color:#000;font-weight:bold">]</span> <span style="color:#ce5c00;font-weight:bold">--&gt;</span> <span style="color:#000;font-weight:bold">{</span>
</span></span><span style="display:flex;"><span>                <span style="color:#000">outer_loop</span><span style="color:#000;font-weight:bold">::</span> <span style="color:#ce5c00;font-weight:bold">++</span><span style="color:#000;font-weight:bold">;</span>    <span style="color:#8f5902;font-style:italic"># Прерываем outer_loop</span>
</span></span><span style="display:flex;"><span>            <span style="color:#000;font-weight:bold">},</span> <span style="color:#000;font-weight:bold">[</span><span style="color:#000">b2</span> <span style="color:#ce5c00;font-weight:bold">==</span> <span style="color:#0000cf;font-weight:bold">5</span><span style="color:#000;font-weight:bold">]</span> <span style="color:#ce5c00;font-weight:bold">--&gt;</span> <span style="color:#000;font-weight:bold">{</span>
</span></span><span style="display:flex;"><span>                <span style="color:#000">inner_loop</span><span style="color:#000;font-weight:bold">::</span> <span style="color:#ce5c00;font-weight:bold">++</span><span style="color:#000;font-weight:bold">;</span>    <span style="color:#8f5902;font-style:italic"># Прерываем inner_loop</span>
</span></span><span style="display:flex;"><span>            <span style="color:#000;font-weight:bold">}</span>
</span></span><span style="display:flex;"><span>            <span style="color:#000">b2</span> <span style="color:#ce5c00;font-weight:bold">+=</span> <span style="color:#0000cf;font-weight:bold">1</span><span style="color:#000;font-weight:bold">;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#000;font-weight:bold">}</span>
</span></span><span style="display:flex;"><span>        <span style="color:#000">b1</span> <span style="color:#ce5c00;font-weight:bold">+=</span> <span style="color:#0000cf;font-weight:bold">1</span><span style="color:#000;font-weight:bold">;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">}</span>
</span></span></code></pre></div><p>Тоже самое с использованием <a href="/ru/docs/syntax/dsl/">макросов DSL</a>.:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span>    <span style="color:#000">b1</span> <span style="color:#ce5c00;font-weight:bold">:=</span> <span style="color:#0000cf;font-weight:bold">1</span><span style="color:#000;font-weight:bold">;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#5c35cc;font-weight:bold">@loop</span> <span style="color:#000">outer_loop</span><span style="color:#000;font-weight:bold">::</span> <span style="color:#000;font-weight:bold">{</span> <span style="color:#8f5902;font-style:italic"># @while(@true)</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#000">b2</span> <span style="color:#ce5c00;font-weight:bold">:=</span> <span style="color:#0000cf;font-weight:bold">1</span><span style="color:#000;font-weight:bold">;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#5c35cc;font-weight:bold">@loop</span> <span style="color:#000">inner_loop</span> <span style="color:#000;font-weight:bold">{</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>            <span style="color:#000">printf</span><span style="color:#000;font-weight:bold">(</span><span style="color:#4e9a06">&#34;Values: b1=</span><span style="color:#4e9a06">%d</span><span style="color:#4e9a06">, b2=</span><span style="color:#4e9a06">%d</span><span style="color:#4e9a06">&#34;</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">b1</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">b2</span><span style="color:#000;font-weight:bold">);</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>            <span style="color:#5c35cc;font-weight:bold">@if</span><span style="color:#000;font-weight:bold">(</span> <span style="color:#000">b1</span> <span style="color:#ce5c00;font-weight:bold">==</span> <span style="color:#0000cf;font-weight:bold">2</span> <span style="color:#5c35cc;font-weight:bold">@and</span> <span style="color:#000">b2</span> <span style="color:#ce5c00;font-weight:bold">==</span> <span style="color:#0000cf;font-weight:bold">2</span><span style="color:#000;font-weight:bold">)</span> <span style="color:#000;font-weight:bold">{</span>
</span></span><span style="display:flex;"><span>                <span style="color:#5c35cc;font-weight:bold">@break</span> <span style="color:#000">outer_loop</span><span style="color:#000;font-weight:bold">;</span>
</span></span><span style="display:flex;"><span>            <span style="color:#000;font-weight:bold">}</span> <span style="color:#5c35cc;font-weight:bold">@elif</span><span style="color:#000;font-weight:bold">(</span> <span style="color:#000">b2</span> <span style="color:#ce5c00;font-weight:bold">==</span> <span style="color:#0000cf;font-weight:bold">5</span> <span style="color:#000;font-weight:bold">)</span> <span style="color:#000;font-weight:bold">{</span>
</span></span><span style="display:flex;"><span>                <span style="color:#5c35cc;font-weight:bold">@break</span> <span style="color:#000">inner_loop</span><span style="color:#000;font-weight:bold">;</span>
</span></span><span style="display:flex;"><span>            <span style="color:#000;font-weight:bold">}</span>
</span></span><span style="display:flex;"><span>            <span style="color:#000">b2</span> <span style="color:#ce5c00;font-weight:bold">+=</span> <span style="color:#0000cf;font-weight:bold">1</span><span style="color:#000;font-weight:bold">;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#000;font-weight:bold">}</span>
</span></span><span style="display:flex;"><span>        <span style="color:#000">b1</span> <span style="color:#ce5c00;font-weight:bold">+=</span> <span style="color:#0000cf;font-weight:bold">1</span><span style="color:#000;font-weight:bold">;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">}</span>
</span></span></code></pre></div><h3 id="return">Возврат результата<a class="td-heading-self-link" href="#return" aria-label="Heading self-link"></a></h3>
<p>Для возврата результата из тела функции используется <em>положительное</em> прерывание из блока кода,
меткой которого является полное имя функции, включая текущую область имен.</p>
<p><em>Именованный блок кода при перехвате прерываний возвращают объект, который передавался с помощью прервывания,
либо пусто, если возвращаемое значение отсуствует.</em></p>
<p>Имя блока кода тела функции соответствует её имени.</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#000">ns</span><span style="color:#000;font-weight:bold">::</span> <span style="color:#000;font-weight:bold">{</span> <span style="color:#8f5902;font-style:italic"># Пространство имен ns</span>
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    <span style="color:#000">func_name</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">val</span><span style="color:#000;font-weight:bold">):</span><span style="color:#000">Int32</span> <span style="color:#000;font-weight:bold">:</span><span style="color:#ce5c00;font-weight:bold">:=</span> <span style="color:#000;font-weight:bold">{</span>  
</span></span><span style="display:flex;"><span>        <span style="color:#8f5902;font-style:italic"># Блок кода тела функции ns::func_name::</span>
</span></span><span style="display:flex;"><span>        <span style="color:#ce5c00;font-weight:bold">...</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#8f5902;font-style:italic"># Возврат из функции</span>
</span></span><span style="display:flex;"><span>        <span style="color:#000">func_name</span> <span style="color:#ce5c00;font-weight:bold">++</span> <span style="color:#0000cf;font-weight:bold">0</span> <span style="color:#ce5c00;font-weight:bold">++</span><span style="color:#000;font-weight:bold">;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#8f5902;font-style:italic"># Или @return(0); с ипользованием DSL</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#000;font-weight:bold">::</span> <span style="color:#ce5c00;font-weight:bold">++</span> <span style="color:#0000cf;font-weight:bold">0</span> <span style="color:#ce5c00;font-weight:bold">++</span><span style="color:#000;font-weight:bold">;</span> <span style="color:#8f5902;font-style:italic"># Завершение программы? exit(0)</span>
</span></span><span style="display:flex;"><span>        <span style="color:#000;font-weight:bold">::</span> <span style="color:#ce5c00;font-weight:bold">--</span> <span style="color:#000;font-weight:bold">;</span> <span style="color:#8f5902;font-style:italic"># Прерывание выполенения программы? abort()</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">};</span>
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">};</span>
</span></span></code></pre></div><p>Для оператора прерывания выполенения можно указать и глобальную область видимости.
Тогда при выполнении такого прерывания происходит выход из самого верхнеуровневого блока кода,
что приводит к завершение работы приложения.</p>
<p>Аналогом такого поведения являются функции <code>exit()</code> для <em>положительного</em> прерывания
и <code>abort()</code> для <em>отрицательного</em>, что отражено в <a href="/ru/docs/syntax/dsl/">DSL</a>.</p>
<h3 id="catch">Перехват прерывааний<a class="td-heading-self-link" href="#catch" aria-label="Heading self-link"></a></h3>
<p>Именованные прерывания потока выполнения можно использовать только внутри именованных блоков кода,
что контроллируется во время компиляции программы на уровне исходного кода.</p>
<p>Для не именованных прерываний такое ограничение отсуствует,
поэтому более точным аналогом не именованного прерывания будет не <em>return</em> или <em>break</em>, а <em><strong>throw</strong></em>,
т.к. эти операторы не только прерывают выполнение последовательности команд
в любом <a href="/ru/docs/ops/block/">блоке кода</a> и возвращают результат, но их еще и можно <em>&ldquo;ловить&rdquo;</em>.</p>
<p>Для перехвата <em>не именованных</em> прерываний используются блоки кода с соответствующей семантикой,
<strong>{+</strong> &hellip; <strong>+}</strong> - блок кода, который перехватывает положительные прерывания
и <strong>{-</strong> &hellip; <strong>-}</strong> - блок кода, который перехватывает отрицательные прерывания, созданные операторами <strong>--</strong>,
и блок кода <strong>{*</strong> &hellip; <strong>*}</strong>, который перехватывает сразу оба типа прерываний.</p>
<p><em><strong>Принципиальное отличие блоков кода для перехвата прерываний от именованных блоков кода состоит в
типе возвращаемого значения. Если именованные блоки кода <a href="/ru/docs/ops/throw/#return">возвращают значение</a>,
то при перехвате прервывания, возвращается непосредственно само прерывание, а не возращаемое с его помощью значение.</strong></em></p>
<p>Например, возврат из нескольких вложенных функций без необходимости обрабатывать результат возврата в каждой из них.
В этом примере функция <em>Test</em> перехватывает &ldquo;положительные&rdquo; прерывания из вложенных функций:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span>    <span style="color:#000">Level2</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">arg</span><span style="color:#000;font-weight:bold">)</span> <span style="color:#ce5c00;font-weight:bold">:=</span> <span style="color:#000;font-weight:bold">{</span> 
</span></span><span style="display:flex;"><span>        <span style="color:#204a87;font-weight:bold">if</span><span style="color:#000;font-weight:bold">(</span><span style="color:#a40000">$</span><span style="color:#000">arg</span><span style="color:#ce5c00;font-weight:bold">==</span><span style="color:#0000cf;font-weight:bold">2</span><span style="color:#000;font-weight:bold">)</span> <span style="color:#000;font-weight:bold">{</span>
</span></span><span style="display:flex;"><span>            <span style="color:#ce5c00;font-weight:bold">++</span> <span style="color:#4e9a06">&#34;Level - 2&#34;</span> <span style="color:#ce5c00;font-weight:bold">++</span><span style="color:#000;font-weight:bold">;</span> 
</span></span><span style="display:flex;"><span>        <span style="color:#000;font-weight:bold">};</span>
</span></span><span style="display:flex;"><span>        <span style="color:#4e9a06">&#34;Level2 - DONE&#34;</span><span style="color:#000;font-weight:bold">;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">};</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#000">Level1</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">arg</span><span style="color:#000;font-weight:bold">)</span> <span style="color:#ce5c00;font-weight:bold">:=</span> <span style="color:#000;font-weight:bold">{</span> 
</span></span><span style="display:flex;"><span>        <span style="color:#204a87;font-weight:bold">if</span><span style="color:#000;font-weight:bold">(</span><span style="color:#a40000">$</span><span style="color:#000">arg</span><span style="color:#ce5c00;font-weight:bold">==</span><span style="color:#0000cf;font-weight:bold">1</span><span style="color:#000;font-weight:bold">)</span> <span style="color:#000;font-weight:bold">{</span>
</span></span><span style="display:flex;"><span>            <span style="color:#ce5c00;font-weight:bold">++</span> <span style="color:#4e9a06">&#34;Level - 1&#34;</span> <span style="color:#ce5c00;font-weight:bold">++</span><span style="color:#000;font-weight:bold">;</span> 
</span></span><span style="display:flex;"><span>        <span style="color:#000;font-weight:bold">};</span>
</span></span><span style="display:flex;"><span>        <span style="color:#000">Level2</span><span style="color:#000;font-weight:bold">(</span><span style="color:#a40000">$</span><span style="color:#000">arg</span><span style="color:#000;font-weight:bold">);</span> 
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">};</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#000">Test</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">arg</span><span style="color:#000;font-weight:bold">)</span> <span style="color:#ce5c00;font-weight:bold">:=</span> <span style="color:#ce5c00;font-weight:bold">*</span> <span style="color:#000;font-weight:bold">{</span><span style="color:#ce5c00;font-weight:bold">+</span> 
</span></span><span style="display:flex;"><span>        <span style="color:#204a87;font-weight:bold">if</span><span style="color:#000;font-weight:bold">(</span><span style="color:#a40000">$</span><span style="color:#000">arg</span> <span style="color:#ce5c00;font-weight:bold">&gt;=</span> <span style="color:#0000cf;font-weight:bold">0</span><span style="color:#000;font-weight:bold">)</span> <span style="color:#000;font-weight:bold">{</span>
</span></span><span style="display:flex;"><span>            <span style="color:#000">Level1</span><span style="color:#000;font-weight:bold">(</span><span style="color:#a40000">$</span><span style="color:#000">arg</span><span style="color:#000;font-weight:bold">);</span> 
</span></span><span style="display:flex;"><span>        <span style="color:#000;font-weight:bold">}</span>
</span></span><span style="display:flex;"><span>        <span style="color:#a40000">$</span><span style="color:#000">arg</span><span style="color:#000;font-weight:bold">;</span> 
</span></span><span style="display:flex;"><span>    <span style="color:#ce5c00;font-weight:bold">+</span><span style="color:#000;font-weight:bold">};</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#000">Test</span><span style="color:#000;font-weight:bold">(</span><span style="color:#0000cf;font-weight:bold">2</span><span style="color:#000;font-weight:bold">);</span> <span style="color:#8f5902;font-style:italic"># Вернет &#34;Level — 2&#34; возврат из вложенной функции Level2</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000">Test</span><span style="color:#000;font-weight:bold">(</span><span style="color:#0000cf;font-weight:bold">1</span><span style="color:#000;font-weight:bold">);</span> <span style="color:#8f5902;font-style:italic"># Вернет &#34;Level — 1&#34; возврат из вложенной функции Level1</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000">Test</span><span style="color:#000;font-weight:bold">(</span><span style="color:#0000cf;font-weight:bold">0</span><span style="color:#000;font-weight:bold">);</span> <span style="color:#8f5902;font-style:italic"># Вернет &#34;Level2 - DONE&#34; возврат из вложенной функции Level2</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000">Test</span><span style="color:#000;font-weight:bold">(</span><span style="color:#ce5c00;font-weight:bold">-</span><span style="color:#0000cf;font-weight:bold">2</span><span style="color:#000;font-weight:bold">);</span> <span style="color:#8f5902;font-style:italic"># Вернет -2 — возврат из функции Test</span>
</span></span></code></pre></div><h3 id="error">Обработка ошибок <a class="td-heading-self-link" href="#error" aria-label="Heading self-link"></a></h3>
<p>Оба варианта прерываний равнозначны и &ldquo;отрицательное&rdquo; прерывание для возврата ошибки используется только условно.
Блоки кода с перехватом прерываний, совместно с оператором <a href="/ru/docs/ops/match/">оценки выражения</a>,
можно использовать для обработки исключений в классическом стиле.</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">[</span> <span style="color:#000;font-weight:bold">{</span><span style="color:#ce5c00;font-weight:bold">*</span>  <span style="color:#8f5902;font-style:italic"># Перехват всех исключений на базовом синтаксисе</span>
</span></span><span style="display:flex;"><span>        <span style="color:#000">op1</span><span style="color:#000;font-weight:bold">;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#000">op2</span><span style="color:#000;font-weight:bold">;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#ce5c00;font-weight:bold">...</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#ce5c00;font-weight:bold">*</span><span style="color:#000;font-weight:bold">}</span> <span style="color:#000;font-weight:bold">]</span> <span style="color:#ce5c00;font-weight:bold">~&gt;</span> <span style="color:#000;font-weight:bold">{</span> <span style="color:#8f5902;font-style:italic"># Сопоставление по типу возвращенного значения</span>
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>        <span style="color:#000;font-weight:bold">[:</span><span style="color:#000">ErrorType1</span><span style="color:#000;font-weight:bold">]</span> <span style="color:#ce5c00;font-weight:bold">--&gt;</span> <span style="color:#000;font-weight:bold">{</span> <span style="color:#000">code</span> <span style="color:#000;font-weight:bold">};</span>
</span></span><span style="display:flex;"><span>        <span style="color:#000;font-weight:bold">[:</span><span style="color:#000">ErrorType2</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000;font-weight:bold">:</span><span style="color:#000">ErrorType3</span><span style="color:#000;font-weight:bold">]</span> <span style="color:#ce5c00;font-weight:bold">--&gt;</span> <span style="color:#000;font-weight:bold">{</span> <span style="color:#000">code</span> <span style="color:#000;font-weight:bold">};</span>
</span></span><span style="display:flex;"><span>        <span style="color:#000;font-weight:bold">[</span><span style="color:#ce5c00;font-weight:bold">...</span><span style="color:#000;font-weight:bold">]</span> <span style="color:#ce5c00;font-weight:bold">--&gt;</span> <span style="color:#000;font-weight:bold">{</span> <span style="color:#000">code</span> <span style="color:#000">default</span> <span style="color:#000;font-weight:bold">};</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">};</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#8f5902;font-style:italic"># Семантика с применением DSL</span>
</span></span><span style="display:flex;"><span>    <span style="color:#5c35cc;font-weight:bold">@try</span> <span style="color:#000;font-weight:bold">{</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#000">op1</span><span style="color:#000;font-weight:bold">;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#000">op2</span><span style="color:#000;font-weight:bold">;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#ce5c00;font-weight:bold">...</span>
</span></span><span style="display:flex;"><span>        
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">}</span> <span style="color:#5c35cc;font-weight:bold">@catch</span> <span style="color:#000;font-weight:bold">(</span><span style="color:#ce5c00;font-weight:bold">...</span><span style="color:#000;font-weight:bold">)</span> <span style="color:#000;font-weight:bold">{</span> <span style="color:#8f5902;font-style:italic"># Перехват всех исключений</span>
</span></span><span style="display:flex;"><span>        <span style="color:#5c35cc;font-weight:bold">@case</span><span style="color:#000;font-weight:bold">(:</span><span style="color:#000">Error</span><span style="color:#000;font-weight:bold">){</span> 
</span></span><span style="display:flex;"><span>            <span style="color:#ce5c00;font-weight:bold">...</span>
</span></span><span style="display:flex;"><span>        <span style="color:#000;font-weight:bold">};</span>
</span></span><span style="display:flex;"><span>        <span style="color:#5c35cc;font-weight:bold">@default</span> <span style="color:#5c35cc;font-weight:bold">@forward</span><span style="color:#000;font-weight:bold">;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">};</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#8f5902;font-style:italic"># Тоже самое, только для заданных типов</span>
</span></span><span style="display:flex;"><span>    <span style="color:#5c35cc;font-weight:bold">@try</span> <span style="color:#000;font-weight:bold">{</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#000">op1</span><span style="color:#000;font-weight:bold">;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#000">op2</span><span style="color:#000;font-weight:bold">;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#ce5c00;font-weight:bold">...</span>
</span></span><span style="display:flex;"><span>        
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">}</span> <span style="color:#5c35cc;font-weight:bold">@catch</span> <span style="color:#000;font-weight:bold">(:</span><span style="color:#000">Type</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000;font-weight:bold">:</span><span style="color:#000">Type2</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000;font-weight:bold">:</span><span style="color:#000">Type3</span><span style="color:#000;font-weight:bold">)</span> <span style="color:#000;font-weight:bold">{</span>
</span></span><span style="display:flex;"><span>        <span style="color:#5c35cc;font-weight:bold">@case</span><span style="color:#000;font-weight:bold">(:</span><span style="color:#000">Type</span><span style="color:#000;font-weight:bold">){</span> 
</span></span><span style="display:flex;"><span>            <span style="color:#ce5c00;font-weight:bold">...</span>
</span></span><span style="display:flex;"><span>        <span style="color:#000;font-weight:bold">};</span>
</span></span><span style="display:flex;"><span>        <span style="color:#5c35cc;font-weight:bold">@case</span><span style="color:#000;font-weight:bold">(:</span><span style="color:#000">Type2</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000;font-weight:bold">:</span><span style="color:#000">Type3</span><span style="color:#000;font-weight:bold">){</span> 
</span></span><span style="display:flex;"><span>            <span style="color:#ce5c00;font-weight:bold">...</span>
</span></span><span style="display:flex;"><span>        <span style="color:#000;font-weight:bold">};</span>
</span></span><span style="display:flex;"><span>        <span style="color:#5c35cc;font-weight:bold">@default</span> <span style="color:#5c35cc;font-weight:bold">@forward</span><span style="color:#000;font-weight:bold">;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">};</span>
</span></span></code></pre></div><h3 id="coroutine">Расширенные варинаты прерывания выполнения <a class="td-heading-self-link" href="#coroutine" aria-label="Heading self-link"></a></h3>
<p>Добавить реализациию для короутин после их полной реализации в clang (скорее всего на уровне аннотаций)</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#ce5c00;font-weight:bold">@@</span> <span style="color:#000">coroutine</span> <span style="color:#ce5c00;font-weight:bold">@@</span> <span style="color:#000;font-weight:bold">:</span><span style="color:#ce5c00;font-weight:bold">:=</span> <span style="color:#ce5c00;font-weight:bold">@@</span> <span style="color:#000">__ANNOTATION_SET__</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">coroutine</span><span style="color:#000;font-weight:bold">)</span> <span style="color:#ce5c00;font-weight:bold">@@</span><span style="color:#000;font-weight:bold">;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#ce5c00;font-weight:bold">@@</span> <span style="color:#000">co_yield</span><span style="color:#000;font-weight:bold">(</span><span style="color:#ce5c00;font-weight:bold">...</span><span style="color:#000;font-weight:bold">)</span>    <span style="color:#ce5c00;font-weight:bold">@@</span> <span style="color:#000;font-weight:bold">:</span><span style="color:#ce5c00;font-weight:bold">:=</span> <span style="color:#ce5c00;font-weight:bold">@@</span> <span style="color:#000">__ANNOTATION_CHECK__</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">coroutine</span><span style="color:#000;font-weight:bold">)</span> <span style="color:#5c35cc;font-weight:bold">@__FUNC_BLOCK__</span> <span style="color:#000;font-weight:bold">::</span> <span style="color:#ce5c00;font-weight:bold">--</span> <span style="color:#ce5c00;font-weight:bold">@</span><span style="color:#a40000">$</span><span style="color:#ce5c00;font-weight:bold">...</span> <span style="color:#ce5c00;font-weight:bold">--</span>
</span></span><span style="display:flex;"><span><span style="color:#ce5c00;font-weight:bold">@@</span> <span style="color:#000">co_await</span>         <span style="color:#ce5c00;font-weight:bold">@@</span> <span style="color:#000;font-weight:bold">:</span><span style="color:#ce5c00;font-weight:bold">:=</span> <span style="color:#ce5c00;font-weight:bold">@@</span> <span style="color:#000">__ANNOTATION_CHECK__</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">coroutine</span><span style="color:#000;font-weight:bold">)</span> <span style="color:#5c35cc;font-weight:bold">@__FUNC_BLOCK__</span> <span style="color:#000;font-weight:bold">::</span> <span style="color:#ce5c00;font-weight:bold">+-</span>
</span></span><span style="display:flex;"><span><span style="color:#ce5c00;font-weight:bold">@@</span> <span style="color:#000">co_return</span><span style="color:#000;font-weight:bold">(</span><span style="color:#ce5c00;font-weight:bold">...</span><span style="color:#000;font-weight:bold">)</span>   <span style="color:#ce5c00;font-weight:bold">@@</span> <span style="color:#000;font-weight:bold">:</span><span style="color:#ce5c00;font-weight:bold">:=</span> <span style="color:#ce5c00;font-weight:bold">@@</span> <span style="color:#000">__ANNOTATION_CHECK__</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">coroutine</span><span style="color:#000;font-weight:bold">)</span> <span style="color:#5c35cc;font-weight:bold">@__FUNC_BLOCK__</span> <span style="color:#000;font-weight:bold">::</span> <span style="color:#ce5c00;font-weight:bold">++</span> <span style="color:#ce5c00;font-weight:bold">@</span><span style="color:#a40000">$</span><span style="color:#ce5c00;font-weight:bold">...</span> <span style="color:#ce5c00;font-weight:bold">++</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#000">ns</span> <span style="color:#000;font-weight:bold">{</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#5c35cc;font-weight:bold">@coroutine</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000">co_func</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">val</span><span style="color:#000;font-weight:bold">):</span><span style="color:#000">Int32</span> <span style="color:#000;font-weight:bold">:</span><span style="color:#ce5c00;font-weight:bold">:=</span> <span style="color:#000;font-weight:bold">{</span>  
</span></span><span style="display:flex;"><span>        <span style="color:#8f5902;font-style:italic"># Блок кода тела функции</span>
</span></span><span style="display:flex;"><span>        <span style="color:#ce5c00;font-weight:bold">...</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#8f5902;font-style:italic"># Возврат и приостановка выполнения функции</span>
</span></span><span style="display:flex;"><span>        <span style="color:#5c35cc;font-weight:bold">@__FUNC_BLOCK__</span> <span style="color:#000;font-weight:bold">::</span> <span style="color:#ce5c00;font-weight:bold">--</span> <span style="color:#0000cf;font-weight:bold">0</span> <span style="color:#ce5c00;font-weight:bold">--</span><span style="color:#000;font-weight:bold">;</span> <span style="color:#8f5902;font-style:italic"># ns::co_func::  -- 0 --;  </span>
</span></span><span style="display:flex;"><span>        <span style="color:#8f5902;font-style:italic"># Или @co_yield(0); с ипользованием DSL</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#8f5902;font-style:italic"># Приостановить и вернуть управление</span>
</span></span><span style="display:flex;"><span>        <span style="color:#5c35cc;font-weight:bold">@__FUNC_BLOCK__</span> <span style="color:#000;font-weight:bold">::</span> <span style="color:#ce5c00;font-weight:bold">+-</span><span style="color:#000;font-weight:bold">;</span> <span style="color:#8f5902;font-style:italic"># ns::co_func::  +-;  </span>
</span></span><span style="display:flex;"><span>        <span style="color:#8f5902;font-style:italic"># Или @co_await; с ипользованием DSL</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#8f5902;font-style:italic"># Возврат и завершение функции</span>
</span></span><span style="display:flex;"><span>        <span style="color:#5c35cc;font-weight:bold">@__FUNC_BLOCK__</span> <span style="color:#000;font-weight:bold">::</span> <span style="color:#ce5c00;font-weight:bold">++</span> <span style="color:#0000cf;font-weight:bold">0</span> <span style="color:#ce5c00;font-weight:bold">++</span><span style="color:#000;font-weight:bold">;</span> <span style="color:#8f5902;font-style:italic"># ns::co_func::  ++ 0 ++;  </span>
</span></span><span style="display:flex;"><span>        <span style="color:#8f5902;font-style:italic"># Или @co_return(0); с ипользованием DSL</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">};</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">};</span>
</span></span></code></pre></div><blockquote>
<p>Выражение co_yield возвращает значение вызывающей стороне и приостанавливает текущую сопрограмму:
это общий строительный блок возобновляемых функций-генераторов.</p>
</blockquote>
<p>co_await  <strong>+-</strong></p>
<blockquote>
<p>Унарный оператор co_await приостанавливает сопрограмму и возвращает управление вызывающей стороне.
Его операнд представляет собой выражение, которое либо (1) относится к типу класса, определяющему оператор-член co_await,
либо может быть передано оператору, не являющемуся членом co_await, либо (2) может быть преобразовано в такой тип класса с помощью текущей сопрограммы.</p>
</blockquote>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-cpp" data-lang="cpp"><span style="display:flex;"><span>    <span style="color:#204a87;font-weight:bold">auto</span> <span style="color:#000">request</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">await</span> <span style="color:#000">socket</span><span style="color:#000;font-weight:bold">.</span><span style="color:#000">read</span><span style="color:#000;font-weight:bold">(...);</span>
</span></span><span style="display:flex;"><span>    <span style="color:#204a87;font-weight:bold">auto</span> <span style="color:#000">result</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">await</span> <span style="color:#000">db_client</span><span style="color:#000;font-weight:bold">.</span><span style="color:#000">do_query</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">prepare_request</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">request</span><span style="color:#000;font-weight:bold">));</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000">await</span> <span style="color:#000">socket</span><span style="color:#000;font-weight:bold">.</span><span style="color:#000">write</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">prepare_result</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">result</span><span style="color:#000;font-weight:bold">));</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000">socket</span><span style="color:#000;font-weight:bold">.</span><span style="color:#000">close</span><span style="color:#000;font-weight:bold">();</span>
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span>    <span style="color:#000">request</span> <span style="color:#ce5c00;font-weight:bold">:=</span> <span style="color:#000;font-weight:bold">(){</span> <span style="color:#000">socket</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">read</span><span style="color:#000;font-weight:bold">(</span><span style="color:#ce5c00;font-weight:bold">...</span><span style="color:#000;font-weight:bold">)</span> <span style="color:#000;font-weight:bold">};</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000">auto</span> <span style="color:#000">result</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000;font-weight:bold">(){</span> <span style="color:#000">request</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">db_client</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">do_query</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">prepare_request</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">request</span><span style="color:#000;font-weight:bold">))</span> <span style="color:#000;font-weight:bold">};</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">(){</span> <span style="color:#000">socket</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">write</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">prepare_result</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">result</span><span style="color:#000;font-weight:bold">))</span> <span style="color:#000;font-weight:bold">};</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000">socket</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">close</span><span style="color:#000;font-weight:bold">();</span>
</span></span></code></pre></div>
</div>



    
	
  

    
	
  
    
    
	
    

<div class="td-content" style="page-break-before: always">
    
	<h1 id="pg-1777268c8246a0a796e4cb0a4fdf4c15">4 - Архитектура</h1>
    <div class="lead">Описание архитектуры компилятора для и конкретных технических решений</div>
	<h2 id="на-память">На память<a class="td-heading-self-link" href="#%d0%bd%d0%b0-%d0%bf%d0%b0%d0%bc%d1%8f%d1%82%d1%8c" aria-label="Heading self-link"></a></h2>
<p>clang-17 не поддерживает:</p>
<table>
<thead>
<tr>
<th>Feature</th>
<th>Proposal</th>
<th>Available</th>
</tr>
</thead>
<tbody>
<tr>
<td>Coroutines</td>
<td>P0912R5</td>
<td><em>Partial</em>   Fully supported on all targets except Windows, which still has some stability and ABI issues.</td>
</tr>
<tr>
<td>Extended floating-point types and standard names</td>
<td>P1467R9</td>
<td>No</td>
</tr>
<tr>
<td>Concepts</td>
<td>P0848R3</td>
<td>Clang 16 (Partial)</td>
</tr>
<tr>
<td>Modules</td>
<td></td>
<td>No</td>
</tr>
</tbody>
</table>
<h3 id="начиная-с-c-should-adopt-the-same-characters-for-c26">Начиная с C++ should adopt the same characters for C++26.<a class="td-heading-self-link" href="#%d0%bd%d0%b0%d1%87%d0%b8%d0%bd%d0%b0%d1%8f-%d1%81-c-should-adopt-the-same-characters-for-c26" aria-label="Heading self-link"></a></h3>
<ul>
<li>Add <strong>@</strong>, <strong>$</strong>, and ` to the basic character set          P2558R2 	Yes</li>
</ul>
<h2 id="система-классов-реализации">Система классов реализации<a class="td-heading-self-link" href="#%d1%81%d0%b8%d1%81%d1%82%d0%b5%d0%bc%d0%b0-%d0%ba%d0%bb%d0%b0%d1%81%d1%81%d0%be%d0%b2-%d1%80%d0%b5%d0%b0%d0%bb%d0%b8%d0%b7%d0%b0%d1%86%d0%b8%d0%b8" aria-label="Heading self-link"></a></h2>
<p>RunTime - единственный класс для приложения (процесса) - интерфейс для взаимодействия с операционной системой</p>
<ul>
<li>Загружат и выгружает модули и является их владельцем (shared_ptr)</li>
<li>Хранит сслыки на глобальные объекты (WeakPtr) и непосредственно глобальные объекты (встроенные типы и функции).
Ключем явялется строка с <a href="/ru/docs/arch/mangling/">внутренним именем</a> объекта</li>
<li>Хранит список <strong>глобальных</strong> объектов (типы данных и прототипы функций, которые создаются на этапе компиляции).
Используется парсером и компилятором для разбора исходного текста и создания исполняемого файла.</li>
</ul>
<p>Module - класс для модуля</p>
<ul>
<li>Хранение объектов модуля (shared_ptr) и добавляет weak_ptr в глобальный список объектов в RunTime</li>
</ul>
<p>Context - класс для хранения временных данных при выполнении программы</p>
<ul>
<li>Один класс создается сразу при создании RunTime</li>
<li>В дальнейшем создается по одному объекту для каждого нового потока (:Thread)</li>
<li>Хранение списка объектов (weak_ptr<Obj>)</li>
<li>Хранение локальных объектов (ObjPtr), которые создаются на этапе выполнения</li>
</ul>
<p>Исходный текст -&gt; Парсинг -&gt; AST (TermPtr) -+-&gt;  Компиляция в модуль (LLVM) -&gt; Выполнение модуля
|
+-&gt;  Интерпретация (Выполнение AST)</p>
<h2 id="реализация-загрузки-модулей-и-пакетов">Реализация загрузки модулей и пакетов<a class="td-heading-self-link" href="#%d1%80%d0%b5%d0%b0%d0%bb%d0%b8%d0%b7%d0%b0%d1%86%d0%b8%d1%8f-%d0%b7%d0%b0%d0%b3%d1%80%d1%83%d0%b7%d0%ba%d0%b8-%d0%bc%d0%be%d0%b4%d1%83%d0%bb%d0%b5%d0%b9-%d0%b8-%d0%bf%d0%b0%d0%ba%d0%b5%d1%82%d0%be%d0%b2" aria-label="Heading self-link"></a></h2>
<p>Загрузка модулей происодит следующим образом.
Когда во время парсинга исходного текста встречается команда загруки модуля,
создается отдельный экземпляр парсера, которому на вход подается исходный текст загружаемого модуля.</p>
<p>Загружаемый модуль парсится как обучный файл (включая обработку вложенных модулей),
после чего парсер завершает работу. В результате получается <strong>отдельное AST</strong> загружаемого модуля и <strong>общая база</strong> макросов.
После этого в AST модуля раскрываются области имен, производится проверка имен объетов и создание единой базы глобальных объектов.</p>
<p>После проверки <strong>отдельного AST</strong> модуля, обработка текущего файла моедт быть прожолжена.
После завершения обарботки файла раскрываются области имен, производится проверка имен объетов
и создание единой базы глобальных объектов как и в случае с обработко отдельного AST модуля.</p>
<p>При такой схеме работы, компиляция <strong>отдельных AST</strong> у каждого модуля может производиться параллельно с остальными моделями,
а создание общего исоплняемого файла после компиляции всех используемых модулей.</p>
<p>Загрузка пакета обработывается точто таким же образом, как и загрузка моделя.</p>
<h2 id="шаги-сборки-компилятора">Шаги сборки компилятора<a class="td-heading-self-link" href="#%d1%88%d0%b0%d0%b3%d0%b8-%d1%81%d0%b1%d0%be%d1%80%d0%ba%d0%b8-%d0%ba%d0%be%d0%bc%d0%bf%d0%b8%d0%bb%d1%8f%d1%82%d0%be%d1%80%d0%b0" aria-label="Heading self-link"></a></h2>
<ul>
<li>Сборка <code>nlc</code></li>
<li>Генерация с помощью <code>nlc --no-runtime  --no-dsl -emit-cpp</code> модуля <em>dsl</em></li>
<li>Сборка модуля <em>dsl</em></li>
<li>Генерация с помощью <code>nlc --no-runtime  -emit-cpp</code> пакета <em>runtime</em></li>
<li>Сборка пакета <em>runtime</em></li>
</ul>
<p>В результате имеем готовый <strong>nlc</strong> с модулями <strong>runtime.nlm</strong> и <strong>dsl.nlm</strong>, а заодно и проверяем:</p>
<ul>
<li>генерацию С++ кода без макросов</li>
<li>сборку модуля</li>
<li>загрузку модуля</li>
<li>генерацию С++ кода с макросами</li>
<li>сборку пакета</li>
<li>загрузку пакета</li>
</ul>
<p>Выполнение тестов с модулями <strong>runtime.nlm</strong> и <strong>dsl.nlm</strong></p>
<h2 id="опции-компилятора">Опции компилятора<a class="td-heading-self-link" href="#%d0%be%d0%bf%d1%86%d0%b8%d0%b8-%d0%ba%d0%be%d0%bc%d0%bf%d0%b8%d0%bb%d1%8f%d1%82%d0%be%d1%80%d0%b0" aria-label="Heading self-link"></a></h2>
<ul>
<li>-no-dsl - не использовать автоматически загружаемый модуль <strong>dsl</strong></li>
<li>-no-runtime - не использовать автоматически загружаемый модуль <strong>runtime</strong></li>
<li>-emit-cpp - генерировать выходной <strong>*.cpp</strong> файл</li>
</ul>
<h3 id="55-alignasn">5.5. alignas(N)<a class="td-heading-self-link" href="#55-alignasn" aria-label="Heading self-link"></a></h3>
<p>Этот спецификатор появился в C++11. Применяется к простым переменным, массивам и классам.
N — это выражение, вычисляемое при компиляции, его значение должно быть степенью двойки.
Переменная при этом будет размещена по адресу, кратному значению N. Например:</p>
<pre tabindex="0"><code>    alignas(64) char cacheline[64];

    cacheline:Int8[64](__alignas__=64) := _;
</code></pre><h3 id="constexpr">constexpr<a class="td-heading-self-link" href="#constexpr" aria-label="Heading self-link"></a></h3>
<p>Этот спецификатор появился в C++11. Применяется к простым переменным, массивам, функциям и функциям-членам.
Для простой переменной или массива это означает, что ее значение вычисляется на этапе компиляции и не может быть изменено.
Для функции это означает, что ее возвращаемое значение вычисляется на этапе компиляции, если значения аргументов известно на стадии компиляции.
(Но такую функцию можно использовать и с обычными аргументами.) Вот пример:</p>
<pre tabindex="0"><code>    constexpr double PI = 3.1415926535897932;
    constexpr int Square(int x) { return x * x; }


    PI^:Double = 3.1415926535897932;
    Square^(x:Int64):Int64 ::=  { return x * x; }
</code></pre><h3 id="57-consteval">5.7. consteval<a class="td-heading-self-link" href="#57-consteval" aria-label="Heading self-link"></a></h3>
<p>Этот спецификатор появился в C++20. Применяется к функциям и функциям-членам.
Это более строгий вариант constexpr, при вызове такой функции значения аргументов должны быть всегда известны на стадии компиляции.</p>
<pre tabindex="0"><code>?????????????????????????????????????
    Square^(x^:Int64):Int64 ::=  { return x * x; }
</code></pre><h3 id="58-noexcept">5.8. noexcept<a class="td-heading-self-link" href="#58-noexcept" aria-label="Heading self-link"></a></h3>
<p>Этот спецификатор появился в C++11. Применяется к функциям и функциям-членам и располагается в конце инструкции,
после списка параметров. Этот спецификатор гарантирует отсутствие исключений в процессе выполнения тела функции.</p>
<pre tabindex="0"><code>    func() ::= {*

    *};
</code></pre><h3 id="59-mutable">5.9. mutable<a class="td-heading-self-link" href="#59-mutable" aria-label="Heading self-link"></a></h3>
<p>Применяются к нестатическим членам класса, такие члены можно изменять в константных функциях-членах (см. раздел 5.10.1).</p>
<h3 id="в-c20-для-агрегатных-типов-появилась-еще-назначенная-инициализация-designated-initialization">В C++20 для агрегатных типов появилась еще назначенная инициализация (designated initialization):<a class="td-heading-self-link" href="#%d0%b2-c20-%d0%b4%d0%bb%d1%8f-%d0%b0%d0%b3%d1%80%d0%b5%d0%b3%d0%b0%d1%82%d0%bd%d1%8b%d1%85-%d1%82%d0%b8%d0%bf%d0%be%d0%b2-%d0%bf%d0%be%d1%8f%d0%b2%d0%b8%d0%bb%d0%b0%d1%81%d1%8c-%d0%b5%d1%89%d0%b5-%d0%bd%d0%b0%d0%b7%d0%bd%d0%b0%d1%87%d0%b5%d0%bd%d0%bd%d0%b0%d1%8f-%d0%b8%d0%bd%d0%b8%d1%86%d0%b8%d0%b0%d0%bb%d0%b8%d0%b7%d0%b0%d1%86%d0%b8%d1%8f-designated-initialization" aria-label="Heading self-link"></a></h3>
<p>struct Point
{
int X;
int Y;
};</p>
<p>Point pt = { .X = 1, .Y = 2 };</p>
<p>Эта инициализация позаимствована из C. Инициализируемые члены могут быть опущены и не только в конце, для них гарантируется инициализация по умолчанию. В отличие от C, порядок членов изменять нельзя, он должен быть таким же, как и при объявлении.</p>

</div>



    
      
  
  
  
  

  
  

  
    
    
	
    

<div class="td-content" style="page-break-before: always">
    
	<h1 id="pg-e9bfdeb90c430707fc05933872503964">4.1 - Внутреннее имя и манглинг имен</h1>
    
	<p>Именование объектов основано на <a href="/ru/docs/syntax/naming/">правилах</a> и выбирается из расчёта удобства для программиста.
Название переменной или функции должно нести смысл, понятные параметры и тип возвращаемого значения,
которые упрощают понимание алгоритма при последующем чтении исходного текста программы.</p>
<p>Но обычные имена мало о чём говорят компьютеру. Поэтому при компиляции программы,
имена объектов преобразуются для удобства машинной обработки и к ним добавляется служебная информация.</p>
<h2 id="internal">Внутреннее имя объекта<a class="td-heading-self-link" href="#internal" aria-label="Heading self-link"></a></h2>
<p>Каждый объект имеет свое внутреннее имя, уникальное в рамках <em>текущего модуля</em>,
с помощью которого комипилятор языка однозначно связывает объект с данными в памяти компьютера.</p>
<p>Внутреннее имя формируется во время анализа синтаксического дерева программы.
Оно включает в себя имя объекта, его квалификатор и полное пространство имен, в котором объект был опеределен.</p>
<p>У статических объектов (типов и классов), внутренее имя соотвествует полному имени объекта с учетом всех областей имен,
тогда как внутреннее имя автоматичеких объектов включает в себя и пустые (не именованные) блоки кода,
которые заменяются на монотонно возрастающий порядковый номер блока (т.е. ::1::, ::2:: и т.д.).
Включение в пространство имен пустых блоков кода необходимо для реализации возможности перекрытия имен
у объектов, определенных в разных областях видимости.</p>
<p>Кроме этого, все <a href="/ru/docs/syntax/naming/#sigil">квалификаторы</a> объектов переносятся в конец имени,
что и является отличительным признаком внутреннего имени (последний символ должен быть &ldquo;<strong>$</strong>&rdquo; или &ldquo;<strong>:</strong>&rdquo;).</p>
<p>Примеры внутренних имен:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic"># Глобальный статический объект</span>
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">::</span><span style="color:#000">var</span> <span style="color:#000;font-weight:bold">:</span><span style="color:#ce5c00;font-weight:bold">:=</span> <span style="color:#0000cf;font-weight:bold">0</span><span style="color:#000;font-weight:bold">;</span> <span style="color:#8f5902;font-style:italic"># ::var::</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic"># Локальный объект модуля</span>
</span></span><span style="display:flex;"><span><span style="color:#a40000">$</span><span style="color:#000">var</span> <span style="color:#ce5c00;font-weight:bold">:=</span> <span style="color:#0000cf;font-weight:bold">0</span><span style="color:#000;font-weight:bold">;</span>  <span style="color:#8f5902;font-style:italic"># var$</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic"># Статический объект модуля</span>
</span></span><span style="display:flex;"><span><span style="color:#ce5c00;font-weight:bold">@</span><span style="color:#000;font-weight:bold">::</span><span style="color:#000">var</span> <span style="color:#000;font-weight:bold">:</span><span style="color:#ce5c00;font-weight:bold">:=</span> <span style="color:#0000cf;font-weight:bold">0</span><span style="color:#000;font-weight:bold">;</span> <span style="color:#8f5902;font-style:italic"># var::</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic"># Глобальные тип и конструктор класса</span>
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">::</span> <span style="color:#000;font-weight:bold">:</span><span style="color:#204a87">type</span> <span style="color:#ce5c00;font-weight:bold">:=</span> <span style="color:#000;font-weight:bold">:</span><span style="color:#000">Type</span><span style="color:#000;font-weight:bold">;</span>     <span style="color:#8f5902;font-style:italic"># ::type:::</span>
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">::</span> <span style="color:#000;font-weight:bold">:</span><span style="color:#3465a4">cls</span> <span style="color:#ce5c00;font-weight:bold">:=</span> <span style="color:#000">Class</span><span style="color:#000;font-weight:bold">(){};</span>  <span style="color:#8f5902;font-style:italic"># ::cls:::</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic"># Синоним типа или конструктор класса модуля</span>
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">:</span><span style="color:#204a87">type</span> <span style="color:#ce5c00;font-weight:bold">:=</span> <span style="color:#000;font-weight:bold">:</span><span style="color:#000">Type</span><span style="color:#000;font-weight:bold">;</span>     <span style="color:#8f5902;font-style:italic"># type:::</span>
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">:</span><span style="color:#3465a4">cls</span> <span style="color:#ce5c00;font-weight:bold">:=</span> <span style="color:#000">Class</span><span style="color:#000;font-weight:bold">(){};</span>  <span style="color:#8f5902;font-style:italic"># cls:::</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic"># Тип или конструктор класса всегда статические</span>
</span></span><span style="display:flex;"><span><span style="color:#ce5c00;font-weight:bold">@</span><span style="color:#000;font-weight:bold">::</span> <span style="color:#000;font-weight:bold">:</span><span style="color:#204a87">type</span> <span style="color:#ce5c00;font-weight:bold">:=</span> <span style="color:#000;font-weight:bold">:</span><span style="color:#000">Type</span><span style="color:#000;font-weight:bold">;</span>     <span style="color:#8f5902;font-style:italic"># type:::</span>
</span></span><span style="display:flex;"><span><span style="color:#ce5c00;font-weight:bold">@</span><span style="color:#000;font-weight:bold">::</span> <span style="color:#000;font-weight:bold">:</span><span style="color:#3465a4">cls</span> <span style="color:#ce5c00;font-weight:bold">:=</span> <span style="color:#000">Class</span><span style="color:#000;font-weight:bold">(){};</span>  <span style="color:#8f5902;font-style:italic"># cls:::</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#000">ns</span> <span style="color:#000;font-weight:bold">{</span>
</span></span><span style="display:flex;"><span>    <span style="color:#a40000">$</span><span style="color:#000">var</span> <span style="color:#ce5c00;font-weight:bold">:=</span> <span style="color:#0000cf;font-weight:bold">0</span><span style="color:#000;font-weight:bold">;</span>      <span style="color:#8f5902;font-style:italic"># ns::var$</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000">var</span> <span style="color:#000;font-weight:bold">:</span><span style="color:#ce5c00;font-weight:bold">:=</span> <span style="color:#0000cf;font-weight:bold">0</span><span style="color:#000;font-weight:bold">;</span>      <span style="color:#8f5902;font-style:italic"># ns::var$</span>
</span></span><span style="display:flex;"><span>    <span style="color:#ce5c00;font-weight:bold">@</span><span style="color:#000;font-weight:bold">::</span><span style="color:#000">var</span> <span style="color:#000;font-weight:bold">:</span><span style="color:#ce5c00;font-weight:bold">:=</span> <span style="color:#0000cf;font-weight:bold">0</span><span style="color:#000;font-weight:bold">;</span>   <span style="color:#8f5902;font-style:italic"># ns::var:: - статический объект</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">:</span><span style="color:#204a87">type</span> <span style="color:#ce5c00;font-weight:bold">:=</span> <span style="color:#000;font-weight:bold">:</span><span style="color:#000">Type</span><span style="color:#000;font-weight:bold">;</span>     <span style="color:#8f5902;font-style:italic"># ns::type:::</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">:</span><span style="color:#3465a4">cls</span> <span style="color:#ce5c00;font-weight:bold">:=</span> <span style="color:#000">Class</span><span style="color:#000;font-weight:bold">(){};</span>  <span style="color:#8f5902;font-style:italic"># ns::cls:::</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#ce5c00;font-weight:bold">@</span><span style="color:#000;font-weight:bold">::</span><span style="color:#000">func1</span><span style="color:#000;font-weight:bold">()</span> <span style="color:#000;font-weight:bold">:</span><span style="color:#ce5c00;font-weight:bold">:=</span> <span style="color:#000;font-weight:bold">{};</span>   <span style="color:#8f5902;font-style:italic"># ns::func1::</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000">func2</span><span style="color:#000;font-weight:bold">()</span> <span style="color:#000;font-weight:bold">:</span><span style="color:#ce5c00;font-weight:bold">:=</span> <span style="color:#000;font-weight:bold">{};</span>      <span style="color:#8f5902;font-style:italic"># ns::func2::</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#8f5902;font-style:italic"># Не именованный блок кода</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">{</span>  
</span></span><span style="display:flex;"><span>        <span style="color:#8f5902;font-style:italic"># Локальные имена перекрывают объявления выше</span>
</span></span><span style="display:flex;"><span>        <span style="color:#a40000">$</span><span style="color:#000">var</span> <span style="color:#ce5c00;font-weight:bold">:=</span> <span style="color:#0000cf;font-weight:bold">0</span><span style="color:#000;font-weight:bold">;</span>  <span style="color:#8f5902;font-style:italic"># ns::1::var$</span>
</span></span><span style="display:flex;"><span>        <span style="color:#000">var</span> <span style="color:#ce5c00;font-weight:bold">:=</span> <span style="color:#0000cf;font-weight:bold">0</span><span style="color:#000;font-weight:bold">;</span>   <span style="color:#8f5902;font-style:italic"># ns::1::var$</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#8f5902;font-style:italic"># Статический объект соответствует области имен</span>
</span></span><span style="display:flex;"><span>        <span style="color:#ce5c00;font-weight:bold">@</span><span style="color:#000;font-weight:bold">::</span><span style="color:#000">var</span> <span style="color:#000;font-weight:bold">:</span><span style="color:#ce5c00;font-weight:bold">:=</span> <span style="color:#0000cf;font-weight:bold">0</span><span style="color:#000;font-weight:bold">;</span> <span style="color:#8f5902;font-style:italic"># ns::var::</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#8f5902;font-style:italic"># Типы данных всегда статические</span>
</span></span><span style="display:flex;"><span>        <span style="color:#000;font-weight:bold">:</span><span style="color:#204a87">type</span> <span style="color:#ce5c00;font-weight:bold">:=</span> <span style="color:#000;font-weight:bold">:</span><span style="color:#000">Type</span><span style="color:#000;font-weight:bold">;</span>     <span style="color:#8f5902;font-style:italic"># ns::type:::</span>
</span></span><span style="display:flex;"><span>        <span style="color:#000;font-weight:bold">:</span><span style="color:#3465a4">cls</span> <span style="color:#ce5c00;font-weight:bold">:=</span> <span style="color:#000">Class</span><span style="color:#000;font-weight:bold">(){};</span>  <span style="color:#8f5902;font-style:italic"># ns::cls:::</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#ce5c00;font-weight:bold">@</span><span style="color:#000;font-weight:bold">::</span><span style="color:#000">func3</span><span style="color:#000;font-weight:bold">()</span> <span style="color:#ce5c00;font-weight:bold">:=</span> <span style="color:#000;font-weight:bold">{};</span>    <span style="color:#8f5902;font-style:italic"># ns::func3::</span>
</span></span><span style="display:flex;"><span>        <span style="color:#8f5902;font-style:italic"># Локальная функция с ограниченной областью видимости ?????</span>
</span></span><span style="display:flex;"><span>        <span style="color:#000">func4</span><span style="color:#000;font-weight:bold">()</span> <span style="color:#ce5c00;font-weight:bold">:=</span> <span style="color:#000;font-weight:bold">{};</span>       <span style="color:#8f5902;font-style:italic"># ns::1::func4$</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">}</span>
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">};</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic"># Не именованный блок кода </span>
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">{</span>
</span></span><span style="display:flex;"><span>    <span style="color:#a40000">$</span><span style="color:#000">var</span> <span style="color:#ce5c00;font-weight:bold">:=</span> <span style="color:#0000cf;font-weight:bold">0</span><span style="color:#000;font-weight:bold">;</span>      <span style="color:#8f5902;font-style:italic"># 2::var$</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000">var</span> <span style="color:#000;font-weight:bold">:</span><span style="color:#ce5c00;font-weight:bold">:=</span> <span style="color:#0000cf;font-weight:bold">0</span><span style="color:#000;font-weight:bold">;</span>      <span style="color:#8f5902;font-style:italic"># 2::var$</span>
</span></span><span style="display:flex;"><span>    <span style="color:#ce5c00;font-weight:bold">@</span><span style="color:#000;font-weight:bold">::</span><span style="color:#000">var</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#0000cf;font-weight:bold">0</span><span style="color:#000;font-weight:bold">;</span>     <span style="color:#8f5902;font-style:italic"># var:: - статический объект</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">:</span><span style="color:#204a87">type</span> <span style="color:#ce5c00;font-weight:bold">:=</span> <span style="color:#000;font-weight:bold">:</span><span style="color:#000">Type</span><span style="color:#000;font-weight:bold">;</span>     <span style="color:#8f5902;font-style:italic"># type:::</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">:</span><span style="color:#3465a4">cls</span> <span style="color:#ce5c00;font-weight:bold">:=</span> <span style="color:#000">Class</span><span style="color:#000;font-weight:bold">(){};</span>  <span style="color:#8f5902;font-style:italic"># cls:::</span>
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">};</span>
</span></span></code></pre></div><h2 id="mangling">Манглинг внутренних имен<a class="td-heading-self-link" href="#mangling" aria-label="Heading self-link"></a></h2>
<p>Внутреннее имя уникально только в рамках одного <a href="/ru/docs/syntax/modules/">модуля</a>, но внутренние имена в разных модулях могут пересекаться.</p>
<p>Манглинг внутренних имя предназначен для объединения нескольких модулей в рамках одной программы,
и используется как способ кодирования имени функции, структуры, класса или другого типа данных
при передачи дополнительной семантической информации от компилятора <em>компоновщику</em>.</p>
<p>Внутреннее имя объекта после манглинга является корректным идентификатором для языков C/C++,
что позволяет обращатся к объектам NewLang из внешних библиотек и приложений на языке реализации (C/C++)
по семантически похожему имени (в отличии от <a href="https://en.wikipedia.org/wiki/Name_mangling#Complex_example">манглинга имен в С++</a>).</p>
<p>Манглинг внутреннего имени заключается в замене каждого символа двоеточия на символ <strong>$</strong>,
а у имени типа <a href="/ru/docs/syntax/naming/#sigil">квалификатор</a> заменяется тремя символами &lsquo;<strong>$</strong>&rsquo;, т.е. &rsquo;type <strong>$$$</strong>&rsquo;.</p>
<p>При манглинге, к внутренним именам объектов добавляется специальный префикс, который кодирует имя компилируемого модуля.
Имя текущего модуля находится в переменной препроцессора <strong>&quot;@$$&quot;</strong> и по умолчанию,
содержит имя файла модуля (у главного модуля приложения имя модуля отсутствует).</p>
<p>Имя модуля может быть однократно переопределено самым первым оператором модуля
или заменено во время импорта модуля с помощью системного параметра <code>__package__</code>.</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span>    <span style="color:#8f5902;font-style:italic"># Задать имя модуля</span>
</span></span><span style="display:flex;"><span>    <span style="color:#ce5c00;font-weight:bold">@</span><span style="color:#a40000">$$</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#4e9a06">&#34;\dir</span><span style="color:#4e9a06">\f</span><span style="color:#4e9a06">ile&#34;</span><span style="color:#000;font-weight:bold">;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#8f5902;font-style:italic"># Импорт модуля с переопределением имени</span>
</span></span><span style="display:flex;"><span>    \<span style="color:#204a87">dir</span>\<span style="color:#000">file</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">__package__</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#4e9a06">&#34;</span><span style="color:#4e9a06">\n</span><span style="color:#4e9a06">ew\module</span><span style="color:#4e9a06">\n</span><span style="color:#4e9a06">ame&#34;</span><span style="color:#000;font-weight:bold">);</span>
</span></span></code></pre></div><p>Тоже само с использвоанием DSL:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#5c35cc;font-weight:bold">@package</span> \<span style="color:#204a87">dir</span>\<span style="color:#000">name</span><span style="color:#000;font-weight:bold">;</span>  <span style="color:#8f5902;font-style:italic"># @$$ = &#34;\dir\file&#34;;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#5c35cc;font-weight:bold">@import</span> \<span style="color:#204a87">dir</span>\<span style="color:#000">name</span> <span style="color:#204a87;font-weight:bold">as</span> \<span style="color:#000">new</span>\<span style="color:#000">module</span>\<span style="color:#000">name</span><span style="color:#000;font-weight:bold">;</span> <span style="color:#8f5902;font-style:italic"># \dir\file(__package__=&#34;\new\module\name&#34;);</span>
</span></span></code></pre></div><p>При манглинге имя модуля, по умолчанию имя файла отностительно каталога главного файла программы,
размещается в начале внутреннего системного имени.
Так как имя модуля, согласно правилам синтаксиса, может содерждать только строчные буквы и цифры,
то разделитель каталогов (обратный слеш) заменяется на подчерк,
а начало и конец имени модуля отмечаются комбинациями символов &ldquo;<strong>_$</strong>&rdquo; и &ldquo;<strong>$_</strong>&rdquo; соответственно.</p>
<p>Так как локальной переменной с одним подчерком в качестве имени быть не может,
то начало строки на &ldquo;<strong>_$</strong>&rdquo; служит отличительным признаком манглинга внутреннего имени объекта.</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#ce5c00;font-weight:bold">@</span><span style="color:#a40000">$$</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#4e9a06">&#34;\dir</span><span style="color:#4e9a06">\f</span><span style="color:#4e9a06">ile&#34;</span><span style="color:#000;font-weight:bold">;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic"># Глобальный статический объект</span>
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">::</span><span style="color:#000">var</span> <span style="color:#000;font-weight:bold">:</span><span style="color:#ce5c00;font-weight:bold">:=</span> <span style="color:#0000cf;font-weight:bold">0</span><span style="color:#000;font-weight:bold">;</span> <span style="color:#8f5902;font-style:italic"># _$dir_file$_$$var$$</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic"># Локальный объект модуля</span>
</span></span><span style="display:flex;"><span><span style="color:#a40000">$</span><span style="color:#000">var</span> <span style="color:#ce5c00;font-weight:bold">:=</span> <span style="color:#0000cf;font-weight:bold">0</span><span style="color:#000;font-weight:bold">;</span>  <span style="color:#8f5902;font-style:italic"># _$dir_file$_var$</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic"># Статический объект модуля</span>
</span></span><span style="display:flex;"><span><span style="color:#ce5c00;font-weight:bold">@</span><span style="color:#000;font-weight:bold">::</span><span style="color:#000">var</span> <span style="color:#000;font-weight:bold">:</span><span style="color:#ce5c00;font-weight:bold">:=</span> <span style="color:#0000cf;font-weight:bold">0</span><span style="color:#000;font-weight:bold">;</span> <span style="color:#8f5902;font-style:italic"># _$dir_file$_var$$</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic"># Глобальные тип и конструктор класса</span>
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">::</span> <span style="color:#000;font-weight:bold">:</span><span style="color:#204a87">type</span> <span style="color:#ce5c00;font-weight:bold">:=</span> <span style="color:#000;font-weight:bold">:</span><span style="color:#000">Type</span><span style="color:#000;font-weight:bold">;</span>     <span style="color:#8f5902;font-style:italic"># _$dir_file$_$$type$$$</span>
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">::</span> <span style="color:#000;font-weight:bold">:</span><span style="color:#3465a4">cls</span> <span style="color:#ce5c00;font-weight:bold">:=</span> <span style="color:#000">Class</span><span style="color:#000;font-weight:bold">(){};</span>  <span style="color:#8f5902;font-style:italic"># _$dir_file$_$$cls$$$</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic"># Синоним типа или конструктор класса модуля</span>
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">:</span><span style="color:#204a87">type</span> <span style="color:#ce5c00;font-weight:bold">:=</span> <span style="color:#000;font-weight:bold">:</span><span style="color:#000">Type</span><span style="color:#000;font-weight:bold">;</span>     <span style="color:#8f5902;font-style:italic"># _$dir_file$_type$$$</span>
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">:</span><span style="color:#3465a4">cls</span> <span style="color:#ce5c00;font-weight:bold">:=</span> <span style="color:#000">Class</span><span style="color:#000;font-weight:bold">(){};</span>  <span style="color:#8f5902;font-style:italic"># _$dir_file$_cls$$$</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#000">ns</span> <span style="color:#000;font-weight:bold">{</span>
</span></span><span style="display:flex;"><span>    <span style="color:#a40000">$</span><span style="color:#000">var</span> <span style="color:#ce5c00;font-weight:bold">:=</span> <span style="color:#0000cf;font-weight:bold">0</span><span style="color:#000;font-weight:bold">;</span>  <span style="color:#8f5902;font-style:italic"># _$dir_file$_ns$$var$</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000">var</span> <span style="color:#000;font-weight:bold">:</span><span style="color:#ce5c00;font-weight:bold">:=</span> <span style="color:#0000cf;font-weight:bold">0</span><span style="color:#000;font-weight:bold">;</span>  <span style="color:#8f5902;font-style:italic"># _$dir_file$_ns$$var$</span>
</span></span><span style="display:flex;"><span>    <span style="color:#ce5c00;font-weight:bold">@</span><span style="color:#000;font-weight:bold">::</span><span style="color:#000">var</span> <span style="color:#000;font-weight:bold">:</span><span style="color:#ce5c00;font-weight:bold">:=</span> <span style="color:#0000cf;font-weight:bold">0</span><span style="color:#000;font-weight:bold">;</span> <span style="color:#8f5902;font-style:italic"># _$dir_file$_ns$$var$$ - статический объект</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">:</span><span style="color:#204a87">type</span> <span style="color:#ce5c00;font-weight:bold">:=</span> <span style="color:#000;font-weight:bold">:</span><span style="color:#000">Type</span><span style="color:#000;font-weight:bold">;</span>     <span style="color:#8f5902;font-style:italic"># _$dir_file$_ns$$type$$$</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">:</span><span style="color:#3465a4">cls</span> <span style="color:#ce5c00;font-weight:bold">:=</span> <span style="color:#000">Class</span><span style="color:#000;font-weight:bold">(){};</span>  <span style="color:#8f5902;font-style:italic"># _$dir_file$_ns$$cls$$$</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#ce5c00;font-weight:bold">@</span><span style="color:#000;font-weight:bold">::</span><span style="color:#000">func</span><span style="color:#000;font-weight:bold">()</span> <span style="color:#000;font-weight:bold">:</span><span style="color:#ce5c00;font-weight:bold">:=</span> <span style="color:#000;font-weight:bold">{};</span>      <span style="color:#8f5902;font-style:italic"># _$dir_file$_ns$$func$$</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000">func</span><span style="color:#000;font-weight:bold">()</span> <span style="color:#000;font-weight:bold">:</span><span style="color:#ce5c00;font-weight:bold">:=</span> <span style="color:#000;font-weight:bold">{};</span>      <span style="color:#8f5902;font-style:italic"># _$dir_file$_ns$$func$</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#8f5902;font-style:italic"># Не именованный блок кода</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">{</span>  
</span></span><span style="display:flex;"><span>        <span style="color:#8f5902;font-style:italic"># Локальные имена перекрывают обяъявления выше</span>
</span></span><span style="display:flex;"><span>        <span style="color:#a40000">$</span><span style="color:#000">var</span> <span style="color:#ce5c00;font-weight:bold">:=</span> <span style="color:#0000cf;font-weight:bold">0</span><span style="color:#000;font-weight:bold">;</span>  <span style="color:#8f5902;font-style:italic"># _$dir_file$_ns$$1$$var$</span>
</span></span><span style="display:flex;"><span>        <span style="color:#000">var</span> <span style="color:#ce5c00;font-weight:bold">:=</span> <span style="color:#0000cf;font-weight:bold">0</span><span style="color:#000;font-weight:bold">;</span>  <span style="color:#8f5902;font-style:italic"># _$dir_file$_ns$$1$$var$</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#8f5902;font-style:italic"># Статический объект соответствует области имен</span>
</span></span><span style="display:flex;"><span>        <span style="color:#ce5c00;font-weight:bold">@</span><span style="color:#000;font-weight:bold">::</span><span style="color:#000">var</span> <span style="color:#000;font-weight:bold">:</span><span style="color:#ce5c00;font-weight:bold">:=</span> <span style="color:#0000cf;font-weight:bold">0</span><span style="color:#000;font-weight:bold">;</span> <span style="color:#8f5902;font-style:italic"># _$dir_file$_ns$$var$$</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#8f5902;font-style:italic"># Типы данных и функции всегда статические</span>
</span></span><span style="display:flex;"><span>        <span style="color:#000;font-weight:bold">:</span><span style="color:#204a87">type</span> <span style="color:#ce5c00;font-weight:bold">:=</span> <span style="color:#000;font-weight:bold">:</span><span style="color:#000">Type</span><span style="color:#000;font-weight:bold">;</span>     <span style="color:#8f5902;font-style:italic"># _$dir_file$_ns$$type$$$</span>
</span></span><span style="display:flex;"><span>        <span style="color:#000;font-weight:bold">:</span><span style="color:#3465a4">cls</span> <span style="color:#ce5c00;font-weight:bold">:=</span> <span style="color:#000">Class</span><span style="color:#000;font-weight:bold">(){};</span>  <span style="color:#8f5902;font-style:italic"># _$dir_file$_ns$$cls$$$</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#ce5c00;font-weight:bold">@</span><span style="color:#000;font-weight:bold">::</span><span style="color:#000">func</span><span style="color:#000;font-weight:bold">()</span> <span style="color:#ce5c00;font-weight:bold">:=</span> <span style="color:#000;font-weight:bold">{};</span>      <span style="color:#8f5902;font-style:italic"># _$dir_file$_ns$$func$$</span>
</span></span><span style="display:flex;"><span>        <span style="color:#000">func</span><span style="color:#000;font-weight:bold">()</span> <span style="color:#ce5c00;font-weight:bold">:=</span> <span style="color:#000;font-weight:bold">{};</span>      <span style="color:#8f5902;font-style:italic"># _$dir_file$_ns$$1$$func$ ????????</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">}</span>
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">};</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic"># Не именованный блок кода </span>
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">{</span>
</span></span><span style="display:flex;"><span>    <span style="color:#a40000">$</span><span style="color:#000">var</span> <span style="color:#ce5c00;font-weight:bold">:=</span> <span style="color:#0000cf;font-weight:bold">0</span><span style="color:#000;font-weight:bold">;</span>      <span style="color:#8f5902;font-style:italic"># _$dir_file$_2::var$</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000">var</span> <span style="color:#000;font-weight:bold">:</span><span style="color:#ce5c00;font-weight:bold">:=</span> <span style="color:#0000cf;font-weight:bold">0</span><span style="color:#000;font-weight:bold">;</span>      <span style="color:#8f5902;font-style:italic"># _$dir_file$_2::var$</span>
</span></span><span style="display:flex;"><span>    <span style="color:#ce5c00;font-weight:bold">@</span><span style="color:#000;font-weight:bold">::</span><span style="color:#000">var</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#0000cf;font-weight:bold">0</span><span style="color:#000;font-weight:bold">;</span>     <span style="color:#8f5902;font-style:italic"># _$dir_file$_var$$ - статический объект</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">:</span><span style="color:#204a87">type</span> <span style="color:#ce5c00;font-weight:bold">:=</span> <span style="color:#000;font-weight:bold">:</span><span style="color:#000">Type</span><span style="color:#000;font-weight:bold">;</span>     <span style="color:#8f5902;font-style:italic"># _$dir_file$_type$$$</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">:</span><span style="color:#3465a4">cls</span> <span style="color:#ce5c00;font-weight:bold">:=</span> <span style="color:#000">Class</span><span style="color:#000;font-weight:bold">(){};</span>  <span style="color:#8f5902;font-style:italic"># _$dir_file$_cls$$$</span>
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">};</span>
</span></span></code></pre></div><p>Манглинг имен блока кода главного модуля программы:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#000;font-weight:bold">{</span>
</span></span><span style="display:flex;"><span>    <span style="color:#a40000">$</span><span style="color:#000">var</span> <span style="color:#ce5c00;font-weight:bold">:=</span> <span style="color:#0000cf;font-weight:bold">0</span><span style="color:#000;font-weight:bold">;</span>      <span style="color:#8f5902;font-style:italic"># _$$_1::var$</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000">var</span> <span style="color:#000;font-weight:bold">:</span><span style="color:#ce5c00;font-weight:bold">:=</span> <span style="color:#0000cf;font-weight:bold">0</span><span style="color:#000;font-weight:bold">;</span>      <span style="color:#8f5902;font-style:italic"># _$$_1::var$</span>
</span></span><span style="display:flex;"><span>    <span style="color:#ce5c00;font-weight:bold">@</span><span style="color:#000;font-weight:bold">::</span><span style="color:#000">var</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#0000cf;font-weight:bold">0</span><span style="color:#000;font-weight:bold">;</span>     <span style="color:#8f5902;font-style:italic"># _$$_var$$ - статический объект</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">:</span><span style="color:#204a87">type</span> <span style="color:#ce5c00;font-weight:bold">:=</span> <span style="color:#000;font-weight:bold">:</span><span style="color:#000">Type</span><span style="color:#000;font-weight:bold">;</span>     <span style="color:#8f5902;font-style:italic"># _$$_type$$$</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">:</span><span style="color:#3465a4">cls</span> <span style="color:#ce5c00;font-weight:bold">:=</span> <span style="color:#000">Class</span><span style="color:#000;font-weight:bold">(){};</span>  <span style="color:#8f5902;font-style:italic"># _$$_cls$$$</span>
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">};</span>
</span></span></code></pre></div><h2 id="встроенный-блок-кода-и-вызов-функций">Встроенный блок кода и вызов функций<a class="td-heading-self-link" href="#%d0%b2%d1%81%d1%82%d1%80%d0%be%d0%b5%d0%bd%d0%bd%d1%8b%d0%b9-%d0%b1%d0%bb%d0%be%d0%ba-%d0%ba%d0%be%d0%b4%d0%b0-%d0%b8-%d0%b2%d1%8b%d0%b7%d0%be%d0%b2-%d1%84%d1%83%d0%bd%d0%ba%d1%86%d0%b8%d0%b9" aria-label="Heading self-link"></a></h2>
<p>В <a href="/ru/docs/ops/block/#embed">расширенном синатксисе</a> с исходным кодом языка реализации
можно взаимодействовать с другим кодом программы за счет обращения к локальным объектам или макросам изнутри блока кода.</p>
<p>Это досупкается как для обычных переменных, так и для имен функций, реализованных в NewLang,
и для того, что бы компилятор C/C++ имел возможность создать правильный код, при раскрытии встроенного блока кода перед
ним добавляются сигнатуры переменных и функций, которые используются во строенном блоке кода.</p>
<p>Для имен переменных дополнительный манглинг имен не производится,
а для функций автоматичсеки создается дополнительная сигнатура
с описанием типов аргументов и их значений по умолчанию, если таковые используются.</p>
<p>Каждая функция NewLang имеет две сигнатуры, первая (<em>основная</em>) принимает все аргументы в виде словаря,
а вторая (<em>дополнительная</em>) с развернутым списком аргументов, чтобы её можно было вызывать как обычную C++ функцию
и проверка типов могла происходить С/С++ непосредственно компилятором.</p>
<p>Манглинг второго (<em>дополнительного</em>) имени функции заключается в добавлении в конец имени двух символов &ldquo;_$&rdquo;.</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    <span style="color:#8f5902;font-style:italic"># Определение функции в NewLang</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">::</span><span style="color:#000">func_embed</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">int64_t</span> <span style="color:#000">arg_long</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">uint8_t</span> <span style="color:#000">arg_byte</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#0000cf;font-weight:bold">10</span><span style="color:#000;font-weight:bold">):</span> <span style="color:#000">Int64</span> <span style="color:#000;font-weight:bold">:</span><span style="color:#ce5c00;font-weight:bold">:=</span> <span style="color:#000;font-weight:bold">{</span>
</span></span><span style="display:flex;"><span>        <span style="color:#5c35cc;font-weight:bold">@return</span> <span style="color:#000">arg_long</span> <span style="color:#ce5c00;font-weight:bold">+</span> <span style="color:#000">arg_byte</span><span style="color:#000;font-weight:bold">;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">}</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#8f5902;font-style:italic"># С/С++ прототип для первого (основоного) имени</span>
</span></span><span style="display:flex;"><span>    <span style="color:#8f5902;font-style:italic"># extern &#34;C&#34; _$$_func_embed$( Obj &amp;args );</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#8f5902;font-style:italic"># С/С++ прототип для второго (дополнительного) имени</span>
</span></span><span style="display:flex;"><span>    <span style="color:#8f5902;font-style:italic"># extern &#34;C&#34; _$$_func_embed$_$(int64_t arg_long, uint8_t arg_byte = 10);</span>
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    <span style="color:#8f5902;font-style:italic"># Тогда при раскрытии блока с расширенным синтаксисом </span>
</span></span><span style="display:flex;"><span>    <span style="color:#8f5902;font-style:italic"># $func_embed заменяется на _$$_func_embed$_$, а компилятор С/С++ </span>
</span></span><span style="display:flex;"><span>    <span style="color:#8f5902;font-style:italic"># будет в состоянии проверить её аргументы</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">{</span><span style="color:#ce5c00;font-weight:bold">%</span>
</span></span><span style="display:flex;"><span>        <span style="color:#000">int64_t</span> <span style="color:#000">value</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#a40000">$</span><span style="color:#000">func_embed</span><span style="color:#000;font-weight:bold">(</span><span style="color:#0000cf;font-weight:bold">10</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#0000cf;font-weight:bold">20</span><span style="color:#000;font-weight:bold">);</span>
</span></span><span style="display:flex;"><span>    <span style="color:#ce5c00;font-weight:bold">%</span><span style="color:#000;font-weight:bold">}</span>
</span></span></code></pre></div><p><em>Хотя может имеет смысл сделать inline шаблон для подобного вызова, а не создавать кополнительное имя?</em></p>


<div class="pageinfo pageinfo-primary">
<pre tabindex="0"><code>./object.h:732:25: error: deduced conflicting types (&#39;int&#39; vs &#39;const char *&#39;) for initializer list element type   
            auto list = {args...};   
                        ^~~~~
test/object_test.cpp:131:21: note: in instantiation of function template specialization &#39;newlang::Obj::operator()&lt;int, const char *&gt;&#39; requested here   
    str3 = (*format)(-1, &#34;222&#34;);   
                    ^     
</code></pre>
</div>


</div>



    
	
  
    
    
	
    

<div class="td-content" style="page-break-before: always">
    
	<h1 id="pg-0edf501a32548420dc5a47b09522d47e">4.2 - Реализация прерываний и обработки ошибок</h1>
    
	<p>Чтобы не усложнять обработку ошибок и не разделять их на внутренние и внешние,
реализовано всего два класса для сообщения об ошибоках, накопительные и непосредственные + возврат значений.</p>
<h3 id="накопительные-ошибки-и-их-реализация">Накопительные ошибки и их реализация<a class="td-heading-self-link" href="#%d0%bd%d0%b0%d0%ba%d0%be%d0%bf%d0%b8%d1%82%d0%b5%d0%bb%d1%8c%d0%bd%d1%8b%d0%b5-%d0%be%d1%88%d0%b8%d0%b1%d0%ba%d0%b8-%d0%b8-%d0%b8%d1%85-%d1%80%d0%b5%d0%b0%d0%bb%d0%b8%d0%b7%d0%b0%d1%86%d0%b8%d1%8f" aria-label="Heading self-link"></a></h3>
<p>Накопительные ошибки используются при обработке исходного текста программы при его парсинге, анализа или компиляции.
<em>Накопительнность</em> данных ошибок заключается в том, что процесс обработки исходного текста прерывается не сразу после возникновения первой ошибки,
а только после превышения определнного лимита (по умолчанию &ndash;nlc-error-limit=10).</p>
<p>Для логирования места возникновения ошибки используется макрос LOG_ERROR и при необходиости инкремент количества ошибок,
или без оного (LOG_WARNING, LOG_INFO, LOG_DEBUG, LOG_DUMP) и обязательной пометкой термина TermPtr как причины её возникновения.</p>
<p>После превышения лимита накопительных ошибок или при их наличии и завершении исходного текста программы,
генерируется обычное исключение std::exception с описанием причины (последней ошибки).</p>
<h3 id="непосредственные-ошибки-и-их-реализация">Непосредственные ошибки и их реализация<a class="td-heading-self-link" href="#%d0%bd%d0%b5%d0%bf%d0%be%d1%81%d1%80%d0%b5%d0%b4%d1%81%d1%82%d0%b2%d0%b5%d0%bd%d0%bd%d1%8b%d0%b5-%d0%be%d1%88%d0%b8%d0%b1%d0%ba%d0%b8-%d0%b8-%d0%b8%d1%85-%d1%80%d0%b5%d0%b0%d0%bb%d0%b8%d0%b7%d0%b0%d1%86%d0%b8%d1%8f" aria-label="Heading self-link"></a></h3>
<p>Непосредственные ошибки применяются при выполнении (интерпретции) тела программы и предназнчены для
информирования пользователя о возникновении ошибки прерывания работы программы.
Так как контекст (текущий термин или строка в исходном файла) как правило не доступны,
то сразу генерируется обычное исключение std::exception с описанием причины возникновения,
а идентификация места её возникновения с конкретным исходным местом в тексте программы возлагается на обработчик прерываний.</p>
<h3 id="возврат-знечений">Возврат знечений<a class="td-heading-self-link" href="#%d0%b2%d0%be%d0%b7%d0%b2%d1%80%d0%b0%d1%82-%d0%b7%d0%bd%d0%b5%d1%87%d0%b5%d0%bd%d0%b8%d0%b9" aria-label="Heading self-link"></a></h3>
<p>Для обработки <a href="/ru/docs/ops/throw/">перываний потока выполения</a>, используются отдельные С++ классы,
которые <strong>не</strong> являются наследниками <em>std::exception</em>, чтобы специально разделить код обработки возврата значений от обработки ошибок,
<em>а при выполнении (генерации кода) именованные прерывания могут быть реализованы вообще <strong>без использования исключений</strong> (return, break, continue или goto)!</em></p>
<pre tabindex="0"><code>    :IntAny --+-&gt; :IntPlus
    (ObjPtr)  |
              |
              +-&gt; :IntMinus
                
</code></pre>
</div>



    
	
  
    
    
	
    

<div class="td-content" style="page-break-before: always">
    
	<h1 id="pg-89138bfdfd307537b9369eef3039a6ea">4.3 - Реализация JIT</h1>
    
	<p>В состав языка взодят следующие компоненты:</p>
<ol>
<li>Приложение компилятор и REPL одновременнно <strong>nlc</strong>.</li>
<li>Библиотека nlc-rt - минимально необходимые компоненты для работы с обощенными типами данных.</li>
<li>Рантайм компоненты проекта libtorch - для тензорных вычислений.</li>
<li>Библиотека nlc-jit - реализация REPL и компилятора</li>
<li>Рантайм библиотека LLVM как зависимость для nlc-jit.</li>
</ol>
<p>Варианты сборки приложения и необходимые для его работы библиотеки зависят от следующих факторов:</p>
<ol>
<li>Если приложение использует <strong>только нативные</strong> объекты и типы данных, тогда для его работы
не требуется компоненты языка, а само приложение представляет собой обычныую C/C++ программу.</li>
</ol>
<p>Приложение нужно собирать с ключами &ndash;no-nlc-rt и &mdash;embed-source</p>
<p>Созадется один чистый исполняемый файл без связи с библиотеками nlc-jit и nlc-rt и без прочих зависимостей.
Программа должна состоять из одного единственного встроенного кода C/C++ и внутри него
не должно быть обращения к объектам языка или аргументам.</p>
<ol start="2">
<li>Если приложение кроме нативных объектов использует другие типы данных,
например тензоры или рациональные числа неограниченной точности и/или создаются функции,
тогда для работы приложения требуется библиотека <em>nlc-rt</em> и компоненты проекта <em>torch</em>.</li>
</ol>
<p>Созадется один исполняемый файл без связи с библиотеками nlc-jit.
Допускается обработка любых объектов языка, но без возможности динамической загрузки модулей
или любой другой рантайм компиляции (REPL, динамической отладки и т.д.).</p>
<p>Во всех остальных случаях используются обе библиотеки (плюс LLVM) и имеется возможность динамиечкой загрузки модулей,
REPL и прочие возможностями JIT компиляции, такими, как вставки нативного кода и интерпретация кода в рантайме.</p>
<p>Пример чистого нативного приложения из-за использования одного единственного блока нативного кода
и отсутствию отбращения к объектам языка.</p>
<p><code>./nlc --compile --no-nlc-rt --nlc-embed-source -o hello  hello_embed.src</code></p>
<p>&ndash;ofile-cpp
&ndash;ofile-include
&ndash;ofile-bytecode
&ndash;ofile-pre</p>
<p>Пример чистого нативного приложения из-за использования одного единственного блока нативного кода
и отсутствию отбращения к объектам языка (в том числе и аргументам).
Тело программы (одинственный фрагмент) вставляется в main непосредственно.</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-cpp" data-lang="cpp"><span style="display:flex;"><span>    <span style="color:#8f5902;font-style:italic"># For compile run: ./nlc --compile --no-nlc-rt --embed-source -o hello 
</span></span></span><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic"></span>
</span></span><span style="display:flex;"><span>    <span style="color:#8f5902;font-style:italic"># int main(int argc, char* argv[], char* envp[]);
</span></span></span><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic"></span>    <span style="color:#000;font-weight:bold">{</span><span style="color:#ce5c00;font-weight:bold">%</span>
</span></span><span style="display:flex;"><span>        <span style="color:#8f5902;font-style:italic">/*
</span></span></span><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic">        *  @\\stdio.h     --&gt;  #include &lt;stdio.h&gt;
</span></span></span><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic">        *  @\sys\time.h   --&gt;  #include &#34;sys/time.h&#34;
</span></span></span><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic">        */</span>
</span></span><span style="display:flex;"><span>        <span style="color:#000">printf</span><span style="color:#000;font-weight:bold">(</span><span style="color:#4e9a06">&#34;Hello, world!</span><span style="color:#4e9a06">\n</span><span style="color:#4e9a06">&#34;</span><span style="color:#000;font-weight:bold">);</span>
</span></span><span style="display:flex;"><span>    <span style="color:#ce5c00;font-weight:bold">%</span><span style="color:#000;font-weight:bold">}</span>
</span></span></code></pre></div><p>Пример простого приложения с использованием только одой библиотеки nlc-rt:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span>    <span style="color:#204a87">print</span><span style="color:#000;font-weight:bold">(</span><span style="color:#4e9a06">&#34;Hello, world!</span><span style="color:#4e9a06">\n</span><span style="color:#4e9a06">&#34;</span><span style="color:#000;font-weight:bold">);</span>
</span></span></code></pre></div><p>Пример простого приложения с использованием только одой библиотеки nlc_runtime и
интеграцией объектов языка в нативнй код. Тело программы (блок кода) оформляется в виде
функции и вызывается из main с передачей агрументов, переданных программе.
<code>./nlc --compile -o factorial</code></p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span>    <span style="color:#a40000">$</span><span style="color:#000">top</span> <span style="color:#ce5c00;font-weight:bold">:=</span> <span style="color:#000">_</span><span style="color:#000;font-weight:bold">;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#5c35cc;font-weight:bold">@try</span> <span style="color:#000;font-weight:bold">{</span>
</span></span><span style="display:flex;"><span>        <span style="color:#a40000">$</span><span style="color:#000">top</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000;font-weight:bold">:</span><span style="color:#000">Int32</span><span style="color:#000;font-weight:bold">(</span><span style="color:#a40000">$</span><span style="color:#0000cf;font-weight:bold">1</span><span style="color:#000;font-weight:bold">);</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">}</span> <span style="color:#5c35cc;font-weight:bold">@catch</span><span style="color:#000;font-weight:bold">(</span><span style="color:#ce5c00;font-weight:bold">...</span><span style="color:#000;font-weight:bold">){</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">}</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#204a87;font-weight:bold">if</span><span style="color:#000;font-weight:bold">(</span><span style="color:#5c35cc;font-weight:bold">@latter</span> <span style="color:#ce5c00;font-weight:bold">~</span> <span style="color:#000;font-weight:bold">:</span><span style="color:#000">Error</span> <span style="color:#ce5c00;font-weight:bold">||</span> <span style="color:#a40000">$</span><span style="color:#000">top</span> <span style="color:#ce5c00;font-weight:bold">&lt;</span> <span style="color:#0000cf;font-weight:bold">1</span><span style="color:#000;font-weight:bold">){</span>
</span></span><span style="display:flex;"><span>        <span style="color:#204a87">print</span><span style="color:#000;font-weight:bold">(</span><span style="color:#4e9a06">&#34;Use: factorial &lt;int&gt;</span><span style="color:#4e9a06">\n</span><span style="color:#4e9a06">&#34;</span><span style="color:#000;font-weight:bold">);</span>
</span></span><span style="display:flex;"><span>        <span style="color:#5c35cc;font-weight:bold">@exit</span><span style="color:#000;font-weight:bold">(</span><span style="color:#0000cf;font-weight:bold">1</span><span style="color:#000;font-weight:bold">);</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">}</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#a40000">$</span><span style="color:#000">fact</span> <span style="color:#ce5c00;font-weight:bold">:=</span> <span style="color:#0000cf;font-weight:bold">1</span>\<span style="color:#0000cf;font-weight:bold">1</span><span style="color:#000;font-weight:bold">;</span> <span style="color:#8f5902;font-style:italic"># Rational number 1 (no precision limit)</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#8f5902;font-style:italic"># Example build programm for factorial calculate</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">{</span><span style="color:#ce5c00;font-weight:bold">%</span>
</span></span><span style="display:flex;"><span>        <span style="color:#204a87;font-weight:bold">for</span><span style="color:#000;font-weight:bold">(</span><span style="color:#204a87">int</span> <span style="color:#000">i</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#0000cf;font-weight:bold">2</span><span style="color:#000;font-weight:bold">;</span> <span style="color:#000">i</span> <span style="color:#ce5c00;font-weight:bold">&lt;=</span> <span style="color:#000">static_cast</span><span style="color:#ce5c00;font-weight:bold">&lt;</span><span style="color:#204a87">int</span><span style="color:#ce5c00;font-weight:bold">&gt;</span><span style="color:#000;font-weight:bold">(</span><span style="color:#a40000">$</span><span style="color:#000">top</span><span style="color:#000;font-weight:bold">);</span> <span style="color:#000">i</span><span style="color:#ce5c00;font-weight:bold">++</span><span style="color:#000;font-weight:bold">){</span>
</span></span><span style="display:flex;"><span>            <span style="color:#a40000">$</span><span style="color:#000">fact</span> <span style="color:#ce5c00;font-weight:bold">*=</span> <span style="color:#000">i</span><span style="color:#000;font-weight:bold">;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#000;font-weight:bold">}</span>
</span></span><span style="display:flex;"><span>    <span style="color:#ce5c00;font-weight:bold">%</span><span style="color:#000;font-weight:bold">}</span>
</span></span><span style="display:flex;"><span>    <span style="color:#204a87">print</span><span style="color:#000;font-weight:bold">(</span><span style="color:#4e9a06">&#34;Factorial </span><span style="color:#4e9a06">%d</span><span style="color:#4e9a06"> - </span><span style="color:#4e9a06">%s</span><span style="color:#4e9a06">\n</span><span style="color:#4e9a06">&#34;</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#a40000">$</span><span style="color:#000">top</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000;font-weight:bold">:</span><span style="color:#000">StrChar</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">fact</span><span style="color:#000;font-weight:bold">));</span>
</span></span><span style="display:flex;"><span>    <span style="color:#5c35cc;font-weight:bold">@exit</span><span style="color:#000;font-weight:bold">(</span><span style="color:#0000cf;font-weight:bold">0</span><span style="color:#000;font-weight:bold">);</span>
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-cpp" data-lang="cpp"><span style="display:flex;"><span>    <span style="color:#204a87;font-weight:bold">try</span> <span style="color:#000;font-weight:bold">{</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">}</span> <span style="color:#204a87;font-weight:bold">catch</span> <span style="color:#000;font-weight:bold">(</span><span style="color:#000">IntAny</span> <span style="color:#000">ret</span><span style="color:#000;font-weight:bold">)</span> <span style="color:#000;font-weight:bold">{</span>
</span></span><span style="display:flex;"><span>        <span style="color:#000">m_latter</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">ret</span><span style="color:#000;font-weight:bold">.</span><span style="color:#000">m_ret_value</span><span style="color:#000;font-weight:bold">;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">}</span>
</span></span><span style="display:flex;"><span>    <span style="color:#204a87;font-weight:bold">if</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">m_latter</span><span style="color:#ce5c00;font-weight:bold">-&gt;</span><span style="color:#000">op_class_test</span><span style="color:#000;font-weight:bold">(</span><span style="color:#ce5c00;font-weight:bold">:</span><span style="color:#000">Error</span><span style="color:#000;font-weight:bold">)</span> <span style="color:#ce5c00;font-weight:bold">||</span> <span style="color:#000;font-weight:bold">(</span><span style="color:#ce5c00;font-weight:bold">*</span><span style="color:#000">top</span><span style="color:#000;font-weight:bold">)</span> <span style="color:#ce5c00;font-weight:bold">&lt;</span> <span style="color:#0000cf;font-weight:bold">1</span> <span style="color:#000;font-weight:bold">){</span>
</span></span><span style="display:flex;"><span>        <span style="color:#000">print</span><span style="color:#000;font-weight:bold">(</span><span style="color:#4e9a06">&#34;Use: factorial &lt;int&gt;</span><span style="color:#4e9a06">\n</span><span style="color:#4e9a06">&#34;</span><span style="color:#000;font-weight:bold">);</span>
</span></span><span style="display:flex;"><span>        <span style="color:#204a87;font-weight:bold">throw</span> <span style="color:#000">IntMinus</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">Obj</span><span style="color:#ce5c00;font-weight:bold">::</span><span style="color:#000">CreateValue</span><span style="color:#000;font-weight:bold">(</span><span style="color:#0000cf;font-weight:bold">1</span><span style="color:#000;font-weight:bold">));</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">}</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic">//    {%
</span></span></span><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic"></span>        <span style="color:#204a87;font-weight:bold">for</span><span style="color:#000;font-weight:bold">(</span><span style="color:#204a87;font-weight:bold">int</span> <span style="color:#000">i</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#0000cf;font-weight:bold">2</span><span style="color:#000;font-weight:bold">;</span> <span style="color:#000">i</span> <span style="color:#ce5c00;font-weight:bold">&lt;=</span> <span style="color:#204a87;font-weight:bold">static_cast</span><span style="color:#ce5c00;font-weight:bold">&lt;</span><span style="color:#204a87;font-weight:bold">int</span><span style="color:#ce5c00;font-weight:bold">&gt;</span><span style="color:#000;font-weight:bold">((</span><span style="color:#ce5c00;font-weight:bold">*</span><span style="color:#000">top</span><span style="color:#000;font-weight:bold">));</span> <span style="color:#000">i</span><span style="color:#ce5c00;font-weight:bold">++</span><span style="color:#000;font-weight:bold">){</span>
</span></span><span style="display:flex;"><span>            <span style="color:#000;font-weight:bold">(</span><span style="color:#ce5c00;font-weight:bold">*</span><span style="color:#000">fact</span><span style="color:#000;font-weight:bold">)</span> <span style="color:#ce5c00;font-weight:bold">*=</span> <span style="color:#000">i</span><span style="color:#000;font-weight:bold">;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#000;font-weight:bold">}</span>
</span></span><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic">//    %}
</span></span></span></code></pre></div><p><code>nlc -target ??? -compile</code></p>
<blockquote>
<p>compile(source, filename, mode, flag, dont_inherit, optimize)</p>
<p>Параметры:</p>
<pre tabindex="0"><code>   source - обязательный параметр. Может быть обычной строкой, байтовой строкой, 
      либо объектом абстрактного синтаксического дерева.
   filename - обязательный параметр. Имя файла, из которого будет читается код. 
      Если код не будет считан из файла, вы можете написать в качестве параметра любую строку &lt;string&gt;.
   mode - обязательный параметр. Может принимать 3 значения:
       eval, если источником является одно выражение;
       exec,если источником является блок операторов;
       single, если код состоит из одного оператора;
   flag - необязательный параметр. По умолчанию flags=0 и определяет, 
      будет ли скомпилированный код содержать асинхронные операции 
      или какие инструкции из __future__ следует использовать. Указывается битами. 
      Если нужно задать несколько инструкций, то их можно указывать через or;
   dont_inherit - необязательный параметр. По умолчанию dont_inherit=False. 
      Указывает, следует ли использовать future определенные в коде, в дополнение в тем, что указаны во flags;
   optimize - необязательный параметр. По умолчанию optimize=-1.
   Задаёт уровень оптимизации компилятора:
       -1 — использовать настройки интерпретатора (регулируются опцией -O);
       0 — не оптимизировать, включить debug;
       1 — убрать инструкции asserts, выключить debug;
       2 — то, что делает 1 + убрать строки документации.
</code></pre></blockquote>


<div class="pageinfo pageinfo-primary">

</div>


</div>



    
	
  
    
    
	
    

<div class="td-content" style="page-break-before: always">
    
	<h1 id="pg-3a4d642619eb08f47874dbcc8c207079">4.4 - Области видимости</h1>
    
	<p>Управление областью видимости объектов возможно в рамках модуля, пакета и класса.
На область видимости так же влияет и тип объекта (локальный, статический или глобальный).</p>
<p>Явное определение области видимости опредяется по соглашению из языкя Python -
одним или двумя символами подчерка в начале имени объекта.</p>
<p>Один подчерк в начале имени соответствует защищенной области видимости,
а два подчерка - приватной области видимости объекта в модуле, пакете или классе.
Двойные подчерки в начале и в конце имени определяют системное имя.</p>
<p>Объекты модуля:</p>
<table>
<thead>
<tr>
<th style="text-align:left">Определение объекта</th>
<th style="text-align:left">Аналог определения на C++ (или модификатор)</th>
<th style="text-align:center">Общее объявление</th>
<th style="text-align:center">Объявление для пакета</th>
<th style="text-align:center">Доступ по полному имени <em>(из дргуих модулей)</em></th>
<th style="text-align:center">Доступ из других потоков <em>(можно взять ссылку)</em></th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left">::obj_glob</td>
<td style="text-align:left">ObjPtr obj_glob</td>
<td style="text-align:center">да</td>
<td style="text-align:center">да</td>
<td style="text-align:center">да</td>
<td style="text-align:center">да</td>
</tr>
<tr>
<td style="text-align:left">@::obj_static</td>
<td style="text-align:left">ObjPtr obj_static</td>
<td style="text-align:center"><em>нет</em></td>
<td style="text-align:center">да</td>
<td style="text-align:center">да</td>
<td style="text-align:center">да</td>
</tr>
<tr>
<td style="text-align:left">obj_package</td>
<td style="text-align:left">ObjPtr obj_package</td>
<td style="text-align:center"><em>нет</em></td>
<td style="text-align:center">да</td>
<td style="text-align:center">да</td>
<td style="text-align:center"><em>нет</em></td>
</tr>
<tr>
<td style="text-align:left">$obj_local</td>
<td style="text-align:left"><strong>thread_local</strong> ObjPtr obj_local</td>
<td style="text-align:center"><em>нет</em></td>
<td style="text-align:center">да</td>
<td style="text-align:center"><em>нет</em></td>
<td style="text-align:center"><em>нет</em></td>
</tr>
<tr>
<td style="text-align:left"><td colspan="5"><br><strong>Явное ограничение области видимости</strong> <em>(применяется к любому типу объекта)</em></td></td>
<td style="text-align:left"></td>
<td style="text-align:center"></td>
<td style="text-align:center"></td>
<td></td>
<td></td>
</tr>
<tr>
<td style="text-align:left">int_pub:Int32</td>
<td style="text-align:left"><em>int</em> int_pub</td>
<td style="text-align:center">-</td>
<td style="text-align:center">-</td>
<td style="text-align:center">-</td>
<td style="text-align:center">-</td>
</tr>
<tr>
<td style="text-align:left">_int_prot:Int32</td>
<td style="text-align:left"><em>int</em> _int_prot</td>
<td style="text-align:center"><em>нет</em></td>
<td style="text-align:center"><em>нет</em></td>
<td style="text-align:center">-</td>
<td style="text-align:center">-</td>
</tr>
<tr>
<td style="text-align:left">__int_priv:Int32</td>
<td style="text-align:left"><strong>static</strong> <em>int</em> __int_priv</td>
<td style="text-align:center"><em>нет</em></td>
<td style="text-align:center"><em>нет</em></td>
<td style="text-align:center"><em>нет</em></td>
<td style="text-align:center">-</td>
</tr>
</tbody>
</table>
<p>Объекты класса:</p>
<p>Глобальный объект всегда статический, определяется и инициализируется в файле модуля, где он создается.
Время жизни такого объекта ограничено временем жизни модуля.
Достепен по умолчанию во всех областях программы. (есть объявление в include)
Достепен из всех областей программы по полному имени объекта. (нет объявления в include)</p>
<h3 id="области-видимости">Области видимости<a class="td-heading-self-link" href="#%d0%be%d0%b1%d0%bb%d0%b0%d1%81%d1%82%d0%b8-%d0%b2%d0%b8%d0%b4%d0%b8%d0%bc%d0%be%d1%81%d1%82%d0%b8" aria-label="Heading self-link"></a></h3>
<p>Символ подчерка, а так же подчерк в начале имени или двойные подчерки в начале и в конце имени имеют специальное значение.</p>
<p>Один подчерк соответствует защищенной, а два подчерка - приватной области видимости объекта в модуле или классе,
что соответствует принятым соглашениям в языке Python.</p>
<p>Но так же, как и в языке Python, области видимости больше соответствуют &ldquo;джентльменской&rdquo; договоренности и при явном указании имени,
доступ к защищенным объектам можно получить, просто указав полное имя объекта.</p>
<p>В дополнении к этому, существуют еще системные поля и объекты, которые начинаются и заканчиваются на два подчерка.</p>
<ul>
<li>&lsquo;<strong>$</strong>&rsquo; — знак доллара в начале имени обозначает системное (локальное) имя временной переменной,
область памяти для которой выделяется во время выполнения, а время <a href="/ru/docs/syntax/memory/">жизни ограничено семантикой яызка</a></li>
<li>&lsquo;<strong>::</strong>&rsquo; — двойное двоеточие являются разделителем при указании <a href="/ru/docs/syntax/namespace/">пространства имен</a>.
Явное указание пространства имен является признаком статического объекта, область памяти для которого выделяется во время компиляции приложения или модуля.</li>
</ul>

</div>



    
	
  

    
	
  



          </main>
        </div>
      </div>
      <footer class="td-footer row d-print-none">
  <div class="container-fluid">
    <div class="row mx-md-2">
      <div class="td-footer__left col-6 col-sm-4 order-sm-1">
        <ul class="td-footer__links-list">
  
  <li class="td-footer__links-item" data-bs-toggle="tooltip" title="User mailing list" aria-label="User mailing list">
    <a target="_blank" rel="noopener" href="mailto:mail@newlang.net" aria-label="User mailing list">
      <i class="fa fa-envelope"></i>
    </a>
  </li>
  
  <li class="td-footer__links-item" data-bs-toggle="tooltip" title="" aria-label="">
    <a target="_blank" rel="noopener" href="" aria-label="">
      <i class=""></i>
    </a>
  </li>
  
  <li class="td-footer__links-item" data-bs-toggle="tooltip" title="" aria-label="">
    <a target="_blank" rel="noopener" href="" aria-label="">
      <i class=""></i>
    </a>
  </li>
  
</ul>

      </div><div class="td-footer__right col-6 col-sm-4 order-sm-3">
        <ul class="td-footer__links-list">
  
  <li class="td-footer__links-item" data-bs-toggle="tooltip" title="GitHub" aria-label="GitHub">
    <a target="_blank" rel="noopener" href="https://github.com/rsashka/newlang" aria-label="GitHub">
      <i class="fab fa-github"></i>
    </a>
  </li>
  
  <li class="td-footer__links-item" data-bs-toggle="tooltip" title="" aria-label="">
    <a target="_blank" rel="noopener" href="" aria-label="">
      <i class=""></i>
    </a>
  </li>
  
  <li class="td-footer__links-item" data-bs-toggle="tooltip" title="" aria-label="">
    <a target="_blank" rel="noopener" href="" aria-label="">
      <i class=""></i>
    </a>
  </li>
  
</ul>

      </div><div class="td-footer__center col-12 col-sm-4 py-2 order-sm-2">
        <span class="td-footer__copyright">&copy;
    2024
    <span class="td-footer__authors">The NewLang Authors</span></span><span class="td-footer__all_rights_reserved">Все права защищены</span>
      </div>
    </div>
  </div>
</footer>

    </div>
    <script src="/js/main.js"></script>
<script defer src="/js/click-to-copy.js" crossorigin="anonymous"></script>
<script src='/js/tabpane-persist.js'></script>

  </body>
</html>
