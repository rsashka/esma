---
title: Архитектура
weight: 5
description: > 
    Описание реализация архитектуры для лучшего понимания отдельных важных моментов
simple_list: false
---

Ключем поиска объектов явялется строка с полным именем в иерархии имен относительно корня

## Система классов

RunTime - единственный класс для приложения (процесса) - интерфейс для взаимодействия с операционной системой
- Загружат и выгружает модули и является их владельцем (shared_ptr)
- Хранит глобальные объекты (ObjPtr) для глобальных объектов (встроенных типов и функций).
    Ключем явялется строка с полным именем объекта в иерархии имен относительно корня
- Хранит список **глобальных** объектов (типы данных и прототипы функций в TermPtr, которые создаются на этапе компиляции). 
    Используется парсером и компилятором для разбора исходного текста и создания исполняемого файла.

Module - класс для модуля
- Хранение объектов модуля (shared_ptr) и добавляет weak_ptr в глобальный список объектов в RunTime 

Context - класс для хранения временных данных при выполнении программы
- Один класс создается сразу при создании RunTime
- В дальнейшем создается по одному объекту для каждого нового потока (:Thread)
- Хранение списка объектов (weak_ptr<Obj>)
- Хранение локальных объектов (ObjPtr), которые создаются на этапе выполнения



Исходный текст -> Парсинг -> AST (TermPtr) -+->  Компиляция в модуль (LLVM) -> Выполнение модуля
                                            |
                                            +->  Интерпретация (Выполнение AST)



## Шаги сборки компилятора
- Сборка `nlc`
- Генерация с помощью `nlc --no-runtime  --no-dsl -emit-cpp` модуля *dsl*
- Сборка модуля *dsl*
- Генерация с помощью `nlc --no-runtime  -emit-cpp` пакета *runtime*
- Сборка пакета *runtime*

В результате имеем готовый **nlc** с модулями **runtime.nlm** и **dsl.nlm**, а заодно и проверяем:
- генерацию С++ кода без макросов
- сборку модуля
- загрузку модуля
- генерацию С++ кода с макросами
- сборку пакета
- загрузку пакета

Выполнение тестов с модулями **runtime.nlm** и **dsl.nlm**



